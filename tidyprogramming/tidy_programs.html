<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Galen Holt">

<title>Galen Holt - Tidy programming</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<meta property="og:title" content="Galen Holt - Tidy programming">
<meta property="og:description" content="">
<meta property="og:site-name" content="Galen Holt">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Galen Holt</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../research.html" rel="" target="">
 <span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../code_demos.html" rel="" target="" aria-current="page">
 <span class="menu-text">Code Demos</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/galenholt" rel="" target=""><i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://scholar.google.com.au/citations?user=f94WBOoAAAAJ&amp;hl=en" rel="" target=""><i class="bi bi-mortarboard-fill" role="img" aria-label="Google Scholar">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/galen-holt-265aa290" rel="" target=""><i class="bi bi-linkedin" role="img" aria-label="LinkedIn">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://fediscience.org/@galen_holt" rel="" target=""><i class="bi bi-mastodon" role="img" aria-label="Mastodon">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../package/package_creation.html">Building packages</a></li><li class="breadcrumb-item"><a href="../tidyprogramming/tidy_programs.html">Programming with dplyr and rlang</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../code_demos.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Code Demos</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Small how-tos</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../small_helpers/smallpieces.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bits and pieces</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../small_helpers/quarto_notes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quarto notes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../setup/rstudio_themes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Editing Rstudio themes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../small_helpers/zip_downloading.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Download and unpack zips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../small_helpers/json_api_construction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Building JSON syntax from R for API calls</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../small_helpers/list_names.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Naming rules for lists</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../publishing/private_github_figshare.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Creating Figshare from private github</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../small_helpers/error_handling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Intro to error handling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../small_helpers/lifecycle_warnings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Intermittent lifecycle warnings</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../small_helpers/private_github_notes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dealing with private github</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Plotting</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../plotting/ggplot_themes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ggplot themes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../plotting/setting_colors_for_groups.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Consistent colors</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../plotting/tweaks_tricks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Saving and themeing plots</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../plotting/hcl_exploration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exploring HCL colorspace</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../plotting/rgb_to_hex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Converting RGB to hex colors</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../plotting/fonts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Fonts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../plotting/faded_colors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Faded 2d colour ramps</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../plotting/math_in_ggplot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Latex in ggplot with latex2exp</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../plotting/rayshader.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3d plotting with rayshader</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Website</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../website_notes/quarto_website_github.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../website_notes/updating_website.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Updating and maintaining website</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../website_notes/quarto_change_yml.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Avoiding rendering whole site for testing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../website_notes/quarto_images_misc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Figures in quarto</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Theory, simulation, statistics, probability</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../simmodelling/twoDautocorr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generate 2d autocorrelation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../stats_probability/expected_shannon.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bootstrapping the expected shannon diversity</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../stats_probability/fitting_lognormals.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Intro to fitting lognormals</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../stats_probability/shifting_normals.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Basic shifts of normal moments</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../stats_probability/fitting_truncated.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Shifting and fitting truncated lognormals</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Drones</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../drones/overlaps_reactive.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Calculations for flight planning</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../drones/overlaps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Figuring out flight plan calcs</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pix4d/read_pix4d_outputs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Reading and plotting pix4d outputs</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">Observable</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../observable/trying_observable.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Figuring out how to use ojs chunks</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
 <span class="menu-text">R and python</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/python_setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Python environments with pyenv and poetry</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/py_in_rpkg.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Wrapping python in R package</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/RandPython.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using R and python together</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/R_py_shared_projects.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Shared R-py project structure</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/py_r_dates.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Passing complex objects py-R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/R_py_type_passing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Passing types between R and python</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/py_r_project_overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview of building R-py package</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/python_nameerror.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Intermittent NameError py-R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/python_updated_functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Small python bits</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="true">
 <span class="menu-text">Setting up projects</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/rig.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Managing old R versions with rig</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/managingprivate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Private data for website repo</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../setup/R_in_VS.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using R in VScode</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/end_run_renv.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dealing with renv failures</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="true">
 <span class="menu-text">Building packages</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../package/package_creation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">First pass at building a package</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tidyprogramming/tidy_programs.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Programming with dplyr and rlang</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vicwater/vicwater_testing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Testing VicWater API</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" aria-expanded="true">
 <span class="menu-text">Data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../data_acquisition/bom_gauges.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">BOM gauge locations with httr2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vicwater/vicwater_api_howtocall.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Experimenting with API calls for {vicwater}</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../data_acquisition/gauge_data_pre_gauge.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data from pre-gauged periods</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../data_acquisition/ALA_data_pull.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Pulling data from Atlas of Living Australia</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" aria-expanded="true">
 <span class="menu-text">R parallel processing (general)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-11" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../parallelism/interrogating_parallel.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interrogating parallel resources</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../parallelism/nested_parallel.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Testing nested parallelism</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../parallelism/parallel_speed.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Speed-testing parallel</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../parallelism/globals_speed.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Global objects and parallel speed</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../parallelism/nested_dependent_iterations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dependencies of inner parallelism on outer</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-12" aria-expanded="true">
 <span class="menu-text">R parallel processing on HPC</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-12" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-12" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../parallelism/hpc_ephemera.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">HPC notes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../parallelism/plans_and_hpc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using single-machine plans on HPC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../parallelism/initial_future_batchtools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Figuring out future.batchtools</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../parallelism/changing_batchtools_template.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Switching templates, matching to resources</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../parallelism/template_modification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modifying templates</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../parallelism/master_persistence.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Consequences of master timing out</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../parallelism/nested_parallel_hpc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Nested parallel on HPC nodes and cores</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../parallelism/conditional_plans.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Conditional plans for local and HPC</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#the-issue" id="toc-the-issue" class="nav-link active" data-scroll-target="#the-issue">The issue</a></li>
  <li><a href="#passing-to-group_by" id="toc-passing-to-group_by" class="nav-link" data-scroll-target="#passing-to-group_by">Passing to group_by</a></li>
  <li><a href="#passing-to-summarisemutate" id="toc-passing-to-summarisemutate" class="nav-link" data-scroll-target="#passing-to-summarisemutate">Passing to summarise/mutate</a>
  <ul class="collapse">
  <li><a href="#columns-to-operate-on" id="toc-columns-to-operate-on" class="nav-link" data-scroll-target="#columns-to-operate-on">Columns to operate on</a></li>
  <li><a href="#combine-with-group_by" id="toc-combine-with-group_by" class="nav-link" data-scroll-target="#combine-with-group_by">Combine with group_by</a></li>
  <li><a href="#passing-select-syntax" id="toc-passing-select-syntax" class="nav-link" data-scroll-target="#passing-select-syntax">Passing select syntax</a></li>
  <li><a href="#select-syntax-issues" id="toc-select-syntax-issues" class="nav-link" data-scroll-target="#select-syntax-issues">Select syntax issues</a></li>
  <li><a href="#tidyselecteval_select" id="toc-tidyselecteval_select" class="nav-link" data-scroll-target="#tidyselecteval_select">tidyselect::eval_select</a></li>
  </ul></li>
  <li><a href="#functions-to-use" id="toc-functions-to-use" class="nav-link" data-scroll-target="#functions-to-use">Functions to use</a>
  <ul class="collapse">
  <li><a href="#passing-a-function-by-name" id="toc-passing-a-function-by-name" class="nav-link" data-scroll-target="#passing-a-function-by-name">Passing a function by name</a></li>
  <li><a href="#custom-function" id="toc-custom-function" class="nav-link" data-scroll-target="#custom-function">Custom function</a></li>
  <li><a href="#function-with-internal-data-argument" id="toc-function-with-internal-data-argument" class="nav-link" data-scroll-target="#function-with-internal-data-argument">Function with internal data argument</a></li>
  <li><a href="#passing-internal-columns-by-name" id="toc-passing-internal-columns-by-name" class="nav-link" data-scroll-target="#passing-internal-columns-by-name">Passing internal columns by name</a></li>
  <li><a href="#function-with-vector-argument-passed-in" id="toc-function-with-vector-argument-passed-in" class="nav-link" data-scroll-target="#function-with-vector-argument-passed-in">Function with vector argument passed in</a></li>
  </ul></li>
  <li><a href="#multiple-functions--with-appropriate-named-outputs" id="toc-multiple-functions--with-appropriate-named-outputs" class="nav-link" data-scroll-target="#multiple-functions--with-appropriate-named-outputs">Multiple functions- with appropriate named outputs</a>
  <ul class="collapse">
  <li><a href="#simple---hardcoded-number-of-functions" id="toc-simple---hardcoded-number-of-functions" class="nav-link" data-scroll-target="#simple---hardcoded-number-of-functions">Simple - hardcoded number of functions</a></li>
  <li><a href="#variable-number-of-functions" id="toc-variable-number-of-functions" class="nav-link" data-scroll-target="#variable-number-of-functions">Variable number of functions</a></li>
  </ul></li>
  <li><a href="#bringing-it-all-together" id="toc-bringing-it-all-together" class="nav-link" data-scroll-target="#bringing-it-all-together">Bringing it all together</a></li>
  <li><a href="#adjusting-to-dplyr-1.1" id="toc-adjusting-to-dplyr-1.1" class="nav-link" data-scroll-target="#adjusting-to-dplyr-1.1">Adjusting to dplyr 1.1</a>
  <ul class="collapse">
  <li><a href="#re-demoing-the-issue" id="toc-re-demoing-the-issue" class="nav-link" data-scroll-target="#re-demoing-the-issue">Re-demoing the issue</a></li>
  <li><a href="#searching-for-a-solution" id="toc-searching-for-a-solution" class="nav-link" data-scroll-target="#searching-for-a-solution">Searching for a solution</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Tidy programming</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Galen Holt </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<div class="cell" data-hash="tidy_programs_cache/html/setup_75dbd2f0b72914d1e714101b75db91e5">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="the-issue" class="level2">
<h2 class="anchored" data-anchor-id="the-issue">The issue</h2>
<p>Tidyverse, and particularly dplyr and ggplot, are great for quickly doing very powerful rearrangements and calculations of data and making plots. One of the main way they achieve this is by allowing us to use bare variable names- unquoted, no $ syntax. However, that becomes tricky when programming and we might want to pass variables as an argument. Passing other things as arguments can also be a pain, e.g.&nbsp;functions for <code>summarize</code>. I’ve encountered many different things that trip me up, depending on what I’m trying to pass, but my fixes are typically ad-hoc and scattered around my code. I’ll use this doc as a central place to sort out solutions to various problems as they come up. There’s quite a lot of answers <a href="https://cran.r-project.org/web/packages/dplyr/vignettes/programming.html">from dplyr itself</a>, but for some reason I always have to figure things out for myself.</p>
</section>
<section id="passing-to-group_by" class="level2">
<h2 class="anchored" data-anchor-id="passing-to-group_by">Passing to group_by</h2>
<p>let’s say we want to allow the user to pass which functions to group_by. The two usual ways I end up doing this are double-embracing or just using character vectors. Let’s demo and test with a grouped mean for mtcars. Embracing allows the user to pass bare names, chars makes them pass characters and we have to use <code>across(all_of())</code> which is annoying syntax.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-1_59952f56ec5b5d039a0d815a8a0670ad">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># embracing</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>groupbrace <span class="ot">&lt;-</span> <span class="cf">function</span>(data, groupers) {</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  gm <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>({{groupers}}) <span class="sc">%&gt;%</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">meanmpg =</span> <span class="fu">mean</span>(mpg)) <span class="sc">%&gt;%</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(gm)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># characters</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>groupchar <span class="ot">&lt;-</span> <span class="cf">function</span>(data, groupers) {</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  gm <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(groupers))) <span class="sc">%&gt;%</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">meanmpg =</span> <span class="fu">mean</span>(mpg)) <span class="sc">%&gt;%</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(gm)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>How do we use those for a single grouping variable?</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-2_89ea09656d33617df2bb3af4d6f2cf1e">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">groupbrace</span>(mtcars, <span class="at">groupers =</span> gear)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
   gear meanmpg
  &lt;dbl&gt;   &lt;dbl&gt;
1     3    16.1
2     4    24.5
3     5    21.4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">groupchar</span>(mtcars, <span class="at">groupers =</span> <span class="st">'gear'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
   gear meanmpg
  &lt;dbl&gt;   &lt;dbl&gt;
1     3    16.1
2     4    24.5
3     5    21.4</code></pre>
</div>
</div>
<p>What happens when we try to group by more than one column?</p>
<div class="cell" data-hash="tidy_programs_cache/html/error-false_b1306560e26b4d1fcd9de2d719ffcaf6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># groupbrace(mtcars, groupers = c(gear, carb))</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># groupchar(mtcars, groupers = c('gear', 'carb'))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>works with the characters, but the embracing fails (unsurprisingly).</p>
<p>The website says to use <code>…</code>, so we can do that as follows:</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-4_5c8b5bf45c84ef3735aefa5820d3637d">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>groupdots <span class="ot">&lt;-</span> <span class="cf">function</span>(data, ...) {</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  gm <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(...) <span class="sc">%&gt;%</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">meanmpg =</span> <span class="fu">mean</span>(mpg)) <span class="sc">%&gt;%</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(gm)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-5_0a7c82b05c751de1968c7efd3551f0a6">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">groupdots</span>(mtcars, gear, carb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'gear'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 3
    gear  carb meanmpg
   &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
 1     3     1    20.3
 2     3     2    17.2
 3     3     3    16.3
 4     3     4    12.6
 5     4     1    29.1
 6     4     2    24.8
 7     4     4    19.8
 8     5     2    28.2
 9     5     4    15.8
10     5     6    19.7
11     5     8    15  </code></pre>
</div>
</div>
<p>That works, but it becomes an issue if we’re ALSO supplying arguments for other things in the function. See below.</p>
<p>The website only uses the dots example, but <code>across()</code> works like it does with <code>summarize</code>. This I think ends up being the answer for bare variable names that don’t get mixed up between grouping and summarizing. See below.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-6_5cf9dc6871b7fc0cc068f97dbc9a4fd3">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>groupacross <span class="ot">&lt;-</span> <span class="cf">function</span>(data, groupers) {</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  gm <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="fu">across</span>({{groupers}})) <span class="sc">%&gt;%</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">meanmpg =</span> <span class="fu">mean</span>(mpg)) <span class="sc">%&gt;%</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(gm)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-7_019800d06c8c5bf091bd42cd1623d400">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">groupacross</span>(mtcars, <span class="fu">c</span>(gear, carb))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'gear'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 3
    gear  carb meanmpg
   &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
 1     3     1    20.3
 2     3     2    17.2
 3     3     3    16.3
 4     3     4    12.6
 5     4     1    29.1
 6     4     2    24.8
 7     4     4    19.8
 8     5     2    28.2
 9     5     4    15.8
10     5     6    19.7
11     5     8    15  </code></pre>
</div>
</div>
</section>
<section id="passing-to-summarisemutate" class="level2">
<h2 class="anchored" data-anchor-id="passing-to-summarisemutate">Passing to summarise/mutate</h2>
<p>I’m going to set this up with a simple group_by in all cases because it sets up the combo, and I almost never actually call summarise on a full dataset anyway.</p>
<section id="columns-to-operate-on" class="level3">
<h3 class="anchored" data-anchor-id="columns-to-operate-on">Columns to operate on</h3>
<p>If we just want one column, but the user supplies its name, we can again embrace or quote.</p>
<p>Names is an issue here too. They can just be left as a fixed value, but if we want to have the name of the new column reflect what’s being passed in, we handle that in different ways. With the braces we use the glue :=, and the .names argument if characters.</p>
<p>Now, the dots don’t seem to work to pass multiple bare names, I think probably because of issues with names? But we can modify the simple embraced version to use across(), making it more similar to the character version.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-8_7ffad3fd896f284f235a77a6375b4092">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># embracing</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>sumbrace <span class="ot">&lt;-</span> <span class="cf">function</span>(data, sumcols) {</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  gm <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(gear) <span class="sc">%&gt;%</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="st">"mean_{{sumcols}}"</span> <span class="sc">:</span><span class="er">=</span> <span class="fu">mean</span>({{sumcols}})) <span class="sc">%&gt;%</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(gm)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co"># characters</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>sumchar <span class="ot">&lt;-</span> <span class="cf">function</span>(data, sumcols) {</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  gm <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(gear) <span class="sc">%&gt;%</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(sumcols), mean, <span class="at">.names =</span> <span class="st">'mean_{.col}'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(gm)</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="co"># mulitple bare</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>sumbaremulti <span class="ot">&lt;-</span> <span class="cf">function</span>(data, sumcols) {</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>  gm <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(gear) <span class="sc">%&gt;%</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="fu">across</span>({{sumcols}}, mean, <span class="at">.names =</span> <span class="st">'mean_{.col}'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(gm)</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With a single user-supplied column</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-9_ee926865049bba5985c1d807a96e73ab">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sumbrace</span>(mtcars, <span class="at">sumcols =</span> mpg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
   gear mean_mpg
  &lt;dbl&gt;    &lt;dbl&gt;
1     3     16.1
2     4     24.5
3     5     21.4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sumchar</span>(mtcars, <span class="at">sumcols =</span> <span class="st">'mpg'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
   gear mean_mpg
  &lt;dbl&gt;    &lt;dbl&gt;
1     3     16.1
2     4     24.5
3     5     21.4</code></pre>
</div>
</div>
<p>Multiple user-supplied cols</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-10_fd8ed04a97ef9e1a44c6b0ba65996a6f">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sumbaremulti</span>(mtcars, <span class="at">sumcols =</span> <span class="fu">c</span>(mpg, hp))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
   gear mean_mpg mean_hp
  &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;
1     3     16.1   176. 
2     4     24.5    89.5
3     5     21.4   196. </code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sumchar</span>(mtcars, <span class="at">sumcols =</span> <span class="fu">c</span>(<span class="st">'mpg'</span>, <span class="st">'hp'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
   gear mean_mpg mean_hp
  &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;
1     3     16.1   176. 
2     4     24.5    89.5
3     5     21.4   196. </code></pre>
</div>
</div>
</section>
<section id="combine-with-group_by" class="level3">
<h3 class="anchored" data-anchor-id="combine-with-group_by">Combine with group_by</h3>
<p>I often want to pass a set of variable names to group_by <em>and</em> a set of names to summarize. If we use the dots method, these would get all jumbled together. So the options are embracing or characters, and when embracing we still need the c(bare1, bare2, …, bareN) so each component is a single argument.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-11_4323ef9188c31b9d1f7ae0af63c8a097">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># characters</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>gsumchar <span class="ot">&lt;-</span> <span class="cf">function</span>(data, groupers, sumcols) {</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  gm <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(groupers))) <span class="sc">%&gt;%</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(sumcols), mean, <span class="at">.names =</span> <span class="st">'mean_{.col}'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(gm)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="co"># mulitple bare</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>gsumbaremulti <span class="ot">&lt;-</span> <span class="cf">function</span>(data, groupers, sumcols) {</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>  gm <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="fu">across</span>({{groupers}})) <span class="sc">%&gt;%</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="fu">across</span>({{sumcols}}, mean, <span class="at">.names =</span> <span class="st">'mean_{.col}'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(gm)</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we can feed it multiple grouping columns and multiple summary columns</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-12_433bf9e023c1e52d3491ef1ffa9022a0">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gsumbaremulti</span>(mtcars, <span class="at">groupers =</span> <span class="fu">c</span>(gear, carb), <span class="at">sumcols =</span> <span class="fu">c</span>(mpg, hp))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'gear'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 4
    gear  carb mean_mpg mean_hp
   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;
 1     3     1     20.3   104  
 2     3     2     17.2   162. 
 3     3     3     16.3   180  
 4     3     4     12.6   228  
 5     4     1     29.1    72.5
 6     4     2     24.8    79.5
 7     4     4     19.8   116. 
 8     5     2     28.2   102  
 9     5     4     15.8   264  
10     5     6     19.7   175  
11     5     8     15     335  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gsumchar</span>(mtcars, <span class="at">groupers =</span> <span class="fu">c</span>(<span class="st">'gear'</span>, <span class="st">'carb'</span>), <span class="at">sumcols =</span> <span class="fu">c</span>(<span class="st">'mpg'</span>, <span class="st">'hp'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'gear'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 4
    gear  carb mean_mpg mean_hp
   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;
 1     3     1     20.3   104  
 2     3     2     17.2   162. 
 3     3     3     16.3   180  
 4     3     4     12.6   228  
 5     4     1     29.1    72.5
 6     4     2     24.8    79.5
 7     4     4     19.8   116. 
 8     5     2     28.2   102  
 9     5     4     15.8   264  
10     5     6     19.7   175  
11     5     8     15     335  </code></pre>
</div>
</div>
<p>It’s really not clear why I’d ever use the dots version, or why we wouldn’t always use the across() wrap to give us generality. I guess if that generality isn’t needed? But while dots can be handy, they’re vague and it’s not like the across() wrap is hard to type.</p>
<p>What this makes very clear is the similarity between the two methods- they’re really just using the <code>select()</code> syntax in the <code>across()</code>, but one has to embrace bare names and the other uses the <code>all_of()</code> modifier we always have to include when we want to <code>select()</code> with a character vector.</p>
</section>
<section id="passing-select-syntax" class="level3">
<h3 class="anchored" data-anchor-id="passing-select-syntax">Passing select syntax</h3>
<p>Since we’re using that <code>across</code>, is it possible to pass other <code>select()</code> syntax than variable names? e.g.&nbsp;<code>is.numeric</code>, <code>starts_with()</code> or <code>b:f</code>? Let’s test it just with the summarize bit.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-13_6172379f208236be44d80f886a83f983">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gsumbaremulti</span>(mtcars, </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">groupers =</span> <span class="fu">c</span>(gear, carb), </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">sumcols =</span> is.numeric)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There was 1 warning in `summarise()`.
ℹ In argument: `across(is.numeric, mean, .names = "mean_{.col}")`.
Caused by warning:
! Use of bare predicate functions was deprecated in tidyselect 1.1.0.
ℹ Please use wrap predicates in `where()` instead.
  # Was:
  data %&gt;% select(is.numeric)

  # Now:
  data %&gt;% select(where(is.numeric))</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'gear'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 11
    gear  carb mean_mpg mean_cyl mean_disp mean_hp mean_drat mean_wt mean_qsec
   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;
 1     3     1     20.3     5.33     201.    104        3.18    3.05      19.9
 2     3     2     17.2     8        346.    162.       3.04    3.56      17.1
 3     3     3     16.3     8        276.    180        3.07    3.86      17.7
 4     3     4     12.6     8        416.    228        3.22    4.69      16.9
 5     4     1     29.1     4         84.2    72.5      4.06    2.07      19.2
 6     4     2     24.8     4        121.     79.5      4.16    2.68      20.0
 7     4     4     19.8     6        164.    116.       3.91    3.09      17.7
 8     5     2     28.2     4        108.    102        4.1     1.83      16.8
 9     5     4     15.8     8        351     264        4.22    3.17      14.5
10     5     6     19.7     6        145     175        3.62    2.77      15.5
11     5     8     15       8        301     335        3.54    3.57      14.6
# ℹ 2 more variables: mean_vs &lt;dbl&gt;, mean_am &lt;dbl&gt;</code></pre>
</div>
</div>
<p>That works but is angry about missing <code>where()</code>. Just throwing the bare <code>select</code> syntax straight in works though, for the <code>where()</code> type arguments but seems to be general- works for <code>col:col</code> and <code>starts_with()</code> as well.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-14_a5495a7b9a08a7d5c40af5116545cf22">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gsumbaremulti</span>(mtcars, </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">groupers =</span> <span class="fu">c</span>(gear, carb), </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">sumcols =</span> <span class="fu">where</span>(is.numeric))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'gear'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 11
    gear  carb mean_mpg mean_cyl mean_disp mean_hp mean_drat mean_wt mean_qsec
   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;
 1     3     1     20.3     5.33     201.    104        3.18    3.05      19.9
 2     3     2     17.2     8        346.    162.       3.04    3.56      17.1
 3     3     3     16.3     8        276.    180        3.07    3.86      17.7
 4     3     4     12.6     8        416.    228        3.22    4.69      16.9
 5     4     1     29.1     4         84.2    72.5      4.06    2.07      19.2
 6     4     2     24.8     4        121.     79.5      4.16    2.68      20.0
 7     4     4     19.8     6        164.    116.       3.91    3.09      17.7
 8     5     2     28.2     4        108.    102        4.1     1.83      16.8
 9     5     4     15.8     8        351     264        4.22    3.17      14.5
10     5     6     19.7     6        145     175        3.62    2.77      15.5
11     5     8     15       8        301     335        3.54    3.57      14.6
# ℹ 2 more variables: mean_vs &lt;dbl&gt;, mean_am &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-15_3c0dffee165df71aa0e2d872db6dff60">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gsumbaremulti</span>(mtcars, </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">groupers =</span> <span class="fu">c</span>(gear, carb), </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">sumcols =</span> mpg<span class="sc">:</span>disp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'gear'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 5
    gear  carb mean_mpg mean_cyl mean_disp
   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
 1     3     1     20.3     5.33     201. 
 2     3     2     17.2     8        346. 
 3     3     3     16.3     8        276. 
 4     3     4     12.6     8        416. 
 5     4     1     29.1     4         84.2
 6     4     2     24.8     4        121. 
 7     4     4     19.8     6        164. 
 8     5     2     28.2     4        108. 
 9     5     4     15.8     8        351  
10     5     6     19.7     6        145  
11     5     8     15       8        301  </code></pre>
</div>
</div>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-16_d7616ec5a9951e181c6c4ccdd45839b7">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gsumbaremulti</span>(mtcars, </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">groupers =</span> <span class="fu">c</span>(gear, carb), </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">sumcols =</span> <span class="fu">starts_with</span>(<span class="st">'d'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'gear'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 4
    gear  carb mean_disp mean_drat
   &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
 1     3     1     201.       3.18
 2     3     2     346.       3.04
 3     3     3     276.       3.07
 4     3     4     416.       3.22
 5     4     1      84.2      4.06
 6     4     2     121.       4.16
 7     4     4     164.       3.91
 8     5     2     108.       4.1 
 9     5     4     351        4.22
10     5     6     145        3.62
11     5     8     301        3.54</code></pre>
</div>
</div>
</section>
<section id="select-syntax-issues" class="level3">
<h3 class="anchored" data-anchor-id="select-syntax-issues">Select syntax issues</h3>
<p>Sometimes we might want to pass a vector of columns to select, but have those that don’t exist get ignored- basically, select however many of this set of columns exist in the dataset. With a character vector, that’s straightforward with <code>any_of</code>. But it fails with bare names, and <code>any_of</code> requires characters.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-17_4f1a15568d4b089ac536a9cf9dad93fb">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># These both fail</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">c</span>(mpg, fakecolumn))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in `select()`:
! Can't subset columns that don't exist.
✖ Column `fakecolumn` doesn't exist.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">any_of</span>(mpg, fakecolumn))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in `select()`:
! Problem while evaluating `any_of(mpg, fakecolumn)`.
Caused by error in `any_of()`:
! `...` must be empty.
ℹ Did you forget `c()`?
ℹ The expected syntax is `any_of(c("a", "b"))`, not `any_of("a", "b")`</code></pre>
</div>
</div>
<p>An obvious solution is to use character vectors.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-18_57aef20852a5715098154257ae6702f6">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">any_of</span>(<span class="fu">c</span>(<span class="st">'mpg'</span>, <span class="st">'fakecolumn'</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                     mpg
Mazda RX4           21.0
Mazda RX4 Wag       21.0
Datsun 710          22.8
Hornet 4 Drive      21.4
Hornet Sportabout   18.7
Valiant             18.1
Duster 360          14.3
Merc 240D           24.4
Merc 230            22.8
Merc 280            19.2
Merc 280C           17.8
Merc 450SE          16.4
Merc 450SL          17.3
Merc 450SLC         15.2
Cadillac Fleetwood  10.4
Lincoln Continental 10.4
Chrysler Imperial   14.7
Fiat 128            32.4
Honda Civic         30.4
Toyota Corolla      33.9
Toyota Corona       21.5
Dodge Challenger    15.5
AMC Javelin         15.2
Camaro Z28          13.3
Pontiac Firebird    19.2
Fiat X1-9           27.3
Porsche 914-2       26.0
Lotus Europa        30.4
Ford Pantera L      15.8
Ferrari Dino        19.7
Maserati Bora       15.0
Volvo 142E          21.4</code></pre>
</div>
</div>
<p>But does that then preclude using other tidyselect syntax such as :, starts_with, etc? Sure, we can swap back and forth if we’re accessing select directly, but not if this is embedded in a function. The answer is sometimes- it works with <code>starts_with</code> but not <code>:</code> (not really shown here because it fails).</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-19_dc16826fa8e9ed1c4ba8ed766f9a56e3">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">any_of</span>(<span class="fu">starts_with</span>(<span class="st">'d'</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                     disp drat
Mazda RX4           160.0 3.90
Mazda RX4 Wag       160.0 3.90
Datsun 710          108.0 3.85
Hornet 4 Drive      258.0 3.08
Hornet Sportabout   360.0 3.15
Valiant             225.0 2.76
Duster 360          360.0 3.21
Merc 240D           146.7 3.69
Merc 230            140.8 3.92
Merc 280            167.6 3.92
Merc 280C           167.6 3.92
Merc 450SE          275.8 3.07
Merc 450SL          275.8 3.07
Merc 450SLC         275.8 3.07
Cadillac Fleetwood  472.0 2.93
Lincoln Continental 460.0 3.00
Chrysler Imperial   440.0 3.23
Fiat 128             78.7 4.08
Honda Civic          75.7 4.93
Toyota Corolla       71.1 4.22
Toyota Corona       120.1 3.70
Dodge Challenger    318.0 2.76
AMC Javelin         304.0 3.15
Camaro Z28          350.0 3.73
Pontiac Firebird    400.0 3.08
Fiat X1-9            79.0 4.08
Porsche 914-2       120.3 4.43
Lotus Europa         95.1 3.77
Ford Pantera L      351.0 4.22
Ferrari Dino        145.0 3.62
Maserati Bora       301.0 3.54
Volvo 142E          121.0 4.11</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mtcars %&gt;% select(any_of(hp:wt))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Is the trick to pass it the whole <code>any_of</code> expression? that IS a tidyselect call. Try it in the function directly, to get all the <code>across</code> in there correctly. First, this fails if we just pass extra columns:</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-20_3c0b99eeeef8d1855fb6417a605d4d68">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># gsumbaremulti(mtcars, </span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="co">#               groupers = c(gear, carb), </span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="co">#               sumcols = c(mpg, fakecol))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we know some might not exist, we can instead pass the whole any_of and character names. Is this cleaner? No, now we’re back to characters, but ALSO needing to pass the any_of. So why do it? if we sometimes also need to pass other tidyselect syntax.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-21_4c393154c60efeda77c51bf3e0e6c461">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gsumbaremulti</span>(mtcars, </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">groupers =</span> <span class="fu">c</span>(gear, carb), </span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">sumcols =</span> <span class="fu">any_of</span>(<span class="fu">c</span>(<span class="st">'mpg'</span>, <span class="st">'fakecol'</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'gear'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 3
    gear  carb mean_mpg
   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;
 1     3     1     20.3
 2     3     2     17.2
 3     3     3     16.3
 4     3     4     12.6
 5     4     1     29.1
 6     4     2     24.8
 7     4     4     19.8
 8     5     2     28.2
 9     5     4     15.8
10     5     6     19.7
11     5     8     15  </code></pre>
</div>
</div>
<p>Now, what if <em>that</em> is in turn buried in a function, so we need to set the argument outside the call? This might happen if we have a user interface where they choose columns. For example, they might set the cols, and then call a function that calls what we have above.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-22_42333e2d0e6aaccb440f1379b1f03558">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>whichcols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'mpg'</span>, <span class="st">'fakecol'</span>)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="fu">gsumbaremulti</span>(mtcars, </span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">groupers =</span> <span class="fu">c</span>(gear, carb), </span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">sumcols =</span> <span class="fu">any_of</span>(whichcols))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'gear'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 3
    gear  carb mean_mpg
   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;
 1     3     1     20.3
 2     3     2     17.2
 3     3     3     16.3
 4     3     4     12.6
 5     4     1     29.1
 6     4     2     24.8
 7     4     4     19.8
 8     5     2     28.2
 9     5     4     15.8
10     5     6     19.7
11     5     8     15  </code></pre>
</div>
</div>
<p>That’s easy enough. But what if whichcols could be tidyselect syntax? That can’t be saved to an object. It <em>can</em> be saved with <code>expr</code>, but then <em>that</em> has to be unpacked with <code>!!</code>.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-23_23403bb1b3b866aa10b4645645ab4bee">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fails</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="co"># whichcols &lt;- starts_with('m')</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>whichcols <span class="ot">&lt;-</span> <span class="fu">expr</span>(<span class="fu">starts_with</span>(<span class="st">'m'</span>))</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="fu">gsumbaremulti</span>(mtcars, </span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">groupers =</span> <span class="fu">c</span>(gear, carb), </span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">sumcols =</span> <span class="sc">!!</span>whichcols)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'gear'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 3
    gear  carb mean_mpg
   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;
 1     3     1     20.3
 2     3     2     17.2
 3     3     3     16.3
 4     3     4     12.6
 5     4     1     29.1
 6     4     2     24.8
 7     4     4     19.8
 8     5     2     28.2
 9     5     4     15.8
10     5     6     19.7
11     5     8     15  </code></pre>
</div>
</div>
<p>That allows passing tidyselect, but does it break the <code>any_of</code> situation? Not if we wrap it in expr.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-24_1e1f459fcbac0efbddf290ff8ff12023">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>whichcols <span class="ot">&lt;-</span> <span class="fu">expr</span>(<span class="fu">any_of</span>(<span class="fu">c</span>(<span class="st">'mpg'</span>, <span class="st">'fakecol'</span>)))</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="fu">gsumbaremulti</span>(mtcars, </span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">groupers =</span> <span class="fu">c</span>(gear, carb), </span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">sumcols =</span> <span class="sc">!!</span>whichcols)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'gear'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 3
    gear  carb mean_mpg
   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;
 1     3     1     20.3
 2     3     2     17.2
 3     3     3     16.3
 4     3     4     12.6
 5     4     1     29.1
 6     4     2     24.8
 7     4     4     19.8
 8     5     2     28.2
 9     5     4     15.8
10     5     6     19.7
11     5     8     15  </code></pre>
</div>
</div>
<p>That means that if we might have a character vector and might have tidyselect, we can have a multi-step process to create the expression and pass it to the function. Ie the user can set whichcols directly as an <code>expr</code>-wrapped tidyselect, OR if a character vector it makes it itself. See the next two code blocks.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-25_f2e3f4a3fc41dfa0f24925c4d7ee35d2">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>colstosum <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'mpg'</span>, <span class="st">'fakecol'</span>)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="co"># colstosum &lt;- expr(starts_with('d'))</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">is.character</span>(colstosum)) {</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>  whichcols <span class="ot">&lt;-</span> <span class="fu">expr</span>(<span class="fu">any_of</span>(colstosum))</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>  whichcols <span class="ot">&lt;-</span> colstosum</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a><span class="fu">gsumbaremulti</span>(mtcars, </span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>              <span class="at">groupers =</span> <span class="fu">c</span>(gear, carb), </span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>              <span class="at">sumcols =</span> <span class="sc">!!</span>whichcols)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'gear'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 3
    gear  carb mean_mpg
   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;
 1     3     1     20.3
 2     3     2     17.2
 3     3     3     16.3
 4     3     4     12.6
 5     4     1     29.1
 6     4     2     24.8
 7     4     4     19.8
 8     5     2     28.2
 9     5     4     15.8
10     5     6     19.7
11     5     8     15  </code></pre>
</div>
</div>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-26_2251b7047b2c9d976186231c615d11bc">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>colstosum <span class="ot">&lt;-</span> <span class="fu">expr</span>(<span class="fu">starts_with</span>(<span class="st">'d'</span>))</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">is.character</span>(colstosum)) {</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>  whichcols <span class="ot">&lt;-</span> <span class="fu">expr</span>(<span class="fu">any_of</span>(colstosum))</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>  whichcols <span class="ot">&lt;-</span> colstosum</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a><span class="fu">gsumbaremulti</span>(mtcars, </span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">groupers =</span> <span class="fu">c</span>(gear, carb), </span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>              <span class="at">sumcols =</span> <span class="sc">!!</span>whichcols)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'gear'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 4
    gear  carb mean_disp mean_drat
   &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
 1     3     1     201.       3.18
 2     3     2     346.       3.04
 3     3     3     276.       3.07
 4     3     4     416.       3.22
 5     4     1      84.2      4.06
 6     4     2     121.       4.16
 7     4     4     164.       3.91
 8     5     2     108.       4.1 
 9     5     4     351        4.22
10     5     6     145        3.62
11     5     8     301        3.54</code></pre>
</div>
</div>
<p>Because that’s ugly, I’m not going to spend more time on it, but it is a workaround for sometimes needing to pass tidyselect syntax and sometimes column names that might not exist. There’s likely a more general way to do this using <code>tidyselect::eval_select</code>, but what I have here will work for now.</p>
</section>
<section id="tidyselecteval_select" class="level3">
<h3 class="anchored" data-anchor-id="tidyselecteval_select">tidyselect::eval_select</h3>
<p>I’m now running into issues where the approach above isn’t working well, because sometimes the expression ends up including the name of an object (e.g.&nbsp;a passed-in character vector), and by the time we get to the <code>{{}}</code>, we’re too far into the call stack and it ends up failing because it essentially tries to do something like <code>group_by(starts_with(NAME_OF_VECTOR))</code> instead of <code>group_by(starts_with(VALUES_IN_VECTOR)</code>.</p>
<p>So, one way to handle this is to in the outer layer use <code>tidyselect::eval_select</code> in the outer layer to get column names and indices. Then we can just pass those around rather than all the promises that get lost doing it other ways. It’s a bit cruder, but i think will involve less gymnastics.</p>
<section id="how-does-eval_select-work" class="level4">
<h4 class="anchored" data-anchor-id="how-does-eval_select-work">How does eval_select work?</h4>
<p>First, how does <code>eval_select</code> work? What do we need to feed it?</p>
<p>A bare tidyselect function fails</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-27_a83674ce8ce2db97c37f2715f22f7afa">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>colstosum <span class="ot">&lt;-</span> <span class="fu">starts_with</span>(<span class="st">'d'</span>)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>tidyselect<span class="sc">::</span><span class="fu">eval_select</span>(colstosum, mtcars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Works if wrapped in <code>expr</code></p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-28_1a55d3a05f0aa7fa83114d93f3293aa3">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>colstosum <span class="ot">&lt;-</span> <span class="fu">expr</span>(<span class="fu">starts_with</span>(<span class="st">'d'</span>))</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>tidyselect<span class="sc">::</span><span class="fu">eval_select</span>(colstosum, mtcars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>disp drat 
   3    5 </code></pre>
</div>
</div>
<p>Works with character vectors.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-29_542662215808d7d6f4629509a80e8b0b">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>colstosum <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'disp'</span>, <span class="st">'mpg'</span>)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>tidyselect<span class="sc">::</span><span class="fu">eval_select</span>(colstosum, mtcars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>disp  mpg 
   3    1 </code></pre>
</div>
</div>
<p>Does <em>not</em> work if there are values in the character vector that aren’t in the data.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-30_c0eb2d7931c036a9b622dc8761f49c64">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>colstosum <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'disp'</span>, <span class="st">'mpg'</span>, <span class="st">'notinmtcars'</span>)</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>tidyselect<span class="sc">::</span><span class="fu">eval_select</span>(colstosum, mtcars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>So we likely still need the conditional to use <code>any_of</code></p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-31_30d67c4f47a189e7947fa8e761f0d9f1">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>colstosum <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'disp'</span>, <span class="st">'mpg'</span>, <span class="st">'notinmtcars'</span>)</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">is.character</span>(colstosum)) {</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>  whichcols <span class="ot">&lt;-</span> <span class="fu">expr</span>(<span class="fu">any_of</span>(colstosum))</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>  whichcols <span class="ot">&lt;-</span> colstosum</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>tidyselect<span class="sc">::</span><span class="fu">eval_select</span>(whichcols, mtcars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>disp  mpg 
   3    1 </code></pre>
</div>
</div>
<p>And, what if we pass an argument to a tidyselect? I don’t think this is enough to break the original way without some intervening function calls, but it’s the same idea that’s breaking it as we move down a stack.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-32_25b6c3c33c7fc7de8d3b4f71bb7c686b">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>startletter <span class="ot">&lt;-</span> <span class="st">'d'</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>colstosum <span class="ot">&lt;-</span> <span class="fu">expr</span>(<span class="fu">starts_with</span>(startletter))</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>tidyselect<span class="sc">::</span><span class="fu">eval_select</span>(colstosum, mtcars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>disp drat 
   3    5 </code></pre>
</div>
</div>
<p>What actually is that returning? A named vector of indices.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-33_e443a2cc67908c15dc38f04e88d7caa8">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>tsout <span class="ot">&lt;-</span> tidyselect<span class="sc">::</span><span class="fu">eval_select</span>(colstosum, mtcars)</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(tsout)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Named int [1:2] 3 5
 - attr(*, "names")= chr [1:2] "disp" "drat"</code></pre>
</div>
</div>
<p>So, with the conditional in there to guard against grabbing things that don’t exist, that looks like it should work by basically transporting around our selects as character vectors or indices if we evaluate them early enough. In the sort of uses I’m imagining- evaluating this early, and then passing in to further functions- I’d be <em>really</em> nervous about using indices, and so would tend to use the names. How might that work?</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-34_9d7a649a5559411a5938f933d8cd9397">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gsumbaremulti</span>(mtcars, </span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">groupers =</span> <span class="fu">c</span>(gear, carb), </span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">sumcols =</span> <span class="fu">names</span>(tsout))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'gear'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 4
    gear  carb mean_disp mean_drat
   &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
 1     3     1     201.       3.18
 2     3     2     346.       3.04
 3     3     3     276.       3.07
 4     3     4     416.       3.22
 5     4     1      84.2      4.06
 6     4     2     121.       4.16
 7     4     4     164.       3.91
 8     5     2     108.       4.1 
 9     5     4     351        4.22
10     5     6     145        3.62
11     5     8     301        3.54</code></pre>
</div>
</div>
</section>
<section id="a-function-to-parse-eval_select" class="level4">
<h4 class="anchored" data-anchor-id="a-function-to-parse-eval_select">A function to parse eval_select</h4>
<p>What if I actually make the function do the parsing? So I can pass it the characters, bare names, or <code>expr(selectsyntax)</code>?</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-35_e9b2669d40b57d3e93b8eeb5adbe5c42">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>gsumtidy <span class="ot">&lt;-</span> <span class="cf">function</span>(data, groupers, sumcols) {</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.character</span>(groupers)) {</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>    whichg <span class="ot">&lt;-</span> <span class="fu">expr</span>(<span class="fu">any_of</span>(groupers))</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>    whichg <span class="ot">&lt;-</span> groupers</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.character</span>(sumcols)) {</span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>    whichs <span class="ot">&lt;-</span> <span class="fu">expr</span>(<span class="fu">any_of</span>(sumcols)) </span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a>    whichs <span class="ot">&lt;-</span> sumcols</span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a>  gnames <span class="ot">&lt;-</span> whichg <span class="sc">%&gt;%</span> </span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a>    tidyselect<span class="sc">::</span><span class="fu">eval_select</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb88-17"><a href="#cb88-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>()</span>
<span id="cb88-18"><a href="#cb88-18" aria-hidden="true" tabindex="-1"></a>  snames <span class="ot">&lt;-</span> whichs <span class="sc">%&gt;%</span> </span>
<span id="cb88-19"><a href="#cb88-19" aria-hidden="true" tabindex="-1"></a>    tidyselect<span class="sc">::</span><span class="fu">eval_select</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb88-20"><a href="#cb88-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>()</span>
<span id="cb88-21"><a href="#cb88-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb88-22"><a href="#cb88-22" aria-hidden="true" tabindex="-1"></a>  gm <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb88-23"><a href="#cb88-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="fu">across</span>({{gnames}})) <span class="sc">%&gt;%</span></span>
<span id="cb88-24"><a href="#cb88-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="fu">across</span>({{snames}}, mean, <span class="at">.names =</span> <span class="st">'mean_{.col}'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb88-25"><a href="#cb88-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb88-26"><a href="#cb88-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(gm)</span>
<span id="cb88-27"><a href="#cb88-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb88-28"><a href="#cb88-28" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Test that with different sorts of things.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-36_f350130b12a9973a09a84b6772465526">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gsumtidy</span>(mtcars, </span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">groupers =</span> <span class="st">'cyl'</span>, </span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">sumcols =</span> <span class="fu">expr</span>(<span class="fu">starts_with</span>(<span class="st">'d'</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
    cyl mean_disp mean_drat
  &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1     4      105.      4.07
2     6      183.      3.59
3     8      353.      3.23</code></pre>
</div>
</div>
<p>How about if we include extra cols? works fine.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-37_9b2d66bf09147f70fac89a38b01654a6">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gsumtidy</span>(mtcars, </span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">groupers =</span> <span class="fu">c</span>(<span class="st">'cyl'</span>, <span class="st">'notinmtcars'</span>), </span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">sumcols =</span> <span class="fu">expr</span>(<span class="fu">starts_with</span>(<span class="st">'d'</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
    cyl mean_disp mean_drat
  &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1     4      105.      4.07
2     6      183.      3.59
3     8      353.      3.23</code></pre>
</div>
</div>
<p>The whole top part of that could be its own function, and get run at any point in a call stack. Returning the names and not the indices, but could return the whole thing I guess, depending on safety of indices.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-38_93ff8eedc1daeb1920d0df0cee4180e3">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>selectnames <span class="ot">&lt;-</span> <span class="cf">function</span>(data, selector) {</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.character</span>(selector)) {</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>    whichg <span class="ot">&lt;-</span> <span class="fu">expr</span>(<span class="fu">any_of</span>(selector))</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>    whichg <span class="ot">&lt;-</span> selector</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>  selnames <span class="ot">&lt;-</span> whichg <span class="sc">%&gt;%</span> </span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>    tidyselect<span class="sc">::</span><span class="fu">eval_select</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>()</span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(selnames)</span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-39_9e51d832e19428934480f545729a06ec">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>gtidysimple <span class="ot">&lt;-</span> <span class="cf">function</span>(data, groupers, sumcols) {</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>  gnames <span class="ot">&lt;-</span> <span class="fu">selectnames</span>(data, groupers)</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>  snames <span class="ot">&lt;-</span> <span class="fu">selectnames</span>(data, sumcols)</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>  gm <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="fu">across</span>({{gnames}})) <span class="sc">%&gt;%</span></span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="fu">across</span>({{snames}}, mean, <span class="at">.names =</span> <span class="st">'mean_{.col}'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(gm)</span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-40_644a845b1ead0d616da34f9c227f2cd8">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gtidysimple</span>(mtcars, </span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">groupers =</span> <span class="fu">c</span>(<span class="st">'cyl'</span>, <span class="st">'notinmtcars'</span>), </span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">sumcols =</span> <span class="fu">expr</span>(<span class="fu">starts_with</span>(<span class="st">'d'</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
    cyl mean_disp mean_drat
  &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1     4      105.      4.07
2     6      183.      3.59
3     8      353.      3.23</code></pre>
</div>
</div>
</section>
<section id="expr-vs-enquo" class="level4">
<h4 class="anchored" data-anchor-id="expr-vs-enquo">expr() vs enquo()</h4>
<p>The above needs to wrap tidyselect syntax with expr to work- passing the bare <code>starts_with</code> fails</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-41_5eaf2e0108bc457b72bf858f8f844b7d">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gtidysimple</span>(mtcars, </span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">groupers =</span> <span class="fu">c</span>(<span class="st">'cyl'</span>, <span class="st">'notinmtcars'</span>), </span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">sumcols =</span> <span class="fu">starts_with</span>(<span class="st">'d'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Likewise with bare names</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-42_53068510ead0373c25933a23ca1600ac">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gtidysimple</span>(mtcars, </span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">groupers =</span> <span class="fu">c</span>(cyl, notinmtcars), </span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">sumcols =</span> <span class="fu">expr</span>(<span class="fu">starts_with</span>(<span class="st">'d'</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>That’s because things other than character vectors need to be “defused” (see <code>?enquo</code>). <code>expr</code> defuses ‘your own local expressions’, while <code>enquo</code> defuses function arguments. So, there are two options- defuse locally when giving the argument to the funciton with <code>expr</code> (as I’ve done above), or defuse internally with <code>enquo</code>.</p>
<p>In that case, we re-write the outer function to <code>enquo</code> its arguments.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-43_ea157bb9de0370877fe8a4836d6613ec">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>gtidyquo <span class="ot">&lt;-</span> <span class="cf">function</span>(data, groupers, sumcols) {</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>  gnames <span class="ot">&lt;-</span> <span class="fu">selectnames</span>(data, <span class="fu">enquo</span>(groupers))</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>  snames <span class="ot">&lt;-</span> <span class="fu">selectnames</span>(data, <span class="fu">enquo</span>(sumcols))</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>  gm <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="fu">across</span>({{gnames}})) <span class="sc">%&gt;%</span></span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="fu">across</span>({{snames}}, mean, <span class="at">.names =</span> <span class="st">'mean_{.col}'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(gm)</span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, that should work without wrapping tidyselect syntax in <code>expr()</code>, and take bare names or character vectors.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-44_6e04ab11e22e7a3258fe7dc25ec62768">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gtidyquo</span>(mtcars, </span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">groupers =</span> cyl, </span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">sumcols =</span> <span class="fu">starts_with</span>(<span class="st">'d'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
    cyl mean_disp mean_drat
  &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1     4      105.      4.07
2     6      183.      3.59
3     8      353.      3.23</code></pre>
</div>
</div>
<p>It also takes characters</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-45_ac21d9c40ad3f9f57227ad516bd63601">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gtidyquo</span>(mtcars, </span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">groupers =</span> <span class="st">'cyl'</span>, </span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">sumcols =</span> <span class="fu">c</span>(<span class="st">'disp'</span>, <span class="st">'drat'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
    cyl mean_disp mean_drat
  &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1     4      105.      4.07
2     6      183.      3.59
3     8      353.      3.23</code></pre>
</div>
</div>
<p>But it’s no longer ignoring values not in the data</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-46_b65faa8f91832bcc3576a40a0e6550fb">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gtidyquo</span>(mtcars, </span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">groupers =</span> <span class="fu">c</span>(<span class="st">'cyl'</span>, <span class="st">'notinmtcars'</span>), </span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">sumcols =</span> <span class="fu">expr</span>(<span class="fu">starts_with</span>(<span class="st">'d'</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>That’s because the internal <code>enquo(groupers)</code> in <code>gtidyquo</code> means that <code>selectnames</code> is always seeing <code>selector</code> as language, not character, and so bypassing the <code>any_of()</code> conditional. I don’t want to drop that whole conditional section from <code>selectnames</code>, because that keeps <code>selectnames</code> more general (doesn’t have to be fed <code>enquo</code>’d arguments). Instead, we can use the <code>strict</code> argument in <code>eval_select</code> to decide whether to fail or silently ignore missings. This choice is probably good to have, rather than enforce one or the other- it’s often the case that we <em>should</em> fail if missing columns are called, rather than just ignore silently. The same argument can also be used in the conditional as a switch to make the situation with character <code>selector</code> fail or pass.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-47_470027848b084937754d911f2bf36b80">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>selectnames <span class="ot">&lt;-</span> <span class="cf">function</span>(data, selector, <span class="at">failmissing =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.character</span>(selector)) {</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (failmissing) {</span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>      whichg <span class="ot">&lt;-</span> <span class="fu">expr</span>(<span class="fu">all_of</span>(selector))</span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>      whichg <span class="ot">&lt;-</span> <span class="fu">expr</span>(<span class="fu">any_of</span>(selector))</span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a>    whichg <span class="ot">&lt;-</span> selector</span>
<span id="cb105-12"><a href="#cb105-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb105-13"><a href="#cb105-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb105-14"><a href="#cb105-14" aria-hidden="true" tabindex="-1"></a>  selnames <span class="ot">&lt;-</span> whichg <span class="sc">%&gt;%</span> </span>
<span id="cb105-15"><a href="#cb105-15" aria-hidden="true" tabindex="-1"></a>    tidyselect<span class="sc">::</span><span class="fu">eval_select</span>(data, <span class="at">strict =</span> failmissing) <span class="sc">%&gt;%</span> </span>
<span id="cb105-16"><a href="#cb105-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>()</span>
<span id="cb105-17"><a href="#cb105-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb105-18"><a href="#cb105-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(selnames)</span>
<span id="cb105-19"><a href="#cb105-19" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We also need to rewrite <code>gtidyquo</code> to pass failmissing. Could use <code>…</code>, but that’s vague.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-48_8c4de80d686a3aefe5641f72ff0ded76">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>gtidyquo <span class="ot">&lt;-</span> <span class="cf">function</span>(data, groupers, sumcols, <span class="at">failmissing =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>  gnames <span class="ot">&lt;-</span> <span class="fu">selectnames</span>(data, <span class="fu">enquo</span>(groupers), failmissing)</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>  snames <span class="ot">&lt;-</span> <span class="fu">selectnames</span>(data, <span class="fu">enquo</span>(sumcols), failmissing)</span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>  gm <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="fu">across</span>({{gnames}})) <span class="sc">%&gt;%</span></span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="fu">across</span>({{snames}}, mean, <span class="at">.names =</span> <span class="st">'mean_{.col}'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(gm)</span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, does that work with values not in the data?</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-49_3ccc77c45bbb3007bda83f8eb687f98f">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gtidyquo</span>(mtcars, </span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">groupers =</span> <span class="fu">c</span>(<span class="st">'cyl'</span>, <span class="st">'notinmtcars'</span>), </span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">sumcols =</span> <span class="fu">starts_with</span>(<span class="st">'d'</span>),</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">failmissing =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
    cyl mean_disp mean_drat
  &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1     4      105.      4.07
2     6      183.      3.59
3     8      353.      3.23</code></pre>
</div>
</div>
<p>as bare names</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-50_6d67a9bc47f067d1b0eb7301fed41f8b">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gtidyquo</span>(mtcars, </span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">groupers =</span> <span class="fu">c</span>(cyl, notinmtcars), </span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">sumcols =</span> <span class="fu">starts_with</span>(<span class="st">'d'</span>),</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">failmissing =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
    cyl mean_disp mean_drat
  &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1     4      105.      4.07
2     6      183.      3.59
3     8      353.      3.23</code></pre>
</div>
</div>
<p>and it should fail if <code>failmissing = TRUE</code> (or left off, since that’s the default).</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-51_d886f1cc1e15829801b6e495be596722">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gtidyquo</span>(mtcars, </span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">groupers =</span> <span class="fu">c</span>(<span class="st">'cyl'</span>, <span class="st">'notinmtcars'</span>), </span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">sumcols =</span> <span class="fu">starts_with</span>(<span class="st">'d'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="conclusions" class="level4">
<h4 class="anchored" data-anchor-id="conclusions">Conclusions</h4>
<p>That seems a bit lame to just translate to characters, but it ends up being a very robust and flexible workaround for situations where passing an object into a tidyselect ends up trying to select the object instead of its contents once we’re further down a call stack, and lets us use characters, bare names, and tidyselect and choose whether or not to fail when columns don’t exist.</p>
</section>
</section>
</section>
<section id="functions-to-use" class="level2">
<h2 class="anchored" data-anchor-id="functions-to-use">Functions to use</h2>
<p>Sometimes we want to tell the function how to summarise the data. Sometimes we want to do this including arguments, e.g.&nbsp;mean with <code>na.rm = TRUE</code>. Sometimes we want to pass multiple functions and have the names appended, and sometimes those functions are user-defined. Further, sometimes they have an argument internal to the data (such as a weighting column) that they need to access.</p>
<p>We’ll start simple, though I’ll keep the multi-group and multi-col syntax from above because it keeps things general, and allows testing with multiple summarise cols. I’ll use the bare names and embracing for the grouping and summarise variables, but that shouldn’t affect the way function-passing works if we used the character version instead.</p>
<section id="passing-a-function-by-name" class="level3">
<h3 class="anchored" data-anchor-id="passing-a-function-by-name">Passing a function by name</h3>
<p>It’s typically a good idea to name the resulting column with the function when we don’t know what the function will be. And that sets us up for multi-functions.</p>
<p>In the simplest case we can just use a FUN argument. While using the all-caps “FUN” as the argument name seems to be a convention, this isn’t a special argument name and it could be whatever we want.</p>
<p>Previously, we had defined the function to apply inside our function, and so we had hardcoded the naming, e.g.&nbsp;<code>'mean_{.col}</code>. But now, we won’t know what it is. We thus need to get the name of the function as well, using <code>as.character(substitute).</code></p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-52_8a41f47aac8361e6b383e52425ccec5f">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>funpass <span class="ot">&lt;-</span> <span class="cf">function</span>(data, groupers, sumcols,</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>                    FUN) {</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># function name as character</span></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>  funname <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">substitute</span>(FUN))</span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This just avoids clutter in the summarise</span></span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>  funcolname <span class="ot">&lt;-</span> <span class="fu">paste0</span>(funname, <span class="st">'_{.col}'</span>)</span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a>  gm <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="fu">across</span>({{groupers}})) <span class="sc">%&gt;%</span></span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="fu">across</span>({{sumcols}}, FUN, <span class="at">.names =</span> funcolname)) <span class="sc">%&gt;%</span></span>
<span id="cb112-12"><a href="#cb112-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb112-13"><a href="#cb112-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(gm)</span>
<span id="cb112-14"><a href="#cb112-14" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-53_3368f5ad653b312baf6bce33a0072289">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">funpass</span>(mtcars,</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">groupers =</span> gear,</span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">sumcols =</span> mpg,</span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">FUN =</span> mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
   gear mean_mpg
  &lt;dbl&gt;    &lt;dbl&gt;
1     3     16.1
2     4     24.5
3     5     21.4</code></pre>
</div>
</div>
<p>We run into problems as soon as we try to pass arguments to that function, for example when there are NA and we want to use <code>na.rm</code></p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-54_e583fdb8e43af7575426cf72362217fd">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>nacars <span class="ot">&lt;-</span> mtcars <span class="sc">%&gt;%</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">randnum =</span> <span class="fu">rnorm</span>(<span class="fu">n</span>()),</span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">nampg =</span> <span class="fu">ifelse</span>(randnum <span class="sc">&gt;=</span> <span class="dv">0</span>, mpg, <span class="cn">NA</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-55_38d2278d6762c55fb7993579f80f6d34">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| error:false</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a><span class="co"># funpass(nacars,</span></span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a><span class="co">#         groupers = gear,</span></span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a><span class="co">#         sumcols = nampg,</span></span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a><span class="co">#         FUN = mean, na.rm = TRUE)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Using dots syntax works to allow arguments.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-56_c0028dcd57c2adaaefd3a5a301d7289a">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>funpasst <span class="ot">&lt;-</span> <span class="cf">function</span>(data, groupers, sumcols,</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>                    FUN, ...) {</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># function name as character</span></span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>  funname <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">substitute</span>(FUN))</span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This just avoids clutter in the summarise</span></span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a>  funcolname <span class="ot">&lt;-</span> <span class="fu">paste0</span>(funname, <span class="st">'_{.col}'</span>)</span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a>  gm <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="fu">across</span>({{groupers}})) <span class="sc">%&gt;%</span></span>
<span id="cb117-10"><a href="#cb117-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="fu">across</span>({{sumcols}}, FUN,..., <span class="at">.names =</span> funcolname)) <span class="sc">%&gt;%</span></span>
<span id="cb117-11"><a href="#cb117-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb117-12"><a href="#cb117-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(gm)</span>
<span id="cb117-13"><a href="#cb117-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-57_ea35303a56e226f891e70405d69b0a40">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="fu">funpasst</span>(nacars,</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">groupers =</span> gear,</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">sumcols =</span> nampg,</span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">FUN =</span> mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There was 1 warning in `summarise()`.
ℹ In argument: `across(nampg, FUN, ..., .names = funcolname)`.
ℹ In group 1: `gear = 3`.
Caused by warning:
! The `...` argument of `across()` is deprecated as of dplyr 1.1.0.
Supply arguments directly to `.fns` through an anonymous function instead.

  # Previously
  across(a:b, mean, na.rm = TRUE)

  # Now
  across(a:b, \(x) mean(x, na.rm = TRUE))</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
   gear mean_nampg
  &lt;dbl&gt;      &lt;dbl&gt;
1     3       15.7
2     4       23.6
3     5       15.8</code></pre>
</div>
</div>
<p>As usual, dots can be an issue if we’re doing several things. But we’ll get to that. One solution that is also relevant generally is to specify a custom function. In a simple case this could be mean with <code>na.rm = TRUE</code>, but it could be anything.</p>
</section>
<section id="custom-function" class="level3">
<h3 class="anchored" data-anchor-id="custom-function">Custom function</h3>
<p>Maybe we want a custom function. That might be as simple as changing the <code>na.rm</code> default, or it might be something complicated with a few arguments. Here, I’ll demo a version with a swapped <code>na.rm</code> default, illustrating a way to avoid passing arguments, and a more complex function that lags values and multiplies them.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-58_184bd702780748d830e8cb1cc5a8f221">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>meanna <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>customfun <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">lag_k =</span> <span class="dv">1</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>, multiplier) {</span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a>  xl <span class="ot">&lt;-</span> <span class="fu">lag</span>(x, lag_k)</span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a>  xs <span class="ot">&lt;-</span> <span class="fu">sum</span>(xl, <span class="at">na.rm =</span> na.rm)<span class="sc">*</span>multiplier</span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(xs)</span>
<span id="cb121-9"><a href="#cb121-9" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-59_c0c3d4aeb75801dcc21ea6ed54a926b2">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="fu">funpasst</span>(nacars,</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">groupers =</span> gear,</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">sumcols =</span> nampg,</span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">FUN =</span> meanna)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
   gear meanna_nampg
  &lt;dbl&gt;        &lt;dbl&gt;
1     3         15.7
2     4         23.6
3     5         15.8</code></pre>
</div>
</div>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-60_f682edf8294e158cba18f3c849b4be7c">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="fu">funpasst</span>(nacars,</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">groupers =</span> gear,</span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">sumcols =</span> nampg,</span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">FUN =</span> customfun, <span class="at">lag_k =</span> <span class="dv">0</span>, <span class="at">multiplier =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
   gear customfun_nampg
  &lt;dbl&gt;           &lt;dbl&gt;
1     3            1415
2     4            1179
3     5             158</code></pre>
</div>
</div>
<p>and that works with multiple columns and groupers as well</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-61_f7f3be2017c84311fd782b42a57f5993">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="fu">funpasst</span>(nacars,</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">groupers =</span> <span class="fu">c</span>(gear, am),</span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">sumcols =</span> <span class="fu">c</span>(nampg, hp),</span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">FUN =</span> customfun, <span class="at">lag_k =</span> <span class="dv">0</span>, <span class="at">multiplier =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'gear'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 4
   gear    am customfun_nampg customfun_hp
  &lt;dbl&gt; &lt;dbl&gt;           &lt;dbl&gt;        &lt;dbl&gt;
1     3     0            1415        26420
2     4     0             178         4030
3     4     1            1001         6710
4     5     1             158         9780</code></pre>
</div>
</div>
</section>
<section id="function-with-internal-data-argument" class="level3">
<h3 class="anchored" data-anchor-id="function-with-internal-data-argument">Function with internal data argument</h3>
<p>Sometimes we might want to use a function that relies on multiple columns- for example, the mean of one column using weights in another.</p>
<p>In the simplest case, we can hardcode that column. Here in a silly example of finding the mean <code>hp</code> weighted by <code>wt</code>. I’ve removed the dots for now, we’ll get to other arguments next.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-62_43cb4d5e4c0cb2c3002c161803b4d0b5">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>funinternal <span class="ot">&lt;-</span> <span class="cf">function</span>(data, groupers, sumcols,</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>                    FUN) {</span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># function name as character</span></span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>  funname <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">substitute</span>(FUN))</span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This just avoids clutter in the summarise</span></span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a>  funcolname <span class="ot">&lt;-</span> <span class="fu">paste0</span>(funname, <span class="st">'_{.col}'</span>)</span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true" tabindex="-1"></a>  gm <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="fu">across</span>({{groupers}})) <span class="sc">%&gt;%</span></span>
<span id="cb129-10"><a href="#cb129-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="fu">across</span>({{sumcols}}, FUN, wt, <span class="at">.names =</span> funcolname)) <span class="sc">%&gt;%</span></span>
<span id="cb129-11"><a href="#cb129-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb129-12"><a href="#cb129-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(gm)</span>
<span id="cb129-13"><a href="#cb129-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-63_cdd25c3c3a85cbec838d0c8b7e2cf865">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="fu">funinternal</span>(nacars,</span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">groupers =</span> gear,</span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">sumcols =</span> mpg,</span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">FUN =</span> weighted.mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
   gear weighted.mean_mpg
  &lt;dbl&gt;             &lt;dbl&gt;
1     3              15.6
2     4              23.6
3     5              19.7</code></pre>
</div>
</div>
<p>and yes, that is weighting- if we just pass mean we get</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-64_7b6f69998ae2b79912f8ee19b39c9b4c">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="fu">funpasst</span>(nacars,</span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">groupers =</span> gear,</span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">sumcols =</span> mpg,</span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">FUN =</span> mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
   gear mean_mpg
  &lt;dbl&gt;    &lt;dbl&gt;
1     3     16.1
2     4     24.5
3     5     21.4</code></pre>
</div>
</div>
<p>But what if we need to specify other arguments? We can use dots again.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-65_1077ea0a726f5ec3b5bfdcc529ee332b">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>funinternald <span class="ot">&lt;-</span> <span class="cf">function</span>(data, groupers, sumcols,</span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>                    FUN, ...) {</span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># function name as character</span></span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>  funname <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">substitute</span>(FUN))</span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This just avoids clutter in the summarise</span></span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a>  funcolname <span class="ot">&lt;-</span> <span class="fu">paste0</span>(funname, <span class="st">'_{.col}'</span>)</span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a>  gm <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="fu">across</span>({{groupers}})) <span class="sc">%&gt;%</span></span>
<span id="cb134-10"><a href="#cb134-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="fu">across</span>({{sumcols}}, FUN, wt, ..., <span class="at">.names =</span> funcolname)) <span class="sc">%&gt;%</span></span>
<span id="cb134-11"><a href="#cb134-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb134-12"><a href="#cb134-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(gm)</span>
<span id="cb134-13"><a href="#cb134-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-66_61a5f6e2ed3b0ed10a7754468a102104">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="fu">funinternald</span>(nacars,</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">groupers =</span> gear,</span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">sumcols =</span> nampg,</span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">FUN =</span> weighted.mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
   gear weighted.mean_nampg
  &lt;dbl&gt;               &lt;dbl&gt;
1     3                15.0
2     4                22.4
3     5                15.8</code></pre>
</div>
</div>
<p>Another way to do this that might be a bit clearer, especially as the number of arguments grows is to use tilde function specification. This is nearly the same, but makes it clear what arguments belong to the FUN.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-67_e0f3d8e64276d995406d25b26aa0e907">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>funinternaldt <span class="ot">&lt;-</span> <span class="cf">function</span>(data, groupers, sumcols,</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>                    FUN, ...) {</span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># function name as character</span></span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a>  funname <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">substitute</span>(FUN))</span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This just avoids clutter in the summarise</span></span>
<span id="cb137-7"><a href="#cb137-7" aria-hidden="true" tabindex="-1"></a>  funcolname <span class="ot">&lt;-</span> <span class="fu">paste0</span>(funname, <span class="st">'_{.col}'</span>)</span>
<span id="cb137-8"><a href="#cb137-8" aria-hidden="true" tabindex="-1"></a>  gm <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb137-9"><a href="#cb137-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="fu">across</span>({{groupers}})) <span class="sc">%&gt;%</span></span>
<span id="cb137-10"><a href="#cb137-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="fu">across</span>({{sumcols}}, <span class="sc">~</span><span class="fu">FUN</span>(., wt, ...), <span class="at">.names =</span> funcolname)) <span class="sc">%&gt;%</span></span>
<span id="cb137-11"><a href="#cb137-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb137-12"><a href="#cb137-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(gm)</span>
<span id="cb137-13"><a href="#cb137-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>That yields the same result, we’ve just specified the summary function differently.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-68_fe98673e6c43761cb71006c54748d86a">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="fu">funinternaldt</span>(nacars,</span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">groupers =</span> gear,</span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">sumcols =</span> nampg,</span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">FUN =</span> weighted.mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
   gear weighted.mean_nampg
  &lt;dbl&gt;               &lt;dbl&gt;
1     3                15.0
2     4                22.4
3     5                15.8</code></pre>
</div>
</div>
</section>
<section id="passing-internal-columns-by-name" class="level3">
<h3 class="anchored" data-anchor-id="passing-internal-columns-by-name">Passing internal columns by name</h3>
<p>So far, the internal columns have been hardcoded, and at a known position in the arguments to the FUN. What if we want to specify them on calling the function?</p>
<p>Can we just use the dots? Not with a bare name.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-69_74c4f38c8a0f68ebbc376ef915aafe1e">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="co"># funpasst(nacars,</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a><span class="co">#         groupers = gear,</span></span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a><span class="co">#         sumcols = nampg,</span></span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a><span class="co">#         FUN = weighted.mean, wt, na.rm = TRUE)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Does it work to use the tilde version?</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-70_defc8d366ad4c75128dc2c45bba7ca06">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>funtildedots <span class="ot">&lt;-</span> <span class="cf">function</span>(data, groupers, sumcols,</span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>                    FUN, ...) {</span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># function name as character</span></span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a>  funname <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">substitute</span>(FUN))</span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This just avoids clutter in the summarise</span></span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a>  funcolname <span class="ot">&lt;-</span> <span class="fu">paste0</span>(funname, <span class="st">'_{.col}'</span>)</span>
<span id="cb141-8"><a href="#cb141-8" aria-hidden="true" tabindex="-1"></a>  gm <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb141-9"><a href="#cb141-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="fu">across</span>({{groupers}})) <span class="sc">%&gt;%</span></span>
<span id="cb141-10"><a href="#cb141-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="fu">across</span>({{sumcols}}, <span class="sc">~</span><span class="fu">FUN</span>(., ...), <span class="at">.names =</span> funcolname)) <span class="sc">%&gt;%</span></span>
<span id="cb141-11"><a href="#cb141-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb141-12"><a href="#cb141-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(gm)</span>
<span id="cb141-13"><a href="#cb141-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>No, that still can’t find the bare name- it looks for an object, not something internal to the data.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-71_33ebef89a737f7c394e1f40de7c1d7d3">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="fu">funtildedots</span>(nacars,</span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">groupers =</span> gear,</span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">sumcols =</span> nampg,</span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">FUN =</span> weighted.mean, wt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we <em>know</em> that there will be a second data-variable argument to the function, we might be able to embrace.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-72_67cb7be9ff5f484c383c703372e42bfb">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>funinteralembrace <span class="ot">&lt;-</span> <span class="cf">function</span>(data, groupers, sumcols,</span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>                    FUN, arg2, ...) {</span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># function name as character</span></span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a>  funname <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">substitute</span>(FUN))</span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This just avoids clutter in the summarise</span></span>
<span id="cb143-7"><a href="#cb143-7" aria-hidden="true" tabindex="-1"></a>  funcolname <span class="ot">&lt;-</span> <span class="fu">paste0</span>(funname, <span class="st">'_{.col}'</span>)</span>
<span id="cb143-8"><a href="#cb143-8" aria-hidden="true" tabindex="-1"></a>  gm <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb143-9"><a href="#cb143-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="fu">across</span>({{groupers}})) <span class="sc">%&gt;%</span></span>
<span id="cb143-10"><a href="#cb143-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="fu">across</span>({{sumcols}}, FUN, {{arg2}}, ..., <span class="at">.names =</span> funcolname)) <span class="sc">%&gt;%</span></span>
<span id="cb143-11"><a href="#cb143-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb143-12"><a href="#cb143-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(gm)</span>
<span id="cb143-13"><a href="#cb143-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb143-14"><a href="#cb143-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-15"><a href="#cb143-15" aria-hidden="true" tabindex="-1"></a>funinteralembraceT <span class="ot">&lt;-</span> <span class="cf">function</span>(data, groupers, sumcols,</span>
<span id="cb143-16"><a href="#cb143-16" aria-hidden="true" tabindex="-1"></a>                    FUN, arg2, ...) {</span>
<span id="cb143-17"><a href="#cb143-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># function name as character</span></span>
<span id="cb143-18"><a href="#cb143-18" aria-hidden="true" tabindex="-1"></a>  funname <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">substitute</span>(FUN))</span>
<span id="cb143-19"><a href="#cb143-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb143-20"><a href="#cb143-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This just avoids clutter in the summarise</span></span>
<span id="cb143-21"><a href="#cb143-21" aria-hidden="true" tabindex="-1"></a>  funcolname <span class="ot">&lt;-</span> <span class="fu">paste0</span>(funname, <span class="st">'_{.col}'</span>)</span>
<span id="cb143-22"><a href="#cb143-22" aria-hidden="true" tabindex="-1"></a>  gm <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb143-23"><a href="#cb143-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="fu">across</span>({{groupers}})) <span class="sc">%&gt;%</span></span>
<span id="cb143-24"><a href="#cb143-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="fu">across</span>({{sumcols}}, <span class="sc">~</span><span class="fu">FUN</span>(., {{arg2}}, ...), <span class="at">.names =</span> funcolname)) <span class="sc">%&gt;%</span></span>
<span id="cb143-25"><a href="#cb143-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb143-26"><a href="#cb143-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(gm)</span>
<span id="cb143-27"><a href="#cb143-27" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>That works for both the tilde and non-tilde versions.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-73_ea0cb3ca8479033dcf4dcafddc6301d5">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="fu">funinteralembrace</span>(nacars,</span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">groupers =</span> gear,</span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">sumcols =</span> nampg,</span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">FUN =</span> weighted.mean, </span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">arg2 =</span> wt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
   gear weighted.mean_nampg
  &lt;dbl&gt;               &lt;dbl&gt;
1     3                15.0
2     4                22.4
3     5                15.8</code></pre>
</div>
</div>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-74_68ddefe2e868ca3f567eb1b21befdae4">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="fu">funinteralembraceT</span>(nacars,</span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">groupers =</span> gear,</span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">sumcols =</span> nampg,</span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">FUN =</span> weighted.mean, </span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">arg2 =</span> wt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
   gear weighted.mean_nampg
  &lt;dbl&gt;               &lt;dbl&gt;
1     3                15.0
2     4                22.4
3     5                15.8</code></pre>
</div>
</div>
<p>But what if we want a function that works with FUNS that may or may not require a second data-variable argument? Do the above functions work with something like <code>mean</code> that won’t have an arg2? <strong>No</strong>.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-75_aa60da55332d94a8c4909eb46fa64db8">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">funinteralembrace</span>(nacars,</span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">groupers =</span> gear,</span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">sumcols =</span> nampg,</span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">FUN =</span> mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a><span class="fu">funinteralembraceT</span>(nacars,</span>
<span id="cb148-7"><a href="#cb148-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">groupers =</span> gear,</span>
<span id="cb148-8"><a href="#cb148-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">sumcols =</span> nampg,</span>
<span id="cb148-9"><a href="#cb148-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">FUN =</span> mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Is there a way to write a function that may have any number from 0 to <em>n</em> internal data arguments, <em>as well as</em> other non-data arguments (e.g.&nbsp;na.rm etc)? It will be tricky, because some unknown number of items will need to be embraced. Usual methods to unpack the ellipses using <code>list(...)</code> won’t work, I don’t think. And if they do, it’s still unclear how many of the items in the list should be embraced. Does it even work if we <em>know</em> how many need to be embraced? Test with a simple case of whether we can even do the <code>list(…)</code>.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-76_74f981212de13db58913f780ad929e25">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>testdots <span class="ot">&lt;-</span> <span class="cf">function</span>(data, groupers, sumcols,</span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>                    FUN, ...) {</span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># function name as character</span></span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a>  funname <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">substitute</span>(FUN))</span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This just avoids clutter in the summarise</span></span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a>  funcolname <span class="ot">&lt;-</span> <span class="fu">paste0</span>(funname, <span class="st">'_{.col}'</span>)</span>
<span id="cb149-8"><a href="#cb149-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb149-9"><a href="#cb149-9" aria-hidden="true" tabindex="-1"></a>  dots <span class="ot">&lt;-</span> <span class="fu">list</span>(...)</span>
<span id="cb149-10"><a href="#cb149-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb149-11"><a href="#cb149-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(dots)</span>
<span id="cb149-12"><a href="#cb149-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb149-13"><a href="#cb149-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># gm &lt;- data %&gt;%</span></span>
<span id="cb149-14"><a href="#cb149-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   group_by(across({{groupers}})) %&gt;%</span></span>
<span id="cb149-15"><a href="#cb149-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   summarise(across({{sumcols}}, ~FUN(., {{dots[1]}}, ...), .names = funcolname)) %&gt;%</span></span>
<span id="cb149-16"><a href="#cb149-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   ungroup()</span></span>
<span id="cb149-17"><a href="#cb149-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># return(gm)</span></span>
<span id="cb149-18"><a href="#cb149-18" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Even that doesn’t work- including bare names in the dots and then embracing doesn’t work because list() needs them as objects.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-77_cecd22d69e005bdee9095c81724a851b">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="fu">testdots</span>(nacars,</span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">groupers =</span> gear,</span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">sumcols =</span> nampg,</span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">FUN =</span> weighted.mean, wt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>What is it I’m actually trying to do here? Write a function that takes an arbitrary number of data-variable arguments and an arbitrary number of passed env-arguments. That’s always going to be tricky, and will get trickier to sort things out like the order of the arguments. Is it possible? Almost certainly. But I think I’ll leave sorting it out for later. We have a version that works for a known number of arguments in a known order, which is enough in some situations. A workaround will become apparent anyway after the next section, where I pass in external vectors.</p>
</section>
<section id="function-with-vector-argument-passed-in" class="level3">
<h3 class="anchored" data-anchor-id="function-with-vector-argument-passed-in">Function with vector argument passed in</h3>
<p>One way to get around the issue above is instead of passing the name of a data variable, pass in the vector itself as an object. This also allows passing in vectors unattached to the dataframe being operated on, though since the’ll need to have the same <code>nrow</code>s, in most cases they’ll be attached.</p>
<p>How does this work? We write the main function to do the grouping and summarizing, and <em>within it</em> define the function to evaluate in the summarize, accounting for the various types of arguments and the grouping. This works because the <code>…</code> are all env-variables (vectors and scalars) instead of bare names of data-variables. This is all based on <code>funpasst</code> above, with the addition of the internal function creation. Because the function we define may be grouped, it needs to be passed the indices for the current group rows so it only operates on those. I’m using tilde notation to keep it clearer how that function gets called in the summarise.</p>
<p>We could write the function that creates the function to evaluate inside the main function, or elsewhere. Writing it inside allows us to take some shortcuts because it can access objects in the outer function environment and avoid explicitly passing as many objects around. Though that can be dangerous.</p>
<p>The <code>!!!</code> unpacks a list of function arguments.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-78_ce822a146caaba6efbdd47ab9c5cb88f">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a>arbvecscal <span class="ot">&lt;-</span> <span class="cf">function</span>(data, groupers, sumcols,</span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>                    FUN, ...) {</span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># function name as character</span></span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a>  funname <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">substitute</span>(FUN))</span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This just avoids clutter in the summarise</span></span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a>  funcolname <span class="ot">&lt;-</span> <span class="fu">paste0</span>(funname, <span class="st">'_{.col}'</span>)</span>
<span id="cb151-7"><a href="#cb151-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb151-8"><a href="#cb151-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define the function to evaluate</span></span>
<span id="cb151-9"><a href="#cb151-9" aria-hidden="true" tabindex="-1"></a>  thisfun <span class="ot">&lt;-</span> <span class="cf">function</span>(x, indices) {</span>
<span id="cb151-10"><a href="#cb151-10" aria-hidden="true" tabindex="-1"></a>    elip <span class="ot">&lt;-</span> <span class="fu">list</span>(...)</span>
<span id="cb151-11"><a href="#cb151-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb151-12"><a href="#cb151-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># deal with the case of no passed arguments</span></span>
<span id="cb151-13"><a href="#cb151-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(elip) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb151-14"><a href="#cb151-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(rlang<span class="sc">::</span><span class="fu">exec</span>(FUN, x))</span>
<span id="cb151-15"><a href="#cb151-15" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb151-16"><a href="#cb151-16" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb151-17"><a href="#cb151-17" aria-hidden="true" tabindex="-1"></a>      <span class="co"># clip vector ... arguments (e.g. weights) to just the group</span></span>
<span id="cb151-18"><a href="#cb151-18" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(elip)) {</span>
<span id="cb151-19"><a href="#cb151-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">length</span>(elip[[i]]) <span class="sc">==</span> <span class="fu">nrow</span>(data)) {</span>
<span id="cb151-20"><a href="#cb151-20" aria-hidden="true" tabindex="-1"></a>          elip[[i]] <span class="ot">&lt;-</span> elip[[i]][indices]</span>
<span id="cb151-21"><a href="#cb151-21" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb151-22"><a href="#cb151-22" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb151-23"><a href="#cb151-23" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb151-24"><a href="#cb151-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(rlang<span class="sc">::</span><span class="fu">exec</span>(FUN, x, <span class="sc">!!!</span>elip))</span>
<span id="cb151-25"><a href="#cb151-25" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb151-26"><a href="#cb151-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb151-27"><a href="#cb151-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb151-28"><a href="#cb151-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The main group and summarise</span></span>
<span id="cb151-29"><a href="#cb151-29" aria-hidden="true" tabindex="-1"></a>  gm <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb151-30"><a href="#cb151-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="fu">across</span>({{groupers}})) <span class="sc">%&gt;%</span></span>
<span id="cb151-31"><a href="#cb151-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="fu">across</span>({{sumcols}}, <span class="sc">~</span><span class="fu">thisfun</span>(., <span class="fu">cur_group_rows</span>()), <span class="at">.names =</span> funcolname)) <span class="sc">%&gt;%</span></span>
<span id="cb151-32"><a href="#cb151-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb151-33"><a href="#cb151-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(gm)</span>
<span id="cb151-34"><a href="#cb151-34" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>So, for something like the weighted average with an <code>na.rm</code> argument, we specify the vector of weights, rather than their bare name in the dataframe.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-79_9fdc9d9f1849036ec9b45d33b6635bfb">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arbvecscal</span>(nacars,</span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">groupers =</span> gear,</span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">sumcols =</span> nampg,</span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">FUN =</span> weighted.mean, nacars<span class="sc">$</span>wt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
   gear weighted.mean_nampg
  &lt;dbl&gt;               &lt;dbl&gt;
1     3                15.0
2     4                22.4
3     5                15.8</code></pre>
</div>
</div>
<p>And that also works if we want a function without any data-variables</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-80_38c7bf2dea4387e74d349e1c01e5aefa">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arbvecscal</span>(nacars,</span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">groupers =</span> gear,</span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">sumcols =</span> nampg,</span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">FUN =</span> mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
   gear mean_nampg
  &lt;dbl&gt;      &lt;dbl&gt;
1     3       15.7
2     4       23.6
3     5       15.8</code></pre>
</div>
</div>
<p>If we don’t want to pass vectors but pass bare names, we might be able to do that with the same approach, but will need to specify which are which. Then we’d create the vectors internal to the function using the same select syntax as before.</p>
<p>Now the internal function has to be a bit different (simpler) since it doesn’t have to do the checking for length since we’ve specified dataargs.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-81_304ed3fd6ff2e497a8550a664cd51971">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>arbdatanames <span class="ot">&lt;-</span> <span class="cf">function</span>(data, groupers, sumcols,</span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>                         FUN, dataargs, ...) {</span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># function name as character</span></span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a>  funname <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">substitute</span>(FUN))</span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This just avoids clutter in the summarise</span></span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a>  funcolname <span class="ot">&lt;-</span> <span class="fu">paste0</span>(funname, <span class="st">'_{.col}'</span>)</span>
<span id="cb156-7"><a href="#cb156-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb156-8"><a href="#cb156-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make a tibble so it doesn't collapse to vector if only one column</span></span>
<span id="cb156-9"><a href="#cb156-9" aria-hidden="true" tabindex="-1"></a>  datavecs <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb156-10"><a href="#cb156-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb156-11"><a href="#cb156-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>({{dataargs}})</span>
<span id="cb156-12"><a href="#cb156-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb156-13"><a href="#cb156-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define the function to evaluate</span></span>
<span id="cb156-14"><a href="#cb156-14" aria-hidden="true" tabindex="-1"></a>  thisfun <span class="ot">&lt;-</span> <span class="cf">function</span>(x, indices) {</span>
<span id="cb156-15"><a href="#cb156-15" aria-hidden="true" tabindex="-1"></a>    elip <span class="ot">&lt;-</span> <span class="fu">list</span>(...)</span>
<span id="cb156-16"><a href="#cb156-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb156-17"><a href="#cb156-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># deal with the case of no passed arguments</span></span>
<span id="cb156-18"><a href="#cb156-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(elip) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="fu">nrow</span>(datavecs) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb156-19"><a href="#cb156-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(rlang<span class="sc">::</span><span class="fu">exec</span>(FUN, x))</span>
<span id="cb156-20"><a href="#cb156-20" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb156-21"><a href="#cb156-21" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb156-22"><a href="#cb156-22" aria-hidden="true" tabindex="-1"></a>      <span class="co"># clip data arguments (e.g. weights) to just the group</span></span>
<span id="cb156-23"><a href="#cb156-23" aria-hidden="true" tabindex="-1"></a>      thisdata <span class="ot">&lt;-</span> datavecs[indices, ]</span>
<span id="cb156-24"><a href="#cb156-24" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb156-25"><a href="#cb156-25" aria-hidden="true" tabindex="-1"></a>      <span class="co"># make all the arguments a list so we can call it</span></span>
<span id="cb156-26"><a href="#cb156-26" aria-hidden="true" tabindex="-1"></a>      allargs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">as.list</span>(thisdata), elip)</span>
<span id="cb156-27"><a href="#cb156-27" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb156-28"><a href="#cb156-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(rlang<span class="sc">::</span><span class="fu">exec</span>(FUN, x, <span class="sc">!!!</span>allargs))</span>
<span id="cb156-29"><a href="#cb156-29" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb156-30"><a href="#cb156-30" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb156-31"><a href="#cb156-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb156-32"><a href="#cb156-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The main group and summarise</span></span>
<span id="cb156-33"><a href="#cb156-33" aria-hidden="true" tabindex="-1"></a>  gm <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb156-34"><a href="#cb156-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="fu">across</span>({{groupers}})) <span class="sc">%&gt;%</span></span>
<span id="cb156-35"><a href="#cb156-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="fu">across</span>({{sumcols}}, <span class="sc">~</span><span class="fu">thisfun</span>(., <span class="fu">cur_group_rows</span>()), <span class="at">.names =</span> funcolname)) <span class="sc">%&gt;%</span></span>
<span id="cb156-36"><a href="#cb156-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb156-37"><a href="#cb156-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(gm)</span>
<span id="cb156-38"><a href="#cb156-38" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, that should work for the weighted mean as well. Note that now the data variables have to be part of the dataframe- this function does not accept vectors passed in from elsewhere.</p>
<p>BUT, it doesn’t work because the <em>names</em> of the arguments need to be the names in the list of arguments following the <code>!!!</code>. And here, <code>wt</code> is the name, but <code>weighted.mean</code> wants <code>w</code>. So we not only need to specify the data-variable name, but the function-argument name for that variable as well. This is getting <em>very</em> in the weeds.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-82_e34ad1bf4ed5715bf4648ec9ab0def88">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arbdatanames</span>(nacars,</span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">groupers =</span> gear,</span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">sumcols =</span> nampg,</span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">FUN =</span> weighted.mean, <span class="at">dataargs =</span> wt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For example, arguments with the wrong names just get ignored. Names are essential, the execution does not just rely on order like if we called a function directly. Which makes sense for safety, but makes things harder here.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-83_ac46de28efef58b72674779c610c460e">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>vals <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">10</span>)</span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>arglist <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">x =</span> vals, <span class="at">wt =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>rlang<span class="sc">::</span><span class="fu">exec</span>(weighted.mean, <span class="sc">!!!</span>arglist)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.2123889</code></pre>
</div>
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>arglist2 <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">x =</span> vals, <span class="at">w =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>rlang<span class="sc">::</span><span class="fu">exec</span>(weighted.mean, <span class="sc">!!!</span>arglist2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.1297073</code></pre>
</div>
</div>
<p>It would be nice to pass name-value pairs, but the bare names are going to trip us up, I think. Could do it with paired characters I guess, but we’ve just spent quite a lot of time trying to avoid that. Would work though. Kind of a pain to setup- would make most sense as two paired columns or vectors. And if we do that, it’d end up being roughly equivalent to just adding another argument to the function for the matched names.</p>
<p>Skipping the rename if <code>dataargnames</code> aren’t specified allows ignoring it if the columns have the correct names, and helps it work more smoothly if there aren’t <code>dataargs</code> at all.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-84_b78e44e18e0f2193a32e9ceafae34e1f">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a>arbdatanames <span class="ot">&lt;-</span> <span class="cf">function</span>(data, groupers, sumcols,</span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a>                         FUN, dataargs, <span class="at">dataargnames =</span> <span class="cn">NULL</span>, ...) {</span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># function name as character</span></span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a>  funname <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">substitute</span>(FUN))</span>
<span id="cb162-5"><a href="#cb162-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This just avoids clutter in the summarise</span></span>
<span id="cb162-6"><a href="#cb162-6" aria-hidden="true" tabindex="-1"></a>  funcolname <span class="ot">&lt;-</span> <span class="fu">paste0</span>(funname, <span class="st">'_{.col}'</span>)</span>
<span id="cb162-7"><a href="#cb162-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb162-8"><a href="#cb162-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make a tibble so it doesn't collapse to vector if only one column</span></span>
<span id="cb162-9"><a href="#cb162-9" aria-hidden="true" tabindex="-1"></a>  datavecs <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb162-10"><a href="#cb162-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb162-11"><a href="#cb162-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>({{dataargs}})</span>
<span id="cb162-12"><a href="#cb162-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb162-13"><a href="#cb162-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(dataargnames)) {</span>
<span id="cb162-14"><a href="#cb162-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(datavecs) <span class="ot">&lt;-</span> dataargnames</span>
<span id="cb162-15"><a href="#cb162-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb162-16"><a href="#cb162-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb162-17"><a href="#cb162-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb162-18"><a href="#cb162-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define the function to evaluate</span></span>
<span id="cb162-19"><a href="#cb162-19" aria-hidden="true" tabindex="-1"></a>  thisfun <span class="ot">&lt;-</span> <span class="cf">function</span>(x, indices) {</span>
<span id="cb162-20"><a href="#cb162-20" aria-hidden="true" tabindex="-1"></a>    elip <span class="ot">&lt;-</span> <span class="fu">list</span>(...)</span>
<span id="cb162-21"><a href="#cb162-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb162-22"><a href="#cb162-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># deal with the case of no passed arguments</span></span>
<span id="cb162-23"><a href="#cb162-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(elip) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="fu">nrow</span>(datavecs) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb162-24"><a href="#cb162-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(rlang<span class="sc">::</span><span class="fu">exec</span>(FUN, x))</span>
<span id="cb162-25"><a href="#cb162-25" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb162-26"><a href="#cb162-26" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb162-27"><a href="#cb162-27" aria-hidden="true" tabindex="-1"></a>      <span class="co"># clip data arguments (e.g. weights) to just the group</span></span>
<span id="cb162-28"><a href="#cb162-28" aria-hidden="true" tabindex="-1"></a>      thisdata <span class="ot">&lt;-</span> datavecs[indices, ]</span>
<span id="cb162-29"><a href="#cb162-29" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb162-30"><a href="#cb162-30" aria-hidden="true" tabindex="-1"></a>      <span class="co"># make all the arguments a list so we can call it</span></span>
<span id="cb162-31"><a href="#cb162-31" aria-hidden="true" tabindex="-1"></a>      allargs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">as.list</span>(thisdata), elip)</span>
<span id="cb162-32"><a href="#cb162-32" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb162-33"><a href="#cb162-33" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(rlang<span class="sc">::</span><span class="fu">exec</span>(FUN, x, <span class="sc">!!!</span>allargs))</span>
<span id="cb162-34"><a href="#cb162-34" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb162-35"><a href="#cb162-35" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb162-36"><a href="#cb162-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb162-37"><a href="#cb162-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The main group and summarise</span></span>
<span id="cb162-38"><a href="#cb162-38" aria-hidden="true" tabindex="-1"></a>  gm <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb162-39"><a href="#cb162-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="fu">across</span>({{groupers}})) <span class="sc">%&gt;%</span></span>
<span id="cb162-40"><a href="#cb162-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="fu">across</span>({{sumcols}}, <span class="sc">~</span><span class="fu">thisfun</span>(., <span class="fu">cur_group_rows</span>()), <span class="at">.names =</span> funcolname)) <span class="sc">%&gt;%</span></span>
<span id="cb162-41"><a href="#cb162-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb162-42"><a href="#cb162-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(gm)</span>
<span id="cb162-43"><a href="#cb162-43" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now that works. The alternative would be to have a table of matched <code>dataargs</code> and <code>dataargnames</code>, and have that table be a single argument to <code>arbdatanames</code>, but we’d still have to created it and that’d involve more overhead.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-85_950c8e29c439bb34b46f3e41333e76f7">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arbdatanames</span>(nacars,</span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">groupers =</span> gear,</span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">sumcols =</span> nampg,</span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">FUN =</span> weighted.mean, <span class="at">dataargs =</span> wt, <span class="at">dataargnames =</span> <span class="st">'w'</span>, </span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
   gear weighted.mean_nampg
  &lt;dbl&gt;               &lt;dbl&gt;
1     3                15.0
2     4                22.4
3     5                15.8</code></pre>
</div>
</div>
<p>And it works in situations without data args.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-86_471f19f4a0131176b7ca13dd8341e196">
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arbdatanames</span>(nacars,</span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">groupers =</span> gear,</span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">sumcols =</span> nampg,</span>
<span id="cb165-4"><a href="#cb165-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">FUN =</span> mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
   gear mean_nampg
  &lt;dbl&gt;      &lt;dbl&gt;
1     3       15.7
2     4       23.6
3     5       15.8</code></pre>
</div>
</div>
<p>That should work for &gt;1 data variable as well. Let’s define a function that needs multiple data variables. This is very contrived with just some division and multiplication, but works as a check.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-87_3f95c6418b75d1a6efae1b76c3fc4cc3">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>multidat <span class="ot">&lt;-</span> <span class="cf">function</span>(x, w, d, m, na.rm) {</span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a>  preprep <span class="ot">&lt;-</span> x<span class="sc">/</span>d<span class="sc">*</span>m</span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a>  outcome <span class="ot">&lt;-</span> <span class="fu">weighted.mean</span>(preprep, w, <span class="at">na.rm =</span> na.rm)</span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>That works. Note that the dependence on argument names means we can specify out of order- we get two very different answers depending on whether we call <code>cyl</code> and <code>hp</code> <code>d</code> and <code>m</code> or <code>m</code> and <code>d</code>.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-88_98b24604ee3acf2cf9131b2667022405">
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arbdatanames</span>(nacars,</span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">groupers =</span> gear,</span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">sumcols =</span> nampg,</span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">FUN =</span> multidat, <span class="at">dataargs =</span> <span class="fu">c</span>(wt, cyl, hp), <span class="at">dataargnames =</span> <span class="fu">c</span>(<span class="st">'w'</span>, <span class="st">'d'</span>, <span class="st">'m'</span>), </span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
   gear multidat_nampg
  &lt;dbl&gt;          &lt;dbl&gt;
1     3           373.
2     4           435.
3     5           521.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arbdatanames</span>(nacars,</span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">groupers =</span> gear,</span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">sumcols =</span> nampg,</span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">FUN =</span> multidat, <span class="at">dataargs =</span> <span class="fu">c</span>(wt, cyl, hp), <span class="at">dataargnames =</span> <span class="fu">c</span>(<span class="st">'w'</span>, <span class="st">'m'</span>, <span class="st">'d'</span>), </span>
<span id="cb170-5"><a href="#cb170-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
   gear multidat_nampg
  &lt;dbl&gt;          &lt;dbl&gt;
1     3          0.615
2     4          1.22 
3     5          0.479</code></pre>
</div>
</div>
<p>Is there any reason to specify <code>thisfun</code> externally to the main function? I guess maybe? It forces us to specify arguments, and potentially makes things clearer.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-89_b3fc0cd49cadc3e7e48ca8d82f4cb0fe">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the function to evaluate within the summary</span></span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a>sumfun <span class="ot">&lt;-</span> <span class="cf">function</span>(x, indices, FUN, datavecs, ...) {</span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a>  elip <span class="ot">&lt;-</span> <span class="fu">list</span>(...)</span>
<span id="cb172-4"><a href="#cb172-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb172-5"><a href="#cb172-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># deal with the case of no passed arguments</span></span>
<span id="cb172-6"><a href="#cb172-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(elip) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="fu">nrow</span>(datavecs) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb172-7"><a href="#cb172-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(rlang<span class="sc">::</span><span class="fu">exec</span>(FUN, x))</span>
<span id="cb172-8"><a href="#cb172-8" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb172-9"><a href="#cb172-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb172-10"><a href="#cb172-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># clip data arguments (e.g. weights) to just the group</span></span>
<span id="cb172-11"><a href="#cb172-11" aria-hidden="true" tabindex="-1"></a>    thisdata <span class="ot">&lt;-</span> datavecs[indices, ]</span>
<span id="cb172-12"><a href="#cb172-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb172-13"><a href="#cb172-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make all the arguments a list so we can call it</span></span>
<span id="cb172-14"><a href="#cb172-14" aria-hidden="true" tabindex="-1"></a>    allargs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">as.list</span>(thisdata), elip)</span>
<span id="cb172-15"><a href="#cb172-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb172-16"><a href="#cb172-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(rlang<span class="sc">::</span><span class="fu">exec</span>(FUN, x, <span class="sc">!!!</span>allargs))</span>
<span id="cb172-17"><a href="#cb172-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb172-18"><a href="#cb172-18" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-90_e2c8ab6f93d027d8d388b3da47b3c6fa">
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a>newfun <span class="ot">&lt;-</span> <span class="cf">function</span>(data, groupers, sumcols,</span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a>                         FUN, dataargs, <span class="at">dataargnames =</span> <span class="cn">NULL</span>, ...) {</span>
<span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># function name as character</span></span>
<span id="cb173-4"><a href="#cb173-4" aria-hidden="true" tabindex="-1"></a>  funname <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">substitute</span>(FUN))</span>
<span id="cb173-5"><a href="#cb173-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This just avoids clutter in the summarise</span></span>
<span id="cb173-6"><a href="#cb173-6" aria-hidden="true" tabindex="-1"></a>  funcolname <span class="ot">&lt;-</span> <span class="fu">paste0</span>(funname, <span class="st">'_{.col}'</span>)</span>
<span id="cb173-7"><a href="#cb173-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb173-8"><a href="#cb173-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make a tibble so it doesn't collapse to vector if only one column</span></span>
<span id="cb173-9"><a href="#cb173-9" aria-hidden="true" tabindex="-1"></a>  datavecs <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb173-10"><a href="#cb173-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb173-11"><a href="#cb173-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>({{dataargs}})</span>
<span id="cb173-12"><a href="#cb173-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb173-13"><a href="#cb173-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(dataargnames)) {</span>
<span id="cb173-14"><a href="#cb173-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(datavecs) <span class="ot">&lt;-</span> dataargnames</span>
<span id="cb173-15"><a href="#cb173-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb173-16"><a href="#cb173-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb173-17"><a href="#cb173-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb173-18"><a href="#cb173-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The main group and summarise</span></span>
<span id="cb173-19"><a href="#cb173-19" aria-hidden="true" tabindex="-1"></a>  gm <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb173-20"><a href="#cb173-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="fu">across</span>({{groupers}})) <span class="sc">%&gt;%</span></span>
<span id="cb173-21"><a href="#cb173-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="fu">across</span>({{sumcols}}, <span class="sc">~</span><span class="fu">sumfun</span>(., <span class="at">indices =</span> <span class="fu">cur_group_rows</span>(), <span class="at">FUN =</span> FUN, <span class="at">datavecs =</span> datavecs, ...), <span class="at">.names =</span> funcolname)) <span class="sc">%&gt;%</span></span>
<span id="cb173-22"><a href="#cb173-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb173-23"><a href="#cb173-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(gm)</span>
<span id="cb173-24"><a href="#cb173-24" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>That does work just as above. I’m not sure which will be cleaner in practice, but I like that this relies less on borrowing variables from the creating environment.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-91_37d7da0ff74354341da60e6c94749458">
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="fu">newfun</span>(nacars,</span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">groupers =</span> gear,</span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">sumcols =</span> nampg,</span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">FUN =</span> weighted.mean, <span class="at">dataargs =</span> wt, <span class="at">dataargnames =</span> <span class="st">'w'</span>, </span>
<span id="cb174-5"><a href="#cb174-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
   gear weighted.mean_nampg
  &lt;dbl&gt;               &lt;dbl&gt;
1     3                15.0
2     4                22.4
3     5                15.8</code></pre>
</div>
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="fu">newfun</span>(nacars,</span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">groupers =</span> gear,</span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">sumcols =</span> nampg,</span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">FUN =</span> multidat, <span class="at">dataargs =</span> <span class="fu">c</span>(wt, cyl, hp), <span class="at">dataargnames =</span> <span class="fu">c</span>(<span class="st">'w'</span>, <span class="st">'m'</span>, <span class="st">'d'</span>), </span>
<span id="cb176-5"><a href="#cb176-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
   gear multidat_nampg
  &lt;dbl&gt;          &lt;dbl&gt;
1     3          0.615
2     4          1.22 
3     5          0.479</code></pre>
</div>
</div>
</section>
</section>
<section id="multiple-functions--with-appropriate-named-outputs" class="level2">
<h2 class="anchored" data-anchor-id="multiple-functions--with-appropriate-named-outputs">Multiple functions- with appropriate named outputs</h2>
<section id="simple---hardcoded-number-of-functions" class="level3">
<h3 class="anchored" data-anchor-id="simple---hardcoded-number-of-functions">Simple - hardcoded number of functions</h3>
<p>Sometimes we might want to calculate multiple summary or mutate functions for the same set of data, and so rather than repeating the above functions multiple times with different <code>FUN</code> arguments, it would be good to be able to send them all at once for one run-through. The simplest way to do this is to have a <em>known</em> number of functions and write that number of summaries, e.g.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-92_5300ed574d15a2c1142a511c2cebc9e1">
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a>simplemultifun <span class="ot">&lt;-</span> <span class="cf">function</span>(data, groupers, sumcols,</span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a>                         FUN1, dataargs1, <span class="at">dataargnames1 =</span> <span class="cn">NULL</span>,</span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a>                         FUN2, dataargs2, <span class="at">dataargnames2 =</span> <span class="cn">NULL</span>, ...) {</span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># function name as character</span></span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a>  funname1 <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">substitute</span>(FUN1))</span>
<span id="cb178-6"><a href="#cb178-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This just avoids clutter in the summarise</span></span>
<span id="cb178-7"><a href="#cb178-7" aria-hidden="true" tabindex="-1"></a>  funcolname1 <span class="ot">&lt;-</span> <span class="fu">paste0</span>(funname1, <span class="st">'_{.col}'</span>)</span>
<span id="cb178-8"><a href="#cb178-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb178-9"><a href="#cb178-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># function name as character</span></span>
<span id="cb178-10"><a href="#cb178-10" aria-hidden="true" tabindex="-1"></a>  funname2 <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">substitute</span>(FUN2))</span>
<span id="cb178-11"><a href="#cb178-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This just avoids clutter in the summarise</span></span>
<span id="cb178-12"><a href="#cb178-12" aria-hidden="true" tabindex="-1"></a>  funcolname2 <span class="ot">&lt;-</span> <span class="fu">paste0</span>(funname2, <span class="st">'_{.col}'</span>)</span>
<span id="cb178-13"><a href="#cb178-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb178-14"><a href="#cb178-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make a tibble so it doesn't collapse to vector if only one column</span></span>
<span id="cb178-15"><a href="#cb178-15" aria-hidden="true" tabindex="-1"></a>  datavecs1 <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb178-16"><a href="#cb178-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb178-17"><a href="#cb178-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>({{dataargs1}})</span>
<span id="cb178-18"><a href="#cb178-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb178-19"><a href="#cb178-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(dataargnames1)) {</span>
<span id="cb178-20"><a href="#cb178-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(datavecs1) <span class="ot">&lt;-</span> dataargnames1</span>
<span id="cb178-21"><a href="#cb178-21" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb178-22"><a href="#cb178-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb178-23"><a href="#cb178-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make a tibble so it doesn't collapse to vector if only one column</span></span>
<span id="cb178-24"><a href="#cb178-24" aria-hidden="true" tabindex="-1"></a>  datavecs2 <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb178-25"><a href="#cb178-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb178-26"><a href="#cb178-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>({{dataargs2}})</span>
<span id="cb178-27"><a href="#cb178-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb178-28"><a href="#cb178-28" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(dataargnames2)) {</span>
<span id="cb178-29"><a href="#cb178-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(datavecs2) <span class="ot">&lt;-</span> dataargnames2</span>
<span id="cb178-30"><a href="#cb178-30" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb178-31"><a href="#cb178-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb178-32"><a href="#cb178-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb178-33"><a href="#cb178-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The main group and summarise</span></span>
<span id="cb178-34"><a href="#cb178-34" aria-hidden="true" tabindex="-1"></a>  gm <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb178-35"><a href="#cb178-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="fu">across</span>({{groupers}})) <span class="sc">%&gt;%</span></span>
<span id="cb178-36"><a href="#cb178-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="fu">across</span>({{sumcols}},</span>
<span id="cb178-37"><a href="#cb178-37" aria-hidden="true" tabindex="-1"></a>                     <span class="sc">~</span><span class="fu">sumfun</span>(., <span class="at">indices =</span> <span class="fu">cur_group_rows</span>(), </span>
<span id="cb178-38"><a href="#cb178-38" aria-hidden="true" tabindex="-1"></a>                             <span class="at">FUN =</span> FUN1, <span class="at">datavecs =</span> datavecs1, ...),</span>
<span id="cb178-39"><a href="#cb178-39" aria-hidden="true" tabindex="-1"></a>                     <span class="at">.names =</span> funcolname1),</span>
<span id="cb178-40"><a href="#cb178-40" aria-hidden="true" tabindex="-1"></a>              <span class="fu">across</span>({{sumcols}},</span>
<span id="cb178-41"><a href="#cb178-41" aria-hidden="true" tabindex="-1"></a>                     <span class="sc">~</span><span class="fu">sumfun</span>(., <span class="at">indices =</span> <span class="fu">cur_group_rows</span>(),</span>
<span id="cb178-42"><a href="#cb178-42" aria-hidden="true" tabindex="-1"></a>                             <span class="at">FUN =</span> FUN2, <span class="at">datavecs =</span> datavecs2, ...),</span>
<span id="cb178-43"><a href="#cb178-43" aria-hidden="true" tabindex="-1"></a>                     <span class="at">.names =</span> funcolname2)) <span class="sc">%&gt;%</span></span>
<span id="cb178-44"><a href="#cb178-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb178-45"><a href="#cb178-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(gm)</span>
<span id="cb178-46"><a href="#cb178-46" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then as an example, let’s do a weighted mean but unweighted sd. note that they need to share the dots.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-93_db9e5accb43fa261348eb185a7027913">
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="fu">simplemultifun</span>(nacars,</span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">groupers =</span> gear,</span>
<span id="cb179-3"><a href="#cb179-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">sumcols =</span> nampg,</span>
<span id="cb179-4"><a href="#cb179-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">FUN1 =</span> weighted.mean, <span class="at">dataargs1 =</span> wt, <span class="at">dataargnames1 =</span> <span class="st">'w'</span>,</span>
<span id="cb179-5"><a href="#cb179-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">FUN2 =</span> sd,</span>
<span id="cb179-6"><a href="#cb179-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
   gear weighted.mean_nampg sd_nampg
  &lt;dbl&gt;               &lt;dbl&gt;    &lt;dbl&gt;
1     3                15.0     3.90
2     4                22.4     5.13
3     5                15.8    NA   </code></pre>
</div>
</div>
<p>That works, but is really hardcoded in terms of what we can do. It <em>has</em> to have two functions. So, let’s try to say we can pass an arbitrary set of functions from 1 to n.</p>
<p><em>Note that a different data structure out the end is likely to be warranted, especially if we calculate these functions on multiple variables.</em>- making this long with a column for the variable name and then the values of the functions might be the way to go if we do this for multiple variables.</p>
</section>
<section id="variable-number-of-functions" class="level3">
<h3 class="anchored" data-anchor-id="variable-number-of-functions">Variable number of functions</h3>
<p>What we really want here is to be able to pass in an arbitrary number of functions. That will get complicated if they have things like different data-variable arguments. In the simplest case, we can make the FUNS a list, and summarise just handles it. However, this breaks the names and the dots for arguments- the list needs to have all the info in it.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-94_0e61d60dc2ae40d5331f8018dd84f804">
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a>funmulti <span class="ot">&lt;-</span> <span class="cf">function</span>(data, groupers, sumcols,</span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a>                    FUNS, ...) {</span>
<span id="cb181-3"><a href="#cb181-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb181-4"><a href="#cb181-4" aria-hidden="true" tabindex="-1"></a>  gm <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb181-5"><a href="#cb181-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="fu">across</span>({{groupers}})) <span class="sc">%&gt;%</span></span>
<span id="cb181-6"><a href="#cb181-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="fu">across</span>({{sumcols}}, FUNS)) <span class="sc">%&gt;%</span></span>
<span id="cb181-7"><a href="#cb181-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb181-8"><a href="#cb181-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(gm)</span>
<span id="cb181-9"><a href="#cb181-9" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If the list is named (using <code>lst</code> here, but <code>list(mean = mean, sd = sd)</code> would work too), those names get appended.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-95_97192c147a671cab6182524261085eb2">
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="fu">funmulti</span>(nacars,</span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">groupers =</span> gear,</span>
<span id="cb182-3"><a href="#cb182-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">sumcols =</span> mpg,</span>
<span id="cb182-4"><a href="#cb182-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">FUNS =</span> <span class="fu">lst</span>(mean, sd))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
   gear mpg_mean mpg_sd
  &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;
1     3     16.1   3.37
2     4     24.5   5.28
3     5     21.4   6.66</code></pre>
</div>
</div>
<p>That approach should work for arbitrary arguments if I use the tilde notation, and even allows data variables. This is a bit messier in the function call than I’d like, and there’s a bit less control over the names, but I think neither of those are major issues. Would be hard to be less verbose, really, and still have argument specification make any sense across multiple functions.</p>
<p>Actually, can I control the names with <code>.names</code> after all?</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-96_06e7b33c02a00df1adad0e832ac901bb">
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a>funmulti <span class="ot">&lt;-</span> <span class="cf">function</span>(data, groupers, sumcols,</span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a>                    FUNS, ...) {</span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb184-4"><a href="#cb184-4" aria-hidden="true" tabindex="-1"></a><span class="co"># nameparser &lt;- paste0('prefix_{.fn}_{.col}')</span></span>
<span id="cb184-5"><a href="#cb184-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb184-6"><a href="#cb184-6" aria-hidden="true" tabindex="-1"></a>  gm <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb184-7"><a href="#cb184-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="fu">across</span>({{groupers}})) <span class="sc">%&gt;%</span></span>
<span id="cb184-8"><a href="#cb184-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="fu">across</span>({{sumcols}}, FUNS, </span>
<span id="cb184-9"><a href="#cb184-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">.names =</span> <span class="st">'prefix_{.fn}_{.col}'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb184-10"><a href="#cb184-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb184-11"><a href="#cb184-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(gm)</span>
<span id="cb184-12"><a href="#cb184-12" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><em>As of {dplyr} 1.1, this no longer works- it looks for <code>wt</code></em> <em>as an object, not a data-variable. We’ll need to find a new solution.</em></p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-97_c278877ca89b629bfa372e5b4235c3b6">
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="fu">funmulti</span>(nacars, </span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">groupers =</span> gear, </span>
<span id="cb185-3"><a href="#cb185-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">sumcols =</span> nampg,</span>
<span id="cb185-4"><a href="#cb185-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">FUNS =</span> <span class="fu">list</span>(<span class="at">mean =</span> <span class="sc">~</span><span class="fu">mean</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb185-5"><a href="#cb185-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">sd =</span> <span class="sc">~</span><span class="fu">sd</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb185-6"><a href="#cb185-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">wm =</span> <span class="sc">~</span><span class="fu">weighted.mean</span>(., wt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in `summarise()`:
ℹ In argument: `across(nampg, FUNS, .names = "prefix_{.fn}_{.col}")`.
ℹ In group 1: `gear = 3`.
Caused by error in `across()`:
! Can't compute column `prefix_wm_nampg`.
Caused by error:
! object 'wt' not found</code></pre>
</div>
</div>
<p>Note that now the function args in the list work with data-variables and scalars, not with vectors passed in. This is not solely because of the grouping needing to be handled as we did above with the <code>sumfun</code> cutting to the correct indices, because even if we don’t group, we get errors about promise evals. This is because the FUNS list is being evaluated <em>inside</em> the summarise, and so thinks everything is a data-variable. There is probably a way to sort that out by using <code>.env[['variablename']]</code> in the specification, but that’ll just get more complex than just adding the column to the dataframe if we hit this situation. Especially since we’d have to pass the vector in so it’s available inside the <code>funmulti</code> environment, not just the global environment.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-98_b0dd45af7596a0a728ab64e1a6f3b61e">
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a>outerweights <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(nacars)</span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-3"><a href="#cb187-3" aria-hidden="true" tabindex="-1"></a><span class="fu">funmulti</span>(nacars,</span>
<span id="cb187-4"><a href="#cb187-4" aria-hidden="true" tabindex="-1"></a>         <span class="co"># groupers = gear,</span></span>
<span id="cb187-5"><a href="#cb187-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">sumcols =</span> nampg,</span>
<span id="cb187-6"><a href="#cb187-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">FUNS =</span> <span class="fu">list</span>(<span class="at">mean =</span> <span class="sc">~</span><span class="fu">mean</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb187-7"><a href="#cb187-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">sd =</span> <span class="sc">~</span><span class="fu">sd</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb187-8"><a href="#cb187-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">wm =</span> <span class="sc">~</span><span class="fu">weighted.mean</span>(., <span class="at">w =</span> outerweights, </span>
<span id="cb187-9"><a href="#cb187-9" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  prefix_mean_nampg prefix_sd_nampg prefix_wm_nampg
              &lt;dbl&gt;           &lt;dbl&gt;           &lt;dbl&gt;
1              18.3            5.56            18.9</code></pre>
</div>
</div>
<p>Could we do something fancy with a list of FUNS and lists of arglists, parallelling how we did things above? Probably. I think in most instances though, this approach will work. I’ll develop that more complex situation only if needed.</p>
</section>
</section>
<section id="bringing-it-all-together" class="level2">
<h2 class="anchored" data-anchor-id="bringing-it-all-together">Bringing it all together</h2>
<p>Now, let’s choose a couple grouping columns, a selection of cols to summarise, and multiple summary functions, some with data arguments and some that are custom.</p>
<p><em>None of this works as of dplyr 1.1.</em> The issue is that with new behaviour in dplyr, it is looking for the additional arguments not in the column names but as objects. See section below.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-99_bc88ba8d1d75a3c8cdbb5185807812bb">
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a>complexSummary <span class="ot">&lt;-</span> <span class="fu">funmulti</span>(nacars, </span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">groupers =</span> <span class="fu">c</span>(gear, carb), </span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">sumcols =</span> <span class="fu">c</span>(<span class="fu">starts_with</span>(<span class="st">'d'</span>), nampg),</span>
<span id="cb189-4"><a href="#cb189-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">FUNS =</span> <span class="fu">list</span>(<span class="at">mean =</span> <span class="sc">~</span><span class="fu">mean</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb189-5"><a href="#cb189-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">sd =</span> <span class="sc">~</span><span class="fu">sd</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb189-6"><a href="#cb189-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">wm =</span> <span class="sc">~</span><span class="fu">weighted.mean</span>(., wt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb189-7"><a href="#cb189-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">custom =</span> <span class="sc">~</span><span class="fu">multidat</span>(., <span class="at">w =</span> wt, <span class="at">d =</span> cyl, <span class="at">m =</span> hp,</span>
<span id="cb189-8"><a href="#cb189-8" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">na.rm =</span> <span class="cn">FALSE</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in `summarise()`:
ℹ In argument: `across(c(starts_with("d"), nampg), FUNS, .names =
  "prefix_{.fn}_{.col}")`.
ℹ In group 1: `gear = 3`, `carb = 1`.
Caused by error in `across()`:
! Can't compute column `prefix_wm_disp`.
Caused by error:
! object 'wt' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a>complexSummary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'complexSummary' not found</code></pre>
</div>
</div>
<p>This is complex enough it’s probably useful to <code>pivot_longer</code></p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-100_3853bdc634c8d6934716ce9f625b5498">
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a>longsums <span class="ot">&lt;-</span> complexSummary <span class="sc">%&gt;%</span> </span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(gear, carb), </span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">'variable'</span>, <span class="st">'summary_statistic'</span>),</span>
<span id="cb193-4"><a href="#cb193-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_sep =</span> <span class="st">'_'</span>,</span>
<span id="cb193-5"><a href="#cb193-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">'value'</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'complexSummary' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a>longsums</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'longsums' not found</code></pre>
</div>
</div>
<p>But that actually puts a lot of values with different meaning in the same <code>value</code> column. What’s probably better is to give different statistics their own columns, as sort of an intermediate long/wide.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-101_1eaf4dc2bae69c47d97bdb3dbda71b5a">
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a>longwide <span class="ot">&lt;-</span> longsums <span class="sc">%&gt;%</span> </span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> summary_statistic, <span class="at">values_from =</span> value) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'longsums' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a>longwide</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'longwide' not found</code></pre>
</div>
</div>
<p>Anyway, this sort of arrangement isn’t the point of this document, so I’ll stop there.</p>
</section>
<section id="adjusting-to-dplyr-1.1" class="level2">
<h2 class="anchored" data-anchor-id="adjusting-to-dplyr-1.1">Adjusting to dplyr 1.1</h2>
<p>As of dplyr 1.1, new behaviour means that if we pass multi-argument functions, it looks for the additional arguments not as data-variables (column names), but as objects. E.g., we now get errors for all the <code>weighted.mean</code> calls above, since it cannot find a <code>wt</code> object when <code>wt</code> is a column name.</p>
<p>This is discussed as a <a href="https://github.com/tidyverse/dplyr/issues/6809~">dplyr github issue</a>, where there is a workaround using <code>rlang::quo</code>, but I really don’t like it for a couple reasons, primarily that it forces a user to wrap their code in <code>rlang::quo</code>, and it matters where in the call stack the function gets defined. I’m not sure I’ll figure anything out that works better for me, since the tidyverse people came up with the workaround, but I need to try.</p>
<section id="re-demoing-the-issue" class="level3">
<h3 class="anchored" data-anchor-id="re-demoing-the-issue">Re-demoing the issue</h3>
<p>That workaround uses <code>{{}}</code> around FUNS in the function. Building on <code>funmulti</code> above,</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-102_329aad2eded103c21a3402ef2ac952fe">
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a>funbrace <span class="ot">&lt;-</span> <span class="cf">function</span>(data, groupers, sumcols,</span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a>                    FUNS, ...) {</span>
<span id="cb201-3"><a href="#cb201-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb201-4"><a href="#cb201-4" aria-hidden="true" tabindex="-1"></a>  gm <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb201-5"><a href="#cb201-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="fu">across</span>({{groupers}})) <span class="sc">%&gt;%</span></span>
<span id="cb201-6"><a href="#cb201-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="fu">across</span>({{sumcols}}, {{FUNS}}, </span>
<span id="cb201-7"><a href="#cb201-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">.names =</span> <span class="st">'prefix_{.fn}_{.col}'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb201-8"><a href="#cb201-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb201-9"><a href="#cb201-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(gm)</span>
<span id="cb201-10"><a href="#cb201-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>That actually works when we define the function to call <em>inside the function argument</em>.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-103_68dad5580c6852c923a20f62ed914674">
<div class="sourceCode cell-code" id="cb202"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a>bracecheck <span class="ot">&lt;-</span> <span class="fu">funbrace</span>(nacars, </span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">groupers =</span> <span class="fu">c</span>(gear, carb), </span>
<span id="cb202-3"><a href="#cb202-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">sumcols =</span> <span class="fu">c</span>(<span class="fu">starts_with</span>(<span class="st">'d'</span>), nampg),</span>
<span id="cb202-4"><a href="#cb202-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">FUNS =</span> <span class="fu">list</span>(<span class="at">mean =</span> <span class="sc">~</span><span class="fu">mean</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb202-5"><a href="#cb202-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">wm =</span> <span class="sc">~</span><span class="fu">weighted.mean</span>(., wt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'gear'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb204"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a>bracecheck</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 8
    gear  carb prefix_mean_disp prefix_wm_disp prefix_mean_drat prefix_wm_drat
   &lt;dbl&gt; &lt;dbl&gt;            &lt;dbl&gt;          &lt;dbl&gt;            &lt;dbl&gt;          &lt;dbl&gt;
 1     3     1            201.           208.              3.18           3.13
 2     3     2            346.           347.              3.04           3.03
 3     3     3            276.           276.              3.07           3.07
 4     3     4            416.           425.              3.22           3.19
 5     4     1             84.2           85.3             4.06           4.05
 6     4     2            121.           128.              4.16           4.05
 7     4     4            164.           164.              3.91           3.91
 8     5     2            108.           110.              4.1            4.16
 9     5     4            351            351               4.22           4.22
10     5     6            145            145               3.62           3.62
11     5     8            301            301               3.54           3.54
# ℹ 2 more variables: prefix_mean_nampg &lt;dbl&gt;, prefix_wm_nampg &lt;dbl&gt;</code></pre>
</div>
</div>
<p>However, if we define the functions to call in an object, it fails</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-104_455822bf7d155e70aa7fece53e9da393">
<div class="sourceCode cell-code" id="cb206"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a>funstocall <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">mean =</span> <span class="sc">~</span><span class="fu">mean</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb206-2"><a href="#cb206-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">wm =</span> <span class="sc">~</span><span class="fu">weighted.mean</span>(., rlang<span class="sc">::</span><span class="fu">data_sym</span>(<span class="st">'wt'</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb206-3"><a href="#cb206-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-4"><a href="#cb206-4" aria-hidden="true" tabindex="-1"></a>bracecheck2 <span class="ot">&lt;-</span> <span class="fu">funbrace</span>(nacars, </span>
<span id="cb206-5"><a href="#cb206-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">groupers =</span> <span class="fu">c</span>(gear, carb), </span>
<span id="cb206-6"><a href="#cb206-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">sumcols =</span> <span class="fu">c</span>(<span class="fu">starts_with</span>(<span class="st">'d'</span>), nampg),</span>
<span id="cb206-7"><a href="#cb206-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">FUNS =</span> funstocall)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in `summarise()`:
ℹ In argument: `across(c(starts_with("d"), nampg), funstocall, .names =
  "prefix_{.fn}_{.col}")`.
ℹ In group 1: `gear = 3`, `carb = 1`.
Caused by error in `across()`:
! Can't compute column `prefix_wm_disp`.
Caused by error in `x * w`:
! non-numeric argument to binary operator</code></pre>
</div>
<div class="sourceCode cell-code" id="cb208"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a>bracecheck2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'bracecheck2' not found</code></pre>
</div>
</div>
<p>And the ‘solution’ is to use <code>rlang::quo</code> , followed by <code>!!</code> in the call</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-105_5dc8d173d3475673094037b4ac607c53">
<div class="sourceCode cell-code" id="cb210"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a>funstocallq <span class="ot">&lt;-</span> rlang<span class="sc">::</span><span class="fu">quo</span>(<span class="fu">list</span>(<span class="at">mean =</span> <span class="sc">~</span><span class="fu">mean</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb210-2"><a href="#cb210-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">wm =</span> <span class="sc">~</span><span class="fu">weighted.mean</span>(., wt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb210-3"><a href="#cb210-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-4"><a href="#cb210-4" aria-hidden="true" tabindex="-1"></a>bracecheckq <span class="ot">&lt;-</span> <span class="fu">funbrace</span>(nacars, </span>
<span id="cb210-5"><a href="#cb210-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">groupers =</span> <span class="fu">c</span>(gear, carb), </span>
<span id="cb210-6"><a href="#cb210-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">sumcols =</span> <span class="fu">c</span>(<span class="fu">starts_with</span>(<span class="st">'d'</span>), nampg),</span>
<span id="cb210-7"><a href="#cb210-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">FUNS =</span> <span class="sc">!!</span>funstocallq)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'gear'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb212"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a>bracecheckq</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 8
    gear  carb prefix_mean_disp prefix_wm_disp prefix_mean_drat prefix_wm_drat
   &lt;dbl&gt; &lt;dbl&gt;            &lt;dbl&gt;          &lt;dbl&gt;            &lt;dbl&gt;          &lt;dbl&gt;
 1     3     1            201.           208.              3.18           3.13
 2     3     2            346.           347.              3.04           3.03
 3     3     3            276.           276.              3.07           3.07
 4     3     4            416.           425.              3.22           3.19
 5     4     1             84.2           85.3             4.06           4.05
 6     4     2            121.           128.              4.16           4.05
 7     4     4            164.           164.              3.91           3.91
 8     5     2            108.           110.              4.1            4.16
 9     5     4            351            351               4.22           4.22
10     5     6            145            145               3.62           3.62
11     5     8            301            301               3.54           3.54
# ℹ 2 more variables: prefix_mean_nampg &lt;dbl&gt;, prefix_wm_nampg &lt;dbl&gt;</code></pre>
</div>
</div>
<p>That works, but it sure requires a lot of fiddling by the user with quosures.</p>
<p>We can bring the <code>!!</code> inside the function, which seems to work. I’ve run into issues before where this then <em>requires</em> quosures for everything, but it seems to be working here for <code>mean</code>, which doesn’t need the quosure because it doesn’t reference data-variables.</p>
<p>The <code>!!</code> method is</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-106_da11af19f478573d37f581bab72d09a4">
<div class="sourceCode cell-code" id="cb214"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a>fundefuse <span class="ot">&lt;-</span> <span class="cf">function</span>(data, groupers, sumcols,</span>
<span id="cb214-2"><a href="#cb214-2" aria-hidden="true" tabindex="-1"></a>                    FUNS, ...) {</span>
<span id="cb214-3"><a href="#cb214-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb214-4"><a href="#cb214-4" aria-hidden="true" tabindex="-1"></a>  gm <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb214-5"><a href="#cb214-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="fu">across</span>({{groupers}})) <span class="sc">%&gt;%</span></span>
<span id="cb214-6"><a href="#cb214-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="fu">across</span>({{sumcols}}, <span class="sc">!!</span>FUNS, </span>
<span id="cb214-7"><a href="#cb214-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">.names =</span> <span class="st">'prefix_{.fn}_{.col}'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb214-8"><a href="#cb214-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb214-9"><a href="#cb214-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(gm)</span>
<span id="cb214-10"><a href="#cb214-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And so now we don’t have to defuse in the function call.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-107_b3860d4d91c2f4c4f48085a213d4a181">
<div class="sourceCode cell-code" id="cb215"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a>funstocallq <span class="ot">&lt;-</span> rlang<span class="sc">::</span><span class="fu">quo</span>(<span class="fu">c</span>(<span class="at">mean =</span> <span class="sc">~</span><span class="fu">mean</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb215-2"><a href="#cb215-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">wm =</span> <span class="sc">~</span><span class="fu">weighted.mean</span>(., wt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb215-3"><a href="#cb215-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-4"><a href="#cb215-4" aria-hidden="true" tabindex="-1"></a>defusecheckb <span class="ot">&lt;-</span> <span class="fu">fundefuse</span>(nacars, </span>
<span id="cb215-5"><a href="#cb215-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">groupers =</span> <span class="fu">c</span>(gear, carb), </span>
<span id="cb215-6"><a href="#cb215-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">sumcols =</span> <span class="fu">c</span>(<span class="fu">starts_with</span>(<span class="st">'d'</span>), nampg),</span>
<span id="cb215-7"><a href="#cb215-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">FUNS =</span> funstocallq)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'gear'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb217"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a>defusecheckb</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 8
    gear  carb prefix_mean_disp prefix_wm_disp prefix_mean_drat prefix_wm_drat
   &lt;dbl&gt; &lt;dbl&gt;            &lt;dbl&gt;          &lt;dbl&gt;            &lt;dbl&gt;          &lt;dbl&gt;
 1     3     1            201.           208.              3.18           3.13
 2     3     2            346.           347.              3.04           3.03
 3     3     3            276.           276.              3.07           3.07
 4     3     4            416.           425.              3.22           3.19
 5     4     1             84.2           85.3             4.06           4.05
 6     4     2            121.           128.              4.16           4.05
 7     4     4            164.           164.              3.91           3.91
 8     5     2            108.           110.              4.1            4.16
 9     5     4            351            351               4.22           4.22
10     5     6            145            145               3.62           3.62
11     5     8            301            301               3.54           3.54
# ℹ 2 more variables: prefix_mean_nampg &lt;dbl&gt;, prefix_wm_nampg &lt;dbl&gt;</code></pre>
</div>
</div>
<p>and <code>mean</code> works as well, even when it’s not wrapped in <code>rlang::quo</code> because it doesn’t reference data-variables.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-108_eccabbf17d3d151d2cbbf1cf5a41b097">
<div class="sourceCode cell-code" id="cb219"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a>funmean <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">mean =</span> <span class="sc">~</span><span class="fu">mean</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb219-2"><a href="#cb219-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-3"><a href="#cb219-3" aria-hidden="true" tabindex="-1"></a>defusecheckm <span class="ot">&lt;-</span> <span class="fu">fundefuse</span>(nacars, </span>
<span id="cb219-4"><a href="#cb219-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">groupers =</span> <span class="fu">c</span>(gear, carb), </span>
<span id="cb219-5"><a href="#cb219-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">sumcols =</span> <span class="fu">c</span>(<span class="fu">starts_with</span>(<span class="st">'d'</span>), nampg),</span>
<span id="cb219-6"><a href="#cb219-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">FUNS =</span> funmean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'gear'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb221"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a>defusecheckm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 5
    gear  carb prefix_mean_disp prefix_mean_drat prefix_mean_nampg
   &lt;dbl&gt; &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;             &lt;dbl&gt;
 1     3     1            201.              3.18              21.5
 2     3     2            346.              3.04              19.0
 3     3     3            276.              3.07              16.8
 4     3     4            416.              3.22              12.1
 5     4     1             84.2             4.06              27.3
 6     4     2            121.              4.16              25.9
 7     4     4            164.              3.91              19.4
 8     5     2            108.              4.1              NaN  
 9     5     4            351               4.22              15.8
10     5     6            145               3.62             NaN  
11     5     8            301               3.54             NaN  </code></pre>
</div>
</div>
</section>
<section id="searching-for-a-solution" class="level3">
<h3 class="anchored" data-anchor-id="searching-for-a-solution">Searching for a solution</h3>
<p>I really don’t want to require quosures. And I want to be able to pass character function names.</p>
<section id="make-reference-internal-to-a-custom-function" class="level4">
<h4 class="anchored" data-anchor-id="make-reference-internal-to-a-custom-function">Make reference internal to a custom function?</h4>
<p>Attempt 1: can I simply define a function with the data-var internally referenced so it only takes one argument? I doubt it, but that might be the easiest.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-109_f0fd7d419973847fae35cf6c779d2f83">
<div class="sourceCode cell-code" id="cb223"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a>weightcars <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb223-2"><a href="#cb223-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">weighted.mean</span>(x, <span class="at">w =</span> wt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb223-3"><a href="#cb223-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>That doesn’t work with either the <code>!!</code> or <code>{{}}</code> method.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-110_c5c242c55bec5ea48d234a90a2959712">
<div class="sourceCode cell-code" id="cb224"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a>funscustom <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">mean =</span> <span class="sc">~</span><span class="fu">mean</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb224-2"><a href="#cb224-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">wm =</span> <span class="sc">~</span><span class="fu">weightcars</span>(.))</span>
<span id="cb224-3"><a href="#cb224-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-4"><a href="#cb224-4" aria-hidden="true" tabindex="-1"></a>defusecheckc <span class="ot">&lt;-</span> <span class="fu">fundefuse</span>(nacars, </span>
<span id="cb224-5"><a href="#cb224-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">groupers =</span> <span class="fu">c</span>(gear, carb), </span>
<span id="cb224-6"><a href="#cb224-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">sumcols =</span> <span class="fu">c</span>(<span class="fu">starts_with</span>(<span class="st">'d'</span>), nampg),</span>
<span id="cb224-7"><a href="#cb224-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">FUNS =</span> funscustom)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in `summarise()`:
ℹ In argument: `across(...)`.
ℹ In group 1: `gear = 3`, `carb = 1`.
Caused by error in `across()`:
! Can't compute column `prefix_wm_disp`.
Caused by error in `weightcars()`:
! object 'wt' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb226"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a>defusecheckc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'defusecheckc' not found</code></pre>
</div>
</div>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-111_bc5014c5f3e4b7e39e2c25c62e9b40d5">
<div class="sourceCode cell-code" id="cb228"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a>bracecheckc <span class="ot">&lt;-</span> <span class="fu">funbrace</span>(nacars, </span>
<span id="cb228-2"><a href="#cb228-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">groupers =</span> <span class="fu">c</span>(gear, carb), </span>
<span id="cb228-3"><a href="#cb228-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">sumcols =</span> <span class="fu">c</span>(<span class="fu">starts_with</span>(<span class="st">'d'</span>), nampg),</span>
<span id="cb228-4"><a href="#cb228-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">FUNS =</span> funscustom)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in `summarise()`:
ℹ In argument: `across(c(starts_with("d"), nampg), funscustom, .names =
  "prefix_{.fn}_{.col}")`.
ℹ In group 1: `gear = 3`, `carb = 1`.
Caused by error in `across()`:
! Can't compute column `prefix_wm_disp`.
Caused by error in `weightcars()`:
! object 'wt' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb230"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a>bracecheckc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'bracecheckc' not found</code></pre>
</div>
</div>
<p>And that doesn’t even work with the <code>rlang::quo</code> wrapper (unsurprisingly, I suppose).</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-112_21e6bb7bcfc1cc66047f78418c0d6e1e">
<div class="sourceCode cell-code" id="cb232"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a>funscustom <span class="ot">&lt;-</span> rlang<span class="sc">::</span><span class="fu">quo</span>(<span class="fu">list</span>(<span class="at">mean =</span> <span class="sc">~</span><span class="fu">mean</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb232-2"><a href="#cb232-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">wm =</span> <span class="sc">~</span><span class="fu">weightcars</span>(.)))</span>
<span id="cb232-3"><a href="#cb232-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-4"><a href="#cb232-4" aria-hidden="true" tabindex="-1"></a>defusecheckc <span class="ot">&lt;-</span> <span class="fu">fundefuse</span>(nacars, </span>
<span id="cb232-5"><a href="#cb232-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">groupers =</span> <span class="fu">c</span>(gear, carb), </span>
<span id="cb232-6"><a href="#cb232-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">sumcols =</span> <span class="fu">c</span>(<span class="fu">starts_with</span>(<span class="st">'d'</span>), nampg),</span>
<span id="cb232-7"><a href="#cb232-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">FUNS =</span> funscustom)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in `summarise()`:
ℹ In argument: `across(...)`.
ℹ In group 1: `gear = 3`, `carb = 1`.
Caused by error in `across()`:
! Can't compute column `prefix_wm_disp`.
Caused by error in `weightcars()`:
! object 'wt' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb234"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a>defusecheckc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'defusecheckc' not found</code></pre>
</div>
</div>
</section>
<section id="modify-the-aggregation-function-somehow" class="level4">
<h4 class="anchored" data-anchor-id="modify-the-aggregation-function-somehow">Modify the aggregation function somehow</h4>
<p>My basic thought here is whether I can auto-build the data referencing. I’ve tried using <code>rlang::data_sym</code> in the weighted mean function, and doing a bunch of other things, but I haven’t come up with anything yet. Maybe <code>rlang::inject</code>?</p>
<p>Even if I specify the FUNS as a list <em>inside</em> the function, I need the <code>rlang::quo</code>. Which is surprising, since I <em>don’t</em> need it if they’re specified as a function argument. I’m missing something about quoting, I think.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-113_ad6a0727b07150586a8c699b827382aa">
<div class="sourceCode cell-code" id="cb236"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a>funbrace <span class="ot">&lt;-</span> <span class="cf">function</span>(data, groupers, sumcols,</span>
<span id="cb236-2"><a href="#cb236-2" aria-hidden="true" tabindex="-1"></a>                    FUNS, ...) {</span>
<span id="cb236-3"><a href="#cb236-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb236-4"><a href="#cb236-4" aria-hidden="true" tabindex="-1"></a>  gm <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb236-5"><a href="#cb236-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="fu">across</span>({{groupers}})) <span class="sc">%&gt;%</span></span>
<span id="cb236-6"><a href="#cb236-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="fu">across</span>({{sumcols}}, {{FUNS}}, </span>
<span id="cb236-7"><a href="#cb236-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">.names =</span> <span class="st">'prefix_{.fn}_{.col}'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb236-8"><a href="#cb236-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb236-9"><a href="#cb236-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(gm)</span>
<span id="cb236-10"><a href="#cb236-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="different-formulat-specification" class="level4">
<h4 class="anchored" data-anchor-id="different-formulat-specification">Different formulat specification</h4>
<p>What if instead of using the formula version of anonymous functions, we use <code>\(x)</code>? I think this will behave like the custom <code>weightcars</code> above, but maybe we can have more control inside the aggregation function?</p>
<p>First, does it work with the <code>quo</code>?</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-114_a1edf40a885d10e285057de68619d068">
<div class="sourceCode cell-code" id="cb237"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a>anonq <span class="ot">&lt;-</span> rlang<span class="sc">::</span><span class="fu">quo</span>(<span class="fu">list</span>(<span class="at">mean =</span> \(x) <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb237-2"><a href="#cb237-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">wm =</span> \(x) <span class="fu">weighted.mean</span>(x, wt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-115_6a7d19f87b67726a3f483cc2f07c8a0c">
<div class="sourceCode cell-code" id="cb238"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a>defusechecka <span class="ot">&lt;-</span> <span class="fu">fundefuse</span>(nacars, </span>
<span id="cb238-2"><a href="#cb238-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">groupers =</span> <span class="fu">c</span>(gear, carb), </span>
<span id="cb238-3"><a href="#cb238-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">sumcols =</span> <span class="fu">c</span>(<span class="fu">starts_with</span>(<span class="st">'d'</span>), nampg),</span>
<span id="cb238-4"><a href="#cb238-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">FUNS =</span> anonq)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'gear'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb240"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a>defusechecka</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 8
    gear  carb prefix_mean_disp prefix_wm_disp prefix_mean_drat prefix_wm_drat
   &lt;dbl&gt; &lt;dbl&gt;            &lt;dbl&gt;          &lt;dbl&gt;            &lt;dbl&gt;          &lt;dbl&gt;
 1     3     1            201.           208.              3.18           3.13
 2     3     2            346.           347.              3.04           3.03
 3     3     3            276.           276.              3.07           3.07
 4     3     4            416.           425.              3.22           3.19
 5     4     1             84.2           85.3             4.06           4.05
 6     4     2            121.           128.              4.16           4.05
 7     4     4            164.           164.              3.91           3.91
 8     5     2            108.           110.              4.1            4.16
 9     5     4            351            351               4.22           4.22
10     5     6            145            145               3.62           3.62
11     5     8            301            301               3.54           3.54
# ℹ 2 more variables: prefix_mean_nampg &lt;dbl&gt;, prefix_wm_nampg &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Works with the <code>!!</code> but not <code>{{}}</code>.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-116_d70381ce7f43ca59d569d44a9409a6ce">
<div class="sourceCode cell-code" id="cb242"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a>bracechecka <span class="ot">&lt;-</span> <span class="fu">funbrace</span>(nacars, </span>
<span id="cb242-2"><a href="#cb242-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">groupers =</span> <span class="fu">c</span>(gear, carb), </span>
<span id="cb242-3"><a href="#cb242-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">sumcols =</span> <span class="fu">c</span>(<span class="fu">starts_with</span>(<span class="st">'d'</span>), nampg),</span>
<span id="cb242-4"><a href="#cb242-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">FUNS =</span> anonq)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Returning more (or less) than 1 row per `summarise()` group was deprecated in
dplyr 1.1.0.
ℹ Please use `reframe()` instead.
ℹ When switching from `summarise()` to `reframe()`, remember that `reframe()`
  always returns an ungrouped data frame and adjust accordingly.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'gear', 'carb'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb245"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a>bracechecka</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 22 × 5
    gear  carb prefix_1_disp prefix_1_drat prefix_1_nampg
   &lt;dbl&gt; &lt;dbl&gt; &lt;named list&gt;  &lt;named list&gt;  &lt;named list&gt;  
 1     3     1 &lt;fn&gt;          &lt;fn&gt;          &lt;fn&gt;          
 2     3     1 &lt;fn&gt;          &lt;fn&gt;          &lt;fn&gt;          
 3     3     2 &lt;fn&gt;          &lt;fn&gt;          &lt;fn&gt;          
 4     3     2 &lt;fn&gt;          &lt;fn&gt;          &lt;fn&gt;          
 5     3     3 &lt;fn&gt;          &lt;fn&gt;          &lt;fn&gt;          
 6     3     3 &lt;fn&gt;          &lt;fn&gt;          &lt;fn&gt;          
 7     3     4 &lt;fn&gt;          &lt;fn&gt;          &lt;fn&gt;          
 8     3     4 &lt;fn&gt;          &lt;fn&gt;          &lt;fn&gt;          
 9     4     1 &lt;fn&gt;          &lt;fn&gt;          &lt;fn&gt;          
10     4     1 &lt;fn&gt;          &lt;fn&gt;          &lt;fn&gt;          
# ℹ 12 more rows</code></pre>
</div>
</div>
<p>Now, can we get it to work without <code>quo</code>???</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-117_2d89934fcdd908343a8cb12df9835d0b">
<div class="sourceCode cell-code" id="cb247"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a>anonbare <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">mean =</span> \(x) <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb247-2"><a href="#cb247-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">wm =</span> \(x) <span class="fu">weighted.mean</span>(x, wt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>anonbare &lt;- list(mean = \(x) mean(x, na.rm = TRUE),</p>
<p>Not immediately. but can we modify those functions?</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-118_fa7704bf2bf799d2942df46d80448c84">
<div class="sourceCode cell-code" id="cb248"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true" tabindex="-1"></a>defusecheckab <span class="ot">&lt;-</span> <span class="fu">fundefuse</span>(nacars, </span>
<span id="cb248-2"><a href="#cb248-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">groupers =</span> <span class="fu">c</span>(gear, carb), </span>
<span id="cb248-3"><a href="#cb248-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">sumcols =</span> <span class="fu">c</span>(<span class="fu">starts_with</span>(<span class="st">'d'</span>), nampg),</span>
<span id="cb248-4"><a href="#cb248-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">FUNS =</span> anonbare)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in `summarise()`:
ℹ In argument: `across(...)`.
ℹ In group 1: `gear = 3`, `carb = 1`.
Caused by error in `across()`:
! Can't compute column `prefix_wm_disp`.
Caused by error:
! object 'wt' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb250"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb250-1"><a href="#cb250-1" aria-hidden="true" tabindex="-1"></a>defusecheckab</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'defusecheckab' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb252"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a>bracecheckab <span class="ot">&lt;-</span> <span class="fu">funbrace</span>(nacars, </span>
<span id="cb252-2"><a href="#cb252-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">groupers =</span> <span class="fu">c</span>(gear, carb), </span>
<span id="cb252-3"><a href="#cb252-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">sumcols =</span> <span class="fu">c</span>(<span class="fu">starts_with</span>(<span class="st">'d'</span>), nampg),</span>
<span id="cb252-4"><a href="#cb252-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">FUNS =</span> anonbare)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in `summarise()`:
ℹ In argument: `across(c(starts_with("d"), nampg), anonbare, .names =
  "prefix_{.fn}_{.col}")`.
ℹ In group 1: `gear = 3`, `carb = 1`.
Caused by error in `across()`:
! Can't compute column `prefix_wm_disp`.
Caused by error:
! object 'wt' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb254"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a>bracecheckab</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'bracecheckab' not found</code></pre>
</div>
</div>
</section>
<section id="is-the-answer-to-drop-dplyr" class="level4">
<h4 class="anchored" data-anchor-id="is-the-answer-to-drop-dplyr">Is the answer to drop dplyr?</h4>
<p>I thought about moving to <code>stats::aggregate</code>, but it seems like that is going to cause just as many problems, especially when we get to passing it arbitrary lists of functions. The syntax is just so clumsy (at least to me).</p>
</section>
<section id="does-it-just-work-if-i-give-it-the-vector" class="level4">
<h4 class="anchored" data-anchor-id="does-it-just-work-if-i-give-it-the-vector">Does it just work if I give it the vector?</h4>
<p>This won’t solve the whole problem, and I think it still won’t actually work with the groupings, but should test.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-119_194a13e716104f10a9074905fb4245f7">
<div class="sourceCode cell-code" id="cb256"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb256-1"><a href="#cb256-1" aria-hidden="true" tabindex="-1"></a>anonbarevec <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">mean =</span> \(x) <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb256-2"><a href="#cb256-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">wm =</span> \(x) <span class="fu">weighted.mean</span>(x, nacars<span class="sc">$</span>wt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As expected, that fails because the external vector doesn’t get broken up by the groups.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-120_8c485dee7956d73f90e172236855388d">
<div class="sourceCode cell-code" id="cb257"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true" tabindex="-1"></a>defusecheckab <span class="ot">&lt;-</span> <span class="fu">fundefuse</span>(nacars,  </span>
<span id="cb257-2"><a href="#cb257-2" aria-hidden="true" tabindex="-1"></a>                           <span class="at">groupers =</span> <span class="fu">c</span>(gear, carb),</span>
<span id="cb257-3"><a href="#cb257-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">sumcols =</span> <span class="fu">c</span>(<span class="fu">starts_with</span>(<span class="st">'d'</span>), nampg),</span>
<span id="cb257-4"><a href="#cb257-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">FUNS =</span> anonbarevec) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in `summarise()`:
ℹ In argument: `across(...)`.
ℹ In group 1: `gear = 3`, `carb = 1`.
Caused by error in `across()`:
! Can't compute column `prefix_wm_disp`.
Caused by error in `weighted.mean.default()`:
! 'x' and 'w' must have the same length</code></pre>
</div>
<div class="sourceCode cell-code" id="cb259"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb259-1"><a href="#cb259-1" aria-hidden="true" tabindex="-1"></a>defusecheckab  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'defusecheckab' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb261"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb261-1"><a href="#cb261-1" aria-hidden="true" tabindex="-1"></a>bracecheckab <span class="ot">&lt;-</span> <span class="fu">funbrace</span>(nacars,  </span>
<span id="cb261-2"><a href="#cb261-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">groupers =</span> <span class="fu">c</span>(gear, carb), </span>
<span id="cb261-3"><a href="#cb261-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">sumcols =</span> <span class="fu">c</span>(<span class="fu">starts_with</span>(<span class="st">'d'</span>), nampg),   </span>
<span id="cb261-4"><a href="#cb261-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">FUNS =</span> anonbarevec) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in `summarise()`:
ℹ In argument: `across(c(starts_with("d"), nampg), anonbarevec, .names =
  "prefix_{.fn}_{.col}")`.
ℹ In group 1: `gear = 3`, `carb = 1`.
Caused by error in `across()`:
! Can't compute column `prefix_wm_disp`.
Caused by error in `weighted.mean.default()`:
! 'x' and 'w' must have the same length</code></pre>
</div>
<div class="sourceCode cell-code" id="cb263"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb263-1"><a href="#cb263-1" aria-hidden="true" tabindex="-1"></a>bracecheckab</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'bracecheckab' not found</code></pre>
</div>
</div>
</section>
<section id="build-and-feed-a-character-string" class="level4">
<h4 class="anchored" data-anchor-id="build-and-feed-a-character-string">Build and feed a character string</h4>
<p>We know we need the <code>rlang::quo</code> to get this to work, but we can <em>see</em> the expressions we need in the list inside the function while debugging. So can we build the list wrapped in rlang::quo inside the function? Not very directly, as far as I can tell. But <code>eval(parse(STRING))</code> seems to be a crude way forward.</p>
<p>It works to feed it a character string</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-121_2e643a709ad5294ab7cabbe58d5f4665">
<div class="sourceCode cell-code" id="cb265"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb265-1"><a href="#cb265-1" aria-hidden="true" tabindex="-1"></a>charfuns <span class="ot">&lt;-</span> <span class="st">"rlang::quo(list(mean = function(x) mean(x, na.rm = TRUE), wm = function(x) weighted.mean(x, wt, na.rm = TRUE)))"</span></span>
<span id="cb265-2"><a href="#cb265-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-3"><a href="#cb265-3" aria-hidden="true" tabindex="-1"></a><span class="co"># seems to work. NOW, how can I do that, and do it safely?</span></span>
<span id="cb265-4"><a href="#cb265-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Likely turn the list into characters, then put rlang::quo on it, and round and round we go. Going to need lots of testing.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And a function that parses that</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-122_e776639e5c6c97fb3a36134ddcc7b2ee">
<div class="sourceCode cell-code" id="cb266"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a>funchar <span class="ot">&lt;-</span> <span class="cf">function</span>(data, groupers, sumcols,</span>
<span id="cb266-2"><a href="#cb266-2" aria-hidden="true" tabindex="-1"></a>                     FUNS, ...) {</span>
<span id="cb266-3"><a href="#cb266-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb266-4"><a href="#cb266-4" aria-hidden="true" tabindex="-1"></a>  FUNS <span class="ot">&lt;-</span> <span class="fu">eval</span>(<span class="fu">parse</span>(<span class="at">text =</span> FUNS))</span>
<span id="cb266-5"><a href="#cb266-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb266-6"><a href="#cb266-6" aria-hidden="true" tabindex="-1"></a>  gm <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb266-7"><a href="#cb266-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="fu">across</span>({{groupers}})) <span class="sc">%&gt;%</span></span>
<span id="cb266-8"><a href="#cb266-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="fu">across</span>({{sumcols}}, {{FUNS}}, </span>
<span id="cb266-9"><a href="#cb266-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">.names =</span> <span class="st">'prefix_{.fn}_{.col}'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb266-10"><a href="#cb266-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb266-11"><a href="#cb266-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(gm)</span>
<span id="cb266-12"><a href="#cb266-12" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-123_b348ba28e1ed50898d11d00ab004ae1a">
<div class="sourceCode cell-code" id="cb267"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb267-1"><a href="#cb267-1" aria-hidden="true" tabindex="-1"></a>charcheck <span class="ot">&lt;-</span> <span class="fu">funchar</span>(nacars,  </span>
<span id="cb267-2"><a href="#cb267-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">groupers =</span> <span class="fu">c</span>(gear, carb), </span>
<span id="cb267-3"><a href="#cb267-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">sumcols =</span> <span class="fu">c</span>(<span class="fu">starts_with</span>(<span class="st">'d'</span>), nampg),   </span>
<span id="cb267-4"><a href="#cb267-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">FUNS =</span> charfuns) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'gear'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb269"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb269-1"><a href="#cb269-1" aria-hidden="true" tabindex="-1"></a>charcheck</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 8
    gear  carb prefix_mean_disp prefix_wm_disp prefix_mean_drat prefix_wm_drat
   &lt;dbl&gt; &lt;dbl&gt;            &lt;dbl&gt;          &lt;dbl&gt;            &lt;dbl&gt;          &lt;dbl&gt;
 1     3     1            201.           208.              3.18           3.13
 2     3     2            346.           347.              3.04           3.03
 3     3     3            276.           276.              3.07           3.07
 4     3     4            416.           425.              3.22           3.19
 5     4     1             84.2           85.3             4.06           4.05
 6     4     2            121.           128.              4.16           4.05
 7     4     4            164.           164.              3.91           3.91
 8     5     2            108.           110.              4.1            4.16
 9     5     4            351            351               4.22           4.22
10     5     6            145            145               3.62           3.62
11     5     8            301            301               3.54           3.54
# ℹ 2 more variables: prefix_mean_nampg &lt;dbl&gt;, prefix_wm_nampg &lt;dbl&gt;</code></pre>
</div>
</div>
<p>So, that works. This is getting very messy though. We certianly don’t want to make a user send us that string- that’s far worse than just wrapping in <code>rlang::quo</code>.</p>
<p>BUT, does this allow us to programatically <em>build</em> that string inside the function? Should <code>try</code> without it first, and then if it fails, build the string. Make a function that does that.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-124_fbecd6b6de8cf08b44e59ce7afa70903">
<div class="sourceCode cell-code" id="cb271"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb271-1"><a href="#cb271-1" aria-hidden="true" tabindex="-1"></a>funbracechar <span class="ot">&lt;-</span> <span class="cf">function</span>(data, groupers, sumcols,</span>
<span id="cb271-2"><a href="#cb271-2" aria-hidden="true" tabindex="-1"></a>                     FUNS, ...) {</span>
<span id="cb271-3"><a href="#cb271-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb271-4"><a href="#cb271-4" aria-hidden="true" tabindex="-1"></a>  gm <span class="ot">&lt;-</span> <span class="fu">try</span>(data <span class="sc">%&gt;%</span></span>
<span id="cb271-5"><a href="#cb271-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="fu">across</span>({{groupers}})) <span class="sc">%&gt;%</span></span>
<span id="cb271-6"><a href="#cb271-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="fu">across</span>({{sumcols}}, {{FUNS}}, </span>
<span id="cb271-7"><a href="#cb271-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">.names =</span> <span class="st">'prefix_{.fn}_{.col}'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb271-8"><a href="#cb271-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>(), <span class="at">silent =</span> <span class="cn">TRUE</span>)</span>
<span id="cb271-9"><a href="#cb271-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb271-10"><a href="#cb271-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">inherits</span>(gm, <span class="st">'try-error'</span>)) {</span>
<span id="cb271-11"><a href="#cb271-11" aria-hidden="true" tabindex="-1"></a>    fchar <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">c</span>(<span class="st">"rlang::quo("</span>, <span class="fu">deparse</span>(FUNS), <span class="st">")"</span>), <span class="at">collapse =</span> <span class="st">''</span>)</span>
<span id="cb271-12"><a href="#cb271-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># FUNS2 &lt;- eval(parse(text = fchar)) # base R</span></span>
<span id="cb271-13"><a href="#cb271-13" aria-hidden="true" tabindex="-1"></a>    FUNS3 <span class="ot">&lt;-</span> rlang<span class="sc">::</span><span class="fu">eval_tidy</span>(rlang<span class="sc">::</span><span class="fu">parse_expr</span>(fchar)) <span class="co"># rlang claims to be faster?</span></span>
<span id="cb271-14"><a href="#cb271-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb271-15"><a href="#cb271-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb271-16"><a href="#cb271-16" aria-hidden="true" tabindex="-1"></a>  gm <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb271-17"><a href="#cb271-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="fu">across</span>({{groupers}})) <span class="sc">%&gt;%</span></span>
<span id="cb271-18"><a href="#cb271-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="fu">across</span>({{sumcols}}, {{FUNS3}}, </span>
<span id="cb271-19"><a href="#cb271-19" aria-hidden="true" tabindex="-1"></a>                     <span class="at">.names =</span> <span class="st">'prefix_{.fn}_{.col}'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb271-20"><a href="#cb271-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb271-21"><a href="#cb271-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb271-22"><a href="#cb271-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(gm)</span>
<span id="cb271-23"><a href="#cb271-23" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Will need to test this with ~ functions, bare names, and <code>\(x)</code> anonymous functions. I don’t think I expect it to work with character names. But it <em>might</em> work with character specification of the whole function?</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-125_b397067c7de9d441152b82e35f0737c7">
<div class="sourceCode cell-code" id="cb272"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb272-1"><a href="#cb272-1" aria-hidden="true" tabindex="-1"></a>anonbare <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">mean =</span> \(x) <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb272-2"><a href="#cb272-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">wm =</span> \(x) <span class="fu">weighted.mean</span>(x, wt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>it works with the <code>\(x)</code> style anonymous function</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-126_39994e69637ab0332d249207ade55179">
<div class="sourceCode cell-code" id="cb273"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb273-1"><a href="#cb273-1" aria-hidden="true" tabindex="-1"></a>charcheck <span class="ot">&lt;-</span> <span class="fu">funbracechar</span>(nacars,  </span>
<span id="cb273-2"><a href="#cb273-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">groupers =</span> <span class="fu">c</span>(gear, carb), </span>
<span id="cb273-3"><a href="#cb273-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">sumcols =</span> <span class="fu">c</span>(<span class="fu">starts_with</span>(<span class="st">'d'</span>), nampg),   </span>
<span id="cb273-4"><a href="#cb273-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">FUNS =</span> anonbare) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'gear'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb275"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb275-1"><a href="#cb275-1" aria-hidden="true" tabindex="-1"></a>charcheck</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 8
    gear  carb prefix_mean_disp prefix_wm_disp prefix_mean_drat prefix_wm_drat
   &lt;dbl&gt; &lt;dbl&gt;            &lt;dbl&gt;          &lt;dbl&gt;            &lt;dbl&gt;          &lt;dbl&gt;
 1     3     1            201.           208.              3.18           3.13
 2     3     2            346.           347.              3.04           3.03
 3     3     3            276.           276.              3.07           3.07
 4     3     4            416.           425.              3.22           3.19
 5     4     1             84.2           85.3             4.06           4.05
 6     4     2            121.           128.              4.16           4.05
 7     4     4            164.           164.              3.91           3.91
 8     5     2            108.           110.              4.1            4.16
 9     5     4            351            351               4.22           4.22
10     5     6            145            145               3.62           3.62
11     5     8            301            301               3.54           3.54
# ℹ 2 more variables: prefix_mean_nampg &lt;dbl&gt;, prefix_wm_nampg &lt;dbl&gt;</code></pre>
</div>
</div>
<p>works with tilde-style anonymous functions</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-127_7e9904c7eba14cbad3b5ae8432cdd3e2">
<div class="sourceCode cell-code" id="cb277"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb277-1"><a href="#cb277-1" aria-hidden="true" tabindex="-1"></a>funstilde <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">mean =</span> <span class="sc">~</span><span class="fu">mean</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb277-2"><a href="#cb277-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">wm =</span> <span class="sc">~</span><span class="fu">weighted.mean</span>(., wt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb277-3"><a href="#cb277-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb277-4"><a href="#cb277-4" aria-hidden="true" tabindex="-1"></a>chartilde <span class="ot">&lt;-</span> <span class="fu">funbracechar</span>(nacars,  </span>
<span id="cb277-5"><a href="#cb277-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">groupers =</span> <span class="fu">c</span>(gear, carb), </span>
<span id="cb277-6"><a href="#cb277-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">sumcols =</span> <span class="fu">c</span>(<span class="fu">starts_with</span>(<span class="st">'d'</span>), nampg),   </span>
<span id="cb277-7"><a href="#cb277-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">FUNS =</span> funstilde) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'gear'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb279"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb279-1"><a href="#cb279-1" aria-hidden="true" tabindex="-1"></a>chartilde</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 8
    gear  carb prefix_mean_disp prefix_wm_disp prefix_mean_drat prefix_wm_drat
   &lt;dbl&gt; &lt;dbl&gt;            &lt;dbl&gt;          &lt;dbl&gt;            &lt;dbl&gt;          &lt;dbl&gt;
 1     3     1            201.           208.              3.18           3.13
 2     3     2            346.           347.              3.04           3.03
 3     3     3            276.           276.              3.07           3.07
 4     3     4            416.           425.              3.22           3.19
 5     4     1             84.2           85.3             4.06           4.05
 6     4     2            121.           128.              4.16           4.05
 7     4     4            164.           164.              3.91           3.91
 8     5     2            108.           110.              4.1            4.16
 9     5     4            351            351               4.22           4.22
10     5     6            145            145               3.62           3.62
11     5     8            301            301               3.54           3.54
# ℹ 2 more variables: prefix_mean_nampg &lt;dbl&gt;, prefix_wm_nampg &lt;dbl&gt;</code></pre>
</div>
</div>
<p>and unsurprisingly with the long form anonymous</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-128_47ee7cbaf7ccc25a39d4bee1d68f15d7">
<div class="sourceCode cell-code" id="cb281"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb281-1"><a href="#cb281-1" aria-hidden="true" tabindex="-1"></a>funsfullanon <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">mean =</span> <span class="cf">function</span>(x) <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb281-2"><a href="#cb281-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">wm =</span> <span class="cf">function</span>(x) <span class="fu">weighted.mean</span>(x, wt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb281-3"><a href="#cb281-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-4"><a href="#cb281-4" aria-hidden="true" tabindex="-1"></a>charfullanon <span class="ot">&lt;-</span> <span class="fu">funbracechar</span>(nacars,  </span>
<span id="cb281-5"><a href="#cb281-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">groupers =</span> <span class="fu">c</span>(gear, carb), </span>
<span id="cb281-6"><a href="#cb281-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">sumcols =</span> <span class="fu">c</span>(<span class="fu">starts_with</span>(<span class="st">'d'</span>), nampg),   </span>
<span id="cb281-7"><a href="#cb281-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">FUNS =</span> funsfullanon) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'gear'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb283"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb283-1"><a href="#cb283-1" aria-hidden="true" tabindex="-1"></a>charfullanon</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 8
    gear  carb prefix_mean_disp prefix_wm_disp prefix_mean_drat prefix_wm_drat
   &lt;dbl&gt; &lt;dbl&gt;            &lt;dbl&gt;          &lt;dbl&gt;            &lt;dbl&gt;          &lt;dbl&gt;
 1     3     1            201.           208.              3.18           3.13
 2     3     2            346.           347.              3.04           3.03
 3     3     3            276.           276.              3.07           3.07
 4     3     4            416.           425.              3.22           3.19
 5     4     1             84.2           85.3             4.06           4.05
 6     4     2            121.           128.              4.16           4.05
 7     4     4            164.           164.              3.91           3.91
 8     5     2            108.           110.              4.1            4.16
 9     5     4            351            351               4.22           4.22
10     5     6            145            145               3.62           3.62
11     5     8            301            301               3.54           3.54
# ℹ 2 more variables: prefix_mean_nampg &lt;dbl&gt;, prefix_wm_nampg &lt;dbl&gt;</code></pre>
</div>
</div>
<p>It works with custom functions with the argument inside. If we look at what the <code>deparse</code> does inside the debugger, we can see that it expands those functions out, and so the thing that gets quoted is actually exactly the same as the previous version in <code>funsfullanon</code>.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-129_68dc59e5b00868d5cef7ea362fb535c5">
<div class="sourceCode cell-code" id="cb285"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb285-1"><a href="#cb285-1" aria-hidden="true" tabindex="-1"></a>weightcustom <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb285-2"><a href="#cb285-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">weighted.mean</span>(x, <span class="at">w =</span> wt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb285-3"><a href="#cb285-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb285-4"><a href="#cb285-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb285-5"><a href="#cb285-5" aria-hidden="true" tabindex="-1"></a>meancustom <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb285-6"><a href="#cb285-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb285-7"><a href="#cb285-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb285-8"><a href="#cb285-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb285-9"><a href="#cb285-9" aria-hidden="true" tabindex="-1"></a>funscustom <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">mean =</span> meancustom,</span>
<span id="cb285-10"><a href="#cb285-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">wm =</span> weightcustom)</span>
<span id="cb285-11"><a href="#cb285-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb285-12"><a href="#cb285-12" aria-hidden="true" tabindex="-1"></a>charweightcustom <span class="ot">&lt;-</span> <span class="fu">funbracechar</span>(nacars,  </span>
<span id="cb285-13"><a href="#cb285-13" aria-hidden="true" tabindex="-1"></a>                         <span class="at">groupers =</span> <span class="fu">c</span>(gear, carb), </span>
<span id="cb285-14"><a href="#cb285-14" aria-hidden="true" tabindex="-1"></a>                         <span class="at">sumcols =</span> <span class="fu">c</span>(<span class="fu">starts_with</span>(<span class="st">'d'</span>), nampg),   </span>
<span id="cb285-15"><a href="#cb285-15" aria-hidden="true" tabindex="-1"></a>                         <span class="at">FUNS =</span> funscustom) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'gear'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb287"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb287-1"><a href="#cb287-1" aria-hidden="true" tabindex="-1"></a>charweightcustom</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 8
    gear  carb prefix_mean_disp prefix_wm_disp prefix_mean_drat prefix_wm_drat
   &lt;dbl&gt; &lt;dbl&gt;            &lt;dbl&gt;          &lt;dbl&gt;            &lt;dbl&gt;          &lt;dbl&gt;
 1     3     1            201.           208.              3.18           3.13
 2     3     2            346.           347.              3.04           3.03
 3     3     3            276.           276.              3.07           3.07
 4     3     4            416.           425.              3.22           3.19
 5     4     1             84.2           85.3             4.06           4.05
 6     4     2            121.           128.              4.16           4.05
 7     4     4            164.           164.              3.91           3.91
 8     5     2            108.           110.              4.1            4.16
 9     5     4            351            351               4.22           4.22
10     5     6            145            145               3.62           3.62
11     5     8            301            301               3.54           3.54
# ℹ 2 more variables: prefix_mean_nampg &lt;dbl&gt;, prefix_wm_nampg &lt;dbl&gt;</code></pre>
</div>
</div>
<p>It works when there’s a single function, not a list, too. If we look in the debugger, this does still fail with the simple <code>{{}}</code>, triggers the try loop, and gets deparsed.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-130_113be2dd621524491a5d198357600545">
<div class="sourceCode cell-code" id="cb289"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb289-1"><a href="#cb289-1" aria-hidden="true" tabindex="-1"></a>funsnolist <span class="ot">&lt;-</span> weightcustom</span>
<span id="cb289-2"><a href="#cb289-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb289-3"><a href="#cb289-3" aria-hidden="true" tabindex="-1"></a>charweightcustom <span class="ot">&lt;-</span> <span class="fu">funbracechar</span>(nacars,  </span>
<span id="cb289-4"><a href="#cb289-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">groupers =</span> <span class="fu">c</span>(gear, carb), </span>
<span id="cb289-5"><a href="#cb289-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">sumcols =</span> <span class="fu">c</span>(<span class="fu">starts_with</span>(<span class="st">'d'</span>), nampg),   </span>
<span id="cb289-6"><a href="#cb289-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">FUNS =</span> funsnolist) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'gear'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb291"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb291-1"><a href="#cb291-1" aria-hidden="true" tabindex="-1"></a>charweightcustom</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 5
    gear  carb prefix_1_disp prefix_1_drat prefix_1_nampg
   &lt;dbl&gt; &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt;          &lt;dbl&gt;
 1     3     1         208.           3.13           21.5
 2     3     2         347.           3.03           19.0
 3     3     3         276.           3.07           16.8
 4     3     4         425.           3.19           11.8
 5     4     1          85.3          4.05           27.3
 6     4     2         128.           4.05           24.7
 7     4     4         164.           3.91           19.2
 8     5     2         110.           4.16          NaN  
 9     5     4         351            4.22           15.8
10     5     6         145            3.62          NaN  
11     5     8         301            3.54          NaN  </code></pre>
</div>
</div>
<p>I expect it <em>not</em> to work for a character vector, and it doesn’t.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-131_43f59ce8962b064ca6850033b18ea7db">
<div class="sourceCode cell-code" id="cb293"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb293-1"><a href="#cb293-1" aria-hidden="true" tabindex="-1"></a>funsnolistchar <span class="ot">&lt;-</span> <span class="st">'weightcustom'</span></span>
<span id="cb293-2"><a href="#cb293-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb293-3"><a href="#cb293-3" aria-hidden="true" tabindex="-1"></a>charnolistchar <span class="ot">&lt;-</span> <span class="fu">funbracechar</span>(nacars,  </span>
<span id="cb293-4"><a href="#cb293-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">groupers =</span> <span class="fu">c</span>(gear, carb), </span>
<span id="cb293-5"><a href="#cb293-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">sumcols =</span> <span class="fu">c</span>(<span class="fu">starts_with</span>(<span class="st">'d'</span>), nampg),   </span>
<span id="cb293-6"><a href="#cb293-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">FUNS =</span> funsnolistchar) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in `summarise()`:
ℹ In argument: `across(c(starts_with("d"), nampg), "weightcustom",
  .names = "prefix_{.fn}_{.col}")`.
Caused by error in `across()`:
! `.fns` must be a function, a formula, or a list of functions/formulas.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb295"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb295-1"><a href="#cb295-1" aria-hidden="true" tabindex="-1"></a>charnolistchar</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'charnolistchar' not found</code></pre>
</div>
</div>
<p>But, does it work if we add an <code>mget</code> line?</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-132_f01cfcbec9794452f1bf9e70ce36cb71">
<div class="sourceCode cell-code" id="cb297"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb297-1"><a href="#cb297-1" aria-hidden="true" tabindex="-1"></a>funbracechar <span class="ot">&lt;-</span> <span class="cf">function</span>(data, groupers, sumcols,</span>
<span id="cb297-2"><a href="#cb297-2" aria-hidden="true" tabindex="-1"></a>                     FUNS, ...) {</span>
<span id="cb297-3"><a href="#cb297-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.character</span>(FUNS)) {</span>
<span id="cb297-4"><a href="#cb297-4" aria-hidden="true" tabindex="-1"></a>    FUNS <span class="ot">&lt;-</span> <span class="fu">mget</span>(FUNS, <span class="at">inherits =</span> <span class="cn">TRUE</span>)</span>
<span id="cb297-5"><a href="#cb297-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb297-6"><a href="#cb297-6" aria-hidden="true" tabindex="-1"></a>  gm <span class="ot">&lt;-</span> <span class="fu">try</span>(data <span class="sc">%&gt;%</span></span>
<span id="cb297-7"><a href="#cb297-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="fu">across</span>({{groupers}})) <span class="sc">%&gt;%</span></span>
<span id="cb297-8"><a href="#cb297-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="fu">across</span>({{sumcols}}, {{FUNS}}, </span>
<span id="cb297-9"><a href="#cb297-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">.names =</span> <span class="st">'prefix_{.fn}_{.col}'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb297-10"><a href="#cb297-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>(), <span class="at">silent =</span> <span class="cn">TRUE</span>)</span>
<span id="cb297-11"><a href="#cb297-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb297-12"><a href="#cb297-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">inherits</span>(gm, <span class="st">'try-error'</span>)) {</span>
<span id="cb297-13"><a href="#cb297-13" aria-hidden="true" tabindex="-1"></a>    fchar <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">c</span>(<span class="st">"rlang::quo("</span>, <span class="fu">deparse</span>(FUNS), <span class="st">")"</span>), <span class="at">collapse =</span> <span class="st">''</span>)</span>
<span id="cb297-14"><a href="#cb297-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># FUNS2 &lt;- eval(parse(text = fchar)) # base R</span></span>
<span id="cb297-15"><a href="#cb297-15" aria-hidden="true" tabindex="-1"></a>    FUNS3 <span class="ot">&lt;-</span> rlang<span class="sc">::</span><span class="fu">eval_tidy</span>(rlang<span class="sc">::</span><span class="fu">parse_expr</span>(fchar)) <span class="co"># rlang claims to be faster?</span></span>
<span id="cb297-16"><a href="#cb297-16" aria-hidden="true" tabindex="-1"></a>    gm <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb297-17"><a href="#cb297-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="fu">across</span>({{groupers}})) <span class="sc">%&gt;%</span></span>
<span id="cb297-18"><a href="#cb297-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="fu">across</span>({{sumcols}}, {{FUNS3}}, </span>
<span id="cb297-19"><a href="#cb297-19" aria-hidden="true" tabindex="-1"></a>                     <span class="at">.names =</span> <span class="st">'prefix_{.fn}_{.col}'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb297-20"><a href="#cb297-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb297-21"><a href="#cb297-21" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb297-22"><a href="#cb297-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb297-23"><a href="#cb297-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb297-24"><a href="#cb297-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb297-25"><a href="#cb297-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(gm)</span>
<span id="cb297-26"><a href="#cb297-26" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It works for a single function</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-133_9ee646302d03dd77ddc5325324b679ee">
<div class="sourceCode cell-code" id="cb298"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb298-1"><a href="#cb298-1" aria-hidden="true" tabindex="-1"></a>funsnolistchar <span class="ot">&lt;-</span> <span class="st">'weightcustom'</span></span>
<span id="cb298-2"><a href="#cb298-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-3"><a href="#cb298-3" aria-hidden="true" tabindex="-1"></a>charnolistchar <span class="ot">&lt;-</span> <span class="fu">funbracechar</span>(nacars,  </span>
<span id="cb298-4"><a href="#cb298-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">groupers =</span> <span class="fu">c</span>(gear, carb), </span>
<span id="cb298-5"><a href="#cb298-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">sumcols =</span> <span class="fu">c</span>(<span class="fu">starts_with</span>(<span class="st">'d'</span>), nampg),   </span>
<span id="cb298-6"><a href="#cb298-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">FUNS =</span> funsnolistchar) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'gear'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb300"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb300-1"><a href="#cb300-1" aria-hidden="true" tabindex="-1"></a>charnolistchar</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 5
    gear  carb prefix_weightcustom_disp prefix_weightcustom_drat
   &lt;dbl&gt; &lt;dbl&gt;                    &lt;dbl&gt;                    &lt;dbl&gt;
 1     3     1                    208.                      3.13
 2     3     2                    347.                      3.03
 3     3     3                    276.                      3.07
 4     3     4                    425.                      3.19
 5     4     1                     85.3                     4.05
 6     4     2                    128.                      4.05
 7     4     4                    164.                      3.91
 8     5     2                    110.                      4.16
 9     5     4                    351                       4.22
10     5     6                    145                       3.62
11     5     8                    301                       3.54
# ℹ 1 more variable: prefix_weightcustom_nampg &lt;dbl&gt;</code></pre>
</div>
</div>
<p>And for multiple functions <em>if they are in a character vector</em></p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-134_007e11bca8b064a98e11005a47243f74">
<div class="sourceCode cell-code" id="cb302"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb302-1"><a href="#cb302-1" aria-hidden="true" tabindex="-1"></a>funsmultichar <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'mean'</span>, <span class="st">'weightcustom'</span>)</span>
<span id="cb302-2"><a href="#cb302-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb302-3"><a href="#cb302-3" aria-hidden="true" tabindex="-1"></a>charmultichar <span class="ot">&lt;-</span> <span class="fu">funbracechar</span>(nacars,  </span>
<span id="cb302-4"><a href="#cb302-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">groupers =</span> <span class="fu">c</span>(gear, carb), </span>
<span id="cb302-5"><a href="#cb302-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">sumcols =</span> <span class="fu">c</span>(<span class="fu">starts_with</span>(<span class="st">'d'</span>), nampg),   </span>
<span id="cb302-6"><a href="#cb302-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">FUNS =</span> funsmultichar) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'gear'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb304"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb304-1"><a href="#cb304-1" aria-hidden="true" tabindex="-1"></a>charmultichar</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 8
    gear  carb prefix_mean_disp prefix_weightcustom_disp prefix_mean_drat
   &lt;dbl&gt; &lt;dbl&gt;            &lt;dbl&gt;                    &lt;dbl&gt;            &lt;dbl&gt;
 1     3     1            201.                     208.              3.18
 2     3     2            346.                     347.              3.04
 3     3     3            276.                     276.              3.07
 4     3     4            416.                     425.              3.22
 5     4     1             84.2                     85.3             4.06
 6     4     2            121.                     128.              4.16
 7     4     4            164.                     164.              3.91
 8     5     2            108.                     110.              4.1 
 9     5     4            351                      351               4.22
10     5     6            145                      145               3.62
11     5     8            301                      301               3.54
# ℹ 3 more variables: prefix_weightcustom_drat &lt;dbl&gt;, prefix_mean_nampg &lt;dbl&gt;,
#   prefix_weightcustom_nampg &lt;dbl&gt;</code></pre>
</div>
</div>
<p>But not for a list. This is not unexpected- the <code>mget</code> is in <code>if(is.character(FUNS))</code> , and so the list won’t get mgot. I think that’s good enough for now. It would be doable obviously to <code>purrr</code> over the list and <code>mget</code> the items that are characters, but that’s not really the focus here. We have figured out an (ugly) workaround for the dplyr 1.1 issue, and that will have to do for now- applying it over all possible organisations of FUNS will have to be for another day.</p>
<div class="cell" data-hash="tidy_programs_cache/html/unnamed-chunk-135_43d865f75c46ebf2a6210801780b3ab8">
<div class="sourceCode cell-code" id="cb306"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb306-1"><a href="#cb306-1" aria-hidden="true" tabindex="-1"></a>funsmulticharl <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">m =</span> <span class="st">'mean'</span>, <span class="at">wm =</span> <span class="st">'weightcustom'</span>)</span>
<span id="cb306-2"><a href="#cb306-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb306-3"><a href="#cb306-3" aria-hidden="true" tabindex="-1"></a>charmulticharl <span class="ot">&lt;-</span> <span class="fu">funbracechar</span>(nacars,  </span>
<span id="cb306-4"><a href="#cb306-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">groupers =</span> <span class="fu">c</span>(gear, carb), </span>
<span id="cb306-5"><a href="#cb306-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">sumcols =</span> <span class="fu">c</span>(<span class="fu">starts_with</span>(<span class="st">'d'</span>), nampg),   </span>
<span id="cb306-6"><a href="#cb306-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">FUNS =</span> funsmulticharl) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in `summarise()`:
ℹ In argument: `across(...)`.
Caused by error in `across()`:
! `.fns` must be a function, a formula, or a list of functions/formulas.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb308"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb308-1"><a href="#cb308-1" aria-hidden="true" tabindex="-1"></a>charmulticharl</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'charmulticharl' not found</code></pre>
</div>
</div>
</section>
<section id="eval_tidy" class="level4">
<h4 class="anchored" data-anchor-id="eval_tidy">eval_tidy</h4>
<p>I keep feeling like <code>eval_tidy</code> should work somehow, since it allows the <code>.data</code> pronoun, but I can’t seem to get my head around how it would work here. I’d happily write something like <code>\(x) eval_tidy(weighted.mean(x, .data$wt, na.rm = TRUE)))</code>. Maybe I can get that to work with the right sort of enquoing? I tried for a while and couldn’t figure it out, but maybe come back fresh later on.</p>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Website created by Galen Holt</div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="mailto:g.holt@deakin.edu.au">Contact</a>
  </li>  
</ul>
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/galenholt">
      <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://scholar.google.com.au/citations?user=f94WBOoAAAAJ&amp;hl=en">
      <i class="bi bi-mortarboard-fill" role="img" aria-label="Google Scholar">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/galen-holt-265aa290">
      <i class="bi bi-linkedin" role="img" aria-label="LinkedIn">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://fediscience.org/@galen_holt">
      <i class="bi bi-mastodon" role="img" aria-label="Mastodon">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>



</body></html>