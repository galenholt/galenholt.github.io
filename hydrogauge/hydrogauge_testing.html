<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Galen Holt">

<title>Testing hydrogauge API – Galen Holt</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<meta property="og:title" content="Testing hydrogauge API – Galen Holt">
<meta property="og:description" content="">
<meta property="og:site_name" content="Galen Holt">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Galen Holt</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../research.html"> 
<span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../code_demos.html" aria-current="page"> 
<span class="menu-text">Code Demos</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/galenholt"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://scholar.google.com.au/citations?user=f94WBOoAAAAJ&amp;hl=en"> <i class="bi bi-mortarboard-fill" role="img" aria-label="Google Scholar">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/galen-holt-265aa290"> <i class="bi bi-linkedin" role="img" aria-label="LinkedIn">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://fediscience.org/@galen_holt"> <i class="bi bi-mastodon" role="img" aria-label="Mastodon">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../package/package_creation.html">Building packages</a></li><li class="breadcrumb-item"><a href="../hydrogauge/hydrogauge_testing.html">Testing hydrogauge API</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../code_demos.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Code Demos</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Small how-tos</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../small_helpers/smallpieces.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bits and pieces</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../small_helpers/quarto_notes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quarto notes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../setup/rstudio_themes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Editing Rstudio themes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../small_helpers/zip_downloading.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Download and unpack zips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../small_helpers/json_api_construction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Building JSON syntax from R for API calls</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../small_helpers/list_names.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Naming rules for lists</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../publishing/private_github_figshare.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Creating Figshare from private github</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../small_helpers/error_handling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Intro to error handling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../small_helpers/error_safely.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><code>Safe</code> error passing in loops</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../small_helpers/lifecycle_warnings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Intermittent lifecycle warnings</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../small_helpers/dplyr_filter_matrix_errors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dplyr filter matrices</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../small_helpers/private_github_notes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dealing with private github</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../small_helpers/renv_github.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Installing from github with renv</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../small_helpers/breaking_whiles.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">While loops, break, and debugging</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../small_helpers/package_dll_error.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Package DLL error</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../small_helpers/git_remote_and_emails.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Changing git remote and private email</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Plotting</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../plotting/ggplot_themes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ggplot themes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../plotting/setting_colors_for_groups.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Consistent colors</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../plotting/tweaks_tricks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Saving and themeing plots</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../plotting/hcl_exploration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exploring HCL colorspace</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../plotting/rgb_to_hex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Converting RGB to hex colors</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../plotting/fonts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Fonts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../plotting/faded_colors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Faded 2d colour ramps</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../plotting/math_in_ggplot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Latex in ggplot with latex2exp</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../plotting/rayshader.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3d plotting with rayshader</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../plotting/legend_in_facet.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Legends in empty facets</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../plotting/venn_diagrams.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Venn diagrams in ggplot2</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Quarto</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../website_notes/quarto_website_github.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../website_notes/updating_website.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Updating and maintaining website</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../website_notes/quarto_change_yml.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Avoiding rendering whole site for testing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../website_notes/quarto_images_misc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Figures in quarto</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../website_notes/render_word.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Rendering to word</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../website_notes/render_pdf.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Rendering to pdf</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../website_notes/multiple_render_formats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Rendering multiple formats (and serving from web)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../website_notes/commenting_quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Adding comments to html</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../website_notes/quarto_profiles.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quarto profiles for incremental render</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../publishing/reference_sections.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sections and numbering</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../publishing/tables_in_word.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Testing word table formatting</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Theory, simulation, statistics, probability</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../simmodelling/twoDautocorr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generate 2d autocorrelation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../stats_probability/spatial_ac.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Regressions with spatial autocorrelation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../stats_probability/expected_shannon.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bootstrapping the expected shannon diversity</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../stats_probability/fitting_lognormals.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Intro to fitting lognormals</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../stats_probability/shifting_normals.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Basic shifts of normal moments</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../stats_probability/fitting_truncated.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Shifting and fitting truncated lognormals</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../betabinomial/betadists.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quick look at beta pdfs</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Drones</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../drones/overlaps_reactive.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Calculations for flight planning</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../drones/overlaps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Figuring out flight plan calcs</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pix4d/read_pix4d_outputs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Reading and plotting pix4d outputs</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Observable</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../observable/trying_observable.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Figuring out how to use ojs chunks</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">R and python</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/python_setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Python environments with pyenv and poetry</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/py_in_rpkg.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Wrapping python in R package</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/RandPython.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using R and python together</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/R_py_shared_projects.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Shared R-py project structure</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/py_r_dates.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Passing complex objects py-R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/R_py_type_passing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Passing types between R and python</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/py_r_project_overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview of building R-py package</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/python_nameerror.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Intermittent NameError py-R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/python_updated_functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Small python bits</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/python_testing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Testing python</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true">
 <span class="menu-text">Setting up projects</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/rig.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Managing old R versions with rig</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/managingprivate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Private data for website repo</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../setup/R_in_VS.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using R in VScode</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/end_run_renv.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dealing with renv failures</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="true">
 <span class="menu-text">Building packages</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../package/package_creation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">First pass at building a package</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../package/indexing_version.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatically indexing package versions with git</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tidyprogramming/tidy_programs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Programming with dplyr and rlang</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../hydrogauge/hydrogauge_testing.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Testing hydrogauge API</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../small_helpers/failing_snapshot_check.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Snapshot failures on check</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../small_helpers/vdiffr_networks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Testing network plots with vdiffr</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="true">
 <span class="menu-text">Data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../data_acquisition/bom_gauges.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">BOM gauge locations with httr2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../hydrogauge/hydrogauge_api_howtocall.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Experimenting with API calls for {hydrogauge}</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../data_acquisition/bom_water.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Experimenting with API calls from BOM</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../data_acquisition/gauge_data_pre_gauge.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data from pre-gauged periods</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../data_acquisition/ALA_data_pull.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Pulling data from Atlas of Living Australia</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../data_acquisition/get_geofabric.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Downloading Australian rivers geofabric</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../data_acquisition/read_geofabric.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using Australian rivers geofabric</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" role="navigation" aria-expanded="true">
 <span class="menu-text">R parallel processing (general)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-11" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../parallelism/interrogating_parallel.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interrogating parallel resources</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../parallelism/nested_parallel.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Testing nested parallelism</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../parallelism/parallel_speed.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Speed-testing parallel</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../parallelism/globals_speed.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Global objects and parallel speed</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../parallelism/nested_dependent_iterations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dependencies of inner parallelism on outer</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../setup/R_in_databricks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R in databricks setup</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-12" role="navigation" aria-expanded="true">
 <span class="menu-text">R parallel processing on HPC</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-12" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-12" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../parallelism/hpc_ephemera.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">HPC notes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../parallelism/plans_and_hpc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using single-machine plans on HPC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../parallelism/initial_future_batchtools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Figuring out future.batchtools</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../parallelism/changing_batchtools_template.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Switching templates, matching to resources</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../parallelism/template_modification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modifying templates</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../parallelism/master_persistence.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Consequences of master timing out</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../parallelism/nested_parallel_hpc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Nested parallel on HPC nodes and cores</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../parallelism/conditional_plans.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Conditional plans for local and HPC</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#section" id="toc-section" class="nav-link active" data-scroll-target="#section"></a></li>
  <li><a href="#access-victoria-water-data-through-api" id="toc-access-victoria-water-data-through-api" class="nav-link" data-scroll-target="#access-victoria-water-data-through-api">Access Victoria water data through API</a></li>
  <li><a href="#set-up-params" id="toc-set-up-params" class="nav-link" data-scroll-target="#set-up-params">Set up params</a>
  <ul class="collapse">
  <li><a href="#url" id="toc-url" class="nav-link" data-scroll-target="#url">URL</a></li>
  <li><a href="#site-lists" id="toc-site-lists" class="nav-link" data-scroll-target="#site-lists">Site lists</a></li>
  </ul></li>
  <li><a href="#api-functions" id="toc-api-functions" class="nav-link" data-scroll-target="#api-functions">API functions</a>
  <ul class="collapse">
  <li><a href="#datasources" id="toc-datasources" class="nav-link" data-scroll-target="#datasources">Datasources</a></li>
  <li><a href="#test-from-the-package" id="toc-test-from-the-package" class="nav-link" data-scroll-target="#test-from-the-package">Test from the package</a></li>
  <li><a href="#sites-by-datasource" id="toc-sites-by-datasource" class="nav-link" data-scroll-target="#sites-by-datasource">Sites by datasource</a></li>
  <li><a href="#test-package-version" id="toc-test-package-version" class="nav-link" data-scroll-target="#test-package-version">Test package version</a></li>
  </ul></li>
  <li><a href="#variables" id="toc-variables" class="nav-link" data-scroll-target="#variables">Variables</a>
  <ul class="collapse">
  <li><a href="#get_variable_list" id="toc-get_variable_list" class="nav-link" data-scroll-target="#get_variable_list">Get_variable_list</a></li>
  <li><a href="#test-package-version-1" id="toc-test-package-version-1" class="nav-link" data-scroll-target="#test-package-version-1">Test package version</a></li>
  </ul></li>
  <li><a href="#get-traces" id="toc-get-traces" class="nav-link" data-scroll-target="#get-traces">get traces</a>
  <ul class="collapse">
  <li><a href="#unpack-different-formats" id="toc-unpack-different-formats" class="nav-link" data-scroll-target="#unpack-different-formats">unpack different formats</a></li>
  <li><a href="#cleaning-that-up" id="toc-cleaning-that-up" class="nav-link" data-scroll-target="#cleaning-that-up">Cleaning that up</a></li>
  <li><a href="#test-package-version-2" id="toc-test-package-version-2" class="nav-link" data-scroll-target="#test-package-version-2">Test package version</a></li>
  </ul></li>
  <li><a href="#a-variable-and-time-aware-version" id="toc-a-variable-and-time-aware-version" class="nav-link" data-scroll-target="#a-variable-and-time-aware-version">A variable and time-aware version</a>
  <ul class="collapse">
  <li><a href="#test-package-version-3" id="toc-test-package-version-3" class="nav-link" data-scroll-target="#test-package-version-3">Test package version</a></li>
  </ul></li>
  <li><a href="#benchmark" id="toc-benchmark" class="nav-link" data-scroll-target="#benchmark">Benchmark</a></li>
  <li><a href="#get-db-info" id="toc-get-db-info" class="nav-link" data-scroll-target="#get-db-info">Get db info</a>
  <ul class="collapse">
  <li><a href="#geofiltering" id="toc-geofiltering" class="nav-link" data-scroll-target="#geofiltering">Geofiltering</a></li>
  <li><a href="#other-filtering" id="toc-other-filtering" class="nav-link" data-scroll-target="#other-filtering">Other filtering</a></li>
  <li><a href="#trying-for-the-stntype" id="toc-trying-for-the-stntype" class="nav-link" data-scroll-target="#trying-for-the-stntype">Trying for the stntype</a></li>
  <li><a href="#aside--get_groups" id="toc-aside--get_groups" class="nav-link" data-scroll-target="#aside--get_groups">Aside- get_groups</a></li>
  <li><a href="#how-about-sitelist_filter" id="toc-how-about-sitelist_filter" class="nav-link" data-scroll-target="#how-about-sitelist_filter">How about <code>sitelist_filter</code>?</a></li>
  <li><a href="#using-complex_filter" id="toc-using-complex_filter" class="nav-link" data-scroll-target="#using-complex_filter">using complex_filter</a></li>
  </ul></li>
  <li><a href="#todo" id="toc-todo" class="nav-link" data-scroll-target="#todo">TODO</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../package/package_creation.html">Building packages</a></li><li class="breadcrumb-item"><a href="../hydrogauge/hydrogauge_testing.html">Testing hydrogauge API</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Testing hydrogauge API</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Galen Holt </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="section" class="level2">
<h2 class="anchored" data-anchor-id="section"></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="access-victoria-water-data-through-api" class="level2">
<h2 class="anchored" data-anchor-id="access-victoria-water-data-through-api">Access Victoria water data through API</h2>
<p>This document is my testing and development of functions to include in the <a href="https://github.com/galenholt/hydrogauge">{hydrogauge} package</a>. Basically, it’s where I interactively sorted through how to hit the API functions, the formats of the lists, and how to unpack the returned lists. It is a work in progress, since that package is under development.</p>
<p>We want to access <a href="https://data.water.vic.gov.au/static.htm">victorian water data</a> for a set of sites. That requires using the api at <strong>https://data.water.vic.gov.au/cgi/webservice.exe?[JSON_request]</strong> , but it’s poorly documented. I think I got it mostly figured out in <a href="../hydrogauge/hydrogauge_api_howtocall.html">a testing document</a>, but there’s a lot of extra testing in there that needs to be skipped over and cleaned up. My plan is to make this a package, but it needs more development. I’m moving further testing here so I can get to the point a bit quicker.</p>
<p>Libraries. Do I still need jsonlite now that I’ve moved ot httr2?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr2)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="set-up-params" class="level2">
<h2 class="anchored" data-anchor-id="set-up-params">Set up params</h2>
<section id="url" class="level3">
<h3 class="anchored" data-anchor-id="url">URL</h3>
<p>The base url that everything gets attached to is: and we use <code>httr2::request</code> to start building the request.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>vicurl <span class="ot">&lt;-</span> <span class="st">"https://data.water.vic.gov.au/WMIS/cgi/webservice.exe?"</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>reqvic <span class="ot">&lt;-</span> <span class="fu">request</span>(vicurl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="site-lists" class="level3">
<h3 class="anchored" data-anchor-id="site-lists">Site lists</h3>
<p>I want to test with one, two, and several sites in a site list. I had tried to do <code>"sitelist" = c('site', 'site')</code> , and that failed. But it works to have <code>"site, site"</code></p>
<p>The upper steavenson is 405328, Barwon is 233217 (and has Temp), Taggerty 405331 only ran 2010-2013, And the Marysville golf course 405837 (only rainfall). That hits some things we want to make sure we pick up- no longer running gauges, gauges with only rain, gauges with lots of variables, etc.</p>
<p>I only make one site_list here with multiple, but can do the <code>str_c</code> inside the calls usually.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>barwon <span class="ot">&lt;-</span> <span class="st">'233217'</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>steavenson <span class="ot">&lt;-</span> <span class="st">'405328'</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>taggerty <span class="ot">&lt;-</span> <span class="st">'405331'</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>golf <span class="ot">&lt;-</span> <span class="st">'405837'</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>allsites <span class="ot">&lt;-</span> <span class="fu">str_c</span>(barwon, steavenson, taggerty, golf, <span class="at">sep =</span> <span class="st">", "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="api-functions" class="level2">
<h2 class="anchored" data-anchor-id="api-functions">API functions</h2>
<p>And how to call each- including multiple values.</p>
<p>I finally found a couple sources of documentation that will hopefully be helpful: <a href="https://kisters.com.au/doco/hydllp.htm" class="uri">https://kisters.com.au/doco/hydllp.htm</a> and <a href="https://water-monitoring.information.qld.gov.au/wini/Documents/RDMW_API_doco.pdf" class="uri">https://water-monitoring.information.qld.gov.au/wini/Documents/RDMW_API_doco.pdf</a>.</p>
<p>The first thing to do is to figure out what basic information is there, so we can ask for it. What we really want is <code>get_ts_traces</code>, but it has a lot of parameters (see <a href="https://kisters.com.au/doco/hydllp.htm#get_ts_traces">Kisters docs</a>). Some are relatively straightforward to meaning, though how to get them to be correct JSON can be tricky (e.g.&nbsp;<code>site_list</code>, while others are opaque, e.g.&nbsp;<code>varfrom</code>, <code>varto</code>, <code>datasource</code>, either to their meaning or what the options are we can ask for. We can try to figure that out with some querying of the other functions.</p>
<section id="datasources" class="level3">
<h3 class="anchored" data-anchor-id="datasources">Datasources</h3>
<p>Can we figure out what datasource means by asking for some by site?</p>
<p><code>version</code> has to be 1.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>ds_s_params <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"function"</span> <span class="ot">=</span> <span class="st">'get_datasources_by_site'</span>,</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"version"</span> <span class="ot">=</span> <span class="st">"1"</span>,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">"params"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"site_list"</span> <span class="ot">=</span> allsites))</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>reqvic <span class="sc">%&gt;%</span> </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(ds_s_params) <span class="sc">%&gt;%</span> </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_dry_run</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>POST /WMIS/cgi/webservice.exe? HTTP/1.1
Host: data.water.vic.gov.au
User-Agent: httr2/1.0.3 r-curl/5.2.2 libcurl/8.3.0
Accept: */*
Accept-Encoding: deflate, gzip
Content-Type: application/json
Content-Length: 108

{"function":"get_datasources_by_site","version":"1","params":{"site_list":"233217, 405328, 405331, 405837"}}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>resp_ds_s <span class="ot">&lt;-</span> reqvic <span class="sc">%&gt;%</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(ds_s_params) <span class="sc">%&gt;%</span> </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>rbody_ds_s <span class="ot">&lt;-</span> resp_ds_s <span class="sc">%&gt;%</span> <span class="fu">resp_body_json</span>(<span class="at">check_type =</span> <span class="cn">FALSE</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(rbody_ds_s)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ error_num: int 0
 $ return   :List of 1
  ..$ sites:List of 4
  .. ..$ :List of 2
  .. .. ..$ site       : chr "233217"
  .. .. ..$ datasources:List of 3
  .. .. .. ..$ : chr "A"
  .. .. .. ..$ : chr "TELEM"
  .. .. .. ..$ : chr "TELEMCOPY"
  .. ..$ :List of 2
  .. .. ..$ site       : chr "405328"
  .. .. ..$ datasources:List of 3
  .. .. .. ..$ : chr "A"
  .. .. .. ..$ : chr "TELEM"
  .. .. .. ..$ : chr "TELEMCOPY"
  .. ..$ :List of 2
  .. .. ..$ site       : chr "405331"
  .. .. ..$ datasources:List of 1
  .. .. .. ..$ : chr "A"
  .. ..$ :List of 2
  .. .. ..$ site       : chr "405837"
  .. .. ..$ datasources:List of 3
  .. .. .. ..$ : chr "A"
  .. .. .. ..$ : chr "TELEM"
  .. .. .. ..$ : chr "TELEMCOPY"</code></pre>
</div>
</div>
<p>I’ll need to sort out how to unpack that list later, but for now, let’s just look at it and see that all of them have options <code>A</code> and <code>TELEM</code>, and a couple have <code>TELEMCOPY</code>.</p>
<p>According to the QLD pdf, the datasource distinguishes things like Archive and Telemetry. That’s similar in Vic, though QLD also had codes for back-filled holes, which don’t seem to be here (at least at these sites).</p>
<p>Seems like it will be safest to ask for ‘A’ or ‘TELEM’.</p>
<p>And the different variables can be in a <code>var_list</code> or <code>varto</code> and <code>varfrom</code> (though not always- see below). The numbers are for different variables, but again, no guarantee they’re the same in Vic.</p>
<section id="unpacking-the-list" class="level4">
<h4 class="anchored" data-anchor-id="unpacking-the-list">unpacking the list</h4>
<p>I might as well do this and build the function. Should be able to do it with <code>unnest</code>, and then maybe drop dumb columns? Nope, some of the lists unpack into lists of mixed type. But <code>unnest_wider</code> and <code>unnest_longer</code> might be the trick. Will need to test with single sites in case the structure changes.</p>
<p>For the function, we probably want to just print the error value or something, and not return it in the df. Or if it errors, return that, if it doesn’t, just give df. That’s probably best.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(rbody_ds_s[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> <span class="co"># the [2] drops the error column</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(<span class="at">col =</span> <span class="fu">where</span>(is.list)) <span class="sc">%&gt;%</span> <span class="co"># error and a `return` list</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> <span class="fu">where</span>(is.list)) <span class="sc">%&gt;%</span> <span class="co"># error, site, and a `datasources` list</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(<span class="at">col =</span> <span class="fu">where</span>(is.list)) <span class="co"># fully unpacked into a long df</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>a</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 2
   site   datasources
   &lt;chr&gt;  &lt;chr&gt;      
 1 233217 A          
 2 233217 TELEM      
 3 233217 TELEMCOPY  
 4 405328 A          
 5 405328 TELEM      
 6 405328 TELEMCOPY  
 7 405331 A          
 8 405837 A          
 9 405837 TELEM      
10 405837 TELEMCOPY  </code></pre>
</div>
</div>
<p>Might actually be better as a table or <code>pivot_wider</code>? Depends what the point is? Pivot wider is kind of a pain, use table? But table actually unpacks longer when I as_tibble or as.data.frame it. Which is annoying.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">table</span>(a<span class="sc">$</span>site, a<span class="sc">$</span>datasources)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>b</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        
         A TELEM TELEMCOPY
  233217 1     1         1
  405328 1     1         1
  405331 1     0         0
  405837 1     1         1</code></pre>
</div>
</div>
<p>I think just return the long tibble, and do the table as a plot or explicitly a table or something. Which orientation makes most sense? Not sure. Probably gauges on x? But plots of actual data will have gauges on y, time on x, so maybe stay consistent.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> b <span class="sc">%&gt;%</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">.name_repair =</span> <span class="st">'unique'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">gauge =</span> <span class="st">`</span><span class="at">...1</span><span class="st">`</span>, <span class="at">datasource =</span> <span class="st">`</span><span class="at">...2</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
• `` -&gt; `...1`
• `` -&gt; `...2`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>c <span class="sc">%&gt;%</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n =</span> <span class="fu">as.logical</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> datasource, <span class="at">y =</span> gauge, <span class="at">fill =</span> n)) <span class="sc">+</span> </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_tile</span>(<span class="at">colour=</span><span class="st">"white"</span>, <span class="at">size=</span><span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_discrete</span>(<span class="at">type =</span> <span class="fu">c</span>(<span class="st">'firebrick'</span>, <span class="st">'dodgerblue'</span>)) <span class="sc">+</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">fill =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">coord_equal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="hydrogauge_testing_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Can I just build that plot from a? Yes, but would be just as annoying. maybe.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>allopts <span class="ot">&lt;-</span> a <span class="sc">%&gt;%</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand</span>(site, datasources)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>a2 <span class="ot">&lt;-</span> a <span class="sc">%&gt;%</span> </span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">indata =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">right_join</span>(allopts) <span class="sc">%&gt;%</span> </span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">indata =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(indata), <span class="cn">FALSE</span>, indata))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(site, datasources)`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(a2, <span class="fu">aes</span>(<span class="at">x =</span> datasources, <span class="at">y =</span> site, <span class="at">fill =</span> indata)) <span class="sc">+</span> </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_tile</span>(<span class="at">colour=</span><span class="st">"white"</span>, <span class="at">linewidth=</span><span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_discrete</span>(<span class="at">type =</span> <span class="fu">c</span>(<span class="st">'firebrick'</span>, <span class="st">'dodgerblue'</span>)) <span class="sc">+</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">fill =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">coord_equal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="hydrogauge_testing_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Good enough for this one</strong>- turn that into a function in a package.</p>
</section>
</section>
<section id="test-from-the-package" class="level3">
<h3 class="anchored" data-anchor-id="test-from-the-package">Test from the package</h3>
<p>I’m using <code>devtools::load_all()</code> to load the package repo in here for interactive testing and poking.</p>
<p>Obviously, hard paths are a bad idea, but I’m going to do it here since I typically do relative within repos, and these are across repos. Still, temporary and hacky.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">load_all</span>(<span class="st">'C:/Users/Galen/Documents/code/hydrogauge'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>ℹ Loading hydrogauge</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>returntib <span class="ot">&lt;-</span> <span class="fu">get_datasources_by_site</span>(vicurl, allsites)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>returntib</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 2
   site   datasource
   &lt;chr&gt;  &lt;chr&gt;     
 1 233217 A         
 2 233217 TELEM     
 3 233217 TELEMCOPY 
 4 405328 A         
 5 405328 TELEM     
 6 405328 TELEMCOPY 
 7 405331 A         
 8 405837 A         
 9 405837 TELEM     
10 405837 TELEMCOPY </code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_datasources_by_site</span>(returntib)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(site, datasource)`</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="hydrogauge_testing_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="sites-by-datasource" class="level3">
<h3 class="anchored" data-anchor-id="sites-by-datasource">Sites by datasource</h3>
<p>Haven’t written this one before, might blow things up. But if we want a list of sites, it might be better than the way I did this before of just asking for everything in the db, lots of which had no data.</p>
<p>And now we know the datasource options. I think? I suppose it’s possible there’s another type I’m not aware of.</p>
<p>For some weird reason, sitelists should be <code>"site, site, site"</code>, while the datasources should be <code>c('source', 'source')</code>. The latter yields JSON array <code>['source', 'source']</code>, while the former yields JSON <code>'site', 'site'</code></p>
<p>This works. The list truncates, but it did work.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>ds_wanted <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'A'</span>, <span class="st">'TELEM'</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>s_ds_params <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"function"</span> <span class="ot">=</span> <span class="st">'get_sites_by_datasource'</span>,</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">"version"</span> <span class="ot">=</span> <span class="st">"1"</span>,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>               <span class="st">"params"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"datasources"</span> <span class="ot">=</span> ds_wanted))</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>reqvic <span class="sc">%&gt;%</span> </span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(s_ds_params) <span class="sc">%&gt;%</span> </span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_dry_run</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>POST /WMIS/cgi/webservice.exe? HTTP/1.1
Host: data.water.vic.gov.au
User-Agent: httr2/1.0.3 r-curl/5.2.2 libcurl/8.3.0
Accept: */*
Accept-Encoding: deflate, gzip
Content-Type: application/json
Content-Length: 91

{"function":"get_sites_by_datasource","version":"1","params":{"datasources":["A","TELEM"]}}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>resp_s_ds <span class="ot">&lt;-</span> reqvic <span class="sc">%&gt;%</span> </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(s_ds_params) <span class="sc">%&gt;%</span> </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>rbody_s_ds <span class="ot">&lt;-</span> resp_s_ds <span class="sc">%&gt;%</span> <span class="fu">resp_body_json</span>(<span class="at">check_type =</span> <span class="cn">FALSE</span>)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(rbody_s_ds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ error_num: int 0
 $ return   :List of 1
  ..$ datasources:List of 2
  .. ..$ :List of 2
  .. .. ..$ datasource: chr "A"
  .. .. ..$ sites     :List of 4177
  .. .. .. ..$ : chr "100023"
  .. .. .. ..$ : chr "100500"
  .. .. .. ..$ : chr "100503"
  .. .. .. ..$ : chr "100504"
  .. .. .. ..$ : chr "101708"
  .. .. .. ..$ : chr "102621"
  .. .. .. ..$ : chr "102827"
  .. .. .. ..$ : chr "102828"
  .. .. .. ..$ : chr "102829"
  .. .. .. ..$ : chr "102830"
  .. .. .. ..$ : chr "102831"
  .. .. .. ..$ : chr "103811"
  .. .. .. ..$ : chr "104104"
  .. .. .. ..$ : chr "104929"
  .. .. .. ..$ : chr "104930"
  .. .. .. ..$ : chr "105134"
  .. .. .. ..$ : chr "105222"
  .. .. .. ..$ : chr "105287"
  .. .. .. ..$ : chr "105317"
  .. .. .. ..$ : chr "105480"
  .. .. .. ..$ : chr "105484"
  .. .. .. ..$ : chr "105936"
  .. .. .. ..$ : chr "107631"
  .. .. .. ..$ : chr "107970"
  .. .. .. ..$ : chr "107971"
  .. .. .. ..$ : chr "108201"
  .. .. .. ..$ : chr "108202"
  .. .. .. ..$ : chr "108203"
  .. .. .. ..$ : chr "108319"
  .. .. .. ..$ : chr "108320"
  .. .. .. ..$ : chr "108321"
  .. .. .. ..$ : chr "108898"
  .. .. .. ..$ : chr "108899"
  .. .. .. ..$ : chr "108917"
  .. .. .. ..$ : chr "108944"
  .. .. .. ..$ : chr "109133"
  .. .. .. ..$ : chr "109461"
  .. .. .. ..$ : chr "109462"
  .. .. .. ..$ : chr "109644"
  .. .. .. ..$ : chr "109645"
  .. .. .. ..$ : chr "109769"
  .. .. .. ..$ : chr "109770"
  .. .. .. ..$ : chr "109778"
  .. .. .. ..$ : chr "109779"
  .. .. .. ..$ : chr "109781"
  .. .. .. ..$ : chr "110151"
  .. .. .. ..$ : chr "110152"
  .. .. .. ..$ : chr "110153"
  .. .. .. ..$ : chr "110171"
  .. .. .. ..$ : chr "110186"
  .. .. .. ..$ : chr "110464"
  .. .. .. ..$ : chr "110721"
  .. .. .. ..$ : chr "110724"
  .. .. .. ..$ : chr "110731"
  .. .. .. ..$ : chr "110739"
  .. .. .. ..$ : chr "110745"
  .. .. .. ..$ : chr "110943"
  .. .. .. ..$ : chr "110978"
  .. .. .. ..$ : chr "111543"
  .. .. .. ..$ : chr "111549"
  .. .. .. ..$ : chr "111551"
  .. .. .. ..$ : chr "111691"
  .. .. .. ..$ : chr "111692"
  .. .. .. ..$ : chr "112182"
  .. .. .. ..$ : chr "112185"
  .. .. .. ..$ : chr "112235"
  .. .. .. ..$ : chr "112236"
  .. .. .. ..$ : chr "112237"
  .. .. .. ..$ : chr "112459"
  .. .. .. ..$ : chr "112708"
  .. .. .. ..$ : chr "112803"
  .. .. .. ..$ : chr "112804"
  .. .. .. ..$ : chr "113004"
  .. .. .. ..$ : chr "113124"
  .. .. .. ..$ : chr "113125"
  .. .. .. ..$ : chr "113467"
  .. .. .. ..$ : chr "113694"
  .. .. .. ..$ : chr "113695"
  .. .. .. ..$ : chr "113705"
  .. .. .. ..$ : chr "113706"
  .. .. .. ..$ : chr "114129"
  .. .. .. ..$ : chr "114158"
  .. .. .. ..$ : chr "114169"
  .. .. .. ..$ : chr "115732"
  .. .. .. ..$ : chr "115872"
  .. .. .. ..$ : chr "116382"
  .. .. .. ..$ : chr "116459"
  .. .. .. ..$ : chr "116460"
  .. .. .. ..$ : chr "116802"
  .. .. .. ..$ : chr "116803"
  .. .. .. ..$ : chr "119329"
  .. .. .. ..$ : chr "119330"
  .. .. .. ..$ : chr "119337"
  .. .. .. ..$ : chr "119338"
  .. .. .. ..$ : chr "119339"
  .. .. .. ..$ : chr "119340"
  .. .. .. ..$ : chr "119341"
  .. .. .. ..$ : chr "119342"
  .. .. .. ..$ : chr "119347"
  .. .. .. .. [list output truncated]
  .. ..$ :List of 2
  .. .. ..$ datasource: chr "TELEM"
  .. .. ..$ sites     :List of 1232
  .. .. .. ..$ : chr "100023"
  .. .. .. ..$ : chr "100500"
  .. .. .. ..$ : chr "100503"
  .. .. .. ..$ : chr "100504"
  .. .. .. ..$ : chr "100731"
  .. .. .. ..$ : chr "101708"
  .. .. .. ..$ : chr "102621"
  .. .. .. ..$ : chr "102827"
  .. .. .. ..$ : chr "102828"
  .. .. .. ..$ : chr "102829"
  .. .. .. ..$ : chr "102830"
  .. .. .. ..$ : chr "102831"
  .. .. .. ..$ : chr "103811"
  .. .. .. ..$ : chr "104929"
  .. .. .. ..$ : chr "104930"
  .. .. .. ..$ : chr "105134"
  .. .. .. ..$ : chr "105222"
  .. .. .. ..$ : chr "105484"
  .. .. .. ..$ : chr "105936"
  .. .. .. ..$ : chr "107631"
  .. .. .. ..$ : chr "107717"
  .. .. .. ..$ : chr "107970"
  .. .. .. ..$ : chr "107971"
  .. .. .. ..$ : chr "108201"
  .. .. .. ..$ : chr "108202"
  .. .. .. ..$ : chr "108203"
  .. .. .. ..$ : chr "108319"
  .. .. .. ..$ : chr "108320"
  .. .. .. ..$ : chr "108321"
  .. .. .. ..$ : chr "108944"
  .. .. .. ..$ : chr "109133"
  .. .. .. ..$ : chr "109462"
  .. .. .. ..$ : chr "109644"
  .. .. .. ..$ : chr "109645"
  .. .. .. ..$ : chr "109769"
  .. .. .. ..$ : chr "109770"
  .. .. .. ..$ : chr "109781"
  .. .. .. ..$ : chr "110151"
  .. .. .. ..$ : chr "110152"
  .. .. .. ..$ : chr "110153"
  .. .. .. ..$ : chr "110171"
  .. .. .. ..$ : chr "110186"
  .. .. .. ..$ : chr "110464"
  .. .. .. ..$ : chr "110721"
  .. .. .. ..$ : chr "110724"
  .. .. .. ..$ : chr "110731"
  .. .. .. ..$ : chr "110739"
  .. .. .. ..$ : chr "110745"
  .. .. .. ..$ : chr "110943"
  .. .. .. ..$ : chr "110978"
  .. .. .. ..$ : chr "111543"
  .. .. .. ..$ : chr "111549"
  .. .. .. ..$ : chr "111551"
  .. .. .. ..$ : chr "111691"
  .. .. .. ..$ : chr "111692"
  .. .. .. ..$ : chr "112182"
  .. .. .. ..$ : chr "112185"
  .. .. .. ..$ : chr "112235"
  .. .. .. ..$ : chr "112236"
  .. .. .. ..$ : chr "112237"
  .. .. .. ..$ : chr "112459"
  .. .. .. ..$ : chr "112708"
  .. .. .. ..$ : chr "112803"
  .. .. .. ..$ : chr "112804"
  .. .. .. ..$ : chr "113004"
  .. .. .. ..$ : chr "113124"
  .. .. .. ..$ : chr "113125"
  .. .. .. ..$ : chr "113467"
  .. .. .. ..$ : chr "113694"
  .. .. .. ..$ : chr "113695"
  .. .. .. ..$ : chr "113705"
  .. .. .. ..$ : chr "113706"
  .. .. .. ..$ : chr "114129"
  .. .. .. ..$ : chr "114158"
  .. .. .. ..$ : chr "114169"
  .. .. .. ..$ : chr "115732"
  .. .. .. ..$ : chr "116382"
  .. .. .. ..$ : chr "116802"
  .. .. .. ..$ : chr "116803"
  .. .. .. ..$ : chr "119329"
  .. .. .. ..$ : chr "119330"
  .. .. .. ..$ : chr "119337"
  .. .. .. ..$ : chr "119339"
  .. .. .. ..$ : chr "119340"
  .. .. .. ..$ : chr "119341"
  .. .. .. ..$ : chr "119342"
  .. .. .. ..$ : chr "119347"
  .. .. .. ..$ : chr "119348"
  .. .. .. ..$ : chr "119365"
  .. .. .. ..$ : chr "119366"
  .. .. .. ..$ : chr "119367"
  .. .. .. ..$ : chr "119377"
  .. .. .. ..$ : chr "120248"
  .. .. .. ..$ : chr "121019"
  .. .. .. ..$ : chr "122152"
  .. .. .. ..$ : chr "123140"
  .. .. .. ..$ : chr "126975"
  .. .. .. ..$ : chr "127479"
  .. .. .. ..$ : chr "127480"
  .. .. .. .. [list output truncated]</code></pre>
</div>
</div>
<p>Can I tibble that up?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(rbody_s_ds[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> <span class="co"># the [2] drops the error column</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(<span class="at">col =</span> <span class="fu">where</span>(is.list)) <span class="sc">%&gt;%</span> <span class="co"># a `return` list</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> <span class="fu">where</span>(is.list)) <span class="sc">%&gt;%</span> <span class="co"># sites, and a `datasource` list</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(<span class="at">col =</span> <span class="fu">where</span>(is.list)) <span class="co"># fully unpacked into a long df</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>s</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5,409 × 2
   datasource sites 
   &lt;chr&gt;      &lt;chr&gt; 
 1 A          100023
 2 A          100500
 3 A          100503
 4 A          100504
 5 A          101708
 6 A          102621
 7 A          102827
 8 A          102828
 9 A          102829
10 A          102830
# ℹ 5,399 more rows</code></pre>
</div>
</div>
<p>What are the number of sites in each?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>s <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(datasource) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  datasource     n
  &lt;chr&gt;      &lt;int&gt;
1 A           4177
2 TELEM       1232</code></pre>
</div>
</div>
<p>Way more in Archive. Are there any in Telem that aren’t in A?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>tsites <span class="ot">&lt;-</span> s <span class="sc">%&gt;%</span> </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(datasource <span class="sc">==</span> <span class="st">'TELEM'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sites) <span class="sc">%&gt;%</span> </span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>()</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>asites <span class="ot">&lt;-</span> s <span class="sc">%&gt;%</span> </span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(datasource <span class="sc">==</span> <span class="st">'A'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sites) <span class="sc">%&gt;%</span> </span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>()</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="fu">all</span>(tsites <span class="sc">%in%</span> asites)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="sc">!</span>(tsites <span class="sc">%in%</span> asites))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 59</code></pre>
</div>
</div>
<p>see if I can blow up ggplot. Oof the plurals</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> s <span class="sc">%&gt;%</span> </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">site =</span> sites, <span class="at">datasources =</span> datasource)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Unreadable. Not surprisingly.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_datasources_by_site</span>(s) <span class="sc">+</span> <span class="fu">coord_flip</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>yikes.</p>
</section>
<section id="test-package-version" class="level3">
<h3 class="anchored" data-anchor-id="test-package-version">Test package version</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">load_all</span>(<span class="st">'C:/Users/Galen/Documents/code/hydrogauge'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>ℹ Loading hydrogauge</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>sxd <span class="ot">&lt;-</span> <span class="fu">get_sites_by_datasource</span>(<span class="at">portal =</span> <span class="st">'vic'</span>, <span class="at">datasources =</span> <span class="fu">c</span>(<span class="st">'A'</span>, <span class="st">'TELEM'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>sxd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5,409 × 2
   datasource site  
   &lt;chr&gt;      &lt;chr&gt; 
 1 A          100023
 2 A          100500
 3 A          100503
 4 A          100504
 5 A          101708
 6 A          102621
 7 A          102827
 8 A          102828
 9 A          102829
10 A          102830
# ℹ 5,399 more rows</code></pre>
</div>
</div>
<p>Plot still needs work.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_datasources_by_site</span>(sxd) <span class="sc">+</span> <span class="fu">coord_flip</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(datasource, site)`</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="hydrogauge_testing_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="variables" class="level2">
<h2 class="anchored" data-anchor-id="variables">Variables</h2>
<p>or do I go straight for get_ts_ and then back this back out? Or get_db_info?</p>
<p>I think I’m going to want to use get_variable_list both in get_ts_traces and to generate a set of possible variables.</p>
<p>I’d like to get all sites, then make a master list of datasources and variables. But I need to get this usable for get_ts_traces, I think.</p>
<section id="get_variable_list" class="level3">
<h3 class="anchored" data-anchor-id="get_variable_list">Get_variable_list</h3>
<p>Feeding this a c(datasource, datasource) makes it return only some of the results, but throws no errors. So do one at a time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>v_s_params <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"function"</span> <span class="ot">=</span> <span class="st">'get_variable_list'</span>,</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"version"</span> <span class="ot">=</span> <span class="st">"1"</span>,</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">"params"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"site_list"</span> <span class="ot">=</span> allsites,</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"datasource"</span> <span class="ot">=</span> <span class="st">"A"</span>))</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>req <span class="ot">&lt;-</span> <span class="fu">request</span>(vicurl)</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>req <span class="sc">%&gt;%</span> </span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(v_s_params) <span class="sc">%&gt;%</span> </span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_dry_run</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>POST /WMIS/cgi/webservice.exe? HTTP/1.1
Host: data.water.vic.gov.au
User-Agent: httr2/1.0.3 r-curl/5.2.2 libcurl/8.3.0
Accept: */*
Accept-Encoding: deflate, gzip
Content-Type: application/json
Content-Length: 119

{"function":"get_variable_list","version":"1","params":{"site_list":"233217, 405328, 405331, 405837","datasource":"A"}}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>resp_v_s <span class="ot">&lt;-</span> req <span class="sc">%&gt;%</span> </span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(v_s_params) <span class="sc">%&gt;%</span> </span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>rbody_v_s <span class="ot">&lt;-</span> resp_v_s <span class="sc">%&gt;%</span> <span class="fu">resp_body_json</span>(<span class="at">check_type =</span> <span class="cn">FALSE</span>)</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(rbody_v_s)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ error_num: int 0
 $ return   :List of 1
  ..$ sites:List of 4
  .. ..$ :List of 3
  .. .. ..$ site_details:List of 3
  .. .. .. ..$ timezone  : chr "10.0"
  .. .. .. ..$ short_name: chr "BARWON @ GEELONG"
  .. .. .. ..$ name      : chr "BARWON RIVER @ GEELONG"
  .. .. ..$ variables   :List of 6
  .. .. .. ..$ :List of 6
  .. .. .. .. ..$ period_end  : chr "20240903074500"
  .. .. .. .. ..$ period_start: chr "19610306171500"
  .. .. .. .. ..$ subdesc     : chr "Available for release"
  .. .. .. .. ..$ variable    : chr "100.00"
  .. .. .. .. ..$ units       : chr "metres"
  .. .. .. .. ..$ name        : chr "Stream Water Level (m)"
  .. .. .. ..$ :List of 6
  .. .. .. .. ..$ period_end  : chr "20240903074500"
  .. .. .. .. ..$ period_start: chr "20100706123100"
  .. .. .. .. ..$ subdesc     : chr "Available for release"
  .. .. .. .. ..$ variable    : chr "210.00"
  .. .. .. .. ..$ units       : chr "pH"
  .. .. .. .. ..$ name        : chr "Acidity/Alkalinity (pH)"
  .. .. .. ..$ :List of 6
  .. .. .. .. ..$ period_end  : chr "20240903074500"
  .. .. .. .. ..$ period_start: chr "20100706123100"
  .. .. .. .. ..$ subdesc     : chr "Available for release"
  .. .. .. .. ..$ variable    : chr "215.00"
  .. .. .. .. ..$ units       : chr "ppm"
  .. .. .. .. ..$ name        : chr "Dissolved Oxygen (ppm)"
  .. .. .. ..$ :List of 6
  .. .. .. .. ..$ period_end  : chr "20240903074500"
  .. .. .. .. ..$ period_start: chr "20100706123100"
  .. .. .. .. ..$ subdesc     : chr "Available for release"
  .. .. .. .. ..$ variable    : chr "450.00"
  .. .. .. .. ..$ units       : chr "Degrees celsius"
  .. .. .. .. ..$ name        : chr "Water Temperature (°C)"
  .. .. .. ..$ :List of 6
  .. .. .. .. ..$ period_end  : chr "20240903074500"
  .. .. .. .. ..$ period_start: chr "20100706123100"
  .. .. .. .. ..$ subdesc     : chr "Available for release"
  .. .. .. .. ..$ variable    : chr "810.00"
  .. .. .. .. ..$ units       : chr "NTU"
  .. .. .. .. ..$ name        : chr "Turbidity (NTU)"
  .. .. .. ..$ :List of 6
  .. .. .. .. ..$ period_end  : chr "20240903074500"
  .. .. .. .. ..$ period_start: chr "20100706123100"
  .. .. .. .. ..$ subdesc     : chr "Available for release"
  .. .. .. .. ..$ variable    : chr "820.00"
  .. .. .. .. ..$ units       : chr "µS/cm@25°C"
  .. .. .. .. ..$ name        : chr "Conductivity (µS/cm)"
  .. .. ..$ site        : chr "233217"
  .. ..$ :List of 3
  .. .. ..$ site_details:List of 3
  .. .. .. ..$ timezone  : chr "10.0"
  .. .. .. ..$ short_name: chr "STEAVENSON R @ FALLS"
  .. .. .. ..$ name      : chr "STEAVENSON RIVER @ FALLS ROAD MARYSVILLE"
  .. .. ..$ variables   :List of 1
  .. .. .. ..$ :List of 6
  .. .. .. .. ..$ period_end  : chr "20240826102700"
  .. .. .. .. ..$ period_start: chr "20091119170800"
  .. .. .. .. ..$ subdesc     : chr "Available for release"
  .. .. .. .. ..$ variable    : chr "100.00"
  .. .. .. .. ..$ units       : chr "metres"
  .. .. .. .. ..$ name        : chr "Stream Water Level (m)"
  .. .. ..$ site        : chr "405328"
  .. ..$ :List of 3
  .. .. ..$ site_details:List of 3
  .. .. .. ..$ timezone  : chr "10.0"
  .. .. .. ..$ short_name: chr "TAGGERTY R LADY TALT"
  .. .. .. ..$ name      : chr "TAGGERTY RV @ LADY TALBOT DRIVE NEAR MARYSVILLE"
  .. .. ..$ variables   :List of 4
  .. .. .. ..$ :List of 6
  .. .. .. .. ..$ period_end  : chr "20130211110700"
  .. .. .. .. ..$ period_start: chr "20100729122000"
  .. .. .. .. ..$ subdesc     : chr "Available for release"
  .. .. .. .. ..$ variable    : chr "100.00"
  .. .. .. .. ..$ units       : chr "metres"
  .. .. .. .. ..$ name        : chr "Stream Water Level (m)"
  .. .. .. ..$ :List of 6
  .. .. .. .. ..$ period_end  : chr "20130211110700"
  .. .. .. .. ..$ period_start: chr "20100729122000"
  .. .. .. .. ..$ subdesc     : chr "Available for release"
  .. .. .. .. ..$ variable    : chr "450.00"
  .. .. .. .. ..$ units       : chr "Degrees celsius"
  .. .. .. .. ..$ name        : chr "Water Temperature (°C)"
  .. .. .. ..$ :List of 6
  .. .. .. .. ..$ period_end  : chr "20130211110700"
  .. .. .. .. ..$ period_start: chr "20100729122000"
  .. .. .. .. ..$ subdesc     : chr "Available for release"
  .. .. .. .. ..$ variable    : chr "810.00"
  .. .. .. .. ..$ units       : chr "NTU"
  .. .. .. .. ..$ name        : chr "Turbidity (NTU)"
  .. .. .. ..$ :List of 6
  .. .. .. .. ..$ period_end  : chr "20130211110700"
  .. .. .. .. ..$ period_start: chr "20100729122000"
  .. .. .. .. ..$ subdesc     : chr "Available for release"
  .. .. .. .. ..$ variable    : chr "820.00"
  .. .. .. .. ..$ units       : chr "µS/cm@25°C"
  .. .. .. .. ..$ name        : chr "Conductivity (µS/cm)"
  .. .. ..$ site        : chr "405331"
  .. ..$ :List of 3
  .. .. ..$ site_details:List of 3
  .. .. .. ..$ timezone  : chr "10.0"
  .. .. .. ..$ short_name: chr "R.G. MARYSVILLE"
  .. .. .. ..$ name      : chr "RAINGAUGE @ MARYSVILLE GOLF CLUB"
  .. .. ..$ variables   :List of 1
  .. .. .. ..$ :List of 6
  .. .. .. .. ..$ period_end  : chr "20240506120600"
  .. .. .. .. ..$ period_start: chr "20010621142700"
  .. .. .. .. ..$ subdesc     : chr "Available for release"
  .. .. .. .. ..$ variable    : chr "10.00"
  .. .. .. .. ..$ units       : chr "mm"
  .. .. .. .. ..$ name        : chr "Rainfall (mm)"
  .. .. ..$ site        : chr "405837"</code></pre>
</div>
</div>
<p>Unpack that</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(rbody_v_s[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> <span class="co"># the [2] drops the error column</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(<span class="at">col =</span> <span class="fu">where</span>(is.list)) <span class="sc">%&gt;%</span> <span class="co"># a `return` list</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> <span class="fu">where</span>(is.list)) <span class="sc">%&gt;%</span> <span class="co"># sites, and a `datasource` list</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> site_details) <span class="sc">%&gt;%</span> <span class="co"># site details in new cols</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(<span class="at">col =</span> variables) <span class="sc">%&gt;%</span> <span class="co"># one line per variable, details of variables in a list</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">long_name =</span> name) <span class="sc">%&gt;%</span> <span class="co"># variables have names too, avoid conflicts</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> variables) <span class="sc">%&gt;%</span> <span class="co"># columns for each attribute of the variables</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">var_name =</span> name)</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>s</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 10
   timezone short_name  long_name period_end period_start subdesc variable units
   &lt;chr&gt;    &lt;chr&gt;       &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;        &lt;chr&gt;   &lt;chr&gt;    &lt;chr&gt;
 1 10.0     BARWON @ G… BARWON R… 202409030… 19610306171… Availa… 100.00   metr…
 2 10.0     BARWON @ G… BARWON R… 202409030… 20100706123… Availa… 210.00   pH   
 3 10.0     BARWON @ G… BARWON R… 202409030… 20100706123… Availa… 215.00   ppm  
 4 10.0     BARWON @ G… BARWON R… 202409030… 20100706123… Availa… 450.00   Degr…
 5 10.0     BARWON @ G… BARWON R… 202409030… 20100706123… Availa… 810.00   NTU  
 6 10.0     BARWON @ G… BARWON R… 202409030… 20100706123… Availa… 820.00   µS/c…
 7 10.0     STEAVENSON… STEAVENS… 202408261… 20091119170… Availa… 100.00   metr…
 8 10.0     TAGGERTY R… TAGGERTY… 201302111… 20100729122… Availa… 100.00   metr…
 9 10.0     TAGGERTY R… TAGGERTY… 201302111… 20100729122… Availa… 450.00   Degr…
10 10.0     TAGGERTY R… TAGGERTY… 201302111… 20100729122… Availa… 810.00   NTU  
11 10.0     TAGGERTY R… TAGGERTY… 201302111… 20100729122… Availa… 820.00   µS/c…
12 10.0     R.G. MARYS… RAINGAUG… 202405061… 20010621142… Availa… 10.00    mm   
# ℹ 2 more variables: var_name &lt;chr&gt;, site &lt;chr&gt;</code></pre>
</div>
</div>
</section>
<section id="test-package-version-1" class="level3">
<h3 class="anchored" data-anchor-id="test-package-version-1">Test package version</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">load_all</span>(<span class="st">'C:/Users/Galen/Documents/code/hydrogauge'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>ℹ Loading hydrogauge</code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>vl <span class="ot">&lt;-</span> <span class="fu">get_variable_list</span>(<span class="at">portal =</span> <span class="st">'vic'</span>, <span class="at">site_list =</span> allsites, <span class="at">datasource =</span> <span class="st">'A'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>vl</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 11
   site   short_name       long_name variable units var_name period_start       
   &lt;chr&gt;  &lt;chr&gt;            &lt;chr&gt;     &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;    &lt;dttm&gt;             
 1 233217 BARWON @ GEELONG BARWON R… 100.00   metr… Stream … 1961-03-06 07:15:00
 2 233217 BARWON @ GEELONG BARWON R… 210.00   pH    Acidity… 2010-07-06 02:31:00
 3 233217 BARWON @ GEELONG BARWON R… 215.00   ppm   Dissolv… 2010-07-06 02:31:00
 4 233217 BARWON @ GEELONG BARWON R… 450.00   Degr… Water T… 2010-07-06 02:31:00
 5 233217 BARWON @ GEELONG BARWON R… 810.00   NTU   Turbidi… 2010-07-06 02:31:00
 6 233217 BARWON @ GEELONG BARWON R… 820.00   µS/c… Conduct… 2010-07-06 02:31:00
 7 405328 STEAVENSON R @ … STEAVENS… 100.00   metr… Stream … 2009-11-19 07:08:00
 8 405331 TAGGERTY R LADY… TAGGERTY… 100.00   metr… Stream … 2010-07-29 02:20:00
 9 405331 TAGGERTY R LADY… TAGGERTY… 450.00   Degr… Water T… 2010-07-29 02:20:00
10 405331 TAGGERTY R LADY… TAGGERTY… 810.00   NTU   Turbidi… 2010-07-29 02:20:00
11 405331 TAGGERTY R LADY… TAGGERTY… 820.00   µS/c… Conduct… 2010-07-29 02:20:00
12 405837 R.G. MARYSVILLE  RAINGAUG… 10.00    mm    Rainfal… 2001-06-21 04:27:00
# ℹ 4 more variables: period_end &lt;dttm&gt;, subdesc &lt;chr&gt;, datasource &lt;chr&gt;,
#   database_timezone &lt;chr&gt;</code></pre>
</div>
</div>
<p>Try with two datasources</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>v2 <span class="ot">&lt;-</span> <span class="fu">get_variable_list</span>(<span class="at">portal =</span> <span class="st">'vic'</span>, <span class="at">site_list =</span> allsites, <span class="at">datasource =</span> <span class="fu">c</span>(<span class="st">'A'</span>, <span class="st">'TELEM'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>v2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 11
   site   short_name       long_name variable units var_name period_start       
   &lt;chr&gt;  &lt;chr&gt;            &lt;chr&gt;     &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;    &lt;dttm&gt;             
 1 233217 BARWON @ GEELONG BARWON R… 100.00   metr… Stream … 1961-03-06 07:15:00
 2 233217 BARWON @ GEELONG BARWON R… 210.00   pH    Acidity… 2010-07-06 02:31:00
 3 233217 BARWON @ GEELONG BARWON R… 215.00   ppm   Dissolv… 2010-07-06 02:31:00
 4 233217 BARWON @ GEELONG BARWON R… 450.00   Degr… Water T… 2010-07-06 02:31:00
 5 233217 BARWON @ GEELONG BARWON R… 810.00   NTU   Turbidi… 2010-07-06 02:31:00
 6 233217 BARWON @ GEELONG BARWON R… 820.00   µS/c… Conduct… 2010-07-06 02:31:00
 7 405328 STEAVENSON R @ … STEAVENS… 100.00   metr… Stream … 2009-11-19 07:08:00
 8 405331 TAGGERTY R LADY… TAGGERTY… 100.00   metr… Stream … 2010-07-29 02:20:00
 9 405331 TAGGERTY R LADY… TAGGERTY… 450.00   Degr… Water T… 2010-07-29 02:20:00
10 405331 TAGGERTY R LADY… TAGGERTY… 810.00   NTU   Turbidi… 2010-07-29 02:20:00
# ℹ 14 more rows
# ℹ 4 more variables: period_end &lt;dttm&gt;, subdesc &lt;chr&gt;, datasource &lt;chr&gt;,
#   database_timezone &lt;chr&gt;</code></pre>
</div>
</div>
<p>I think now go to get_ts_traces, and then go back and write some helpers that can call get_datasources and get_variable and geo-locate, and use them to allow passing things like variables = ‘all’</p>
</section>
</section>
<section id="get-traces" class="level2">
<h2 class="anchored" data-anchor-id="get-traces">get traces</h2>
<p>The basic format is this, will need to do some testing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>b1params <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"function"</span> <span class="ot">=</span> <span class="st">'get_ts_traces'</span>,</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"version"</span> <span class="ot">=</span> <span class="st">"2"</span>,</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">"params"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"site_list"</span> <span class="ot">=</span> barwon,</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"start_time"</span> <span class="ot">=</span> <span class="st">"20200101000000"</span>,</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"var_list"</span> <span class="ot">=</span> <span class="st">"100"</span>,</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"interval"</span> <span class="ot">=</span> <span class="st">"day"</span>,</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"datasource"</span> <span class="ot">=</span> <span class="st">"A"</span>, </span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"end_time"</span> <span class="ot">=</span> <span class="st">"20200115000000"</span>,</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"data_type"</span> <span class="ot">=</span> <span class="st">"mean"</span>,</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"multiplier"</span> <span class="ot">=</span> <span class="st">"1"</span>))</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>req <span class="ot">&lt;-</span> <span class="fu">request</span>(vicurl)</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>req <span class="sc">%&gt;%</span> </span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(b1params) <span class="sc">%&gt;%</span> </span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_dry_run</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>POST /WMIS/cgi/webservice.exe? HTTP/1.1
Host: data.water.vic.gov.au
User-Agent: httr2/1.0.3 r-curl/5.2.2 libcurl/8.3.0
Accept: */*
Accept-Encoding: deflate, gzip
Content-Type: application/json
Content-Length: 219

{"function":"get_ts_traces","version":"2","params":{"site_list":"233217","start_time":"20200101000000","var_list":"100","interval":"day","datasource":"A","end_time":"20200115000000","data_type":"mean","multiplier":"1"}}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>respb1 <span class="ot">&lt;-</span> req <span class="sc">%&gt;%</span> </span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(b1params) <span class="sc">%&gt;%</span> </span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>rbodyb1 <span class="ot">&lt;-</span> respb1 <span class="sc">%&gt;%</span> <span class="fu">resp_body_json</span>(<span class="at">check_type =</span> <span class="cn">FALSE</span>)</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(rbodyb1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ error_num: int 0
 $ return   :List of 1
  ..$ traces:List of 1
  .. ..$ :List of 8
  .. .. ..$ error_num      : int 0
  .. .. ..$ compressed     : chr "0"
  .. .. ..$ site_details   :List of 6
  .. .. .. ..$ timezone  : chr "10.0"
  .. .. .. ..$ short_name: chr "BARWON @ GEELONG"
  .. .. .. ..$ longitude : chr "144.346892200"
  .. .. .. ..$ name      : chr "BARWON RIVER @ GEELONG"
  .. .. .. ..$ latitude  : chr "-38.163605590"
  .. .. .. ..$ org_name  : chr "Dept. Sustainability and Environment"
  .. .. ..$ quality_codes  :List of 2
  .. .. .. ..$ 2 : chr "Good quality data - minimal editing required. +/- 0mm-10mm Drift correction"
  .. .. .. ..$ 15: chr "Minor editing. +/- 11mm-20mm drift correction"
  .. .. ..$ trace          :List of 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.838"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.834"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.827"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.821"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.816"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.814"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.811"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.802"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.791"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.805"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.831"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.824"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.820"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.812"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.817"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. ..$ varfrom_details:List of 6
  .. .. .. ..$ short_name: chr "Water Level (m)"
  .. .. .. ..$ precision : chr "0.001000"
  .. .. .. ..$ subdesc   : chr "Available for release"
  .. .. .. ..$ variable  : chr "100.00"
  .. .. .. ..$ units     : chr "metres"
  .. .. .. ..$ name      : chr "Stream Water Level (m)"
  .. .. ..$ site           : chr "233217"
  .. .. ..$ varto_details  :List of 6
  .. .. .. ..$ short_name: chr "Water Level (m)"
  .. .. .. ..$ precision : chr "0.001000"
  .. .. .. ..$ subdesc   : chr "Available for release"
  .. .. .. ..$ variable  : chr "100.00"
  .. .. .. ..$ units     : chr "metres"
  .. .. .. ..$ name      : chr "Stream Water Level (m)"</code></pre>
</div>
</div>
<p>and with two params</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>b2params <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"function"</span> <span class="ot">=</span> <span class="st">'get_ts_traces'</span>,</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"version"</span> <span class="ot">=</span> <span class="st">"2"</span>,</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">"params"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"site_list"</span> <span class="ot">=</span> barwon,</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"start_time"</span> <span class="ot">=</span> <span class="st">"20200101000000"</span>,</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"var_list"</span> <span class="ot">=</span> <span class="st">"100,210"</span>,</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"interval"</span> <span class="ot">=</span> <span class="st">"day"</span>,</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"datasource"</span> <span class="ot">=</span> <span class="st">"A"</span>, </span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"end_time"</span> <span class="ot">=</span> <span class="st">"20200115000000"</span>,</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"data_type"</span> <span class="ot">=</span> <span class="st">"mean"</span>,</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"multiplier"</span> <span class="ot">=</span> <span class="st">"1"</span>))</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>req <span class="ot">&lt;-</span> <span class="fu">request</span>(vicurl)</span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a>req <span class="sc">%&gt;%</span> </span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(b2params) <span class="sc">%&gt;%</span> </span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_dry_run</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>POST /WMIS/cgi/webservice.exe? HTTP/1.1
Host: data.water.vic.gov.au
User-Agent: httr2/1.0.3 r-curl/5.2.2 libcurl/8.3.0
Accept: */*
Accept-Encoding: deflate, gzip
Content-Type: application/json
Content-Length: 223

{"function":"get_ts_traces","version":"2","params":{"site_list":"233217","start_time":"20200101000000","var_list":"100,210","interval":"day","datasource":"A","end_time":"20200115000000","data_type":"mean","multiplier":"1"}}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>respb2 <span class="ot">&lt;-</span> req <span class="sc">%&gt;%</span> </span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(b2params) <span class="sc">%&gt;%</span> </span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>rbodyb2 <span class="ot">&lt;-</span> respb2 <span class="sc">%&gt;%</span> <span class="fu">resp_body_json</span>(<span class="at">check_type =</span> <span class="cn">FALSE</span>)</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(rbodyb2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ error_num: int 0
 $ return   :List of 1
  ..$ traces:List of 2
  .. ..$ :List of 8
  .. .. ..$ error_num      : int 0
  .. .. ..$ compressed     : chr "0"
  .. .. ..$ site_details   :List of 6
  .. .. .. ..$ timezone  : chr "10.0"
  .. .. .. ..$ short_name: chr "BARWON @ GEELONG"
  .. .. .. ..$ longitude : chr "144.346892200"
  .. .. .. ..$ name      : chr "BARWON RIVER @ GEELONG"
  .. .. .. ..$ latitude  : chr "-38.163605590"
  .. .. .. ..$ org_name  : chr "Dept. Sustainability and Environment"
  .. .. ..$ quality_codes  :List of 2
  .. .. .. ..$ 2 : chr "Good quality data - minimal editing required. +/- 0mm-10mm Drift correction"
  .. .. .. ..$ 15: chr "Minor editing. +/- 11mm-20mm drift correction"
  .. .. ..$ trace          :List of 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.838"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.834"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.827"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.821"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.816"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.814"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.811"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.802"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.791"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.805"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.831"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.824"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.820"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.812"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.817"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. ..$ varfrom_details:List of 6
  .. .. .. ..$ short_name: chr "Water Level (m)"
  .. .. .. ..$ precision : chr "0.001000"
  .. .. .. ..$ subdesc   : chr "Available for release"
  .. .. .. ..$ variable  : chr "100.00"
  .. .. .. ..$ units     : chr "metres"
  .. .. .. ..$ name      : chr "Stream Water Level (m)"
  .. .. ..$ site           : chr "233217"
  .. .. ..$ varto_details  :List of 6
  .. .. .. ..$ short_name: chr "Water Level (m)"
  .. .. .. ..$ precision : chr "0.001000"
  .. .. .. ..$ subdesc   : chr "Available for release"
  .. .. .. ..$ variable  : chr "100.00"
  .. .. .. ..$ units     : chr "metres"
  .. .. .. ..$ name      : chr "Stream Water Level (m)"
  .. ..$ :List of 8
  .. .. ..$ error_num      : int 0
  .. .. ..$ compressed     : chr "0"
  .. .. ..$ site_details   :List of 6
  .. .. .. ..$ timezone  : chr "10.0"
  .. .. .. ..$ short_name: chr "BARWON @ GEELONG"
  .. .. .. ..$ longitude : chr "144.346892200"
  .. .. .. ..$ name      : chr "BARWON RIVER @ GEELONG"
  .. .. .. ..$ latitude  : chr "-38.163605590"
  .. .. .. ..$ org_name  : chr "Dept. Sustainability and Environment"
  .. .. ..$ quality_codes  :List of 1
  .. .. .. ..$ 2: chr "Good quality data - minimal editing required. +/- 0mm-10mm Drift correction"
  .. .. ..$ trace          :List of 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.80"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.82"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.94"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.90"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.71"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.59"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.52"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.64"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.95"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "8.11"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "8.01"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "8.14"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.85"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.92"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.79"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. ..$ varfrom_details:List of 6
  .. .. .. ..$ short_name: chr "Field pH"
  .. .. .. ..$ precision : chr "0.010000"
  .. .. .. ..$ subdesc   : chr "Available for release"
  .. .. .. ..$ variable  : chr "210.00"
  .. .. .. ..$ units     : chr "pH"
  .. .. .. ..$ name      : chr "Acidity/Alkalinity (pH)"
  .. .. ..$ site           : chr "233217"
  .. .. ..$ varto_details  :List of 6
  .. .. .. ..$ short_name: chr "Field pH"
  .. .. .. ..$ precision : chr "0.010000"
  .. .. .. ..$ subdesc   : chr "Available for release"
  .. .. .. ..$ variable  : chr "210.00"
  .. .. .. ..$ units     : chr "pH"
  .. .. .. ..$ name      : chr "Acidity/Alkalinity (pH)"</code></pre>
</div>
</div>
<p>Two params, two sites (one site only has one var, but not an error, I hope)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>b22params <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"function"</span> <span class="ot">=</span> <span class="st">'get_ts_traces'</span>,</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"version"</span> <span class="ot">=</span> <span class="st">"2"</span>,</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">"params"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"site_list"</span> <span class="ot">=</span> <span class="fu">str_c</span>(barwon, steavenson, <span class="at">sep =</span> <span class="st">", "</span>),</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"start_time"</span> <span class="ot">=</span> <span class="st">"20200101000000"</span>,</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"var_list"</span> <span class="ot">=</span> <span class="st">"100,210"</span>,</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"interval"</span> <span class="ot">=</span> <span class="st">"day"</span>,</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"datasource"</span> <span class="ot">=</span> <span class="st">"A"</span>, </span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"end_time"</span> <span class="ot">=</span> <span class="st">"20200115000000"</span>,</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"data_type"</span> <span class="ot">=</span> <span class="st">"mean"</span>,</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"multiplier"</span> <span class="ot">=</span> <span class="st">"1"</span>))</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>req <span class="ot">&lt;-</span> <span class="fu">request</span>(vicurl)</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>req <span class="sc">%&gt;%</span> </span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(b22params) <span class="sc">%&gt;%</span> </span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_dry_run</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>POST /WMIS/cgi/webservice.exe? HTTP/1.1
Host: data.water.vic.gov.au
User-Agent: httr2/1.0.3 r-curl/5.2.2 libcurl/8.3.0
Accept: */*
Accept-Encoding: deflate, gzip
Content-Type: application/json
Content-Length: 231

{"function":"get_ts_traces","version":"2","params":{"site_list":"233217, 405328","start_time":"20200101000000","var_list":"100,210","interval":"day","datasource":"A","end_time":"20200115000000","data_type":"mean","multiplier":"1"}}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>respb22 <span class="ot">&lt;-</span> req <span class="sc">%&gt;%</span> </span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(b22params) <span class="sc">%&gt;%</span> </span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>rbodyb22 <span class="ot">&lt;-</span> respb22 <span class="sc">%&gt;%</span> <span class="fu">resp_body_json</span>(<span class="at">check_type =</span> <span class="cn">FALSE</span>)</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(rbodyb22)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ error_num: int 0
 $ return   :List of 1
  ..$ traces:List of 3
  .. ..$ :List of 8
  .. .. ..$ error_num      : int 0
  .. .. ..$ compressed     : chr "0"
  .. .. ..$ site_details   :List of 6
  .. .. .. ..$ timezone  : chr "10.0"
  .. .. .. ..$ short_name: chr "BARWON @ GEELONG"
  .. .. .. ..$ longitude : chr "144.346892200"
  .. .. .. ..$ name      : chr "BARWON RIVER @ GEELONG"
  .. .. .. ..$ latitude  : chr "-38.163605590"
  .. .. .. ..$ org_name  : chr "Dept. Sustainability and Environment"
  .. .. ..$ quality_codes  :List of 2
  .. .. .. ..$ 2 : chr "Good quality data - minimal editing required. +/- 0mm-10mm Drift correction"
  .. .. .. ..$ 15: chr "Minor editing. +/- 11mm-20mm drift correction"
  .. .. ..$ trace          :List of 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.838"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.834"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.827"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.821"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.816"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.814"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.811"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.802"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.791"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.805"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.831"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.824"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.820"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.812"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.817"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. ..$ varfrom_details:List of 6
  .. .. .. ..$ short_name: chr "Water Level (m)"
  .. .. .. ..$ precision : chr "0.001000"
  .. .. .. ..$ subdesc   : chr "Available for release"
  .. .. .. ..$ variable  : chr "100.00"
  .. .. .. ..$ units     : chr "metres"
  .. .. .. ..$ name      : chr "Stream Water Level (m)"
  .. .. ..$ site           : chr "233217"
  .. .. ..$ varto_details  :List of 6
  .. .. .. ..$ short_name: chr "Water Level (m)"
  .. .. .. ..$ precision : chr "0.001000"
  .. .. .. ..$ subdesc   : chr "Available for release"
  .. .. .. ..$ variable  : chr "100.00"
  .. .. .. ..$ units     : chr "metres"
  .. .. .. ..$ name      : chr "Stream Water Level (m)"
  .. ..$ :List of 8
  .. .. ..$ error_num      : int 0
  .. .. ..$ compressed     : chr "0"
  .. .. ..$ site_details   :List of 6
  .. .. .. ..$ timezone  : chr "10.0"
  .. .. .. ..$ short_name: chr "BARWON @ GEELONG"
  .. .. .. ..$ longitude : chr "144.346892200"
  .. .. .. ..$ name      : chr "BARWON RIVER @ GEELONG"
  .. .. .. ..$ latitude  : chr "-38.163605590"
  .. .. .. ..$ org_name  : chr "Dept. Sustainability and Environment"
  .. .. ..$ quality_codes  :List of 1
  .. .. .. ..$ 2: chr "Good quality data - minimal editing required. +/- 0mm-10mm Drift correction"
  .. .. ..$ trace          :List of 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.80"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.82"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.94"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.90"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.71"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.59"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.52"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.64"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.95"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "8.11"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "8.01"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "8.14"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.85"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.92"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.79"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. ..$ varfrom_details:List of 6
  .. .. .. ..$ short_name: chr "Field pH"
  .. .. .. ..$ precision : chr "0.010000"
  .. .. .. ..$ subdesc   : chr "Available for release"
  .. .. .. ..$ variable  : chr "210.00"
  .. .. .. ..$ units     : chr "pH"
  .. .. .. ..$ name      : chr "Acidity/Alkalinity (pH)"
  .. .. ..$ site           : chr "233217"
  .. .. ..$ varto_details  :List of 6
  .. .. .. ..$ short_name: chr "Field pH"
  .. .. .. ..$ precision : chr "0.010000"
  .. .. .. ..$ subdesc   : chr "Available for release"
  .. .. .. ..$ variable  : chr "210.00"
  .. .. .. ..$ units     : chr "pH"
  .. .. .. ..$ name      : chr "Acidity/Alkalinity (pH)"
  .. ..$ :List of 8
  .. .. ..$ error_num      : int 0
  .. .. ..$ compressed     : chr "0"
  .. .. ..$ site_details   :List of 6
  .. .. .. ..$ timezone  : chr "10.0"
  .. .. .. ..$ short_name: chr "STEAVENSON R @ FALLS"
  .. .. .. ..$ longitude : chr "145.773503100"
  .. .. .. ..$ name      : chr "STEAVENSON RIVER @ FALLS ROAD MARYSVILLE"
  .. .. .. ..$ latitude  : chr "-37.525797590"
  .. .. .. ..$ org_name  : chr "Victorian Rural Water Corporation"
  .. .. ..$ quality_codes  :List of 1
  .. .. .. ..$ 2: chr "Good quality data - minimal editing required. +/- 0mm-10mm Drift correction"
  .. .. ..$ trace          :List of 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.741"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.738"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.736"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.734"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.741"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.755"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.745"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.739"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.735"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.745"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.759"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.745"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.742"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.740"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.757"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. ..$ varfrom_details:List of 6
  .. .. .. ..$ short_name: chr "Water Level (m)"
  .. .. .. ..$ precision : chr "0.001000"
  .. .. .. ..$ subdesc   : chr "Available for release"
  .. .. .. ..$ variable  : chr "100.00"
  .. .. .. ..$ units     : chr "metres"
  .. .. .. ..$ name      : chr "Stream Water Level (m)"
  .. .. ..$ site           : chr "405328"
  .. .. ..$ varto_details  :List of 6
  .. .. .. ..$ short_name: chr "Water Level (m)"
  .. .. .. ..$ precision : chr "0.001000"
  .. .. .. ..$ subdesc   : chr "Available for release"
  .. .. .. ..$ variable  : chr "100.00"
  .. .. .. ..$ units     : chr "metres"
  .. .. .. ..$ name      : chr "Stream Water Level (m)"</code></pre>
</div>
</div>
<p>I wasn’t able to get discharge (140, 141) from a varlist. Double check</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>bparamsd <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"function"</span> <span class="ot">=</span> <span class="st">'get_ts_traces'</span>,</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"version"</span> <span class="ot">=</span> <span class="st">"2"</span>,</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">"params"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"site_list"</span> <span class="ot">=</span> barwon,</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"start_time"</span> <span class="ot">=</span> <span class="st">"20200101000000"</span>,</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"var_list"</span> <span class="ot">=</span> <span class="st">"100,140"</span>,</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"interval"</span> <span class="ot">=</span> <span class="st">"day"</span>,</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"datasource"</span> <span class="ot">=</span> <span class="st">"A"</span>, </span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"end_time"</span> <span class="ot">=</span> <span class="st">"20200115000000"</span>,</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"data_type"</span> <span class="ot">=</span> <span class="st">"mean"</span>,</span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"multiplier"</span> <span class="ot">=</span> <span class="st">"1"</span>))</span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>req <span class="ot">&lt;-</span> <span class="fu">request</span>(vicurl)</span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a>req <span class="sc">%&gt;%</span> </span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(bparamsd) <span class="sc">%&gt;%</span> </span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_dry_run</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>POST /WMIS/cgi/webservice.exe? HTTP/1.1
Host: data.water.vic.gov.au
User-Agent: httr2/1.0.3 r-curl/5.2.2 libcurl/8.3.0
Accept: */*
Accept-Encoding: deflate, gzip
Content-Type: application/json
Content-Length: 223

{"function":"get_ts_traces","version":"2","params":{"site_list":"233217","start_time":"20200101000000","var_list":"100,140","interval":"day","datasource":"A","end_time":"20200115000000","data_type":"mean","multiplier":"1"}}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>respbd <span class="ot">&lt;-</span> req <span class="sc">%&gt;%</span> </span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(bparamsd) <span class="sc">%&gt;%</span> </span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>rbodybd <span class="ot">&lt;-</span> respbd <span class="sc">%&gt;%</span> <span class="fu">resp_body_json</span>(<span class="at">check_type =</span> <span class="cn">FALSE</span>)</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(rbodybd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ error_num: int 0
 $ return   :List of 1
  ..$ traces:List of 1
  .. ..$ :List of 8
  .. .. ..$ error_num      : int 0
  .. .. ..$ compressed     : chr "0"
  .. .. ..$ site_details   :List of 6
  .. .. .. ..$ timezone  : chr "10.0"
  .. .. .. ..$ short_name: chr "BARWON @ GEELONG"
  .. .. .. ..$ longitude : chr "144.346892200"
  .. .. .. ..$ name      : chr "BARWON RIVER @ GEELONG"
  .. .. .. ..$ latitude  : chr "-38.163605590"
  .. .. .. ..$ org_name  : chr "Dept. Sustainability and Environment"
  .. .. ..$ quality_codes  :List of 2
  .. .. .. ..$ 2 : chr "Good quality data - minimal editing required. +/- 0mm-10mm Drift correction"
  .. .. .. ..$ 15: chr "Minor editing. +/- 11mm-20mm drift correction"
  .. .. ..$ trace          :List of 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.838"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.834"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.827"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.821"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.816"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.814"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.811"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.802"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.791"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.805"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.831"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.824"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.820"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.812"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.817"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. ..$ varfrom_details:List of 6
  .. .. .. ..$ short_name: chr "Water Level (m)"
  .. .. .. ..$ precision : chr "0.001000"
  .. .. .. ..$ subdesc   : chr "Available for release"
  .. .. .. ..$ variable  : chr "100.00"
  .. .. .. ..$ units     : chr "metres"
  .. .. .. ..$ name      : chr "Stream Water Level (m)"
  .. .. ..$ site           : chr "233217"
  .. .. ..$ varto_details  :List of 6
  .. .. .. ..$ short_name: chr "Water Level (m)"
  .. .. .. ..$ precision : chr "0.001000"
  .. .. .. ..$ subdesc   : chr "Available for release"
  .. .. .. ..$ variable  : chr "100.00"
  .. .. .. ..$ units     : chr "metres"
  .. .. .. ..$ name      : chr "Stream Water Level (m)"</code></pre>
</div>
</div>
<p>Kisters has an example of asking for 140.01? Try that? No, just do the varfrom/varto method for discharge and stage.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>bparams <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"function"</span> <span class="ot">=</span> <span class="st">'get_ts_traces'</span>,</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"version"</span> <span class="ot">=</span> <span class="st">"2"</span>,</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">"params"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"site_list"</span> <span class="ot">=</span> barwon,</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"start_time"</span> <span class="ot">=</span> <span class="st">"20200101000000"</span>,</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"var_list"</span> <span class="ot">=</span> <span class="st">"100,140.01"</span>,</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"interval"</span> <span class="ot">=</span> <span class="st">"day"</span>,</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"datasource"</span> <span class="ot">=</span> <span class="st">"A"</span>, </span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"end_time"</span> <span class="ot">=</span> <span class="st">"20200115000000"</span>,</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"data_type"</span> <span class="ot">=</span> <span class="st">"mean"</span>,</span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"multiplier"</span> <span class="ot">=</span> <span class="st">"1"</span>))</span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>req <span class="ot">&lt;-</span> <span class="fu">request</span>(vicurl)</span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>req <span class="sc">%&gt;%</span> </span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(bparams) <span class="sc">%&gt;%</span> </span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_dry_run</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>POST /WMIS/cgi/webservice.exe? HTTP/1.1
Host: data.water.vic.gov.au
User-Agent: httr2/1.0.3 r-curl/5.2.2 libcurl/8.3.0
Accept: */*
Accept-Encoding: deflate, gzip
Content-Type: application/json
Content-Length: 226

{"function":"get_ts_traces","version":"2","params":{"site_list":"233217","start_time":"20200101000000","var_list":"100,140.01","interval":"day","datasource":"A","end_time":"20200115000000","data_type":"mean","multiplier":"1"}}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>respb <span class="ot">&lt;-</span> req <span class="sc">%&gt;%</span> </span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(bparams) <span class="sc">%&gt;%</span> </span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>rbodyb <span class="ot">&lt;-</span> respb <span class="sc">%&gt;%</span> <span class="fu">resp_body_json</span>(<span class="at">check_type =</span> <span class="cn">FALSE</span>)</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(rbodyb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ error_num: int 0
 $ return   :List of 1
  ..$ traces:List of 1
  .. ..$ :List of 8
  .. .. ..$ error_num      : int 0
  .. .. ..$ compressed     : chr "0"
  .. .. ..$ site_details   :List of 6
  .. .. .. ..$ timezone  : chr "10.0"
  .. .. .. ..$ short_name: chr "BARWON @ GEELONG"
  .. .. .. ..$ longitude : chr "144.346892200"
  .. .. .. ..$ name      : chr "BARWON RIVER @ GEELONG"
  .. .. .. ..$ latitude  : chr "-38.163605590"
  .. .. .. ..$ org_name  : chr "Dept. Sustainability and Environment"
  .. .. ..$ quality_codes  :List of 2
  .. .. .. ..$ 2 : chr "Good quality data - minimal editing required. +/- 0mm-10mm Drift correction"
  .. .. .. ..$ 15: chr "Minor editing. +/- 11mm-20mm drift correction"
  .. .. ..$ trace          :List of 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.838"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.834"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.827"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.821"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.816"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.814"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.811"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.802"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.791"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.805"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.831"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.824"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.820"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.812"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.817"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. ..$ varfrom_details:List of 6
  .. .. .. ..$ short_name: chr "Water Level (m)"
  .. .. .. ..$ precision : chr "0.001000"
  .. .. .. ..$ subdesc   : chr "Available for release"
  .. .. .. ..$ variable  : chr "100.00"
  .. .. .. ..$ units     : chr "metres"
  .. .. .. ..$ name      : chr "Stream Water Level (m)"
  .. .. ..$ site           : chr "233217"
  .. .. ..$ varto_details  :List of 6
  .. .. .. ..$ short_name: chr "Water Level (m)"
  .. .. .. ..$ precision : chr "0.001000"
  .. .. .. ..$ subdesc   : chr "Available for release"
  .. .. .. ..$ variable  : chr "100.00"
  .. .. .. ..$ units     : chr "metres"
  .. .. .. ..$ name      : chr "Stream Water Level (m)"</code></pre>
</div>
</div>
<p>varfrom-varto check. Does it give us both, or do we have to ask for the from separately`?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>bparamsft <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"function"</span> <span class="ot">=</span> <span class="st">'get_ts_traces'</span>,</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"version"</span> <span class="ot">=</span> <span class="st">"2"</span>,</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">"params"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"site_list"</span> <span class="ot">=</span> barwon,</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"start_time"</span> <span class="ot">=</span> <span class="st">"20200101000000"</span>,</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"varfrom"</span> <span class="ot">=</span> <span class="st">"100"</span>,</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"varto"</span> <span class="ot">=</span> <span class="st">"140"</span>, </span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"interval"</span> <span class="ot">=</span> <span class="st">"day"</span>,</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"datasource"</span> <span class="ot">=</span> <span class="st">"A"</span>, </span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"end_time"</span> <span class="ot">=</span> <span class="st">"20200115000000"</span>,</span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"data_type"</span> <span class="ot">=</span> <span class="st">"mean"</span>,</span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"multiplier"</span> <span class="ot">=</span> <span class="st">"1"</span>))</span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>req <span class="ot">&lt;-</span> <span class="fu">request</span>(vicurl)</span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a>req <span class="sc">%&gt;%</span> </span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(bparamsft) <span class="sc">%&gt;%</span> </span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_dry_run</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>POST /WMIS/cgi/webservice.exe? HTTP/1.1
Host: data.water.vic.gov.au
User-Agent: httr2/1.0.3 r-curl/5.2.2 libcurl/8.3.0
Accept: */*
Accept-Encoding: deflate, gzip
Content-Type: application/json
Content-Length: 232

{"function":"get_ts_traces","version":"2","params":{"site_list":"233217","start_time":"20200101000000","varfrom":"100","varto":"140","interval":"day","datasource":"A","end_time":"20200115000000","data_type":"mean","multiplier":"1"}}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>respbft <span class="ot">&lt;-</span> req <span class="sc">%&gt;%</span> </span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(bparamsft) <span class="sc">%&gt;%</span> </span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>rbodybft <span class="ot">&lt;-</span> respbft <span class="sc">%&gt;%</span> <span class="fu">resp_body_json</span>(<span class="at">check_type =</span> <span class="cn">FALSE</span>)</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(rbodybft)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ error_num: int 0
 $ return   :List of 1
  ..$ traces:List of 1
  .. ..$ :List of 8
  .. .. ..$ error_num      : int 0
  .. .. ..$ compressed     : chr "0"
  .. .. ..$ site_details   :List of 6
  .. .. .. ..$ timezone  : chr "10.0"
  .. .. .. ..$ short_name: chr "BARWON @ GEELONG"
  .. .. .. ..$ longitude : chr "144.346892200"
  .. .. .. ..$ name      : chr "BARWON RIVER @ GEELONG"
  .. .. .. ..$ latitude  : chr "-38.163605590"
  .. .. .. ..$ org_name  : chr "Dept. Sustainability and Environment"
  .. .. ..$ quality_codes  :List of 1
  .. .. .. ..$ 150: chr "Rating extrapolated above 1.5x maximum flow gauged."
  .. .. ..$ trace          :List of 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.184"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.163"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.130"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.102"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.087"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.078"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.070"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.048"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.029"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.080"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.146"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.114"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.097"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.075"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.113"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. ..$ varfrom_details:List of 6
  .. .. .. ..$ short_name: chr "Water Level (m)"
  .. .. .. ..$ precision : chr "0.001000"
  .. .. .. ..$ subdesc   : chr "Available for release"
  .. .. .. ..$ variable  : chr "100.00"
  .. .. .. ..$ units     : chr "metres"
  .. .. .. ..$ name      : chr "Stream Water Level (m)"
  .. .. ..$ site           : chr "233217"
  .. .. ..$ varto_details  :List of 6
  .. .. .. ..$ short_name: chr "Discharge (m3/sec)"
  .. .. .. ..$ precision : chr "0.001000"
  .. .. .. ..$ subdesc   : chr "Available for release"
  .. .. .. ..$ variable  : chr "140.00"
  .. .. .. ..$ units     : chr "cubic metres/second"
  .. .. .. ..$ name      : chr "Stream Discharge (m3/s)"</code></pre>
</div>
</div>
<p>That looks like it might have only given us varto.</p>
<p>What happens if we ask for a varto/from for a site that doesn’t have it? Earlier we saw that the varlist just skips, but does this?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>bparamse <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"function"</span> <span class="ot">=</span> <span class="st">'get_ts_traces'</span>,</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"version"</span> <span class="ot">=</span> <span class="st">"2"</span>,</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">"params"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"site_list"</span> <span class="ot">=</span> golf,</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"start_time"</span> <span class="ot">=</span> <span class="st">"20200101000000"</span>,</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"var_list"</span> <span class="ot">=</span> <span class="st">"100,210"</span>,</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"interval"</span> <span class="ot">=</span> <span class="st">"day"</span>,</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"datasource"</span> <span class="ot">=</span> <span class="st">"A"</span>, </span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"end_time"</span> <span class="ot">=</span> <span class="st">"20200115000000"</span>,</span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"data_type"</span> <span class="ot">=</span> <span class="st">"mean"</span>,</span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"multiplier"</span> <span class="ot">=</span> <span class="st">"1"</span>))</span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>req <span class="ot">&lt;-</span> <span class="fu">request</span>(vicurl)</span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a>req <span class="sc">%&gt;%</span> </span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(bparamse) <span class="sc">%&gt;%</span> </span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_dry_run</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>POST /WMIS/cgi/webservice.exe? HTTP/1.1
Host: data.water.vic.gov.au
User-Agent: httr2/1.0.3 r-curl/5.2.2 libcurl/8.3.0
Accept: */*
Accept-Encoding: deflate, gzip
Content-Type: application/json
Content-Length: 223

{"function":"get_ts_traces","version":"2","params":{"site_list":"405837","start_time":"20200101000000","var_list":"100,210","interval":"day","datasource":"A","end_time":"20200115000000","data_type":"mean","multiplier":"1"}}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>respbe <span class="ot">&lt;-</span> req <span class="sc">%&gt;%</span> </span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(bparamse) <span class="sc">%&gt;%</span> </span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>rbodybe <span class="ot">&lt;-</span> respbe <span class="sc">%&gt;%</span> <span class="fu">resp_body_json</span>(<span class="at">check_type =</span> <span class="cn">FALSE</span>)</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(rbodybe)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ error_num: int 125
 $ error_msg: chr "No data for specified variable in file"</code></pre>
</div>
</div>
<p>Ok, that errors. So I’ll need to capture and skip errors.</p>
<section id="unpack-different-formats" class="level3">
<h3 class="anchored" data-anchor-id="unpack-different-formats">unpack different formats</h3>
<p>(varlist with multiple, varfrom/to, etc). b1params (one param, one site), b2params (two params, varlist), b22params (two params, two sites- only one param at one site) bparamsft (varfrom/varto), bparamse (error),</p>
<p>start simple- grab errors. Should have been doing this all along.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>er1 <span class="ot">&lt;-</span> rbodyb1[<span class="dv">1</span>]</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>ere <span class="ot">&lt;-</span> rbodybe[<span class="dv">1</span>]</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>er1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$error_num
[1] 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>ere</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$error_num
[1] 125</code></pre>
</div>
</div>
<p>Unpack the single. Yeesh</p>
<p>I’m ignoring quality codes for the moment. They’re a definition list, and so maybe should be unpacked separately, matched to varto (I think not varfrom), and then joined? But I want to see how they work with more complex structures first.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(rbodyb1[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> <span class="co"># the [2] drops the error column</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(<span class="at">col =</span> <span class="fu">where</span>(is.list)) <span class="sc">%&gt;%</span> <span class="co"># a `return` list</span></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> <span class="fu">where</span>(is.list)) <span class="sc">%&gt;%</span> <span class="co"># complex set of lists</span></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> site_details) <span class="sc">%&gt;%</span> <span class="co"># columns of info about the site</span></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">site_name =</span> name, <span class="at">site_short_name =</span> short_name) <span class="sc">%&gt;%</span> </span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># there are name conflicts between site and varfrom and varto. Not sure we need both varfrom and varto?</span></span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> varfrom_details) <span class="sc">%&gt;%</span> </span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span>(<span class="fu">paste0</span>(<span class="st">'varfrom_'</span>, .)), </span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>              <span class="fu">c</span>(short_name, precision, subdesc, variable, units, name)) <span class="sc">%&gt;%</span> </span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> varto_details) <span class="sc">%&gt;%</span> </span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span>(<span class="fu">paste0</span>(<span class="st">'varto_'</span>, .)), </span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a>              <span class="fu">c</span>(short_name, precision, subdesc, variable, units, name)) <span class="sc">%&gt;%</span> </span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(<span class="at">col =</span> trace) <span class="sc">%&gt;%</span> </span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> trace)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Try two variables. still works. still not sure why I need both varfrom and varto when they match.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(rbodyb2[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> <span class="co"># the [2] drops the error column</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(<span class="at">col =</span> <span class="fu">where</span>(is.list)) <span class="sc">%&gt;%</span> <span class="co"># a `return` list</span></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> <span class="fu">where</span>(is.list)) <span class="sc">%&gt;%</span> <span class="co"># complex set of lists</span></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> site_details) <span class="sc">%&gt;%</span> <span class="co"># columns of info about the site</span></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">site_name =</span> name, <span class="at">site_short_name =</span> short_name) <span class="sc">%&gt;%</span> </span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># there are name conflicts between site and varfrom and varto. Not sure we need both varfrom and varto?</span></span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> varfrom_details) <span class="sc">%&gt;%</span> </span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span>(<span class="fu">paste0</span>(<span class="st">'varfrom_'</span>, .)), </span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>              <span class="fu">c</span>(short_name, precision, subdesc, variable, units, name)) <span class="sc">%&gt;%</span> </span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> varto_details) <span class="sc">%&gt;%</span> </span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span>(<span class="fu">paste0</span>(<span class="st">'varto_'</span>, .)), </span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a>              <span class="fu">c</span>(short_name, precision, subdesc, variable, units, name)) <span class="sc">%&gt;%</span> </span>
<span id="cb99-13"><a href="#cb99-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(<span class="at">col =</span> trace) <span class="sc">%&gt;%</span> </span>
<span id="cb99-14"><a href="#cb99-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> trace)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Two variables, two sites</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(rbodyb22[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> <span class="co"># the [2] drops the error column</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(<span class="at">col =</span> <span class="fu">where</span>(is.list)) <span class="sc">%&gt;%</span> <span class="co"># a `return` list</span></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> <span class="fu">where</span>(is.list)) <span class="sc">%&gt;%</span> <span class="co"># complex set of lists</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> site_details) <span class="sc">%&gt;%</span> <span class="co"># columns of info about the site</span></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">site_name =</span> name, <span class="at">site_short_name =</span> short_name) <span class="sc">%&gt;%</span> </span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># there are name conflicts between site and varfrom and varto. Not sure we need both varfrom and varto?</span></span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> varfrom_details) <span class="sc">%&gt;%</span> </span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span>(<span class="fu">paste0</span>(<span class="st">'varfrom_'</span>, .)), </span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>              <span class="fu">c</span>(short_name, precision, subdesc, variable, units, name)) <span class="sc">%&gt;%</span> </span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> varto_details) <span class="sc">%&gt;%</span> </span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span>(<span class="fu">paste0</span>(<span class="st">'varto_'</span>, .)), </span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a>              <span class="fu">c</span>(short_name, precision, subdesc, variable, units, name)) <span class="sc">%&gt;%</span> </span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(<span class="at">col =</span> trace) <span class="sc">%&gt;%</span> </span>
<span id="cb100-14"><a href="#cb100-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> trace)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And finally, the one where we do have a varto</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(rbodybft[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> <span class="co"># the [2] drops the error column</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(<span class="at">col =</span> <span class="fu">where</span>(is.list)) <span class="sc">%&gt;%</span> <span class="co"># a `return` list</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> <span class="fu">where</span>(is.list)) <span class="sc">%&gt;%</span> <span class="co"># complex set of lists</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> site_details) <span class="sc">%&gt;%</span> <span class="co"># columns of info about the site</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">site_name =</span> name, <span class="at">site_short_name =</span> short_name) <span class="sc">%&gt;%</span> </span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># there are name conflicts between site and varfrom and varto. Not sure we need both varfrom and varto?</span></span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> varfrom_details) <span class="sc">%&gt;%</span> </span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span>(<span class="fu">paste0</span>(<span class="st">'varfrom_'</span>, .)), </span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>              <span class="fu">c</span>(short_name, precision, subdesc, variable, units, name)) <span class="sc">%&gt;%</span> </span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> varto_details) <span class="sc">%&gt;%</span> </span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span>(<span class="fu">paste0</span>(<span class="st">'varto_'</span>, .)), </span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a>              <span class="fu">c</span>(short_name, precision, subdesc, variable, units, name)) <span class="sc">%&gt;%</span> </span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(<span class="at">col =</span> trace) <span class="sc">%&gt;%</span> </span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> trace)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, some new q values. and pretty clear we don’t need the varfroms.</p>
<p>Need to change the time column to dates</p>
<p>Do we want to split up or return stacked or return wide? Make an option.</p>
<p>Do we want to return NA days as NA or skip them?</p>
</section>
<section id="cleaning-that-up" class="level3">
<h3 class="anchored" data-anchor-id="cleaning-that-up">Cleaning that up</h3>
<p>safest is code x site x varto. though I think don’t need site, we’ll have expanded there by the time we get varto.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(rbodyb22[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> <span class="co"># the [2] drops the error column</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(<span class="at">col =</span> <span class="fu">where</span>(is.list)) <span class="sc">%&gt;%</span> <span class="co"># a `return` list</span></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> <span class="fu">where</span>(is.list)) <span class="sc">%&gt;%</span> <span class="co"># complex set of lists</span></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> site_details) <span class="sc">%&gt;%</span> <span class="co"># columns of info about the site</span></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">site_name =</span> name, <span class="at">site_short_name =</span> short_name) <span class="sc">%&gt;%</span> </span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># there are name conflicts between site and varfrom and varto. </span></span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># and we can drop varfrom</span></span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>varfrom_details) <span class="sc">%&gt;%</span> </span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> varto_details) <span class="sc">%&gt;%</span> </span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span>(<span class="fu">paste0</span>(<span class="st">'variable_'</span>, .)), </span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>              <span class="fu">c</span>(short_name, name)) </span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a><span class="co"># break in here to get the quality codes to match</span></span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a>qc <span class="ot">&lt;-</span> s <span class="sc">%&gt;%</span> </span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(quality_codes, site, variable) <span class="sc">%&gt;%</span> </span>
<span id="cb102-16"><a href="#cb102-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(<span class="at">col =</span> quality_codes) <span class="sc">%&gt;%</span> </span>
<span id="cb102-17"><a href="#cb102-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">quality_codes_id =</span> <span class="fu">as.integer</span>(quality_codes_id))</span>
<span id="cb102-18"><a href="#cb102-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-19"><a href="#cb102-19" aria-hidden="true" tabindex="-1"></a><span class="co"># finish unpacking</span></span>
<span id="cb102-20"><a href="#cb102-20" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> s <span class="sc">%&gt;%</span></span>
<span id="cb102-21"><a href="#cb102-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>quality_codes) <span class="sc">%&gt;%</span> </span>
<span id="cb102-22"><a href="#cb102-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(<span class="at">col =</span> trace) <span class="sc">%&gt;%</span> </span>
<span id="cb102-23"><a href="#cb102-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> trace)</span>
<span id="cb102-24"><a href="#cb102-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-25"><a href="#cb102-25" aria-hidden="true" tabindex="-1"></a><span class="co"># clean up</span></span>
<span id="cb102-26"><a href="#cb102-26" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> s <span class="sc">%&gt;%</span> </span>
<span id="cb102-27"><a href="#cb102-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">value =</span> v, <span class="at">time =</span> t, <span class="at">quality_codes_id =</span> q) <span class="sc">%&gt;%</span> </span>
<span id="cb102-28"><a href="#cb102-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">time =</span> lubridate<span class="sc">::</span><span class="fu">ymd_hms</span>(time)) <span class="sc">%&gt;%</span> </span>
<span id="cb102-29"><a href="#cb102-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(qc, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'quality_codes_id'</span>, <span class="st">'site'</span>, <span class="st">'variable'</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb102-30"><a href="#cb102-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(longitude, latitude, value), as.numeric)) <span class="co"># leaving some others because they either are names (gauges, variable) or display better (precision)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Can I make that wide? Works without using <code>id_cols</code> but messy because too many info cols. Would end up being better to cut and join the info back on. But then I lose the quality codes, because they apply to each variable differently. Just return like this for now with a warning.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>sw <span class="ot">&lt;-</span> s <span class="sc">%&gt;%</span> <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> variable, <span class="at">values_from =</span> value, <span class="at">id_cols =</span> <span class="fu">c</span>(time, site))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>What I could do though is break it up into a list, potentially by sites and/or variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>slist <span class="ot">&lt;-</span> <span class="fu">split</span>(s, s<span class="sc">$</span>site)</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>vlist <span class="ot">&lt;-</span> <span class="fu">split</span>(s, s<span class="sc">$</span>variable)</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>svlist <span class="ot">&lt;-</span> <span class="fu">split</span>(s, <span class="fu">interaction</span>(s<span class="sc">$</span>site, s<span class="sc">$</span>variable))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="test-package-version-2" class="level3">
<h3 class="anchored" data-anchor-id="test-package-version-2">Test package version</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">load_all</span>(<span class="st">'C:/Users/Galen/Documents/code/hydrogauge'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>ℹ Loading hydrogauge</code></pre>
</div>
</div>
<p>One site, one variable</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>bs <span class="ot">&lt;-</span> <span class="fu">get_ts_traces</span>(<span class="at">portal =</span> <span class="st">'vic'</span>, <span class="at">site_list =</span> barwon, <span class="at">datasource =</span> <span class="st">'A'</span>, <span class="at">var_list =</span> <span class="st">'100'</span>, <span class="at">start_time =</span> <span class="st">'20200101'</span>, <span class="at">end_time =</span> <span class="st">'20200105'</span>, <span class="at">interval =</span> <span class="st">'day'</span>, <span class="at">data_type =</span> <span class="st">'mean'</span>, <span class="at">multiplier =</span> <span class="dv">1</span>, <span class="at">returnformat =</span> <span class="st">'df'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Can I pass decimals? it’s how they come out of get_variable_list</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>bsdec <span class="ot">&lt;-</span> <span class="fu">get_ts_traces</span>(<span class="at">portal =</span> <span class="st">'vic'</span>, <span class="at">site_list =</span> barwon, <span class="at">datasource =</span> <span class="st">'A'</span>, <span class="at">var_list =</span> <span class="st">'100.00'</span>, <span class="at">start_time =</span> <span class="st">'20200101'</span>, <span class="at">end_time =</span> <span class="st">'20200105'</span>, <span class="at">interval =</span> <span class="st">'day'</span>, <span class="at">data_type =</span> <span class="st">'mean'</span>, <span class="at">multiplier =</span> <span class="dv">1</span>, <span class="at">returnformat =</span> <span class="st">'df'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>One site, derived variables</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>bsd <span class="ot">&lt;-</span> <span class="fu">get_ts_traces</span>(<span class="at">portal =</span> <span class="st">'vic'</span>, <span class="at">site_list =</span> barwon, <span class="at">datasource =</span> <span class="st">'A'</span>, <span class="at">var_list =</span> <span class="fu">c</span>(<span class="st">'100'</span>, <span class="st">'140'</span>), <span class="at">start_time =</span> <span class="st">'20200101'</span>, <span class="at">end_time =</span> <span class="st">'20200105'</span>, <span class="at">interval =</span> <span class="st">'day'</span>, <span class="at">data_type =</span> <span class="st">'mean'</span>, <span class="at">multiplier =</span> <span class="dv">1</span>, <span class="at">returnformat =</span> <span class="st">'df'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Only derived</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>bsod <span class="ot">&lt;-</span> <span class="fu">get_ts_traces</span>(<span class="at">portal =</span> <span class="st">'vic'</span>, <span class="at">site_list =</span> barwon, <span class="at">datasource =</span> <span class="st">'A'</span>, <span class="at">var_list =</span> <span class="st">'140'</span>, <span class="at">start_time =</span> <span class="st">'20200101'</span>, <span class="at">end_time =</span> <span class="st">'20200105'</span>, <span class="at">interval =</span> <span class="st">'day'</span>, <span class="at">data_type =</span> <span class="st">'mean'</span>, <span class="at">multiplier =</span> <span class="dv">1</span>, <span class="at">returnformat =</span> <span class="st">'df'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Some more variables, derived and not</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>bsdv <span class="ot">&lt;-</span> <span class="fu">get_ts_traces</span>(<span class="at">portal =</span> <span class="st">'vic'</span>, <span class="at">site_list =</span> barwon, <span class="at">datasource =</span> <span class="st">'A'</span>, <span class="at">var_list =</span> <span class="fu">c</span>(<span class="st">'100'</span>, <span class="st">'140'</span>, <span class="st">'210'</span>, <span class="st">'450'</span>), <span class="at">start_time =</span> <span class="st">'20200101'</span>, <span class="at">end_time =</span> <span class="st">'20200105'</span>, <span class="at">interval =</span> <span class="st">'day'</span>, <span class="at">data_type =</span> <span class="st">'mean'</span>, <span class="at">multiplier =</span> <span class="dv">1</span>, <span class="at">returnformat =</span> <span class="st">'df'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And multi-sites too- does it correctly collapse the vector?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>bsdvs <span class="ot">&lt;-</span> <span class="fu">get_ts_traces</span>(<span class="at">portal =</span> <span class="st">'vic'</span>, <span class="at">site_list =</span> <span class="fu">c</span>(barwon, steavenson), </span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">datasource =</span> <span class="st">'A'</span>, </span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">var_list =</span> <span class="fu">c</span>(<span class="st">'100'</span>, <span class="st">'140'</span>, <span class="st">'210'</span>, <span class="st">'450'</span>), </span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">start_time =</span> <span class="st">'20200101'</span>, <span class="at">end_time =</span> <span class="st">'20200105'</span>, </span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">interval =</span> <span class="st">'day'</span>, <span class="at">data_type =</span> <span class="st">'mean'</span>, </span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">multiplier =</span> <span class="dv">1</span>, <span class="at">returnformat =</span> <span class="st">'df'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And finally everything including rain at golf. Careful though- does mean make sense for that? Probably better as a sum? Tried that and threw an error but told me the options:</p>
<p>Mean/Max/Min/Start/End/First/Last/Tot/MaxMin/Point/Cum</p>
<p><strong>Definitely need two calls if need two different values</strong> at least for now- total temp is nonsense.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>bsdvs <span class="ot">&lt;-</span> <span class="fu">get_ts_traces</span>(<span class="at">portal =</span> <span class="st">'vic'</span>, <span class="at">site_list =</span> allsites, </span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">datasource =</span> <span class="st">'A'</span>, </span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">var_list =</span> <span class="fu">c</span>(<span class="st">'10'</span>, <span class="st">'100'</span>, <span class="st">'140'</span>, <span class="st">'210'</span>, <span class="st">'450'</span>), </span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">start_time =</span> <span class="st">'20200101'</span>, <span class="at">end_time =</span> <span class="st">'20200105'</span>, </span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">interval =</span> <span class="st">'day'</span>, <span class="at">data_type =</span> <span class="st">'mean'</span>, </span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">multiplier =</span> <span class="dv">1</span>, <span class="at">returnformat =</span> <span class="st">'df'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and return a list</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>bsdvsl <span class="ot">&lt;-</span> <span class="fu">get_ts_traces</span>(<span class="at">portal =</span> <span class="st">'vic'</span>, <span class="at">site_list =</span> allsites, </span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">datasource =</span> <span class="st">'A'</span>, </span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">var_list =</span> <span class="fu">c</span>(<span class="st">'10'</span>, <span class="st">'100'</span>, <span class="st">'140'</span>, <span class="st">'210'</span>, <span class="st">'450'</span>), </span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">start_time =</span> <span class="st">'20200101'</span>, <span class="at">end_time =</span> <span class="st">'20200105'</span>, </span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">interval =</span> <span class="st">'day'</span>, <span class="at">data_type =</span> <span class="st">'mean'</span>, </span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">multiplier =</span> <span class="dv">1</span>, <span class="at">returnformat =</span> <span class="st">'sxvlist'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="a-variable-and-time-aware-version" class="level2">
<h2 class="anchored" data-anchor-id="a-variable-and-time-aware-version">A variable and time-aware version</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>possibles <span class="ot">&lt;-</span> <span class="fu">get_variable_list</span>(<span class="at">portal =</span> <span class="st">'vic'</span>, <span class="at">site_list =</span> allsites, <span class="at">datasource =</span> <span class="st">'A'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(site, datasource, variable, period_start, period_end)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>poss140 <span class="ot">&lt;-</span> possibles[possibles<span class="sc">$</span>variable <span class="sc">==</span> <span class="st">'100.00'</span>, ] </span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>poss141 <span class="ot">&lt;-</span> poss140</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>poss140<span class="sc">$</span>variable <span class="ot">&lt;-</span> <span class="st">'140.00'</span></span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>poss141<span class="sc">$</span>variable <span class="ot">&lt;-</span> <span class="st">'141.00'</span></span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>possibles <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(possibles, poss140, poss141)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>all the tests above should run</strong></p>
<section id="test-package-version-3" class="level3">
<h3 class="anchored" data-anchor-id="test-package-version-3">Test package version</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">load_all</span>(<span class="st">'C:/Users/Galen/Documents/code/hydrogauge'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>ℹ Loading hydrogauge</code></pre>
</div>
</div>
<p>We no longer support a working version of get_ts_traces2; a general version is in development.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>bs <span class="ot">&lt;-</span> <span class="fu">get_ts_traces2</span>(<span class="at">portal =</span> <span class="st">'vic'</span>, <span class="at">site_list =</span> barwon, <span class="at">datasource =</span> <span class="st">'A'</span>, <span class="at">var_list =</span> <span class="st">'100'</span>, <span class="at">start_time =</span> <span class="st">'20200101'</span>, <span class="at">end_time =</span> <span class="st">'20200105'</span>, <span class="at">interval =</span> <span class="st">'day'</span>, <span class="at">data_type =</span> <span class="st">'mean'</span>, <span class="at">multiplier =</span> <span class="dv">1</span>, <span class="at">returnformat =</span> <span class="st">'df'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Can I pass decimals? it’s how they come out of get_variable_list</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>bsdec <span class="ot">&lt;-</span> <span class="fu">get_ts_traces2</span>(<span class="at">site_list =</span> barwon, <span class="at">datasource =</span> <span class="st">'A'</span>, <span class="at">var_list =</span> <span class="st">'100.00'</span>, <span class="at">start_time =</span> <span class="st">'20200101'</span>, <span class="at">end_time =</span> <span class="st">'20200105'</span>, <span class="at">interval =</span> <span class="st">'day'</span>, <span class="at">data_type =</span> <span class="st">'mean'</span>, <span class="at">multiplier =</span> <span class="dv">1</span>, <span class="at">returnformat =</span> <span class="st">'df'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>One site, derived variables</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>bsd <span class="ot">&lt;-</span> <span class="fu">get_ts_traces2</span>(<span class="at">site_list =</span> barwon, <span class="at">datasource =</span> <span class="st">'A'</span>, <span class="at">var_list =</span> <span class="fu">c</span>(<span class="st">'100'</span>, <span class="st">'140'</span>, <span class="st">'141'</span>), <span class="at">start_time =</span> <span class="st">'20200101'</span>, <span class="at">end_time =</span> <span class="st">'20200105'</span>, <span class="at">interval =</span> <span class="st">'day'</span>, <span class="at">data_type =</span> <span class="st">'mean'</span>, <span class="at">multiplier =</span> <span class="dv">1</span>, <span class="at">returnformat =</span> <span class="st">'df'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Only derived</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>bsod <span class="ot">&lt;-</span> <span class="fu">get_ts_traces2</span>(<span class="at">site_list =</span> barwon, <span class="at">datasource =</span> <span class="st">'A'</span>, <span class="at">var_list =</span> <span class="st">'140'</span>, <span class="at">start_time =</span> <span class="st">'20200101'</span>, <span class="at">end_time =</span> <span class="st">'20200105'</span>, <span class="at">interval =</span> <span class="st">'day'</span>, <span class="at">data_type =</span> <span class="st">'mean'</span>, <span class="at">multiplier =</span> <span class="dv">1</span>, <span class="at">returnformat =</span> <span class="st">'df'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Some more variables, derived and not</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>bsdv <span class="ot">&lt;-</span> <span class="fu">get_ts_traces2</span>(<span class="at">site_list =</span> barwon, <span class="at">datasource =</span> <span class="st">'A'</span>, <span class="at">var_list =</span> <span class="fu">c</span>(<span class="st">'100'</span>, <span class="st">'140'</span>, <span class="st">'210'</span>, <span class="st">'450'</span>), <span class="at">start_time =</span> <span class="st">'20200101'</span>, <span class="at">end_time =</span> <span class="st">'20200105'</span>, <span class="at">interval =</span> <span class="st">'day'</span>, <span class="at">data_type =</span> <span class="st">'mean'</span>, <span class="at">multiplier =</span> <span class="dv">1</span>, <span class="at">returnformat =</span> <span class="st">'df'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And multi-sites too- does it correctly collapse the vector?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>bsdvs <span class="ot">&lt;-</span> <span class="fu">get_ts_traces2</span>(<span class="at">site_list =</span> <span class="fu">c</span>(barwon, steavenson), </span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">datasource =</span> <span class="st">'A'</span>, </span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">var_list =</span> <span class="fu">c</span>(<span class="st">'100'</span>, <span class="st">'140'</span>, <span class="st">'210'</span>, <span class="st">'450'</span>), </span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">start_time =</span> <span class="st">'20200101'</span>, <span class="at">end_time =</span> <span class="st">'20200105'</span>, </span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">interval =</span> <span class="st">'day'</span>, <span class="at">data_type =</span> <span class="st">'mean'</span>, </span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">multiplier =</span> <span class="dv">1</span>, <span class="at">returnformat =</span> <span class="st">'df'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Do the ‘all’ settings work? Let’s bump to year so I don’t have so much data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>bsdvs <span class="ot">&lt;-</span> <span class="fu">get_ts_traces2</span>(<span class="at">site_list =</span> <span class="fu">c</span>(barwon, steavenson), </span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">datasource =</span> <span class="st">'A'</span>, </span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">var_list =</span> <span class="st">"all"</span>, </span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">start_time =</span> <span class="st">"all"</span>, </span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">end_time =</span> <span class="st">"all"</span>, </span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">interval =</span> <span class="st">'year'</span>, <span class="at">data_type =</span> <span class="st">'mean'</span>, </span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">multiplier =</span> <span class="dv">1</span>, <span class="at">returnformat =</span> <span class="st">'df'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Can I throw something wrong to interval to see if it tells me what it can do? Kisters says</p>
<p>year, month, day, hour, minute, second,<br>
period,<br>
default</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>biw <span class="ot">&lt;-</span> <span class="fu">get_ts_traces2</span>(<span class="at">site_list =</span> barwon, </span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">datasource =</span> <span class="st">'A'</span>, </span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">var_list =</span> <span class="st">"100"</span>, </span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">start_time =</span> <span class="st">"20200101"</span>, </span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">end_time =</span> <span class="st">"20211231"</span>, </span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">interval =</span> <span class="st">'eon'</span>, <span class="at">data_type =</span> <span class="st">'mean'</span>, </span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">multiplier =</span> <span class="dv">1</span>, <span class="at">returnformat =</span> <span class="st">'df'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>error is Invalid interval, must be YEAR, MONTH, DAY, HOUR, MINUTE or SECOND</p>
</section>
</section>
<section id="benchmark" class="level2">
<h2 class="anchored" data-anchor-id="benchmark">Benchmark</h2>
<p>This likely varies a lot depending on what I’m asking for. Should be done more systematically, and use microbenchmark.</p>
<p>They should be roughly the same for a single?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(b1 <span class="ot">&lt;-</span> <span class="fu">get_ts_traces</span>(<span class="at">portal =</span> <span class="st">'vic'</span>, <span class="at">site_list =</span> barwon, </span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">datasource =</span> <span class="st">'A'</span>, </span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">var_list =</span> <span class="st">'100'</span>, </span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">start_time =</span> <span class="st">'20200101'</span>, <span class="at">end_time =</span> <span class="st">'20200105'</span>, </span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">interval =</span> <span class="st">'day'</span>, <span class="at">data_type =</span> <span class="st">'mean'</span>, </span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">multiplier =</span> <span class="dv">1</span>, <span class="at">returnformat =</span> <span class="st">'df'</span>))</span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(b2 <span class="ot">&lt;-</span> <span class="fu">get_ts_traces2</span>(<span class="at">site_list =</span> barwon, </span>
<span id="cb127-9"><a href="#cb127-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">datasource =</span> <span class="st">'A'</span>, </span>
<span id="cb127-10"><a href="#cb127-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">var_list =</span> <span class="st">'100'</span>, </span>
<span id="cb127-11"><a href="#cb127-11" aria-hidden="true" tabindex="-1"></a>                       <span class="at">start_time =</span> <span class="st">'20200101'</span>, <span class="at">end_time =</span> <span class="st">'20200105'</span>, </span>
<span id="cb127-12"><a href="#cb127-12" aria-hidden="true" tabindex="-1"></a>                       <span class="at">interval =</span> <span class="st">'day'</span>, <span class="at">data_type =</span> <span class="st">'mean'</span>, </span>
<span id="cb127-13"><a href="#cb127-13" aria-hidden="true" tabindex="-1"></a>                       <span class="at">multiplier =</span> <span class="dv">1</span>, <span class="at">returnformat =</span> <span class="st">'df'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>interesting. so the second is faster locally, but higher network, I think.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(bsdvs1 <span class="ot">&lt;-</span> <span class="fu">get_ts_traces</span>(<span class="at">site_list =</span> <span class="fu">c</span>(barwon, steavenson), </span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">datasource =</span> <span class="st">'A'</span>, </span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">var_list =</span> <span class="fu">c</span>(<span class="st">'100'</span>, <span class="st">'140'</span>, <span class="st">'210'</span>, <span class="st">'450'</span>), </span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">start_time =</span> <span class="st">'20200101'</span>, <span class="at">end_time =</span> <span class="st">'20200105'</span>, </span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">interval =</span> <span class="st">'day'</span>, <span class="at">data_type =</span> <span class="st">'mean'</span>, </span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">multiplier =</span> <span class="dv">1</span>, <span class="at">returnformat =</span> <span class="st">'df'</span>))</span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(bsdvs2 <span class="ot">&lt;-</span> <span class="fu">get_ts_traces2</span>(<span class="at">site_list =</span> <span class="fu">c</span>(barwon, steavenson), </span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">datasource =</span> <span class="st">'A'</span>, </span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">var_list =</span> <span class="fu">c</span>(<span class="st">'100'</span>, <span class="st">'140'</span>, <span class="st">'210'</span>, <span class="st">'450'</span>), </span>
<span id="cb128-11"><a href="#cb128-11" aria-hidden="true" tabindex="-1"></a>                       <span class="at">start_time =</span> <span class="st">'20200101'</span>, <span class="at">end_time =</span> <span class="st">'20200105'</span>, </span>
<span id="cb128-12"><a href="#cb128-12" aria-hidden="true" tabindex="-1"></a>                       <span class="at">interval =</span> <span class="st">'day'</span>, <span class="at">data_type =</span> <span class="st">'mean'</span>, </span>
<span id="cb128-13"><a href="#cb128-13" aria-hidden="true" tabindex="-1"></a>                       <span class="at">multiplier =</span> <span class="dv">1</span>, <span class="at">returnformat =</span> <span class="st">'df'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Oof. That’s pretty bad. Can I speed it up? probably.</p>
<p>How about parallel?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(doFuture)</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a><span class="fu">registerDoFuture</span>()</span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plan</span>(multisession)</span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(bsdvs1p <span class="ot">&lt;-</span> <span class="fu">get_ts_traces</span>(<span class="at">site_list =</span> <span class="fu">c</span>(barwon, steavenson), </span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">datasource =</span> <span class="st">'A'</span>, </span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">var_list =</span> <span class="fu">c</span>(<span class="st">'100'</span>, <span class="st">'140'</span>, <span class="st">'210'</span>, <span class="st">'450'</span>), </span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">start_time =</span> <span class="st">'20200101'</span>, <span class="at">end_time =</span> <span class="st">'20200105'</span>, </span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">interval =</span> <span class="st">'day'</span>, <span class="at">data_type =</span> <span class="st">'mean'</span>, </span>
<span id="cb129-10"><a href="#cb129-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">multiplier =</span> <span class="dv">1</span>, <span class="at">returnformat =</span> <span class="st">'df'</span>))</span>
<span id="cb129-11"><a href="#cb129-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-12"><a href="#cb129-12" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(bsdvs2p <span class="ot">&lt;-</span> <span class="fu">get_ts_traces2</span>(<span class="at">site_list =</span> <span class="fu">c</span>(barwon, steavenson), </span>
<span id="cb129-13"><a href="#cb129-13" aria-hidden="true" tabindex="-1"></a>                       <span class="at">datasource =</span> <span class="st">'A'</span>, </span>
<span id="cb129-14"><a href="#cb129-14" aria-hidden="true" tabindex="-1"></a>                       <span class="at">var_list =</span> <span class="fu">c</span>(<span class="st">'100'</span>, <span class="st">'140'</span>, <span class="st">'210'</span>, <span class="st">'450'</span>), </span>
<span id="cb129-15"><a href="#cb129-15" aria-hidden="true" tabindex="-1"></a>                       <span class="at">start_time =</span> <span class="st">'20200101'</span>, <span class="at">end_time =</span> <span class="st">'20200105'</span>, </span>
<span id="cb129-16"><a href="#cb129-16" aria-hidden="true" tabindex="-1"></a>                       <span class="at">interval =</span> <span class="st">'day'</span>, <span class="at">data_type =</span> <span class="st">'mean'</span>, </span>
<span id="cb129-17"><a href="#cb129-17" aria-hidden="true" tabindex="-1"></a>                       <span class="at">multiplier =</span> <span class="dv">1</span>, <span class="at">returnformat =</span> <span class="st">'df'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="get-db-info" class="level2">
<h2 class="anchored" data-anchor-id="get-db-info">Get db info</h2>
<section id="geofiltering" class="level3">
<h3 class="anchored" data-anchor-id="geofiltering">Geofiltering</h3>
<p>The <code>get_db_info</code> API function can do a LOT. I’m primarily looking for using it for geofiltering, but it may turn out that that’s better done in other ways anyway. The <code>filter_values</code> <code>sitelist_filter</code>, etc are likely also useful, and will be worth adding as we go.</p>
<p>The area from Teesdale (-38, 144 at top left to Leopold (-38.2, 144.5) should contain 5 sites.</p>
<p>Oh no it doesn’t. It actually contains a bazillion, because there’s a bunch of <code>stntype: "GW"</code>. Turning <code>eval: false</code> to we don’t do that again.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="co"># need a matrix to get the double brackets.</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>topleft <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'-38'</span>, <span class="st">'144'</span>)</span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>bottomright <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'-38.2'</span>, <span class="st">'144.5'</span>)</span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a>rectbox <span class="ot">&lt;-</span> <span class="fu">rbind</span>(topleft, bottomright)</span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a>geo_params <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"function"</span> <span class="ot">=</span> <span class="st">'get_db_info'</span>,</span>
<span id="cb130-7"><a href="#cb130-7" aria-hidden="true" tabindex="-1"></a>               <span class="st">"version"</span> <span class="ot">=</span> <span class="st">"3"</span>,</span>
<span id="cb130-8"><a href="#cb130-8" aria-hidden="true" tabindex="-1"></a>               <span class="st">"params"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"table_name"</span> <span class="ot">=</span> <span class="st">"site"</span>,</span>
<span id="cb130-9"><a href="#cb130-9" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"return_type"</span> <span class="ot">=</span> <span class="st">"array"</span>,</span>
<span id="cb130-10"><a href="#cb130-10" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"geo_filter"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">'rectangle'</span> <span class="ot">=</span> rectbox)))</span>
<span id="cb130-11"><a href="#cb130-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-12"><a href="#cb130-12" aria-hidden="true" tabindex="-1"></a>reqvic <span class="sc">%&gt;%</span> </span>
<span id="cb130-13"><a href="#cb130-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(geo_params) <span class="sc">%&gt;%</span> </span>
<span id="cb130-14"><a href="#cb130-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_dry_run</span>()</span>
<span id="cb130-15"><a href="#cb130-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-16"><a href="#cb130-16" aria-hidden="true" tabindex="-1"></a>resp_geo <span class="ot">&lt;-</span> reqvic <span class="sc">%&gt;%</span> </span>
<span id="cb130-17"><a href="#cb130-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(geo_params) <span class="sc">%&gt;%</span> </span>
<span id="cb130-18"><a href="#cb130-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb130-19"><a href="#cb130-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-20"><a href="#cb130-20" aria-hidden="true" tabindex="-1"></a>rbody_geo <span class="ot">&lt;-</span> resp_geo <span class="sc">%&gt;%</span> <span class="fu">resp_body_json</span>(<span class="at">check_type =</span> <span class="cn">FALSE</span>)</span>
<span id="cb130-21"><a href="#cb130-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-22"><a href="#cb130-22" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(rbody_geo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>So, that is WAAY too much, so we need to filter by surface water station types. Assuming the structure is the same, let’s figure out how to parse that into a table, and then get the stntype that matches surface and develop that capacity. And document how to choose which.</p>
<p>And use the <code>field_list</code> to not return all the ‘category’ nonsense.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>db <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(rbody_geo[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> <span class="co"># the [2] drops the error column</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(<span class="at">col =</span> <span class="fu">where</span>(is.list)) <span class="sc">%&gt;%</span> <span class="co"># a `return` list</span></span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> <span class="fu">where</span>(is.list)) <span class="sc">%&gt;%</span> </span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(station, stntype, stname, <span class="fu">everything</span>(), <span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">'category'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>So, what are the possible stntypes?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(db<span class="sc">$</span>stntype)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>What are those? GW has got to be groundwater. HYD is Hydrology, presumably??? SOB I think is the State Observation Bore Network. VIR???.</p>
<p>Let’s knock off the GW and see if we can figure the others out.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="do">##| rows.print: 30</span></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>dbNoGW <span class="ot">&lt;-</span> db <span class="sc">%&gt;%</span> </span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(stntype <span class="sc">!=</span> <span class="st">'GW'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(station, stntype, stname, shortname, parent, commence, cease, <span class="fu">everything</span>())</span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a>dbNoGW</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>So, the SOB don’t have any info, the HYD seem to be A and B versions of the VIR. Do they have different data??? If we get traces for 233217A and B, do they differ from 233217?</p>
<p>Let’s clean that up a bit first before figuring that out.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="do">##| rows.print = 30</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>dbNoGW <span class="ot">&lt;-</span> dbNoGW <span class="sc">%&gt;%</span> </span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(stntype <span class="sc">!=</span> <span class="st">'SOB'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(station)</span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>dbNoGW</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Interesting.</p>
<p>So, some things to do</p>
<p><strong>TODO</strong>-</p>
<ul>
<li><p>sort out the filters (<code>filter_values</code> I think?) to only get HYD and VIR (or whatever the user wants)</p>
<ul>
<li>and tell the user what the options are- apparently, ‘GW’, ‘SOB’, ‘HYD’, and ‘VIR’</li>
</ul></li>
<li><p>sort out <code>field_list</code> to only get a subset of useful fields</p>
<ul>
<li>And alert the user about what fields are being dropped</li>
</ul></li>
<li><p>figure out whether the data differs between HYD and VIR (should be able to just pass the A,B, numbers to the get_ts_traces)?</p></li>
<li><p>Other geo filters</p></li>
</ul>
</section>
<section id="other-filtering" class="level3">
<h3 class="anchored" data-anchor-id="other-filtering">Other filtering</h3>
<p>Try <code>filter_values</code> and <code>field_list</code>. <code>"filter_values" = list("stntype" = 'HYD, VIR')</code> <em>does not work</em>- figure out why.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>topleft <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'-38'</span>, <span class="st">'144'</span>)</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>bottomright <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'-38.2'</span>, <span class="st">'144.5'</span>)</span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>rectbox <span class="ot">&lt;-</span> <span class="fu">rbind</span>(topleft, bottomright)</span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a>geo_params <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"function"</span> <span class="ot">=</span> <span class="st">'get_db_info'</span>,</span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a>               <span class="st">"version"</span> <span class="ot">=</span> <span class="st">"3"</span>,</span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a>               <span class="st">"params"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"table_name"</span> <span class="ot">=</span> <span class="st">"site"</span>,</span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"return_type"</span> <span class="ot">=</span> <span class="st">"array"</span>,</span>
<span id="cb135-9"><a href="#cb135-9" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"filter_values"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"stntype"</span> <span class="ot">=</span> <span class="st">'VIR'</span>),</span>
<span id="cb135-10"><a href="#cb135-10" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"field_list"</span> <span class="ot">=</span> <span class="st">"station, stntype, stname, shortname, commence, cease, active, northing, easting, longitude, latitude, lldatum"</span>,</span>
<span id="cb135-11"><a href="#cb135-11" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"geo_filter"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">'rectangle'</span> <span class="ot">=</span> rectbox)))</span>
<span id="cb135-12"><a href="#cb135-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-13"><a href="#cb135-13" aria-hidden="true" tabindex="-1"></a>reqvic <span class="sc">%&gt;%</span> </span>
<span id="cb135-14"><a href="#cb135-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(geo_params) <span class="sc">%&gt;%</span> </span>
<span id="cb135-15"><a href="#cb135-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_dry_run</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>POST /WMIS/cgi/webservice.exe? HTTP/1.1
Host: data.water.vic.gov.au
User-Agent: httr2/1.0.3 r-curl/5.2.2 libcurl/8.3.0
Accept: */*
Accept-Encoding: deflate, gzip
Content-Type: application/json
Content-Length: 313

{"function":"get_db_info","version":"3","params":{"table_name":"site","return_type":"array","filter_values":{"stntype":"VIR"},"field_list":"station, stntype, stname, shortname, commence, cease, active, northing, easting, longitude, latitude, lldatum","geo_filter":{"rectangle":[["-38","144"],["-38.2","144.5"]]}}}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>resp_geo <span class="ot">&lt;-</span> reqvic <span class="sc">%&gt;%</span> </span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(geo_params) <span class="sc">%&gt;%</span> </span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a>rbody_geo <span class="ot">&lt;-</span> resp_geo <span class="sc">%&gt;%</span> <span class="fu">resp_body_json</span>(<span class="at">check_type =</span> <span class="cn">FALSE</span>)</span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-7"><a href="#cb137-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(rbody_geo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ error_num: int 0
 $ return   :List of 1
  ..$ rows:List of 6
  .. ..$ :List of 62
  .. .. ..$ category20: chr ""
  .. .. ..$ category19: chr ""
  .. .. ..$ category18: chr ""
  .. .. ..$ category17: chr ""
  .. .. ..$ category16: chr ""
  .. .. ..$ category15: chr ""
  .. .. ..$ category14: chr ""
  .. .. ..$ category13: chr ""
  .. .. ..$ category12: chr ""
  .. .. ..$ category11: chr ""
  .. .. ..$ category10: chr "THIESS"
  .. .. ..$ active    : logi TRUE
  .. .. ..$ northing  : chr "5780764.372"
  .. .. ..$ timezone  : chr "10.0"
  .. .. ..$ shortname : chr "MOORABOOL @ BATESFOR"
  .. .. ..$ datecreate: int 18991230
  .. .. ..$ elevdatum : chr ""
  .. .. ..$ stname    : chr "MOORABOOL RIVER @ BATESFORD"
  .. .. ..$ category9 : chr "YES"
  .. .. ..$ category8 : chr "G"
  .. .. ..$ category7 : chr "G"
  .. .. ..$ category6 : chr "2WD"
  .. .. ..$ category5 : chr "0"
  .. .. ..$ category4 : chr "50"
  .. .. ..$ category3 : chr "S/U"
  .. .. ..$ category2 : chr "V_93F3"
  .. .. ..$ category1 : chr "0"
  .. .. ..$ elevacc   : chr "DEM10"
  .. .. ..$ dbver47   : logi FALSE
  .. .. ..$ quarter   : chr "Y"
  .. .. ..$ section   : int 0
  .. .. ..$ commence  : int 19080101
  .. .. ..$ parent    : chr ""
  .. .. ..$ mapname   : chr "GEE/SW"
  .. .. ..$ meridian  : chr ""
  .. .. ..$ spare5    : chr ""
  .. .. ..$ spare4    : chr ""
  .. .. ..$ spare3    : chr ""
  .. .. ..$ spare2    : chr "03 5276 1201"
  .. .. ..$ spare1    : chr "Derwent Hotel"
  .. .. ..$ posacc    : chr "9"
  .. .. ..$ timemod   : int 1442
  .. .. ..$ region    : chr "232"
  .. .. ..$ grdatum   : chr "UTM"
  .. .. ..$ township  : chr ""
  .. .. ..$ longitude : chr "144.278650000"
  .. .. ..$ comment   : chr "\r\n\r\n\r\nDerwent Hotel BatesfordFrom Geelong West, head west along Ballarat Highway to Batesford. Just befor"| __truncated__
  .. .. ..$ lldatum   : chr "WGS84"
  .. .. ..$ station   : chr "232202"
  .. .. ..$ datemod   : int 20240131
  .. .. ..$ timecreate: int 0
  .. .. ..$ orgcode   : chr "DSE"
  .. .. ..$ barcode   : chr "Batesford"
  .. .. ..$ zone      : int 55
  .. .. ..$ elev      : chr "23.325"
  .. .. ..$ cease     : int 18991230
  .. .. ..$ local_map : chr "232202A"
  .. .. ..$ latitude  : chr "-38.089300000"
  .. .. ..$ range     : chr ""
  .. .. ..$ qquarter  : chr "Y"
  .. .. ..$ easting   : chr "261340.248"
  .. .. ..$ stntype   : chr "VIR"
  .. ..$ :List of 62
  .. .. ..$ category20: chr ""
  .. .. ..$ category19: chr ""
  .. .. ..$ category18: chr ""
  .. .. ..$ category17: chr ""
  .. .. ..$ category16: chr ""
  .. .. ..$ category15: chr ""
  .. .. ..$ category14: chr ""
  .. .. ..$ category13: chr ""
  .. .. ..$ category12: chr ""
  .. .. ..$ category11: chr ""
  .. .. ..$ category10: chr ""
  .. .. ..$ active    : logi FALSE
  .. .. ..$ northing  : chr "5779117.670"
  .. .. ..$ timezone  : chr "10.0"
  .. .. ..$ shortname : chr "WASTEWATER DR @ FORD"
  .. .. ..$ datecreate: int 18991230
  .. .. ..$ elevdatum : chr ""
  .. .. ..$ stname    : chr "WASTEWATER O/F DRAIN @ FORD FACTORY GEELONG"
  .. .. ..$ category9 : chr ""
  .. .. ..$ category8 : chr ""
  .. .. ..$ category7 : chr ""
  .. .. ..$ category6 : chr ""
  .. .. ..$ category5 : chr ""
  .. .. ..$ category4 : chr ""
  .. .. ..$ category3 : chr ""
  .. .. ..$ category2 : chr ""
  .. .. ..$ category1 : chr ""
  .. .. ..$ elevacc   : chr "DEM10"
  .. .. ..$ dbver47   : logi FALSE
  .. .. ..$ quarter   : chr "N"
  .. .. ..$ section   : int 0
  .. .. ..$ commence  : int 20060630
  .. .. ..$ parent    : chr ""
  .. .. ..$ mapname   : chr "GEELONG"
  .. .. ..$ meridian  : chr ""
  .. .. ..$ spare5    : chr ""
  .. .. ..$ spare4    : chr ""
  .. .. ..$ spare3    : chr ""
  .. .. ..$ spare2    : chr ""
  .. .. ..$ spare1    : chr ""
  .. .. ..$ posacc    : chr "1"
  .. .. ..$ timemod   : int 1442
  .. .. ..$ region    : chr "232"
  .. .. ..$ grdatum   : chr "ANG"
  .. .. ..$ township  : chr ""
  .. .. ..$ longitude : chr "144.355800000"
  .. .. ..$ comment   : chr "\r\nStation operated for Ford Aus. Project No 1563532011/07/17 Virtual site entry generated by DSEVIRTUALSITE.H"| __truncated__
  .. .. ..$ lldatum   : chr "AGD66"
  .. .. ..$ station   : chr "232711"
  .. .. ..$ datemod   : int 20240131
  .. .. ..$ timecreate: int 0
  .. .. ..$ orgcode   : chr "VRW"
  .. .. ..$ barcode   : chr ""
  .. .. ..$ zone      : int 55
  .. .. ..$ elev      : chr "4.455"
  .. .. ..$ cease     : int 20071029
  .. .. ..$ local_map : chr "232711A"
  .. .. ..$ latitude  : chr "-38.105900000"
  .. .. ..$ range     : chr ""
  .. .. ..$ qquarter  : chr "N"
  .. .. ..$ easting   : chr "268159.899"
  .. .. ..$ stntype   : chr "VIR"
  .. ..$ :List of 62
  .. .. ..$ category20: chr ""
  .. .. ..$ category19: chr ""
  .. .. ..$ category18: chr ""
  .. .. ..$ category17: chr ""
  .. .. ..$ category16: chr ""
  .. .. ..$ category15: chr ""
  .. .. ..$ category14: chr ""
  .. .. ..$ category13: chr ""
  .. .. ..$ category12: chr ""
  .. .. ..$ category11: chr ""
  .. .. ..$ category10: chr "THIESS"
  .. .. ..$ active    : logi TRUE
  .. .. ..$ northing  : chr "5774520.999"
  .. .. ..$ timezone  : chr "10.0"
  .. .. ..$ shortname : chr "BARWON POLLOCKSFORD"
  .. .. ..$ datecreate: int 18991230
  .. .. ..$ elevdatum : chr ""
  .. .. ..$ stname    : chr "BARWON RIVER @ POLLOCKSFORD"
  .. .. ..$ category9 : chr "N/A"
  .. .. ..$ category8 : chr "B"
  .. .. ..$ category7 : chr "G"
  .. .. ..$ category6 : chr "4WD"
  .. .. ..$ category5 : chr "50"
  .. .. ..$ category4 : chr "150"
  .. .. ..$ category3 : chr "GRAVEL"
  .. .. ..$ category2 : chr "V_93D4"
  .. .. ..$ category1 : chr "18"
  .. .. ..$ elevacc   : chr "DEM10"
  .. .. ..$ dbver47   : logi FALSE
  .. .. ..$ quarter   : chr "Y"
  .. .. ..$ section   : int 0
  .. .. ..$ commence  : int 19060701
  .. .. ..$ parent    : chr ""
  .. .. ..$ mapname   : chr "GEE/SW"
  .. .. ..$ meridian  : chr ""
  .. .. ..$ spare5    : chr ""
  .. .. ..$ spare4    : chr ""
  .. .. ..$ spare3    : chr ""
  .. .. ..$ spare2    : chr "N/A"
  .. .. ..$ spare1    : chr "N/A"
  .. .. ..$ posacc    : chr "9"
  .. .. ..$ timemod   : int 1442
  .. .. ..$ region    : chr "233"
  .. .. ..$ grdatum   : chr "UTM"
  .. .. ..$ township  : chr ""
  .. .. ..$ longitude : chr "144.187100400"
  .. .. ..$ comment   : chr "\r\nFrom Inverliegh, travel east along Hamilton Highway. Turn south down Pollocksford Road and travel 3.1 km to"| __truncated__
  .. .. ..$ lldatum   : chr "WGS84"
  .. .. ..$ station   : chr "233200"
  .. .. ..$ datemod   : int 20240131
  .. .. ..$ timecreate: int 0
  .. .. ..$ orgcode   : chr "DSE"
  .. .. ..$ barcode   : chr "Moriac"
  .. .. ..$ zone      : int 55
  .. .. ..$ elev      : chr "28.681"
  .. .. ..$ cease     : int 18991230
  .. .. ..$ local_map : chr "233200B"
  .. .. ..$ latitude  : chr "-38.143395970"
  .. .. ..$ range     : chr ""
  .. .. ..$ qquarter  : chr "Y"
  .. .. ..$ easting   : chr "253491.999"
  .. .. ..$ stntype   : chr "VIR"
  .. ..$ :List of 62
  .. .. ..$ category20: chr ""
  .. .. ..$ category19: chr ""
  .. .. ..$ category18: chr ""
  .. .. ..$ category17: chr ""
  .. .. ..$ category16: chr ""
  .. .. ..$ category15: chr ""
  .. .. ..$ category14: chr ""
  .. .. ..$ category13: chr ""
  .. .. ..$ category12: chr ""
  .. .. ..$ category11: chr ""
  .. .. ..$ category10: chr "THIESS"
  .. .. ..$ active    : logi TRUE
  .. .. ..$ northing  : chr "5779017.000"
  .. .. ..$ timezone  : chr "10.0"
  .. .. ..$ shortname : chr "LEIGH @ INVERLEIGH"
  .. .. ..$ datecreate: int 18991230
  .. .. ..$ elevdatum : chr ""
  .. .. ..$ stname    : chr "LEIGH RIVER @ INVERLEIGH"
  .. .. ..$ category9 : chr "N/A"
  .. .. ..$ category8 : chr "G"
  .. .. ..$ category7 : chr "G"
  .. .. ..$ category6 : chr "2WD"
  .. .. ..$ category5 : chr "20"
  .. .. ..$ category4 : chr "100"
  .. .. ..$ category3 : chr "SEALED"
  .. .. ..$ category2 : chr "V_93B3"
  .. .. ..$ category1 : chr "1"
  .. .. ..$ elevacc   : chr "DEM10"
  .. .. ..$ dbver47   : logi FALSE
  .. .. ..$ quarter   : chr "N"
  .. .. ..$ section   : int 0
  .. .. ..$ commence  : int 19460315
  .. .. ..$ parent    : chr ""
  .. .. ..$ mapname   : chr "GEE/SW"
  .. .. ..$ meridian  : chr ""
  .. .. ..$ spare5    : chr ""
  .. .. ..$ spare4    : chr ""
  .. .. ..$ spare3    : chr ""
  .. .. ..$ spare2    : chr "N/A"
  .. .. ..$ spare1    : chr "N/A"
  .. .. ..$ posacc    : chr "9"
  .. .. ..$ timemod   : int 1442
  .. .. ..$ region    : chr "233"
  .. .. ..$ grdatum   : chr "UTM"
  .. .. ..$ township  : chr ""
  .. .. ..$ longitude : chr "144.062212200"
  .. .. ..$ comment   : chr "\r\nIt is underneath the Hamilton Highway Bridge that passes over the Leigh River.2011/07/17 Virtual site entry"| __truncated__
  .. .. ..$ lldatum   : chr "WGS84"
  .. .. ..$ station   : chr "233209"
  .. .. ..$ datemod   : int 20240131
  .. .. ..$ timecreate: int 0
  .. .. ..$ orgcode   : chr "DSE"
  .. .. ..$ barcode   : chr "Inverleigh"
  .. .. ..$ zone      : int 55
  .. .. ..$ elev      : chr "55.983"
  .. .. ..$ cease     : int 18991230
  .. .. ..$ local_map : chr "233209A"
  .. .. ..$ latitude  : chr "-38.099828090"
  .. .. ..$ range     : chr ""
  .. .. ..$ qquarter  : chr "n"
  .. .. ..$ easting   : chr "242392.001"
  .. .. ..$ stntype   : chr "VIR"
  .. ..$ :List of 62
  .. .. ..$ category20: chr ""
  .. .. ..$ category19: chr ""
  .. .. ..$ category18: chr ""
  .. .. ..$ category17: chr ""
  .. .. ..$ category16: chr ""
  .. .. ..$ category15: chr ""
  .. .. ..$ category14: chr ""
  .. .. ..$ category13: chr ""
  .. .. ..$ category12: chr ""
  .. .. ..$ category11: chr ""
  .. .. ..$ category10: chr "THIESS"
  .. .. ..$ active    : logi TRUE
  .. .. ..$ northing  : chr "5772691.000"
  .. .. ..$ timezone  : chr "10.0"
  .. .. ..$ shortname : chr "BARWON @ GEELONG"
  .. .. ..$ datecreate: int 18991230
  .. .. ..$ elevdatum : chr ""
  .. .. ..$ stname    : chr "BARWON RIVER @ GEELONG"
  .. .. ..$ category9 : chr "N/A"
  .. .. ..$ category8 : chr "G"
  .. .. ..$ category7 : chr "G"
  .. .. ..$ category6 : chr "2WD"
  .. .. ..$ category5 : chr "0"
  .. .. ..$ category4 : chr "150"
  .. .. ..$ category3 : chr "SEALED"
  .. .. ..$ category2 : chr "V_93G4"
  .. .. ..$ category1 : chr "0"
  .. .. ..$ elevacc   : chr "DEM10"
  .. .. ..$ dbver47   : logi FALSE
  .. .. ..$ quarter   : chr "Y"
  .. .. ..$ section   : int 0
  .. .. ..$ commence  : int 19601118
  .. .. ..$ parent    : chr ""
  .. .. ..$ mapname   : chr "GEE/SW"
  .. .. ..$ meridian  : chr ""
  .. .. ..$ spare5    : chr ""
  .. .. ..$ spare4    : chr ""
  .. .. ..$ spare3    : chr ""
  .. .. ..$ spare2    : chr ""
  .. .. ..$ spare1    : chr "BW"
  .. .. ..$ posacc    : chr "9"
  .. .. ..$ timemod   : int 1442
  .. .. ..$ region    : chr "233"
  .. .. ..$ grdatum   : chr "UTM"
  .. .. ..$ township  : chr ""
  .. .. ..$ longitude : chr "144.346892200"
  .. .. ..$ comment   : chr "\r\n\r\n\r\nBarwon Water flood monitoring stationFrom the intersection of the Fyans St and La Trobe Terrace, he"| __truncated__
  .. .. ..$ lldatum   : chr "WGS84"
  .. .. ..$ station   : chr "233217"
  .. .. ..$ datemod   : int 20240131
  .. .. ..$ timecreate: int 0
  .. .. ..$ orgcode   : chr "DSE"
  .. .. ..$ barcode   : chr "Geelong"
  .. .. ..$ zone      : int 55
  .. .. ..$ elev      : chr "1.992"
  .. .. ..$ cease     : int 18991230
  .. .. ..$ local_map : chr "233217D"
  .. .. ..$ latitude  : chr "-38.163605590"
  .. .. ..$ range     : chr ""
  .. .. ..$ qquarter  : chr "Y"
  .. .. ..$ easting   : chr "267562.001"
  .. .. ..$ stntype   : chr "VIR"
  .. ..$ :List of 62
  .. .. ..$ category20: chr ""
  .. .. ..$ category19: chr ""
  .. .. ..$ category18: chr ""
  .. .. ..$ category17: chr ""
  .. .. ..$ category16: chr ""
  .. .. ..$ category15: chr ""
  .. .. ..$ category14: chr ""
  .. .. ..$ category13: chr ""
  .. .. ..$ category12: chr ""
  .. .. ..$ category11: chr ""
  .. .. ..$ category10: chr ""
  .. .. ..$ active    : logi FALSE
  .. .. ..$ northing  : chr "5777388.289"
  .. .. ..$ timezone  : chr "10.0"
  .. .. ..$ shortname : chr "BARWON RIVER"
  .. .. ..$ datecreate: int 18991230
  .. .. ..$ elevdatum : chr ""
  .. .. ..$ stname    : chr "BARWON RIVER @ MURGHEBOLUC"
  .. .. ..$ category9 : chr ""
  .. .. ..$ category8 : chr ""
  .. .. ..$ category7 : chr ""
  .. .. ..$ category6 : chr ""
  .. .. ..$ category5 : chr ""
  .. .. ..$ category4 : chr ""
  .. .. ..$ category3 : chr ""
  .. .. ..$ category2 : chr ""
  .. .. ..$ category1 : chr ""
  .. .. ..$ elevacc   : chr "DEM10"
  .. .. ..$ dbver47   : logi FALSE
  .. .. ..$ quarter   : chr "N"
  .. .. ..$ section   : int 0
  .. .. ..$ commence  : int 19680208
  .. .. ..$ parent    : chr ""
  .. .. ..$ mapname   : chr "GEELONG"
  .. .. ..$ meridian  : chr ""
  .. .. ..$ spare5    : chr ""
  .. .. ..$ spare4    : chr ""
  .. .. ..$ spare3    : chr ""
  .. .. ..$ spare2    : chr ""
  .. .. ..$ spare1    : chr ""
  .. .. ..$ posacc    : chr "1"
  .. .. ..$ timemod   : int 1442
  .. .. ..$ region    : chr "233"
  .. .. ..$ grdatum   : chr ""
  .. .. ..$ township  : chr ""
  .. .. ..$ longitude : chr "144.150000000"
  .. .. ..$ comment   : chr "2011/07/17 Virtual site entry generated by DSEVIRTUALSITE.HSC from details in 233219A\r\n"
  .. .. ..$ lldatum   : chr ""
  .. .. ..$ station   : chr "233219"
  .. .. ..$ datemod   : int 20240131
  .. .. ..$ timecreate: int 0
  .. .. ..$ orgcode   : chr "VRW"
  .. .. ..$ barcode   : chr ""
  .. .. ..$ zone      : int 55
  .. .. ..$ elev      : chr "36.129"
  .. .. ..$ cease     : int 19690911
  .. .. ..$ local_map : chr "233219A"
  .. .. ..$ latitude  : chr "-38.116666670"
  .. .. ..$ range     : chr ""
  .. .. ..$ qquarter  : chr "N"
  .. .. ..$ easting   : chr "250148.885"
  .. .. ..$ stntype   : chr "VIR"</code></pre>
</div>
</div>
<p>cleanup</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>db <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(rbody_geo[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> <span class="co"># the [2] drops the error column</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(<span class="at">col =</span> <span class="fu">where</span>(is.list)) <span class="sc">%&gt;%</span> <span class="co"># a `return` list</span></span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> <span class="fu">where</span>(is.list)) <span class="sc">%&gt;%</span> </span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(station, stntype, stname, <span class="fu">everything</span>(), <span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">'category'</span>))</span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a>db</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 42
  station stntype stname active northing timezone shortname datecreate elevdatum
  &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  &lt;lgl&gt;  &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;          &lt;int&gt; &lt;chr&gt;    
1 232202  VIR     MOORA… TRUE   5780764… 10.0     MOORABOO…   18991230 ""       
2 232711  VIR     WASTE… FALSE  5779117… 10.0     WASTEWAT…   18991230 ""       
3 233200  VIR     BARWO… TRUE   5774520… 10.0     BARWON P…   18991230 ""       
4 233209  VIR     LEIGH… TRUE   5779017… 10.0     LEIGH @ …   18991230 ""       
5 233217  VIR     BARWO… TRUE   5772691… 10.0     BARWON @…   18991230 ""       
6 233219  VIR     BARWO… FALSE  5777388… 10.0     BARWON R…   18991230 ""       
# ℹ 33 more variables: elevacc &lt;chr&gt;, dbver47 &lt;lgl&gt;, quarter &lt;chr&gt;,
#   section &lt;int&gt;, commence &lt;int&gt;, parent &lt;chr&gt;, mapname &lt;chr&gt;, meridian &lt;chr&gt;,
#   spare5 &lt;chr&gt;, spare4 &lt;chr&gt;, spare3 &lt;chr&gt;, spare2 &lt;chr&gt;, spare1 &lt;chr&gt;,
#   posacc &lt;chr&gt;, timemod &lt;int&gt;, region &lt;chr&gt;, grdatum &lt;chr&gt;, township &lt;chr&gt;,
#   longitude &lt;chr&gt;, comment &lt;chr&gt;, lldatum &lt;chr&gt;, datemod &lt;int&gt;,
#   timecreate &lt;int&gt;, orgcode &lt;chr&gt;, barcode &lt;chr&gt;, zone &lt;int&gt;, elev &lt;chr&gt;,
#   cease &lt;int&gt;, local_map &lt;chr&gt;, latitude &lt;chr&gt;, range &lt;chr&gt;, …</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(db)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "station"    "stntype"    "stname"     "active"     "northing"  
 [6] "timezone"   "shortname"  "datecreate" "elevdatum"  "elevacc"   
[11] "dbver47"    "quarter"    "section"    "commence"   "parent"    
[16] "mapname"    "meridian"   "spare5"     "spare4"     "spare3"    
[21] "spare2"     "spare1"     "posacc"     "timemod"    "region"    
[26] "grdatum"    "township"   "longitude"  "comment"    "lldatum"   
[31] "datemod"    "timecreate" "orgcode"    "barcode"    "zone"      
[36] "elev"       "cease"      "local_map"  "latitude"   "range"     
[41] "qquarter"   "easting"   </code></pre>
</div>
</div>
<p>That seems to have worked for filter vaues but not field list. and it doesn’t work for filtering to multiple values. Figure both those things out.</p>
<p>How about c() on both. Shorten the field list for the moment. Runs but no data.</p>
<p><code>c()</code> on the field list works for a single stntype. Now to figure out the stntypes</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>topleft <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'-38'</span>, <span class="st">'144'</span>)</span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>bottomright <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'-38.2'</span>, <span class="st">'144.5'</span>)</span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a>rectbox <span class="ot">&lt;-</span> <span class="fu">rbind</span>(topleft, bottomright)</span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a>geo_params <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"function"</span> <span class="ot">=</span> <span class="st">'get_db_info'</span>,</span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a>               <span class="st">"version"</span> <span class="ot">=</span> <span class="st">"3"</span>,</span>
<span id="cb143-7"><a href="#cb143-7" aria-hidden="true" tabindex="-1"></a>               <span class="st">"params"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"table_name"</span> <span class="ot">=</span> <span class="st">"site"</span>,</span>
<span id="cb143-8"><a href="#cb143-8" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"return_type"</span> <span class="ot">=</span> <span class="st">"array"</span>,</span>
<span id="cb143-9"><a href="#cb143-9" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"filter_values"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"stntype"</span> <span class="ot">=</span> <span class="st">'HYD'</span>),</span>
<span id="cb143-10"><a href="#cb143-10" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"field_list"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"station"</span>, <span class="st">"stntype"</span>, <span class="st">"stname"</span>),</span>
<span id="cb143-11"><a href="#cb143-11" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"geo_filter"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">'rectangle'</span> <span class="ot">=</span> rectbox)))</span>
<span id="cb143-12"><a href="#cb143-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-13"><a href="#cb143-13" aria-hidden="true" tabindex="-1"></a>reqvic <span class="sc">%&gt;%</span> </span>
<span id="cb143-14"><a href="#cb143-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(geo_params) <span class="sc">%&gt;%</span> </span>
<span id="cb143-15"><a href="#cb143-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_dry_run</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>POST /WMIS/cgi/webservice.exe? HTTP/1.1
Host: data.water.vic.gov.au
User-Agent: httr2/1.0.3 r-curl/5.2.2 libcurl/8.3.0
Accept: */*
Accept-Encoding: deflate, gzip
Content-Type: application/json
Content-Length: 232

{"function":"get_db_info","version":"3","params":{"table_name":"site","return_type":"array","filter_values":{"stntype":"HYD"},"field_list":["station","stntype","stname"],"geo_filter":{"rectangle":[["-38","144"],["-38.2","144.5"]]}}}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>resp_geo <span class="ot">&lt;-</span> reqvic <span class="sc">%&gt;%</span> </span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(geo_params) <span class="sc">%&gt;%</span> </span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a>rbody_geo <span class="ot">&lt;-</span> resp_geo <span class="sc">%&gt;%</span> <span class="fu">resp_body_json</span>(<span class="at">check_type =</span> <span class="cn">FALSE</span>)</span>
<span id="cb145-6"><a href="#cb145-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-7"><a href="#cb145-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(rbody_geo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ error_num: int 0
 $ return   :List of 1
  ..$ rows:List of 12
  .. ..$ :List of 3
  .. .. ..$ stname : chr "MOORABOOL RIVER AT BATESFORD"
  .. .. ..$ station: chr "232202A"
  .. .. ..$ stntype: chr "HYD"
  .. ..$ :List of 3
  .. .. ..$ stname : chr "WASTEWATER O/F DRAIN @ FORD FACTORY GEELONG"
  .. .. ..$ station: chr "232711A"
  .. .. ..$ stntype: chr "HYD"
  .. ..$ :List of 3
  .. .. ..$ stname : chr "BARWON RIVER @ POLLOCKSFORD"
  .. .. ..$ station: chr "233200A"
  .. .. ..$ stntype: chr "HYD"
  .. ..$ :List of 3
  .. .. ..$ stname : chr "BARWON RIVER @ POLLOCKSFORD"
  .. .. ..$ station: chr "233200B"
  .. .. ..$ stntype: chr "HYD"
  .. ..$ :List of 3
  .. .. ..$ stname : chr "LEIGH RIVER @ INVERLEIGH"
  .. .. ..$ station: chr "233209A"
  .. .. ..$ stntype: chr "HYD"
  .. ..$ :List of 3
  .. .. ..$ stname : chr "BARWON RIVER @ GEELONG"
  .. .. ..$ station: chr "233217A"
  .. .. ..$ stntype: chr "HYD"
  .. ..$ :List of 3
  .. .. ..$ stname : chr "BARWON RIVER @ GEELONG"
  .. .. ..$ station: chr "233217B"
  .. .. ..$ stntype: chr "HYD"
  .. ..$ :List of 3
  .. .. ..$ stname : chr "BARWON RIVER @ GEELONG"
  .. .. ..$ station: chr "233217C"
  .. .. ..$ stntype: chr "HYD"
  .. ..$ :List of 3
  .. .. ..$ stname : chr "BARWON RIVER @ GEELONG"
  .. .. ..$ station: chr "233217D"
  .. .. ..$ stntype: chr "HYD"
  .. ..$ :List of 3
  .. .. ..$ stname : chr "BARWON RIVER @ MURGHEBOLUC"
  .. .. ..$ station: chr "233219A"
  .. .. ..$ stntype: chr "HYD"
  .. ..$ :List of 3
  .. .. ..$ stname : chr "Waurn Ponds Creek @ Brearly Reserve"
  .. .. ..$ station: chr "233221A"
  .. .. ..$ stntype: chr "HYD"
  .. ..$ :List of 3
  .. .. ..$ stname : chr "NATIVE HUT CREEK @ TURTLE BEND PARK TEESDALE"
  .. .. ..$ station: chr "233242A"
  .. .. ..$ stntype: chr "HYD"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>db <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(rbody_geo[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> <span class="co"># the [2] drops the error column</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(<span class="at">col =</span> <span class="fu">where</span>(is.list)) <span class="sc">%&gt;%</span> <span class="co"># a `return` list</span></span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> <span class="fu">where</span>(is.list)) <span class="sc">%&gt;%</span> </span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(station, stntype, stname, <span class="fu">everything</span>(), <span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">'category'</span>))</span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a>db</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 3
   station stntype stname                                      
   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;                                       
 1 232202A HYD     MOORABOOL RIVER AT BATESFORD                
 2 232711A HYD     WASTEWATER O/F DRAIN @ FORD FACTORY GEELONG 
 3 233200A HYD     BARWON RIVER @ POLLOCKSFORD                 
 4 233200B HYD     BARWON RIVER @ POLLOCKSFORD                 
 5 233209A HYD     LEIGH RIVER @ INVERLEIGH                    
 6 233217A HYD     BARWON RIVER @ GEELONG                      
 7 233217B HYD     BARWON RIVER @ GEELONG                      
 8 233217C HYD     BARWON RIVER @ GEELONG                      
 9 233217D HYD     BARWON RIVER @ GEELONG                      
10 233219A HYD     BARWON RIVER @ MURGHEBOLUC                  
11 233221A HYD     Waurn Ponds Creek @ Brearly Reserve         
12 233242A HYD     NATIVE HUT CREEK @ TURTLE BEND PARK TEESDALE</code></pre>
</div>
</div>
</section>
<section id="trying-for-the-stntype" class="level3">
<h3 class="anchored" data-anchor-id="trying-for-the-stntype">Trying for the stntype</h3>
<p>Tried to use <code>sitelist_filter = "GROUP(PLUVIO_STATIONS)</code>, which qld made look like would work, but nothing. maybe <code>get_groups</code> is a way to figure out what the groups are?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>geo_params <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"function"</span> <span class="ot">=</span> <span class="st">'get_db_info'</span>,</span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"version"</span> <span class="ot">=</span> <span class="st">"3"</span>,</span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">"params"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"table_name"</span> <span class="ot">=</span> <span class="st">"site"</span>,</span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"return_type"</span> <span class="ot">=</span> <span class="st">"array"</span>,</span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"sitelist_filter"</span> <span class="ot">=</span> <span class="st">"GROUP(PLUVIO_STATIONS)"</span>,</span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"field_list"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"station"</span>, <span class="st">"stntype"</span>, <span class="st">"stname"</span>),</span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"geo_filter"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">'rectangle'</span> <span class="ot">=</span> rectbox)))</span>
<span id="cb149-8"><a href="#cb149-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-9"><a href="#cb149-9" aria-hidden="true" tabindex="-1"></a>reqvic <span class="sc">%&gt;%</span> </span>
<span id="cb149-10"><a href="#cb149-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(geo_params) <span class="sc">%&gt;%</span> </span>
<span id="cb149-11"><a href="#cb149-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_dry_run</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>POST /WMIS/cgi/webservice.exe? HTTP/1.1
Host: data.water.vic.gov.au
User-Agent: httr2/1.0.3 r-curl/5.2.2 libcurl/8.3.0
Accept: */*
Accept-Encoding: deflate, gzip
Content-Type: application/json
Content-Length: 241

{"function":"get_db_info","version":"3","params":{"table_name":"site","return_type":"array","sitelist_filter":"GROUP(PLUVIO_STATIONS)","field_list":["station","stntype","stname"],"geo_filter":{"rectangle":[["-38","144"],["-38.2","144.5"]]}}}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a>resp_geo <span class="ot">&lt;-</span> reqvic <span class="sc">%&gt;%</span> </span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(geo_params) <span class="sc">%&gt;%</span> </span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>rbody_geo <span class="ot">&lt;-</span> resp_geo <span class="sc">%&gt;%</span> <span class="fu">resp_body_json</span>(<span class="at">check_type =</span> <span class="cn">FALSE</span>)</span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-7"><a href="#cb151-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(rbody_geo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ error_num: int 0
 $ return   :List of 1
  ..$ rows: list()</code></pre>
</div>
</div>
</section>
<section id="aside--get_groups" class="level3">
<h3 class="anchored" data-anchor-id="aside--get_groups">Aside- get_groups</h3>
<p>Can we use hydstra groupings, as defined in the db? What <em>are</em> those groupings?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a>grp_params <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"function"</span> <span class="ot">=</span> <span class="st">'get_groups'</span>,</span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"version"</span> <span class="ot">=</span> <span class="st">"1"</span>,</span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">"params"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"site_list"</span> <span class="ot">=</span> allsites))</span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a>reqvic <span class="sc">%&gt;%</span> </span>
<span id="cb153-6"><a href="#cb153-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(grp_params) <span class="sc">%&gt;%</span> </span>
<span id="cb153-7"><a href="#cb153-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_dry_run</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>POST /WMIS/cgi/webservice.exe? HTTP/1.1
Host: data.water.vic.gov.au
User-Agent: httr2/1.0.3 r-curl/5.2.2 libcurl/8.3.0
Accept: */*
Accept-Encoding: deflate, gzip
Content-Type: application/json
Content-Length: 95

{"function":"get_groups","version":"1","params":{"site_list":"233217, 405328, 405331, 405837"}}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>resp_grp <span class="ot">&lt;-</span> reqvic <span class="sc">%&gt;%</span> </span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(grp_params) <span class="sc">%&gt;%</span> </span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-5"><a href="#cb155-5" aria-hidden="true" tabindex="-1"></a>rbody_grp <span class="ot">&lt;-</span> resp_grp <span class="sc">%&gt;%</span> <span class="fu">resp_body_json</span>(<span class="at">check_type =</span> <span class="cn">FALSE</span>)</span>
<span id="cb155-6"><a href="#cb155-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-7"><a href="#cb155-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(rbody_grp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ error_num: int 0
 $ return   :List of 34
  ..$ :List of 5
  .. ..$ group_decode: chr "to be at the top of the list"
  .. ..$ group       : chr "AB"
  .. ..$ value       : chr "CTS"
  .. ..$ value_decode: chr "list of site A files that have changed in the last 24hrs"
  .. ..$ stations    :List of 1
  .. .. ..$ : chr "233217"
  ..$ :List of 5
  .. ..$ group_decode: chr "to be at the top of the list"
  .. ..$ group       : chr "AB"
  .. ..$ value       : chr "FLOOD"
  .. ..$ value_decode: chr "All VIR Sites for Flood Zoom"
  .. ..$ stations    :List of 3
  .. .. ..$ : chr "233217"
  .. .. ..$ : chr "405328"
  .. .. ..$ : chr "405837"
  ..$ :List of 5
  .. ..$ group_decode: chr "All sites in archive"
  .. ..$ group       : chr "ALLA"
  .. ..$ value       : chr "10PLUS"
  .. ..$ value_decode: chr "sites with records longer than 10 years"
  .. ..$ stations    :List of 3
  .. .. ..$ : chr "233217"
  .. .. ..$ : chr "405328"
  .. .. ..$ : chr "405837"
  ..$ :List of 5
  .. ..$ group_decode: chr "All sites in archive"
  .. ..$ group       : chr "ALLA"
  .. ..$ value       : chr "30PLUS"
  .. ..$ value_decode: chr "sites with records longer than 30 years"
  .. ..$ stations    :List of 1
  .. .. ..$ : chr "233217"
  ..$ :List of 5
  .. ..$ group_decode: chr "All sites in archive"
  .. ..$ group       : chr "ALLA"
  .. ..$ value       : chr "ARCHIVE"
  .. ..$ value_decode: chr "Archive files"
  .. ..$ stations    :List of 4
  .. .. ..$ : chr "233217"
  .. .. ..$ : chr "405328"
  .. .. ..$ : chr "405331"
  .. .. ..$ : chr "405837"
  ..$ :List of 5
  .. ..$ group_decode: chr "All sites in archive"
  .. ..$ group       : chr "ALLA"
  .. ..$ value       : chr "FLOWA"
  .. ..$ value_decode: chr "All sites with flow (Vir and Hyd)"
  .. ..$ stations    :List of 3
  .. .. ..$ : chr "233217"
  .. .. ..$ : chr "405328"
  .. .. ..$ : chr "405331"
  ..$ :List of 5
  .. ..$ group_decode: chr "All sites in archive"
  .. ..$ group       : chr "ALLA"
  .. ..$ value       : chr "LEVEL"
  .. ..$ value_decode: chr "All sites with level (100.00 and 130)"
  .. ..$ stations    :List of 3
  .. .. ..$ : chr "233217"
  .. .. ..$ : chr "405328"
  .. .. ..$ : chr "405331"
  ..$ :List of 5
  .. ..$ group_decode: chr "All sites in archive"
  .. ..$ group       : chr "ALLA"
  .. ..$ value       : chr "VFLOW"
  .. ..$ value_decode: chr "Virtual sites with flow"
  .. ..$ stations    :List of 3
  .. .. ..$ : chr "233217"
  .. .. ..$ : chr "405328"
  .. .. ..$ : chr "405331"
  ..$ :List of 4
  .. ..$ group_decode: chr "Goups for the CMA areas"
  .. ..$ group       : chr "CMA"
  .. ..$ value       : chr "CCMA"
  .. ..$ stations    :List of 1
  .. .. ..$ : chr "233217"
  ..$ :List of 5
  .. ..$ group_decode: chr "daily on change generated site lists"
  .. ..$ group       : chr "HYVIRTUAL"
  .. ..$ value       : chr "TS"
  .. ..$ value_decode: chr "list of site A files that have changed in the last 24hrs"
  .. ..$ stations    :List of 1
  .. .. ..$ : chr "233217"
  ..$ :List of 4
  .. ..$ group_decode: chr "Proposed WMIS 2 Groups by me"
  .. ..$ group       : chr "PROP"
  .. ..$ value       : chr "RF"
  .. ..$ stations    :List of 1
  .. .. ..$ : chr "405837"
  ..$ :List of 4
  .. ..$ group_decode: chr "Proposed WMIS 2 Groups by me"
  .. ..$ group       : chr "PROP"
  .. ..$ value       : chr "SW"
  .. ..$ stations    :List of 3
  .. .. ..$ : chr "233217"
  .. .. ..$ : chr "405328"
  .. .. ..$ : chr "405331"
  ..$ :List of 4
  .. ..$ group_decode: chr "Proposed WMIS 2 Groups by me"
  .. ..$ group       : chr "PROP"
  .. ..$ value       : chr "WQ"
  .. ..$ stations    :List of 1
  .. .. ..$ : chr "233217"
  ..$ :List of 4
  .. ..$ group_decode: chr "Telemetry Sites"
  .. ..$ group       : chr "TELEMETRY"
  .. ..$ value       : chr "RAWDATA"
  .. ..$ stations    :List of 4
  .. .. ..$ : chr "233217"
  .. .. ..$ : chr "405328"
  .. .. ..$ : chr "405331"
  .. .. ..$ : chr "405837"
  ..$ :List of 5
  .. ..$ group_decode: chr "Yukkie"
  .. ..$ group       : chr "WDTF"
  .. ..$ value       : chr "LEVEL"
  .. ..$ value_decode: chr "All sites with level (100.00 and 130)"
  .. ..$ stations    :List of 3
  .. .. ..$ : chr "233217"
  .. .. ..$ : chr "405328"
  .. .. ..$ : chr "405331"
  ..$ :List of 5
  .. ..$ group_decode: chr "Yukkie"
  .. ..$ group       : chr "WDTF"
  .. ..$ value       : chr "RAIN"
  .. ..$ value_decode: chr "All rain monitoring sites"
  .. ..$ stations    :List of 1
  .. .. ..$ : chr "405837"
  ..$ :List of 5
  .. ..$ group_decode: chr "Yukkie"
  .. ..$ group       : chr "WDTF"
  .. ..$ value       : chr "WQSITES"
  .. ..$ value_decode: chr "all sites that have WQ in sample table"
  .. ..$ stations    :List of 1
  .. .. ..$ : chr "233217"
  ..$ :List of 5
  .. ..$ group_decode: chr "CMA"
  .. ..$ group       : chr "WEB_GW_CMA"
  .. ..$ value       : chr "CMA01"
  .. ..$ value_decode: chr "Corangamite CMA"
  .. ..$ stations    :List of 1
  .. .. ..$ : chr "233217"
  ..$ :List of 5
  .. ..$ group_decode: chr "CMA"
  .. ..$ group       : chr "WEB_GW_CMA"
  .. ..$ value       : chr "CMA04"
  .. ..$ value_decode: chr "Goulburn Broken CMA"
  .. ..$ stations    :List of 3
  .. .. ..$ : chr "405328"
  .. .. ..$ : chr "405331"
  .. .. ..$ : chr "405837"
  ..$ :List of 5
  .. ..$ group_decode: chr "Registered Aboriginal Party site lists"
  .. ..$ group       : chr "WEB_RAP"
  .. ..$ value       : chr "TLWCAC"
  .. ..$ value_decode: chr "Taungurung Land and Waters Council Aboriginal Corporation"
  .. ..$ stations    :List of 3
  .. .. ..$ : chr "405328"
  .. .. ..$ : chr "405331"
  .. .. ..$ : chr "405837"
  ..$ :List of 5
  .. ..$ group_decode: chr "Registered Aboriginal Party site lists"
  .. ..$ group       : chr "WEB_RAP"
  .. ..$ value       : chr "WTOAC"
  .. ..$ value_decode: chr "Wadawurrung Traditional Owners Aboriginal Corporation"
  .. ..$ stations    :List of 1
  .. .. ..$ : chr "233217"
  ..$ :List of 5
  .. ..$ group_decode: chr "Surface Water Sites"
  .. ..$ group       : chr "WEB_SW"
  .. ..$ value       : chr "B_233_BARWON"
  .. ..$ value_decode: chr "233-Barwon Basin"
  .. ..$ stations    :List of 1
  .. .. ..$ : chr "233217"
  ..$ :List of 5
  .. ..$ group_decode: chr "Surface Water Sites"
  .. ..$ group       : chr "WEB_SW"
  .. ..$ value       : chr "B_405_GOULBURN"
  .. ..$ value_decode: chr "405-Goulburn Basin"
  .. ..$ stations    :List of 3
  .. .. ..$ : chr "405328"
  .. .. ..$ : chr "405331"
  .. .. ..$ : chr "405837"
  ..$ :List of 5
  .. ..$ group_decode: chr "Surface Water Sites - active telem only"
  .. ..$ group       : chr "WEB_SW_TELEM"
  .. ..$ value       : chr "B_233_BARWON"
  .. ..$ value_decode: chr "233-Barwon Basin"
  .. ..$ stations    :List of 1
  .. .. ..$ : chr "233217"
  ..$ :List of 5
  .. ..$ group_decode: chr "Surface Water Sites - active telem only"
  .. ..$ group       : chr "WEB_SW_TELEM"
  .. ..$ value       : chr "B_405_GOULBURN"
  .. ..$ value_decode: chr "405-Goulburn Basin"
  .. ..$ stations    :List of 2
  .. .. ..$ : chr "405328"
  .. .. ..$ : chr "405837"
  ..$ :List of 4
  .. ..$ group_decode: chr "Test Sites"
  .. ..$ group       : chr "WEB_TEST"
  .. ..$ value       : chr "WEB_TEST"
  .. ..$ stations    :List of 1
  .. .. ..$ : chr "405837"
  ..$ :List of 4
  .. ..$ group_decode: chr "WMIS2 Sites"
  .. ..$ group       : chr "WMIS2"
  .. ..$ value       : chr "RF"
  .. ..$ stations    :List of 1
  .. .. ..$ : chr "405837"
  ..$ :List of 4
  .. ..$ group_decode: chr "WMIS2 Sites"
  .. ..$ group       : chr "WMIS2"
  .. ..$ value       : chr "SW"
  .. ..$ stations    :List of 3
  .. .. ..$ : chr "233217"
  .. .. ..$ : chr "405328"
  .. .. ..$ : chr "405331"
  ..$ :List of 4
  .. ..$ group_decode: chr "WMIS2 Sites"
  .. ..$ group       : chr "WMIS2"
  .. ..$ value       : chr "WQ"
  .. ..$ stations    :List of 1
  .. .. ..$ : chr "233217"
  ..$ :List of 4
  .. ..$ group_decode: chr "WMIS2 Topics Sites"
  .. ..$ group       : chr "WMIS2TOPICS"
  .. ..$ value       : chr "RF"
  .. ..$ stations    :List of 1
  .. .. ..$ : chr "405837"
  ..$ :List of 4
  .. ..$ group_decode: chr "WMIS2 Topics Sites"
  .. ..$ group       : chr "WMIS2TOPICS"
  .. ..$ value       : chr "SW"
  .. ..$ stations    :List of 3
  .. .. ..$ : chr "233217"
  .. .. ..$ : chr "405328"
  .. .. ..$ : chr "405331"
  ..$ :List of 4
  .. ..$ group_decode: chr "WMIS2 Topics Sites"
  .. ..$ group       : chr "WMIS2TOPICS"
  .. ..$ value       : chr "WQ"
  .. ..$ stations    :List of 2
  .. .. ..$ : chr "233217"
  .. .. ..$ : chr "405331"
  ..$ :List of 5
  .. ..$ group_decode: chr "WMIS2 CMAs"
  .. ..$ group       : chr "WMIS2_CMA"
  .. ..$ value       : chr "CMA01"
  .. ..$ value_decode: chr "Corangamite CMA"
  .. ..$ stations    :List of 1
  .. .. ..$ : chr "233217"
  ..$ :List of 5
  .. ..$ group_decode: chr "WMIS2 CMAs"
  .. ..$ group       : chr "WMIS2_CMA"
  .. ..$ value       : chr "CMA04"
  .. ..$ value_decode: chr "Goulburn Broken CMA"
  .. ..$ stations    :List of 2
  .. .. ..$ : chr "405328"
  .. .. ..$ : chr "405837"</code></pre>
</div>
</div>
<p>Unpack</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>db <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(rbody_grp[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> <span class="co"># the [2] drops the error column</span></span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> <span class="fu">where</span>(is.list)) <span class="sc">%&gt;%</span> <span class="co"># a `return` list</span></span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(<span class="at">col =</span> <span class="fu">where</span>(is.list))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Drop the stations- what are the groups?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>db <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>stations) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 34 × 4
   group_decode                         group     value   value_decode          
   &lt;chr&gt;                                &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt;                 
 1 to be at the top of the list         AB        CTS     list of site A files …
 2 to be at the top of the list         AB        FLOOD   All VIR Sites for Flo…
 3 All sites in archive                 ALLA      10PLUS  sites with records lo…
 4 All sites in archive                 ALLA      30PLUS  sites with records lo…
 5 All sites in archive                 ALLA      ARCHIVE Archive files         
 6 All sites in archive                 ALLA      FLOWA   All sites with flow (…
 7 All sites in archive                 ALLA      LEVEL   All sites with level …
 8 All sites in archive                 ALLA      VFLOW   Virtual sites with fl…
 9 Goups for the CMA areas              CMA       CCMA    &lt;NA&gt;                  
10 daily on change generated site lists HYVIRTUAL TS      list of site A files …
# ℹ 24 more rows</code></pre>
</div>
</div>
<p>No obvious groupings there to select on except maybe surface water sites, but that drops rainfall.</p>
</section>
<section id="how-about-sitelist_filter" class="level3">
<h3 class="anchored" data-anchor-id="how-about-sitelist_filter">How about <code>sitelist_filter</code>?</h3>
<p>with one site</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>geo_params <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"function"</span> <span class="ot">=</span> <span class="st">'get_db_info'</span>,</span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"version"</span> <span class="ot">=</span> <span class="st">"3"</span>,</span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">"params"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"table_name"</span> <span class="ot">=</span> <span class="st">"site"</span>,</span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"return_type"</span> <span class="ot">=</span> <span class="st">"array"</span>,</span>
<span id="cb160-5"><a href="#cb160-5" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"sitelist_filter"</span> <span class="ot">=</span> <span class="st">"233217"</span>,</span>
<span id="cb160-6"><a href="#cb160-6" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"field_list"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"station"</span>, <span class="st">"stntype"</span>, <span class="st">"stname"</span>),</span>
<span id="cb160-7"><a href="#cb160-7" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"geo_filter"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">'rectangle'</span> <span class="ot">=</span> rectbox)))</span>
<span id="cb160-8"><a href="#cb160-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-9"><a href="#cb160-9" aria-hidden="true" tabindex="-1"></a>reqvic <span class="sc">%&gt;%</span> </span>
<span id="cb160-10"><a href="#cb160-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(geo_params) <span class="sc">%&gt;%</span> </span>
<span id="cb160-11"><a href="#cb160-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_dry_run</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>POST /WMIS/cgi/webservice.exe? HTTP/1.1
Host: data.water.vic.gov.au
User-Agent: httr2/1.0.3 r-curl/5.2.2 libcurl/8.3.0
Accept: */*
Accept-Encoding: deflate, gzip
Content-Type: application/json
Content-Length: 225

{"function":"get_db_info","version":"3","params":{"table_name":"site","return_type":"array","sitelist_filter":"233217","field_list":["station","stntype","stname"],"geo_filter":{"rectangle":[["-38","144"],["-38.2","144.5"]]}}}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a>resp_geo <span class="ot">&lt;-</span> reqvic <span class="sc">%&gt;%</span> </span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(geo_params) <span class="sc">%&gt;%</span> </span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-5"><a href="#cb162-5" aria-hidden="true" tabindex="-1"></a>rbody_geo <span class="ot">&lt;-</span> resp_geo <span class="sc">%&gt;%</span> <span class="fu">resp_body_json</span>(<span class="at">check_type =</span> <span class="cn">FALSE</span>)</span>
<span id="cb162-6"><a href="#cb162-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-7"><a href="#cb162-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(rbody_geo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ error_num: int 0
 $ return   :List of 1
  ..$ rows:List of 1
  .. ..$ :List of 3
  .. .. ..$ stname : chr "BARWON RIVER @ GEELONG"
  .. .. ..$ station: chr "233217"
  .. .. ..$ stntype: chr "VIR"</code></pre>
</div>
</div>
<p>with multiple sites, it just returns the first one. And using <code>c("site1", "site2")</code> errors out.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a>geo_params <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"function"</span> <span class="ot">=</span> <span class="st">'get_db_info'</span>,</span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"version"</span> <span class="ot">=</span> <span class="st">"3"</span>,</span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">"params"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"table_name"</span> <span class="ot">=</span> <span class="st">"site"</span>,</span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"return_type"</span> <span class="ot">=</span> <span class="st">"array"</span>,</span>
<span id="cb164-5"><a href="#cb164-5" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"sitelist_filter"</span> <span class="ot">=</span> <span class="st">"233217, 405331"</span>,</span>
<span id="cb164-6"><a href="#cb164-6" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"field_list"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"station"</span>, <span class="st">"stntype"</span>, <span class="st">"stname"</span>),</span>
<span id="cb164-7"><a href="#cb164-7" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"geo_filter"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">'rectangle'</span> <span class="ot">=</span> rectbox)))</span>
<span id="cb164-8"><a href="#cb164-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-9"><a href="#cb164-9" aria-hidden="true" tabindex="-1"></a>reqvic <span class="sc">%&gt;%</span> </span>
<span id="cb164-10"><a href="#cb164-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(geo_params) <span class="sc">%&gt;%</span> </span>
<span id="cb164-11"><a href="#cb164-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_dry_run</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>POST /WMIS/cgi/webservice.exe? HTTP/1.1
Host: data.water.vic.gov.au
User-Agent: httr2/1.0.3 r-curl/5.2.2 libcurl/8.3.0
Accept: */*
Accept-Encoding: deflate, gzip
Content-Type: application/json
Content-Length: 233

{"function":"get_db_info","version":"3","params":{"table_name":"site","return_type":"array","sitelist_filter":"233217, 405331","field_list":["station","stntype","stname"],"geo_filter":{"rectangle":[["-38","144"],["-38.2","144.5"]]}}}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a>resp_geo <span class="ot">&lt;-</span> reqvic <span class="sc">%&gt;%</span> </span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(geo_params) <span class="sc">%&gt;%</span> </span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-5"><a href="#cb166-5" aria-hidden="true" tabindex="-1"></a>rbody_geo <span class="ot">&lt;-</span> resp_geo <span class="sc">%&gt;%</span> <span class="fu">resp_body_json</span>(<span class="at">check_type =</span> <span class="cn">FALSE</span>)</span>
<span id="cb166-6"><a href="#cb166-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-7"><a href="#cb166-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(rbody_geo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ error_num: int 0
 $ return   :List of 1
  ..$ rows:List of 1
  .. ..$ :List of 3
  .. .. ..$ stname : chr "BARWON RIVER @ GEELONG"
  .. .. ..$ station: chr "233217"
  .. .. ..$ stntype: chr "VIR"</code></pre>
</div>
</div>
</section>
<section id="using-complex_filter" class="level3">
<h3 class="anchored" data-anchor-id="using-complex_filter">using complex_filter</h3>
<p>is this easier or harder than just running it twice (or however many times)</p>
<p>It’s more flexible, but pretty terrible to sort out. And absurdly slow.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a>geo_params <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"function"</span> <span class="ot">=</span> <span class="st">'get_db_info'</span>,</span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"version"</span> <span class="ot">=</span> <span class="st">"3"</span>,</span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">"params"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"table_name"</span> <span class="ot">=</span> <span class="st">"site"</span>,</span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"return_type"</span> <span class="ot">=</span> <span class="st">"array"</span>,</span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"complex_filter"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="fu">list</span>(<span class="st">'fieldname'</span> <span class="ot">=</span> <span class="st">'stntype'</span>,</span>
<span id="cb168-6"><a href="#cb168-6" aria-hidden="true" tabindex="-1"></a>                                                         <span class="st">'value'</span> <span class="ot">=</span> <span class="st">"HYD"</span>,</span>
<span id="cb168-7"><a href="#cb168-7" aria-hidden="true" tabindex="-1"></a>                                                         <span class="st">'operator'</span> <span class="ot">=</span> <span class="st">'EQ'</span>),</span>
<span id="cb168-8"><a href="#cb168-8" aria-hidden="true" tabindex="-1"></a>                                                    <span class="fu">list</span>(<span class="st">'combine'</span> <span class="ot">=</span> <span class="st">'OR'</span>,</span>
<span id="cb168-9"><a href="#cb168-9" aria-hidden="true" tabindex="-1"></a>                                                         <span class="st">'fieldname'</span> <span class="ot">=</span> <span class="st">'stntype'</span>,</span>
<span id="cb168-10"><a href="#cb168-10" aria-hidden="true" tabindex="-1"></a>                                                         <span class="st">'value'</span> <span class="ot">=</span> <span class="st">"VIR"</span>,</span>
<span id="cb168-11"><a href="#cb168-11" aria-hidden="true" tabindex="-1"></a>                                                         <span class="st">'operator'</span> <span class="ot">=</span> <span class="st">'EQ'</span>)),</span>
<span id="cb168-12"><a href="#cb168-12" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"field_list"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"station"</span>, <span class="st">"stntype"</span>, <span class="st">"stname"</span>),</span>
<span id="cb168-13"><a href="#cb168-13" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"geo_filter"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">'rectangle'</span> <span class="ot">=</span> rectbox)))</span>
<span id="cb168-14"><a href="#cb168-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-15"><a href="#cb168-15" aria-hidden="true" tabindex="-1"></a>reqvic <span class="sc">%&gt;%</span> </span>
<span id="cb168-16"><a href="#cb168-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(geo_params) <span class="sc">%&gt;%</span> </span>
<span id="cb168-17"><a href="#cb168-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_dry_run</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>POST /WMIS/cgi/webservice.exe? HTTP/1.1
Host: data.water.vic.gov.au
User-Agent: httr2/1.0.3 r-curl/5.2.2 libcurl/8.3.0
Accept: */*
Accept-Encoding: deflate, gzip
Content-Type: application/json
Content-Length: 340

{"function":"get_db_info","version":"3","params":{"table_name":"site","return_type":"array","complex_filter":[{"fieldname":"stntype","value":"HYD","operator":"EQ"},{"combine":"OR","fieldname":"stntype","value":"VIR","operator":"EQ"}],"field_list":["station","stntype","stname"],"geo_filter":{"rectangle":[["-38","144"],["-38.2","144.5"]]}}}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a>resp_geo <span class="ot">&lt;-</span> reqvic <span class="sc">%&gt;%</span> </span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(geo_params) <span class="sc">%&gt;%</span> </span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-5"><a href="#cb170-5" aria-hidden="true" tabindex="-1"></a>rbody_geo <span class="ot">&lt;-</span> resp_geo <span class="sc">%&gt;%</span> <span class="fu">resp_body_json</span>(<span class="at">check_type =</span> <span class="cn">FALSE</span>)</span>
<span id="cb170-6"><a href="#cb170-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-7"><a href="#cb170-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(rbody_geo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ error_num: int 0
 $ return   :List of 1
  ..$ rows:List of 18
  .. ..$ :List of 3
  .. .. ..$ stname : chr "MOORABOOL RIVER @ BATESFORD"
  .. .. ..$ station: chr "232202"
  .. .. ..$ stntype: chr "VIR"
  .. ..$ :List of 3
  .. .. ..$ stname : chr "MOORABOOL RIVER AT BATESFORD"
  .. .. ..$ station: chr "232202A"
  .. .. ..$ stntype: chr "HYD"
  .. ..$ :List of 3
  .. .. ..$ stname : chr "WASTEWATER O/F DRAIN @ FORD FACTORY GEELONG"
  .. .. ..$ station: chr "232711"
  .. .. ..$ stntype: chr "VIR"
  .. ..$ :List of 3
  .. .. ..$ stname : chr "WASTEWATER O/F DRAIN @ FORD FACTORY GEELONG"
  .. .. ..$ station: chr "232711A"
  .. .. ..$ stntype: chr "HYD"
  .. ..$ :List of 3
  .. .. ..$ stname : chr "BARWON RIVER @ POLLOCKSFORD"
  .. .. ..$ station: chr "233200"
  .. .. ..$ stntype: chr "VIR"
  .. ..$ :List of 3
  .. .. ..$ stname : chr "BARWON RIVER @ POLLOCKSFORD"
  .. .. ..$ station: chr "233200A"
  .. .. ..$ stntype: chr "HYD"
  .. ..$ :List of 3
  .. .. ..$ stname : chr "BARWON RIVER @ POLLOCKSFORD"
  .. .. ..$ station: chr "233200B"
  .. .. ..$ stntype: chr "HYD"
  .. ..$ :List of 3
  .. .. ..$ stname : chr "LEIGH RIVER @ INVERLEIGH"
  .. .. ..$ station: chr "233209"
  .. .. ..$ stntype: chr "VIR"
  .. ..$ :List of 3
  .. .. ..$ stname : chr "LEIGH RIVER @ INVERLEIGH"
  .. .. ..$ station: chr "233209A"
  .. .. ..$ stntype: chr "HYD"
  .. ..$ :List of 3
  .. .. ..$ stname : chr "BARWON RIVER @ GEELONG"
  .. .. ..$ station: chr "233217"
  .. .. ..$ stntype: chr "VIR"
  .. ..$ :List of 3
  .. .. ..$ stname : chr "BARWON RIVER @ GEELONG"
  .. .. ..$ station: chr "233217A"
  .. .. ..$ stntype: chr "HYD"
  .. ..$ :List of 3
  .. .. ..$ stname : chr "BARWON RIVER @ GEELONG"
  .. .. ..$ station: chr "233217B"
  .. .. ..$ stntype: chr "HYD"
  .. ..$ :List of 3
  .. .. ..$ stname : chr "BARWON RIVER @ GEELONG"
  .. .. ..$ station: chr "233217C"
  .. .. ..$ stntype: chr "HYD"
  .. ..$ :List of 3
  .. .. ..$ stname : chr "BARWON RIVER @ GEELONG"
  .. .. ..$ station: chr "233217D"
  .. .. ..$ stntype: chr "HYD"
  .. ..$ :List of 3
  .. .. ..$ stname : chr "BARWON RIVER @ MURGHEBOLUC"
  .. .. ..$ station: chr "233219"
  .. .. ..$ stntype: chr "VIR"
  .. ..$ :List of 3
  .. .. ..$ stname : chr "BARWON RIVER @ MURGHEBOLUC"
  .. .. ..$ station: chr "233219A"
  .. .. ..$ stntype: chr "HYD"
  .. ..$ :List of 3
  .. .. ..$ stname : chr "Waurn Ponds Creek @ Brearly Reserve"
  .. .. ..$ station: chr "233221A"
  .. .. ..$ stntype: chr "HYD"
  .. ..$ :List of 3
  .. .. ..$ stname : chr "NATIVE HUT CREEK @ TURTLE BEND PARK TEESDALE"
  .. .. ..$ station: chr "233242A"
  .. .. ..$ stntype: chr "HYD"</code></pre>
</div>
</div>
<p>that seems to have worked. Unpack- <em>remember we’ve used a field_list here so it’s simpler and we don’t need to have the select we had above</em>. In the package we should probably allow doing that both ways.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a>db <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(rbody_geo[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> <span class="co"># the [2] drops the error column</span></span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(<span class="at">col =</span> <span class="fu">where</span>(is.list)) <span class="sc">%&gt;%</span> <span class="co"># a `return` list</span></span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> <span class="fu">where</span>(is.list))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>TODO</strong> clean that up into a function and include. <em>And test where we know there’s rain gauges- am I losing those with the stntypes I’ve gone with?</em></p>
<p>allow field_list</p>
<p>and geo_filter- all three kinds</p>
<p>how to do stntype- could have one option that allows actually directly passing lists to complex filter (or filter_values).</p>
<p>OR (and?) could have an option that builds that list for the user somehow. would need to limit it to a few common things like stntype. *could I do this by saying if filter_values gets a c() of things for any of its keys, build an OR complex_filter. ie filter_values can only have one stntype. So if it gets c(stntype1, stntype2), just short-circuit and use complex instead. Would need to be careful if user passes more than one filtering thing in. In that case, just make them build the complex filter themselves. maybe provide a test_complex_filter function that just returns req_dry_run?</p>
</section>
</section>
<section id="todo" class="level1">
<h1>TODO</h1>
<p>List of all datasources and variables and sites in the db - cross-reffed? Not sure</p>
<p>List of variable numbers and their names in a readable table (vignette?)</p>
<p>List of possible data_type functions</p>
<p>Can I get a date across years to calculate median, 90%, etc without pulling the full sequence?</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Website created by Galen Holt</p>
</div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="mailto:g.holt@deakin.edu.au">
<p>Contact</p>
</a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="https://orcid.org/0000-0002-7455-9275">
<p>ORCID</p>
</a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="https://experts.deakin.edu.au/43512-galen-holt/about">
<p>Profile</p>
</a>
  </li>  
</ul>
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/galenholt">
      <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://scholar.google.com.au/citations?user=f94WBOoAAAAJ&amp;hl=en">
      <i class="bi bi-mortarboard-fill" role="img" aria-label="Google Scholar">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/galen-holt-265aa290">
      <i class="bi bi-linkedin" role="img" aria-label="LinkedIn">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://fediscience.org/@galen_holt">
      <i class="bi bi-mastodon" role="img" aria-label="Mastodon">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>