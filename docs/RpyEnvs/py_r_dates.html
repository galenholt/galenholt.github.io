<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Galen Holt">

<title>Galen - Complex passing py-R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Galen</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../research.html">
 <span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../code_demos.html" aria-current="page">
 <span class="menu-text">Code Demos</span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Complex passing py-R</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../code_demos.html" class="sidebar-item-text sidebar-link">Code Demos</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Small how-tos</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../small_helpers/smallpieces.html" class="sidebar-item-text sidebar-link">Bits and pieces</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../small_helpers/quarto_notes.html" class="sidebar-item-text sidebar-link">Quarto notes</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../setup/rstudio_themes.html" class="sidebar-item-text sidebar-link">Editing Rstudio themes</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../small_helpers/zip_downloading.html" class="sidebar-item-text sidebar-link">Download and unpack zips</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../small_helpers/json_api_construction.html" class="sidebar-item-text sidebar-link">Building JSON syntax from R for API calls</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../small_helpers/list_names.html" class="sidebar-item-text sidebar-link">Naming rules for lists</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Plotting</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../plotting/ggplot_themes.html" class="sidebar-item-text sidebar-link">ggplot themes</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../plotting/setting_colors_for_groups.html" class="sidebar-item-text sidebar-link">Consistent colors</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../plotting/tweaks_tricks.html" class="sidebar-item-text sidebar-link">Saving and themeing plots</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../plotting/hcl_exploration.html" class="sidebar-item-text sidebar-link">Exploring HCL colorspace</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../plotting/rgb_to_hex.html" class="sidebar-item-text sidebar-link">Converting RGB to hex colors</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../plotting/fonts.html" class="sidebar-item-text sidebar-link">Fonts</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../plotting/faded_colors.html" class="sidebar-item-text sidebar-link">Faded 2d colour ramps</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../plotting/math_in_ggplot.html" class="sidebar-item-text sidebar-link">Latex in ggplot with latex2exp</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">Website</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../website_notes/quarto_website_github.html" class="sidebar-item-text sidebar-link">Getting started</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../website_notes/updating_website.html" class="sidebar-item-text sidebar-link">Updating and maintaining website</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">Theory and simulation</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../simmodelling/twoDautocorr.html" class="sidebar-item-text sidebar-link">Generate 2d autocorrelation</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">Drones</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../drones/overlaps_reactive.html" class="sidebar-item-text sidebar-link">Calculations for flight planning</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../drones/overlaps.html" class="sidebar-item-text sidebar-link">Figuring out flight plan calcs</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pix4d/read_pix4d_outputs.html" class="sidebar-item-text sidebar-link">Reading and plotting pix4d outputs</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">Observable</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../observable/trying_observable.html" class="sidebar-item-text sidebar-link">Figuring out how to use ojs chunks</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">R and python</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/python_setup.html" class="sidebar-item-text sidebar-link">Python environments with pyenv and poetry</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/python_updated_functions.html" class="sidebar-item-text sidebar-link">Small python bits</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/RandPython.html" class="sidebar-item-text sidebar-link">Using R and python together</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/R_py_shared_projects.html" class="sidebar-item-text sidebar-link">Shared R-py project structure</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/py_r_dates.html" class="sidebar-item-text sidebar-link active">Passing complex objects py-R</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/R_py_type_passing.html" class="sidebar-item-text sidebar-link">Passing types between R and python</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/py_r_project_overview.html" class="sidebar-item-text sidebar-link">Overview of building R-py package</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/R_py_package.html" class="sidebar-item-text sidebar-link">Wrapping python in R package</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/python_nameerror.html" class="sidebar-item-text sidebar-link">Intermittent NameError py-R</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="true">Setting up projects</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/rig.html" class="sidebar-item-text sidebar-link">Managing old R versions with rig</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/managingprivate.html" class="sidebar-item-text sidebar-link">Private data for website repo</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../setup/R_in_VS.html" class="sidebar-item-text sidebar-link">Using R in VScode</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/end_run_renv.html" class="sidebar-item-text sidebar-link">Dealing with renv failures</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="true">Building packages</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../package/package_creation.html" class="sidebar-item-text sidebar-link">First pass at building a package</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vicwater/vicwater_testing.html" class="sidebar-item-text sidebar-link">Testing VicWater API</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" aria-expanded="true">Data</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../data_acquisition/bom_gauges.html" class="sidebar-item-text sidebar-link">BOM gauge locations with httr2</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vicwater/vicwater_api_howtocall.html" class="sidebar-item-text sidebar-link">Experimenting with API calls for {vicwater}</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../data_acquisition/gauge_data_pre_gauge.html" class="sidebar-item-text sidebar-link">Data from pre-gauged periods</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" aria-expanded="true">R parallel processing (general)</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-11" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../parallelism/interrogating_parallel.html" class="sidebar-item-text sidebar-link">Interrogating parallel resources</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../parallelism/nested_parallel.html" class="sidebar-item-text sidebar-link">Testing nested parallelism</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../parallelism/parallel_speed.html" class="sidebar-item-text sidebar-link">Speed-testing parallel</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../parallelism/globals_speed.html" class="sidebar-item-text sidebar-link">Global objects and parallel speed</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-12" aria-expanded="true">R parallel processing on HPC</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-12" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-12" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../parallelism/hpc_ephemera.html" class="sidebar-item-text sidebar-link">HPC notes</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../parallelism/plans_and_hpc.html" class="sidebar-item-text sidebar-link">Using single-machine plans on HPC</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../parallelism/initial_future_batchtools.html" class="sidebar-item-text sidebar-link">Figuring out future.batchtools</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../parallelism/changing_batchtools_template.html" class="sidebar-item-text sidebar-link">Switching templates, matching to resources</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../parallelism/template_modification.html" class="sidebar-item-text sidebar-link">Modifying templates</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../parallelism/master_persistence.html" class="sidebar-item-text sidebar-link">Consequences of master timing out</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../parallelism/nested_parallel_hpc.html" class="sidebar-item-text sidebar-link">Nested parallel on HPC nodes and cores</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../parallelism/conditional_plans.html" class="sidebar-item-text sidebar-link">Conditional plans for local and HPC</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#the-issue" id="toc-the-issue" class="nav-link active" data-scroll-target="#the-issue">The issue</a>
  <ul class="collapse">
  <li><a href="#general-problem" id="toc-general-problem" class="nav-link" data-scroll-target="#general-problem">General problem</a></li>
  <li><a href="#a-demonstration-sort-of" id="toc-a-demonstration-sort-of" class="nav-link" data-scroll-target="#a-demonstration-sort-of">A demonstration (sort of)</a></li>
  <li><a href="#now-with-time" id="toc-now-with-time" class="nav-link" data-scroll-target="#now-with-time">Now, with time</a></li>
  <li><a href="#for-future-reference" id="toc-for-future-reference" class="nav-link" data-scroll-target="#for-future-reference">For future reference</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Complex passing py-R</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Galen Holt </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<div class="cell" data-hash="py_r_dates_cache/html/setup_bcab856d081ede9d1dbc58979d4e27ee">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_knit<span class="sc">$</span><span class="fu">set</span>(<span class="at">root.dir =</span> rprojroot<span class="sc">::</span><span class="fu">find_rstudio_root_file</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Old way of giving path to venv, new way is to set it in <code>.Rprofile</code></p>
<div class="cell" data-hash="py_r_dates_cache/html/unnamed-chunk-1_a8c548918c0f6aa896b10dbbb8a7f7a6">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># reticulate::use_virtualenv(file.path('RpyEnvs', 'pytesting', '.venv'), required = TRUE)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="py_r_dates_cache/html/unnamed-chunk-2_c64cfa60ffaf69322ba9a7a8022eb68d">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reticulate)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="the-issue" class="level1">
<h1>The issue</h1>
<p>I previously did some very basic playing with using python and R <a href="../RpyEnvs/RandPython.html">in the same quarto doc</a>. I immediately ran into issues though when I tried to use it in a real project because I was no longer passing just simple objects back and forth.</p>
<p>The specific issue I ran into was that it was straighforward to pass a pandas dataframe, but if one of the columns has dates, they come in as a list of python environments containing the date objects. They can be parsed, but it takes <em>forever</em>. So the solution is to turn them into something else in python, pass the pandas, and re-date them.</p>
<section id="general-problem" class="level2">
<h2 class="anchored" data-anchor-id="general-problem">General problem</h2>
<p>The real issue here is when we bring a df into R from python and it has a list column with ‘environment’ in it. Then the conversion hasn’t really happened, and doing that conversion post-hoc has to convert every single environment, which is all rows. And that takes forever. It’s not necessarily dates (and as we can see below, sometimes they <em>do</em> work just fine). So, if that happens, rather than taking an eternity to <code>purrr</code> or otherwise go through the column to translate, just put it in something easier in py, bring it over, and put it back.</p>
<p>I do wish I had a better idea about <em>why</em> it happened. I’m sure as it happens more I’ll start to figure it out.</p>
<p>It’s possible this has been fixed in more recent {reticulate}, and that’s why I can’t reproduce? <a href="https://github.com/rstudio/reticulate/pull/1266" class="uri">https://github.com/rstudio/reticulate/pull/1266</a>. No, I’m still getting the error where I was before. Still struggling to replicate it, but it does happen in the original case.</p>
</section>
<section id="a-demonstration-sort-of" class="level2">
<h2 class="anchored" data-anchor-id="a-demonstration-sort-of">A demonstration (sort of)</h2>
<p>Say we have a pandas dataframe with a few columns of simple types (numeric, character) and 1000 rows</p>
<div class="cell" data-hash="py_r_dates_cache/html/unnamed-chunk-3_3c6d56686a5f6882ea0ffb67cc48a70a">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> string</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>randnums <span class="op">=</span> [random.gauss(<span class="dv">0</span>, <span class="dv">1</span>) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1000</span>)]</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>allchars <span class="op">=</span> <span class="bu">list</span>(string.ascii_lowercase) <span class="op">+</span> <span class="bu">list</span>(string.ascii_uppercase)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>randchars <span class="op">=</span> [random.choice(allchars) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1000</span>)]</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>simpledf <span class="op">=</span> pd.DataFrame({<span class="st">'rand_nums'</span>: randnums, <span class="st">'rand_chars'</span>: randchars}, columns<span class="op">=</span>[<span class="st">'rand_nums'</span>, <span class="st">'rand_chars'</span>], index<span class="op">=</span><span class="bu">range</span>(<span class="dv">1000</span>))</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>simpledf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     rand_nums rand_chars
0    -0.852387          C
1     0.699115          h
2     1.088182          c
3    -0.125998          v
4    -1.379944          k
..         ...        ...
995   0.160521          w
996   0.226147          H
997  -0.504377          t
998   0.274586          V
999  -0.208838          r

[1000 rows x 2 columns]</code></pre>
</div>
</div>
<p>Now, we can get that into R without too much fuss using <code>py$</code>.</p>
<div class="cell" data-hash="py_r_dates_cache/html/unnamed-chunk-4_3ebfd45672e56b5b58ad5d5898377c96">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>rsimple <span class="ot">&lt;-</span> py<span class="sc">$</span>simpledf</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>rsimple</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        rand_nums rand_chars
1    -0.852387035          C
2     0.699115391          h
3     1.088182247          c
4    -0.125997505          v
5    -1.379944407          k
6    -0.121272017          q
7     0.393571334          b
8     1.867965619          t
9     2.206898460          H
10    1.024628855          W
11    0.796254306          G
12   -0.128749501          v
13    1.615735262          H
14   -1.670567850          Y
15   -0.254295726          P
16    1.760289252          O
17    2.442435943          s
18    0.642185950          p
19   -1.056003383          F
20   -0.596291749          a
21    3.128575375          S
22   -0.304090771          r
23    1.006194701          t
24    0.730406109          j
25    0.655213903          N
26    1.294661841          m
27    0.873581296          W
28   -1.005591407          Y
29   -0.175577895          k
30   -0.616614439          D
31   -0.543446938          j
32    0.445120008          K
33   -0.166283257          C
34    0.560188429          s
35   -0.032647752          b
36    1.468194784          l
37   -1.050685861          Z
38    0.769293356          G
39   -0.438681966          M
40    1.070278848          O
41   -1.292046698          U
42   -0.364750388          P
43   -0.187814928          A
44   -0.276562922          E
45    1.279047433          U
46   -1.304764072          W
47    2.097440654          Q
48   -1.767847171          N
49   -0.045055018          S
50    0.460266169          l
51   -0.791599802          r
52   -0.010697573          k
53   -1.973145380          F
54    1.456568730          O
55    0.268761908          j
56   -0.432689945          D
57   -1.841262097          y
58    1.305362727          w
59   -1.079022081          f
60   -0.722645196          E
61    0.336069100          A
62   -2.313782856          c
63   -0.039640911          c
64    0.435124496          T
65   -0.505580914          o
66   -0.205213589          F
67   -1.503524380          L
68    0.376215957          R
69    1.249395062          R
70   -2.635215553          X
71    0.072333666          j
72    1.934194766          B
73   -0.171189272          L
74    0.066757378          Z
75    0.992864430          H
76    0.577457356          a
77   -1.132997218          Q
78    0.138405735          g
79    1.005894941          c
80   -0.297005535          Z
81    0.403693954          E
82    0.050532762          g
83   -0.218122906          S
84   -0.700313472          D
85    0.785611714          R
86   -1.734482528          P
87   -0.687073110          b
88    0.581553910          q
89    0.234765987          h
90   -0.230607897          c
91    0.573277617          a
92    3.751027477          U
93    0.536425187          o
94    0.418437069          x
95    1.578079576          t
96   -0.689018533          M
97   -0.409271776          o
98    0.278284564          V
99    1.193527181          g
100  -1.255267832          t
101   0.275723132          Z
102  -0.936374172          t
103   0.633262828          X
104   0.839163754          L
105   0.127262564          h
106   0.318560015          r
107   1.363685222          c
108  -1.060879242          w
109   0.085099980          f
110   0.738044437          h
111   0.492598879          p
112   0.441341926          s
113  -0.567042093          j
114   0.568379663          j
115  -0.796867360          G
116  -1.067739073          a
117  -1.960756164          R
118  -1.127232627          d
119  -1.771281033          B
120  -0.101259006          V
121   1.156506404          E
122  -0.558995765          L
123  -0.026782991          c
124   0.306732322          Q
125  -1.104469361          U
126  -0.466080763          k
127   1.740493319          A
128   0.111253202          Q
129   0.054798359          O
130  -0.056855242          X
131  -0.393136252          H
132   0.834360168          X
133   0.846209199          z
134   1.525122293          X
135  -0.590290765          B
136  -0.455595747          J
137   2.289499150          G
138   0.187783959          R
139   0.252235689          H
140   0.900793020          J
141  -0.247793406          U
142   0.521691999          L
143  -0.891307703          x
144  -0.326117311          E
145  -2.110523463          l
146  -1.340087005          v
147   0.494391813          z
148  -1.137413217          J
149   0.444572942          n
150   1.257748973          L
151   0.395653624          K
152   0.419937333          u
153  -1.103253147          y
154   0.088443595          f
155   1.231187264          P
156   0.111980327          q
157   0.167365631          F
158  -0.679370491          K
159   1.198996239          Q
160   0.177053126          w
161   0.379481047          S
162   1.175589508          S
163  -1.471971409          J
164  -0.214380414          T
165  -0.291845975          X
166   0.118400321          g
167   0.742398906          t
168   0.272889144          y
169  -1.209046587          m
170  -0.267432642          r
171  -1.167353035          g
172  -0.192842125          O
173  -0.438187374          l
174   0.766537563          f
175  -0.490805187          s
176   1.984064589          C
177  -0.743103302          E
178   1.178436261          X
179  -0.397506723          t
180   2.259130217          N
181   1.106528787          c
182  -0.337552960          r
183   0.309885797          p
184  -0.264647827          W
185  -0.883146885          p
186   0.370886119          t
187   0.266094801          P
188   0.656855791          y
189   1.463852846          y
190  -0.501604274          n
191  -0.638728007          N
192   0.314170695          b
193  -0.616763746          s
194  -0.169999499          k
195  -0.949336525          f
196  -0.380315478          w
197   0.048493928          j
198  -0.157764749          D
199   0.028228890          j
200   1.640567503          v
201   1.292829890          v
202   0.236064462          T
203  -0.167419312          e
204   1.121490936          c
205  -1.093215902          p
206  -0.328103752          C
207  -0.403603130          q
208   0.052372283          b
209   1.781255758          x
210   1.703887578          X
211   1.016430823          K
212   0.641390858          m
213   1.883451088          L
214  -1.002575374          l
215  -0.326536637          R
216   1.692018201          k
217  -0.490644010          K
218   0.525260790          v
219   0.158733778          Y
220   0.043191009          n
221  -0.952096242          T
222   0.705996808          z
223  -0.894460526          n
224   2.251532744          i
225   0.148711989          u
226  -0.376057523          Q
227  -0.019161384          h
228  -1.164344821          z
229  -1.331295333          j
230   0.605055699          S
231  -0.024534293          H
232   1.316279787          S
233  -0.329771220          M
234   0.606643600          s
235  -0.839629182          i
236  -1.735490742          v
237   0.628402562          A
238   1.915210321          K
239   0.704586475          j
240   0.557170170          o
241  -0.593917343          D
242  -0.654603118          s
243  -0.695652581          O
244  -0.235383160          n
245   1.063234422          b
246  -1.450429767          A
247  -0.328318600          N
248  -0.193453733          F
249  -0.585635060          M
250   0.231052965          m
251   1.326032563          I
252  -1.496760923          N
253   0.347278462          Q
254  -1.052744694          W
255  -0.475215996          U
256  -2.494032118          p
257  -0.621702122          u
258   0.580162867          y
259  -0.138298766          A
260   0.314065320          c
261  -1.486264244          K
262  -0.417898519          Y
263   1.109871929          m
264   0.795673380          T
265   0.685384631          X
266  -0.414322404          O
267   1.466414398          b
268  -1.098494116          T
269  -0.542745888          y
270  -0.944311912          P
271  -1.084834644          I
272  -0.521390280          u
273   0.333615233          t
274  -0.839477228          B
275  -0.889527478          P
276   1.344593931          I
277   0.959932713          b
278   0.650256574          w
279   0.962042041          e
280   0.557918594          B
281  -1.346191008          n
282  -0.986687123          N
283   0.143724057          E
284   0.002510707          P
285   1.993013846          C
286   1.203753923          n
287  -0.460694329          G
288   0.759366726          O
289  -0.668468968          P
290  -1.037264470          c
291  -0.460967031          q
292   2.272317486          o
293  -1.373574362          c
294  -0.517925189          M
295   1.073843339          B
296   0.516282732          X
297   1.608121496          A
298  -0.027937976          C
299  -0.325343620          C
300  -1.246448527          Z
301  -1.001777940          p
302   0.717107478          l
303   0.977778761          h
304   0.043786963          P
305   1.177398849          u
306   1.805278239          k
307  -1.716258934          R
308   0.412172751          b
309   0.407780021          n
310   0.649621008          M
311  -1.481721228          y
312  -1.096340978          u
313   0.541599942          l
314   0.691964543          a
315   1.650262962          k
316   0.091847751          O
317  -3.115819839          q
318   0.902635936          f
319  -0.595136299          f
320  -2.318017807          U
321  -1.398210641          m
322  -0.237510402          c
323   1.173390597          y
324   1.091041648          n
325  -1.657738932          q
326  -1.088631343          T
327   0.158132216          K
328   1.159510608          x
329   1.587189895          E
330   0.037710600          Y
331  -1.365758425          c
332   1.519827229          P
333  -0.178652280          O
334  -0.417099761          j
335   0.148803663          Z
336  -0.189018418          d
337   0.290031176          F
338   0.001309150          f
339  -0.263861170          C
340   0.200235651          Q
341  -1.863894587          N
342  -0.660395593          C
343   0.307922758          l
344  -0.835179025          p
345   0.932083466          B
346   0.237584939          t
347  -0.104622438          j
348  -0.021570107          c
349   0.664001166          h
350   0.004145792          Q
351  -0.574115584          z
352  -0.432584897          v
353  -1.378890021          K
354  -0.177184744          H
355  -0.380044741          N
356   0.473970541          Y
357   1.088087053          I
358   1.268748637          a
359   0.927023685          B
360  -0.107452876          u
361  -0.416514105          s
362  -0.794751138          H
363  -1.937970604          o
364  -0.401741390          f
365   0.624075259          n
366   0.048360184          a
367   1.080127082          R
368   1.364232457          c
369  -0.442282823          T
370   1.177600590          Z
371  -0.717366653          C
372  -0.318240612          D
373  -1.371910116          r
374  -1.769147292          E
375   1.413203708          O
376   0.805192020          W
377   0.352113333          j
378   0.099570158          n
379   0.830711215          B
380  -1.910642804          C
381   0.588340770          I
382  -0.452297498          a
383  -1.312362145          d
384   0.097961307          a
385  -1.158808655          I
386  -0.375178627          U
387  -0.214700377          I
388  -0.857581058          w
389  -0.872932194          V
390  -1.992347212          s
391   0.700744420          u
392  -0.191463005          I
393  -1.604742236          i
394  -0.193386825          i
395  -1.046205973          L
396   0.859664187          g
397  -0.302557993          a
398   0.436645126          E
399   1.147917826          v
400   0.902395179          H
401   0.806343621          z
402  -1.580395440          r
403   0.545764561          W
404   0.765974955          i
405  -1.068779244          C
406   1.596084938          B
407  -1.544011867          T
408  -0.551192281          s
409  -0.056880399          p
410  -0.142215000          g
411   0.310611411          y
412  -0.372834275          F
413   0.479596385          T
414  -0.968875204          t
415  -1.876996855          k
416   1.172802483          E
417   0.084979085          y
418   0.634220756          r
419  -0.577542495          M
420   0.634674362          O
421  -2.084987236          u
422  -0.051791735          T
423  -1.212781819          D
424   1.107379300          O
425   0.858844314          r
426   0.127744571          b
427  -2.085859619          v
428   0.125488010          o
429   0.154553797          X
430   1.296228208          Q
431   1.063998811          R
432  -0.719565881          j
433   0.576094696          R
434   0.718160793          t
435   1.532914243          U
436   0.305504204          W
437  -0.620507328          n
438   0.361540794          b
439  -1.110572871          I
440   0.223470051          e
441  -1.163096847          I
442  -0.248910790          F
443   1.701907748          E
444   1.417001862          r
445   0.814009411          g
446   1.056078026          Y
447   0.507251422          h
448  -1.336659085          m
449  -0.151828428          D
450  -0.841211306          C
451   1.136691374          V
452   0.065055387          r
453   1.838260042          f
454  -0.556639554          B
455   0.413476106          D
456  -0.259798285          E
457  -0.450451850          S
458  -0.077006721          l
459  -0.756769772          e
460   1.091261384          Q
461   0.685135716          H
462   0.343649819          E
463   1.932776689          a
464  -0.574971407          c
465  -0.604732151          h
466  -0.125089391          J
467   0.334690645          F
468  -1.764335970          e
469   0.262364698          A
470  -1.460685574          I
471  -0.269871038          x
472  -0.182831192          S
473  -0.447436874          M
474  -0.478829840          R
475   0.198011282          E
476  -0.091270936          l
477  -0.633982488          a
478  -0.167038752          Z
479  -0.822856293          t
480   1.156638314          G
481   1.015690267          W
482  -0.739827003          k
483  -0.433847896          G
484   0.202527268          J
485  -0.509995649          a
486  -1.494932813          q
487   0.965033134          o
488  -0.493696684          Y
489  -1.617068071          I
490  -1.178758761          g
491  -1.623965126          s
492   0.041216110          l
493   1.575623218          g
494   0.593603925          d
495   0.740302455          U
496   0.619804513          z
497   0.148003779          H
498  -1.029926935          U
499   0.313117875          V
500  -0.547414879          b
501  -0.679246555          p
502   0.699376906          r
503   0.033446175          s
504   0.780584790          V
505  -0.305499626          g
506   0.250181172          u
507   0.701481414          a
508  -0.881580809          P
509  -0.225597289          j
510  -0.511247106          R
511  -1.032505781          A
512  -0.322727697          x
513   0.316959787          H
514   0.632896622          B
515  -0.244425668          l
516   0.620010954          n
517   0.931396513          g
518   0.740893367          T
519   0.038504757          t
520   2.000529104          T
521  -0.120667156          y
522  -0.012464671          g
523   0.202978134          h
524   0.595542342          h
525   0.013554617          y
526   2.022747161          j
527   1.206423084          w
528  -0.063799045          b
529   1.677151074          S
530  -0.264447407          i
531   0.919881100          u
532  -1.051911675          H
533   0.051984042          i
534   0.509884042          L
535  -0.645510014          M
536  -0.340037820          g
537   0.084143818          j
538  -1.132891259          S
539   0.768829618          A
540   2.530919047          I
541  -0.193011051          f
542   0.482617863          q
543  -0.333914751          l
544  -1.053754886          g
545  -1.068216302          i
546   0.609651996          M
547  -1.195956229          I
548   0.402640101          G
549   0.679834592          L
550  -0.385131662          z
551   0.497114371          D
552   1.769649301          D
553  -0.250272608          j
554  -1.249308268          N
555  -1.003715686          u
556   0.095653641          Z
557   0.167394284          O
558  -0.560028763          u
559   1.244764473          g
560  -1.119383441          s
561  -0.208206190          a
562  -0.774311084          k
563  -1.007738783          Q
564  -1.483961385          P
565   0.037313826          n
566   1.777649257          v
567   1.241288507          v
568   1.065200348          D
569   0.868222948          p
570  -0.033838794          d
571  -0.181870315          c
572   1.679065361          T
573  -0.487352520          c
574  -0.149707787          k
575   2.140268906          E
576   0.083065327          h
577   2.014962059          g
578  -1.882850837          R
579   0.924466287          I
580   0.887261383          k
581   0.319232730          s
582  -2.309344503          o
583   1.271973422          y
584  -0.772503717          V
585   0.852146199          i
586   1.652170406          O
587   0.311108936          q
588  -1.253016196          g
589   0.838980477          P
590  -0.394433167          n
591   0.815640703          p
592  -0.607495962          f
593  -1.042248866          O
594   0.791165626          Z
595   1.239945621          h
596   0.497346967          P
597   0.990686100          S
598  -0.629216390          D
599  -1.039920308          v
600   1.810645885          k
601   0.081952779          Y
602  -1.490714852          y
603   1.530005890          g
604  -0.101136524          R
605   0.987766109          a
606   2.765912520          L
607  -0.182632335          z
608  -0.819131268          d
609  -0.724139166          C
610  -0.416447780          P
611  -1.247223535          u
612   0.553986894          g
613  -0.980935106          N
614  -0.731422779          j
615  -2.955773217          d
616  -0.904263461          J
617   1.598463245          d
618   0.576846422          p
619   0.355495613          F
620   1.066003311          y
621  -0.734362793          s
622   0.539906127          M
623  -1.323547728          r
624  -1.555613576          e
625   0.545799557          G
626  -1.914509515          C
627   1.158293884          l
628  -0.187215726          Q
629  -0.652620773          e
630   0.812484476          U
631   1.731076474          Q
632  -0.040298656          D
633   1.409756375          h
634   0.368975554          B
635  -1.683135067          l
636  -0.452598133          V
637   1.292911766          z
638  -0.408594544          Y
639   0.222846165          O
640   0.842863586          c
641   0.585845175          u
642   0.541396533          p
643   0.968483752          A
644  -0.687938638          D
645   1.650416486          w
646   1.393647916          B
647   1.660440275          H
648  -0.431140636          U
649   0.114543929          m
650   0.105936536          r
651   0.619404140          L
652  -2.055718071          o
653  -0.773583771          K
654  -1.640643904          a
655  -0.801876401          b
656  -0.209788991          C
657  -0.997350747          v
658   0.125666015          N
659  -1.016784855          B
660  -1.793460626          V
661   1.477381609          w
662   1.410494581          a
663  -1.224819763          p
664   0.851817924          g
665   0.143992371          m
666  -0.427390914          v
667  -0.055160196          m
668   0.495678720          j
669   0.525409849          i
670   0.394118148          S
671   2.800009083          Z
672   1.818596133          N
673  -0.122484584          l
674   1.512288810          Q
675   1.599210238          s
676  -1.151738881          s
677   0.672130937          x
678   0.652294221          i
679  -0.530099216          Z
680   0.595881554          u
681  -1.575041515          B
682   0.221798804          h
683  -0.284120693          N
684  -0.259443137          V
685  -0.713512822          l
686   1.435801158          S
687  -0.831787004          K
688   0.853072324          J
689  -0.857214854          q
690  -1.075596853          L
691   1.805382890          D
692   1.422297900          c
693   0.962937067          Q
694  -1.578841314          Q
695  -1.322906054          X
696  -0.800459136          n
697  -1.522138383          S
698   0.836592340          X
699   0.045788402          R
700  -0.275247578          f
701   0.917168145          H
702   0.162686600          P
703  -0.114206163          C
704   0.806035470          j
705   2.132647321          a
706  -0.962672943          V
707  -1.201414853          V
708   0.876124892          K
709   1.049553896          i
710   0.953379442          v
711   0.123202776          B
712  -0.823121605          h
713  -0.263874307          y
714  -1.222729108          x
715   1.420353177          D
716  -0.044979486          m
717   0.707160747          K
718   0.688774891          p
719  -0.920200469          A
720  -1.401961863          S
721   0.550912768          g
722   0.955215271          k
723  -1.686472396          m
724  -0.544397775          P
725   1.375395916          G
726   1.566346617          p
727   0.325425538          j
728  -0.362138572          I
729  -1.044403863          I
730  -1.055355621          k
731  -3.181552383          N
732   0.646292432          h
733   0.587007281          b
734   1.064679780          I
735   0.602440043          U
736   1.358961508          w
737   0.488772510          Y
738   1.370619300          w
739   1.720144903          z
740  -0.984322736          X
741  -0.230976681          y
742  -0.081892037          X
743  -0.920843821          V
744  -0.995688498          D
745  -2.359742944          x
746   0.628996427          P
747  -1.953494049          E
748  -0.244165345          i
749   0.177812514          S
750   1.248375696          X
751  -0.203098978          e
752  -1.125328340          Y
753   2.367888518          I
754   1.074424421          Q
755  -0.217304611          J
756   2.619775459          A
757   0.908622539          Q
758   1.586895846          k
759  -0.394844743          d
760   0.466117680          u
761   0.182014001          X
762   0.070117350          Q
763   0.479507689          B
764  -1.123696348          b
765   2.063324569          L
766   0.299029224          G
767  -0.769396874          n
768  -0.206151740          f
769   1.081494874          p
770  -0.609600069          o
771   1.476626696          K
772   0.992249945          E
773   0.099699085          Z
774   0.376744749          o
775  -0.210431625          K
776  -0.606135936          N
777  -1.086532200          h
778   0.809815115          t
779  -1.490128537          m
780   1.475585470          h
781   1.921203617          g
782   1.236309837          x
783  -0.248426631          l
784   0.923005920          t
785  -1.281331055          C
786  -0.369979498          Y
787   1.693186055          d
788  -1.287240502          F
789   0.291905660          e
790   0.906292095          H
791   2.489961459          C
792  -0.987649955          L
793  -0.017481729          f
794   1.495265301          j
795   0.105284423          x
796   0.298523238          R
797   1.019259180          W
798  -0.080745784          N
799  -0.473852267          S
800   1.261624879          Q
801   0.546290368          P
802  -0.130926938          Z
803   0.071263464          n
804   0.377925236          U
805   0.702357279          d
806  -0.784800833          u
807   1.661947717          H
808  -0.776289988          l
809   1.335125357          c
810  -1.052935796          P
811  -1.708619110          w
812   0.037539671          k
813  -0.333951262          Y
814   0.221529379          A
815   0.082900687          h
816   0.588804049          R
817  -0.573079184          q
818   0.824884143          z
819   0.250151666          w
820   1.579373229          Y
821   1.556879345          G
822  -0.137416267          A
823  -0.540148464          p
824   0.102269176          D
825   0.928399641          a
826   0.641180643          D
827  -0.066139265          D
828  -0.989786839          L
829  -0.536694690          R
830   1.106156350          i
831   0.942483736          y
832   0.177007703          Q
833   1.203967257          O
834   0.948286673          f
835   0.799979441          g
836  -2.304673680          Y
837  -0.023715502          e
838   0.481754984          t
839  -0.650599097          V
840   0.654892453          z
841  -0.370317498          t
842  -1.746023716          N
843   0.467319560          F
844  -0.346355135          y
845   1.051643456          U
846   0.438254866          L
847  -0.641184424          w
848  -0.073402185          s
849   0.106784886          n
850   0.675069775          Y
851   0.758303864          b
852   0.367497853          a
853  -0.723419493          r
854  -1.011429914          B
855   0.274029041          E
856   1.008339967          F
857  -0.402124850          r
858   1.046931383          n
859   0.350245683          m
860  -1.025152052          E
861  -0.228563710          L
862   0.741523680          j
863  -0.437829401          I
864  -1.074552762          c
865  -0.951775088          E
866  -1.482993690          T
867  -0.407667790          r
868  -1.320795697          s
869  -0.001228625          h
870  -1.398893607          Z
871   0.624517084          n
872  -0.671385240          q
873   0.189345672          w
874   0.040714376          X
875   1.305288073          R
876  -1.609468298          n
877   0.335413238          U
878   0.522214618          j
879   0.293636552          e
880  -0.856918509          v
881   0.477926181          t
882  -0.456438222          C
883  -1.254528320          c
884  -0.451006187          k
885   0.598004527          r
886  -1.119342949          a
887  -1.898302614          J
888  -0.116946109          z
889  -0.186300318          j
890  -1.139812776          v
891   0.899906452          W
892  -0.691189145          y
893  -0.972716308          a
894   0.552293525          b
895   0.253251842          c
896  -0.036829017          T
897  -0.639971085          g
898   0.358573219          T
899  -0.112767256          b
900  -1.661031014          W
901  -1.649215506          H
902   0.214078263          r
903   0.112887230          u
904   0.682348460          z
905   1.300040111          k
906  -1.279122194          n
907   1.444619635          u
908  -1.174262552          n
909   0.477689866          f
910   0.747193737          G
911   0.819417051          h
912   1.129073092          s
913   0.289365265          W
914  -0.130478228          X
915  -0.883567691          V
916   0.247138539          e
917   1.401042352          R
918   0.053925679          B
919   0.233462951          w
920   0.556186642          j
921   0.337669218          T
922   0.635511943          a
923   0.361658545          f
924   0.427927521          N
925   0.888602845          L
926   0.896962170          F
927   1.244908398          e
928  -1.352215882          O
929   1.745644906          k
930   0.392987599          g
931   2.275003551          r
932   0.176114766          v
933   0.672458087          k
934  -0.676126216          h
935  -0.645599703          q
936  -0.707769677          L
937  -0.430994254          U
938   0.592234306          Q
939  -0.521718813          E
940   0.303268977          d
941  -0.793761249          h
942   0.010511626          p
943  -0.306686306          z
944  -0.109612189          u
945   1.246749817          H
946   0.186763472          f
947  -0.539017391          j
948   0.080841729          F
949  -0.091251730          P
950  -0.191961945          T
951  -1.137698406          F
952  -1.361452366          v
953  -1.004060125          F
954  -0.204953713          J
955  -0.824023415          x
956  -0.459700702          b
957   1.348643112          Z
958  -1.235297016          N
959  -0.215709299          A
960  -0.036469465          N
961   1.080843570          z
962  -1.341631676          w
963  -0.069039578          K
964   0.926385865          s
965  -1.509231189          O
966  -1.242146804          a
967   1.957905513          e
968  -0.132991351          Z
969  -0.811227082          H
970   1.990562103          H
971  -0.461347316          c
972   1.521569861          a
973  -1.109442903          j
974  -1.791264807          H
975   0.679214334          D
976   0.065807140          Q
977  -1.432241137          y
978   0.420404377          E
979  -1.517449418          t
980  -1.186025803          D
981   0.844790614          H
982   1.796640521          J
983   0.199802678          S
984   0.012547003          H
985  -1.926717222          m
986   0.397519149          Y
987   0.538582525          k
988   1.201371821          r
989  -0.840997924          o
990   0.260304254          r
991  -0.745274332          i
992   0.848349841          y
993  -1.530856377          F
994   0.414540889          w
995  -1.875466250          J
996   0.160521412          w
997   0.226147229          H
998  -0.504376714          t
999   0.274586019          V
1000 -0.208837951          r</code></pre>
</div>
</div>
<p>Quick and easy. I <em>think</em> <code>py_to_r</code> is supposed to do some of this, but I can never get it to work. I think maybe it would make more sense in a script where we’re moving back and forth than here where we have separate code chunks?</p>
</section>
<section id="now-with-time" class="level2">
<h2 class="anchored" data-anchor-id="now-with-time">Now, with time</h2>
<p>Let’s add a column of dates to simpledf. First, create the dates, then add to simpledf.</p>
<div class="cell" data-hash="py_r_dates_cache/html/unnamed-chunk-5_8577d822673dcde92b1692fbf7f8d115">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> datetime</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>dates <span class="op">=</span> []</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>d1 <span class="op">=</span> datetime.datetime.strptime(<span class="st">'2000-01-01'</span>, <span class="st">'%Y-%m-</span><span class="sc">%d</span><span class="st">'</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Because i starts at 0, the first loop is the start date</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1000</span>):</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add i days to the start date</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    day_new <span class="op">=</span> d1 <span class="op">+</span> datetime.timedelta(days<span class="op">=</span>i)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Append the current date string to the list of dates</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    dates.append(day_new)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>timedf <span class="op">=</span> simpledf.assign(date <span class="op">=</span> dates)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Try another way too</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>timedf[<span class="st">'date2'</span>] <span class="op">=</span> pd.to_datetime(timedf[<span class="st">'date'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, when we bring it into R, it just works? That’s not at all what happened to me when I had the original issue.</p>
<div class="cell" data-hash="py_r_dates_cache/html/unnamed-chunk-6_1a66193f09603d8d1d3893ef9561f517">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>timedfR <span class="ot">&lt;-</span> py<span class="sc">$</span>timedf</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># tibble::as_tibble(timedfR)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="for-future-reference" class="level2">
<h2 class="anchored" data-anchor-id="for-future-reference">For future reference</h2>
<p>So, I can’t seem to replicate the issue. Previously, the datetime col came in as a list-col into a tibble, and was wrapped in a python environment. It was possible to parse it with <code>purrr</code> (or <code>lapply</code>, but <code>purrr</code> was <em>much</em> faster (and weirdly, <code>furrr</code> was slower). Not running, because this <em>isn’t</em> in a python env, and so this doesn’t actually work.</p>
<div class="cell" data-hash="py_r_dates_cache/html/unnamed-chunk-7_905525e534931e0202728754dd11db6a">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>demodates <span class="ot">&lt;-</span> timedfR<span class="sc">$</span>date</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>rdates <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map</span>(demodates, py_to_r) <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">.name_repair =</span> <span class="sc">~</span><span class="st">'Date'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="at">cols =</span> Date)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>But what was much faster was to convert the column to strings in python with</p>
<div class="cell" data-hash="py_r_dates_cache/html/unnamed-chunk-8_7fda653abcf2482162e7e7916cf45a01">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>timedf[<span class="st">'date_str'</span>] <span class="op">=</span> timedf[<span class="st">'date'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>timedf.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 1000 entries, 0 to 999
Data columns (total 5 columns):
 #   Column      Non-Null Count  Dtype         
---  ------      --------------  -----         
 0   rand_nums   1000 non-null   float64       
 1   rand_chars  1000 non-null   object        
 2   date        1000 non-null   datetime64[ns]
 3   date2       1000 non-null   datetime64[ns]
 4   date_str    1000 non-null   object        
dtypes: datetime64[ns](2), float64(1), object(2)
memory usage: 39.2+ KB</code></pre>
</div>
</div>
<p>And then <code>lubridate</code> back to dates in R</p>
<div class="cell" data-hash="py_r_dates_cache/html/unnamed-chunk-9_6c9f94f61bf9dd4e7e1803f5ee6871c0">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>timedfRstr <span class="ot">&lt;-</span> py<span class="sc">$</span>timedf</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>timedfRstr <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">select</span>(timedfRstr, <span class="sc">-</span>date) <span class="sc">|&gt;</span> </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">date =</span> lubridate<span class="sc">::</span><span class="fu">ymd</span>(date_str))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(timedfRstr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   1000 obs. of  5 variables:
 $ rand_nums : num  -0.852 0.699 1.088 -0.126 -1.38 ...
 $ rand_chars: chr  "C" "h" "c" "v" ...
 $ date2     : POSIXct, format: "2000-01-01 11:00:00" "2000-01-02 11:00:00" ...
 $ date_str  : chr  "2000-01-01" "2000-01-02" "2000-01-03" "2000-01-04" ...
 $ date      : Date, format: "2000-01-01" "2000-01-02" ...
 - attr(*, "pandas.index")=RangeIndex(start=0, stop=1000, step=1)</code></pre>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>