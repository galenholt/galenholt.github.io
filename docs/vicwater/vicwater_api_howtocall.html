<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Galen Holt">

<title>Galen - Vicwater api crude testing</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Galen</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../research.html">
 <span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../code_demos.html" aria-current="page">
 <span class="menu-text">Code Demos</span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Vicwater api crude testing</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../code_demos.html" class="sidebar-item-text sidebar-link">Code Demos</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Small how-tos</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../small_helpers/smallpieces.html" class="sidebar-item-text sidebar-link">Bits and pieces</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../small_helpers/quarto_notes.html" class="sidebar-item-text sidebar-link">Quarto notes</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../setup/rstudio_themes.html" class="sidebar-item-text sidebar-link">Editing Rstudio themes</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../small_helpers/zip_downloading.html" class="sidebar-item-text sidebar-link">Download and unpack zips</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../small_helpers/json_api_construction.html" class="sidebar-item-text sidebar-link">Building JSON syntax from R for API calls</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Plotting</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../plotting/tweaks_tricks.html" class="sidebar-item-text sidebar-link">Saving and themeing plots</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../plotting/hcl_exploration.html" class="sidebar-item-text sidebar-link">Exploring HCL colorspace</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../plotting/rgb_to_hex.html" class="sidebar-item-text sidebar-link">Converting RGB to hex colors</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../plotting/fonts.html" class="sidebar-item-text sidebar-link">Fonts</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../plotting/faded_colors.html" class="sidebar-item-text sidebar-link">Faded 2d colour ramps</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../plotting/math_in_ggplot.html" class="sidebar-item-text sidebar-link">Latex in ggplot with latex2exp</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">Theory and simulation</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../simmodelling/twoDautocorr.html" class="sidebar-item-text sidebar-link">Generate 2d autocorrelation</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">Drones</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../drones/overlaps_reactive.html" class="sidebar-item-text sidebar-link">Calculations for flight planning</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../drones/overlaps.html" class="sidebar-item-text sidebar-link">Figuring out flight plan calcs</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pix4d/read_pix4d_outputs.html" class="sidebar-item-text sidebar-link">Reading and plotting pix4d outputs</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">Observable</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../observable/trying_observable.html" class="sidebar-item-text sidebar-link">Figuring out how to use ojs chunks</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">R and python</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/python_setup.html" class="sidebar-item-text sidebar-link">Python environments with pyenv and poetry</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/python_updated_functions.html" class="sidebar-item-text sidebar-link">Small python bits</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/RandPython.html" class="sidebar-item-text sidebar-link">Using R and python together</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/R_py_shared_projects.html" class="sidebar-item-text sidebar-link">Shared R-py project structure</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/py_r_dates.html" class="sidebar-item-text sidebar-link">Passing complex objects py-R</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/R_py_type_passing.html" class="sidebar-item-text sidebar-link">Passing types between R and python</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/py_r_project_overview.html" class="sidebar-item-text sidebar-link">Overview of building R-py package</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/R_py_package.html" class="sidebar-item-text sidebar-link">Wrapping python in R package</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">Setting up projects</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/rig.html" class="sidebar-item-text sidebar-link">Managing old R versions with rig</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/quarto_website_github.html" class="sidebar-item-text sidebar-link">Getting this website working</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/managingprivate.html" class="sidebar-item-text sidebar-link">Private data for website repo</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../setup/R_in_VS.html" class="sidebar-item-text sidebar-link">Using R in VScode</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="true">Building packages</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../package/package_creation.html" class="sidebar-item-text sidebar-link">First pass at building a package</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vicwater/vicwater_testing.html" class="sidebar-item-text sidebar-link">Testing VicWater API</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="true">Data</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../data_acquisition/bom_gauges.html" class="sidebar-item-text sidebar-link">BOM gauge locations with httr2</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vicwater/vicwater_api_howtocall.html" class="sidebar-item-text sidebar-link active">Experimenting with API calls for {vicwater}</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#this-file" id="toc-this-file" class="nav-link active" data-scroll-target="#this-file">This file</a>
  <ul class="collapse">
  <li><a href="#access-victoria-water-data-through-api" id="toc-access-victoria-water-data-through-api" class="nav-link" data-scroll-target="#access-victoria-water-data-through-api">Access Victoria water data through API</a></li>
  <li><a href="#httr2" id="toc-httr2" class="nav-link" data-scroll-target="#httr2">httr2</a></li>
  </ul></li>
  <li><a href="#testing-queries" id="toc-testing-queries" class="nav-link" data-scroll-target="#testing-queries">Testing queries</a></li>
  <li><a href="#how-does-the-api-work" id="toc-how-does-the-api-work" class="nav-link" data-scroll-target="#how-does-the-api-work">How does the API work?</a>
  <ul class="collapse">
  <li><a href="#querying-options" id="toc-querying-options" class="nav-link" data-scroll-target="#querying-options">Querying options</a>
  <ul class="collapse">
  <li><a href="#datasources" id="toc-datasources" class="nav-link" data-scroll-target="#datasources">Datasources</a></li>
  <li><a href="#sitelist" id="toc-sitelist" class="nav-link" data-scroll-target="#sitelist">Sitelist</a></li>
  <li><a href="#variables" id="toc-variables" class="nav-link" data-scroll-target="#variables">Variables</a></li>
  </ul></li>
  <li><a href="#location-etc" id="toc-location-etc" class="nav-link" data-scroll-target="#location-etc">Location etc</a>
  <ul class="collapse">
  <li><a href="#can-we-get-a-list-of-all-sites-and-all-variables" id="toc-can-we-get-a-list-of-all-sites-and-all-variables" class="nav-link" data-scroll-target="#can-we-get-a-list-of-all-sites-and-all-variables">Can we get a list of all sites and all variables?</a></li>
  </ul></li>
  <li><a href="#getting-timeseries" id="toc-getting-timeseries" class="nav-link" data-scroll-target="#getting-timeseries">Getting timeseries</a>
  <ul class="collapse">
  <li><a href="#can-we-get-derived-141-etc-with-varlist" id="toc-can-we-get-derived-141-etc-with-varlist" class="nav-link" data-scroll-target="#can-we-get-derived-141-etc-with-varlist">Can we get derived (141, etc) with varlist</a></li>
  </ul></li>
  <li><a href="#geolocation" id="toc-geolocation" class="nav-link" data-scroll-target="#geolocation">Geolocation</a></li>
  <li><a href="#db-info" id="toc-db-info" class="nav-link" data-scroll-target="#db-info">DB info</a>
  <ul class="collapse">
  <li><a href="#geofiltering-the-db-to-select-sites" id="toc-geofiltering-the-db-to-select-sites" class="nav-link" data-scroll-target="#geofiltering-the-db-to-select-sites">Geofiltering the db to select sites</a></li>
  </ul></li>
  <li><a href="#get-all-gauges" id="toc-get-all-gauges" class="nav-link" data-scroll-target="#get-all-gauges">Get all gauges</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Vicwater api crude testing</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Galen Holt </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<div class="cell" data-hash="vicwater_api_howtocall_cache/html/setup_f4e93d7eba918f30e825987d7b9aada4">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_knit<span class="sc">$</span><span class="fu">set</span>(<span class="at">root.dir =</span> rprojroot<span class="sc">::</span><span class="fu">find_rstudio_root_file</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="this-file" class="level1">
<h1>This file</h1>
<p>This is VERY early-stage crude working through how to call the vicwater API. Lots of the code chunks fail because it’s testing.</p>
<p>But, it has some potentially useful successes and checks.</p>
<section id="access-victoria-water-data-through-api" class="level2">
<h2 class="anchored" data-anchor-id="access-victoria-water-data-through-api">Access Victoria water data through API</h2>
<p>We want to access <a href="https://data.water.vic.gov.au/static.htm">victorian water data</a> for a set of sites. That requires using the api at <strong>https://data.water.vic.gov.au/cgi/webservice.exe?[JSON_request]</strong> , but it’s poorly documented, and I’ve maybe done one API call ever. Time to figure this out. Will start by piggybacking on the <code>mdba-gauge-getter</code> python that gets water levels as a starting point and then try to get other data.</p>
<p>First, how do we make an API request? Most tutorials use twitter or github, which are well-documented. But let’s try something similar.</p>
<p><code>purrr</code> conflicts with <code>jsonlite::flatten</code>, so don’t load <code>tidyverse</code>.</p>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-1_e4802cfc25463b96f2dd60716de650dc">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'ggplot2' was built under R version 4.2.2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Actually end up using</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'httr2' was built under R version 4.2.2</code></pre>
</div>
</div>
<p>Looks like the first thing is the base url. The web says it’s this, and the mdba-gauge-getter uses the same, and then appends json_data</p>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-2_ab92b5a969755d6b5a1ef584ee0d5034">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>vicurl <span class="ot">&lt;-</span> <span class="st">"https://data.water.vic.gov.au/cgi/webservice.exe?"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I guess I need to specify something to get. But there is no documentation I can find for what the parameters are. The gauge-getter has a few, so I guess start picking things apart.</p>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-3_320f7a255e4ef08db1df1e40663ffbf1">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"site_list"</span> <span class="ot">=</span> <span class="st">'232202'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-4_8fb098b74258153d7d92b515474e537a">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>response <span class="ot">&lt;-</span> <span class="fu">GET</span>(vicurl, <span class="at">query =</span> params)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>response</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Response [https://data.water.vic.gov.au/cgi/webservice.exe?site_list=232202]
  Date: 2022-12-07 02:36
  Status: 200
  Content-Type: text/html
  Size: 103 B</code></pre>
</div>
</div>
<p>Following the R api <a href="https://cran.r-project.org/web/packages/httr/vignettes/api-packages.html">vignette</a>,</p>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-5_6827a202c92e2b35e7659bdaf2429867">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>parsed <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(<span class="fu">content</span>(response, <span class="st">'text'</span>), <span class="at">simplifyVector =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>No encoding supplied: defaulting to UTF-8.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>parsed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$error_num
[1] 120

$error_msg
[1] "Missing top-level \"version\" item\r\nMissing top-level \"params\" item"</code></pre>
</div>
</div>
<p>Interesting. It looked like it returned 200 (good) when I printed response and when I look at it in the View, but actually had errors. Where ARE these results?</p>
<p>so, can we add those missing ‘top-level’ items? I see now that the gauge-getter has a two-level dict</p>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-6_597c5b08965db074bbbd19e9b8024a59">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"version"</span> <span class="ot">=</span> <span class="st">'2'</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>response <span class="ot">&lt;-</span> <span class="fu">GET</span>(vicurl, <span class="at">params =</span> params)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>parsed <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(<span class="fu">content</span>(response, <span class="st">'text'</span>), <span class="at">simplifyVector =</span> <span class="cn">FALSE</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>parsed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Try the example. can’t get it to even be a character vector</p>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-7_8da6399c76a322d0987d0fb4b452dadc">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># demourl &lt;- https://data.water.vic.gov.au/cgi/webservice.exe?{"function":"get_db_info","version":"3","params":{"table_name":"site","return_type":"hash","filter_values":{"station":"221001"</span><span class="re">}}}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-8_ee2e87b6126bd9b1f177d5288df53088">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"function"</span> <span class="ot">=</span> <span class="st">'get_db_info'</span>,</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"version"</span> <span class="ot">=</span> <span class="st">"3"</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>response <span class="ot">&lt;-</span> <span class="fu">GET</span>(vicurl, <span class="at">query =</span> params)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>parsed <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(<span class="fu">content</span>(response, <span class="st">'text'</span>), <span class="at">simplifyVector =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>No encoding supplied: defaulting to UTF-8.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>parsed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$error_num
[1] 122

$error_msg
[1] "Parameter error(s) for function get_db_info:Missing: table_name"</code></pre>
</div>
</div>
<p>Well, that’s a start. at least I’m not getting the top-level errors. Can i just smash that whole demo into a single params list? without the sublists of ‘params’ and ‘filter_values’?</p>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-9_eca90da5800a5a88ce9bd3048b0f6c38">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># params &lt;- list("function" = 'get_db_info',</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co">#                "version" = "3",</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co">#                "table_name" = "site",</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co">#                "station" = "221001")</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co"># response &lt;- GET(vicurl, query = params)</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co"># # The parsed barfs</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="co"># # parsed &lt;- fromJSON(content(response, 'text'), simplifyVector = FALSE)</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="co"># # parsed</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="co"># response</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>What am I actually asking for here? <code>GET</code> is using <code>modify_url</code></p>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-10_f63a02ff4a502174329c8b767b8cd255">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">modify_url</span>(vicurl, <span class="at">query =</span> params)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "https://data.water.vic.gov.au/cgi/webservice.exe?function=get_db_info&amp;version=3"</code></pre>
</div>
</div>
<p>So that’s using the <a href="https://kisters.com.au/doco/Configuring%20and%20Using%20Web%20Services.htm">’conventional parameter pairs</a>’ option here, not the json . How do I generate some json so I can see if I’m matching the format? <code>auto_unbox = TRUE</code> is needed to not wrap the second values in brackets.</p>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-11_21911f15c35b722a6c9e8e2c3bf4214d">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">toJSON</span>(params, <span class="at">auto_unbox =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{"function":"get_db_info","version":"3"} </code></pre>
</div>
</div>
<p>OK, so that looks vaguely right, but not leveled. Can we do lists of lists?</p>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-12_d34aba12a4854e70149bd85b0d2d2bb5">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>nestparams <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"function"</span> <span class="ot">=</span> <span class="st">'get_db_info'</span>,</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"version"</span> <span class="ot">=</span> <span class="st">"3"</span>,</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">"params"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"table_name"</span> <span class="ot">=</span> <span class="st">"site"</span>,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"return_type"</span> <span class="ot">=</span> <span class="st">"hash"</span>,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"filter_values"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"station"</span> <span class="ot">=</span> <span class="st">"221001"</span>)))</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="fu">toJSON</span>(nestparams, <span class="at">auto_unbox =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{"function":"get_db_info","version":"3","params":{"table_name":"site","return_type":"hash","filter_values":{"station":"221001"}}} </code></pre>
</div>
</div>
<p>Whoa! that looks right. Now, let’s try it. It immediately fails to just use <code>GET</code>. try looking at <code>modify_url</code> to see why.</p>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-13_434263d2a3e6014b1b4a8f6e484c2579">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>jsonbit <span class="ot">&lt;-</span> <span class="fu">toJSON</span>(nestparams, <span class="at">auto_unbox =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-14_e2ade718d6c90217bdebf0a4c7be03ec">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">modify_url</span>(vicurl, <span class="at">query =</span> jsonbit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "https://data.water.vic.gov.au/cgi/webservice.exe?{\"function\":\"get_db_info\",\"version\":\"3\",\"params\":{\"table_name\":\"site\",\"return_type\":\"hash\",\"filter_values\":{\"station\":\"221001\"}}}"</code></pre>
</div>
</div>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-15_047ef829ed6b9e6ffe8a56369f2b1de3">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">modify_url</span>(vicurl, <span class="at">path =</span> jsonbit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "https://data.water.vic.gov.au/{\"function\":\"get_db_info\",\"version\":\"3\",\"params\":{\"table_name\":\"site\",\"return_type\":\"hash\",\"filter_values\":{\"station\":\"221001\"}}}"</code></pre>
</div>
</div>
<p>Getting a lot of slashes. does it matter? Maybe?</p>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-16_f6e51c4d8ed40df308d50085667542b0">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">modify_url</span>(vicurl, <span class="at">scheme =</span> nestparams)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "get_db_info://data.water.vic.gov.au/cgi/webservice.exe"                                                                                    
[2] "3://data.water.vic.gov.au/cgi/webservice.exe"                                                                                              
[3] "list(table_name = \"site\", return_type = \"hash\", filter_values = list(station = \"221001\"))://data.water.vic.gov.au/cgi/webservice.exe"</code></pre>
</div>
</div>
<p>Is <code>httpbin</code> a way to test?</p>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-17_1a37ccd32082b8a0d858e8a6000b7201">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>binurl <span class="ot">&lt;-</span> <span class="st">"http://httpbin.org/get"</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>binr <span class="ot">&lt;-</span> <span class="fu">GET</span>(binurl, <span class="at">query =</span> jsonbit)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>binr</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Response [http://httpbin.org/get?{"function":"get_db_info","version":"3","params":{"table_name":"site","return_type":"hash","filter_values":{"station":"221001"}}}]
  Date: 2022-12-07 02:36
  Status: 200
  Content-Type: application/json
  Size: 689 B
{
  "args": {
    "{\"function\":\"get_db_info\",\"version\":\"3\",\"params\":{\"table_name...
  }, 
  "headers": {
    "Accept": "application/json, text/xml, application/xml, */*", 
    "Accept-Encoding": "deflate, gzip", 
    "Host": "httpbin.org", 
    "User-Agent": "libcurl/7.64.1 r-curl/4.3.3 httr/1.4.4", 
    "X-Amzn-Trace-Id": "Root=1-638ffc12-7dab7950495d406217e5071c"
...</code></pre>
</div>
</div>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-18_0b011d878b5909b54bcaa7817d9bb904">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>parsedB <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(<span class="fu">content</span>(binr, <span class="st">'text'</span>), <span class="at">simplifyVector =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>No encoding supplied: defaulting to UTF-8.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>parsedB</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$args
$args$`{"function":"get_db_info","version":"3","params":{"table_name":"site","return_type":"hash","filter_values":{"station":"221001"}}}`
[1] ""


$headers
$headers$Accept
[1] "application/json, text/xml, application/xml, */*"

$headers$`Accept-Encoding`
[1] "deflate, gzip"

$headers$Host
[1] "httpbin.org"

$headers$`User-Agent`
[1] "libcurl/7.64.1 r-curl/4.3.3 httr/1.4.4"

$headers$`X-Amzn-Trace-Id`
[1] "Root=1-638ffc12-7dab7950495d406217e5071c"


$origin
[1] "180.222.17.154"

$url
[1] "http://httpbin.org/get?{\"function\":\"get_db_info\",\"version\":\"3\",\"params\":{\"table_name\":\"site\",\"return_type\":\"hash\",\"filter_values\":{\"station\":\"221001\"}}}"</code></pre>
</div>
</div>
<p>That call looks right.</p>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-19_186e91ffc3bc7ea99be73935760f37d6">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>response <span class="ot">&lt;-</span> <span class="fu">GET</span>(vicurl, <span class="at">query =</span> jsonbit, <span class="at">encode =</span> <span class="st">'json'</span>)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>response</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Response [https://data.water.vic.gov.au/cgi/webservice.exe?{"function":"get_db_info","version":"3","params":{"table_name":"site","return_type":"hash","filter_values":{"station":"221001"}}}]
  Date: 2022-12-07 02:36
  Status: 200
  Content-Type: text/html
  Size: 99 B</code></pre>
</div>
</div>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-20_9d348d796bdfdf17def5656fc2e8bc8d">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>parsed <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(<span class="fu">content</span>(response, <span class="st">'text'</span>), <span class="at">simplifyVector =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>No encoding supplied: defaulting to UTF-8.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>parsed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$error_num
[1] 120

$error_msg
[1] "Request is not well-formed JSON\r\nInput request was not valid JSON"</code></pre>
</div>
</div>
<p>I pasted it in to notebook++ and it’s <em>exactly</em> the same as the example. So, why isn’t it working?</p>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-21_eb1b3628084702042cabac4c0723cd25">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>modurl <span class="ot">&lt;-</span> <span class="fu">modify_url</span>(vicurl, <span class="at">query =</span> jsonbit)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>response <span class="ot">&lt;-</span> <span class="fu">GET</span>(modurl)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>response</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Response [https://data.water.vic.gov.au/cgi/webservice.exe?{"function":"get_db_info","version":"3","params":{"table_name":"site","return_type":"hash","filter_values":{"station":"221001"}}}]
  Date: 2022-12-07 02:36
  Status: 200
  Content-Type: text/html
  Size: 99 B</code></pre>
</div>
</div>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-22_bb45e2db17b6a61c734ade7fe380839f">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>parsed <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(<span class="fu">content</span>(response, <span class="st">'text'</span>), <span class="at">simplifyVector =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>No encoding supplied: defaulting to UTF-8.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>parsed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$error_num
[1] 120

$error_msg
[1] "Request is not well-formed JSON\r\nInput request was not valid JSON"</code></pre>
</div>
</div>
</section>
<section id="httr2" class="level2">
<h2 class="anchored" data-anchor-id="httr2">httr2</h2>
<p>Hmmm. I see Hadley has released a v2. And it has a <code>req_body_json</code>. See if that works</p>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-23_f41d6b7b36f63c699534a98abb14b929">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>req_dry_run</code> lets us see what it’s passing. THat looks right? I think?</p>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-24_402f17e6f806d723d205e7ed5f11df9e">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>req <span class="ot">&lt;-</span> <span class="fu">request</span>(vicurl)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>req <span class="sc">%&gt;%</span> </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(nestparams) <span class="sc">%&gt;%</span> </span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_dry_run</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>POST /cgi/webservice.exe? HTTP/1.1
Host: data.water.vic.gov.au
User-Agent: httr2/0.2.2 r-curl/4.3.3 libcurl/7.64.1
Accept: */*
Accept-Encoding: deflate, gzip
Content-Type: application/json
Content-Length: 129

{"function":"get_db_info","version":"3","params":{"table_name":"site","return_type":"hash","filter_values":{"station":"221001"}}}</code></pre>
</div>
</div>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-25_729ac26b3c30c8f8c9803936036e6a54">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>resp <span class="ot">&lt;-</span> req <span class="sc">%&gt;%</span> </span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(nestparams) <span class="sc">%&gt;%</span> </span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-26_45a2aa1541ef5cbd721ce90f712fe5d5">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>resp <span class="sc">%&gt;%</span> <span class="fu">resp_raw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>HTTP/1.1 200 OK
Date: Wed, 07 Dec 2022 02:36:05 GMT
Content-Type: text/html
Content-Length: 972
Connection: keep-alive
Content-Encoding: gzip
Vary: Accept-Encoding
Server: Microsoft-IIS/10.0
Content: 
Access-Control-Allow-Origin: *

{"error_num":0,"return":{"rows":{"221001":{"category20":"","category19":"","category18":"","category17":"","category16":"","category15":"","category14":"","category13":"","category12":"","category11":"","category10":"N\/A","active":false,"northing":"5887218.000","timezone":"10.0","shortname":"GENOA R @ ROCKTON","datecreate":18991230,"elevdatum":"","stname":"GENOA RIVER @ ROCKTON","category9":"N\/A","category8":"G(S)","category7":"G","category6":"2WD\/4WD","category5":"10","category4":"150","category3":"GRAVEL","category2":"V_70D3","category1":"23","elevacc":"1","dbver47":false,"quarter":"Y","section":0,"commence":19930526,"parent":"","mapname":"MAFFRA","meridian":"","spare5":"","spare4":"","spare3":"","spare2":"N\/A","spare1":"N\/A","posacc":"9","timemod":1642,"region":"221","grdatum":"UTM","township":"","longitude":"149.317296100","comment":" \r\nTurn right from Monaro Highway onto Imlay road signposted 82 km to Eden.  Travel over low level bridge  to a sharp left bend in the road.  A pine plantation  will be directly on the right.  Turn down into plantation and travel approx. 100m2011\/07\/17 Virtual site entry generated by DSEVIRTUALSITE.HSC from details in 221001A\r\n","lldatum":"WGS84","station":"221001","datemod":20221117,"timecreate":0,"orgcode":"DSE","barcode":"Bombala","zone":55,"elev":"429.000","cease":18991230,"local_map":"CRAIGIE","latitude":"-37.138654990","range":"","qquarter":"Y","easting":"705825.000","stntype":"VIR"}}}}</code></pre>
</div>
</div>
<p>I thought it was json? but <code>resp_body_json</code> fails with defaults</p>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-27_856af657be4afda597b9eb1f48676373">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>rj <span class="ot">&lt;-</span> resp <span class="sc">%&gt;%</span> <span class="fu">resp_body_json</span>(<span class="at">check_type =</span> <span class="cn">FALSE</span>)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>rj</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$error_num
[1] 0

$return
$return$rows
$return$rows$`221001`
$return$rows$`221001`$category20
[1] ""

$return$rows$`221001`$category19
[1] ""

$return$rows$`221001`$category18
[1] ""

$return$rows$`221001`$category17
[1] ""

$return$rows$`221001`$category16
[1] ""

$return$rows$`221001`$category15
[1] ""

$return$rows$`221001`$category14
[1] ""

$return$rows$`221001`$category13
[1] ""

$return$rows$`221001`$category12
[1] ""

$return$rows$`221001`$category11
[1] ""

$return$rows$`221001`$category10
[1] "N/A"

$return$rows$`221001`$active
[1] FALSE

$return$rows$`221001`$northing
[1] "5887218.000"

$return$rows$`221001`$timezone
[1] "10.0"

$return$rows$`221001`$shortname
[1] "GENOA R @ ROCKTON"

$return$rows$`221001`$datecreate
[1] 18991230

$return$rows$`221001`$elevdatum
[1] ""

$return$rows$`221001`$stname
[1] "GENOA RIVER @ ROCKTON"

$return$rows$`221001`$category9
[1] "N/A"

$return$rows$`221001`$category8
[1] "G(S)"

$return$rows$`221001`$category7
[1] "G"

$return$rows$`221001`$category6
[1] "2WD/4WD"

$return$rows$`221001`$category5
[1] "10"

$return$rows$`221001`$category4
[1] "150"

$return$rows$`221001`$category3
[1] "GRAVEL"

$return$rows$`221001`$category2
[1] "V_70D3"

$return$rows$`221001`$category1
[1] "23"

$return$rows$`221001`$elevacc
[1] "1"

$return$rows$`221001`$dbver47
[1] FALSE

$return$rows$`221001`$quarter
[1] "Y"

$return$rows$`221001`$section
[1] 0

$return$rows$`221001`$commence
[1] 19930526

$return$rows$`221001`$parent
[1] ""

$return$rows$`221001`$mapname
[1] "MAFFRA"

$return$rows$`221001`$meridian
[1] ""

$return$rows$`221001`$spare5
[1] ""

$return$rows$`221001`$spare4
[1] ""

$return$rows$`221001`$spare3
[1] ""

$return$rows$`221001`$spare2
[1] "N/A"

$return$rows$`221001`$spare1
[1] "N/A"

$return$rows$`221001`$posacc
[1] "9"

$return$rows$`221001`$timemod
[1] 1642

$return$rows$`221001`$region
[1] "221"

$return$rows$`221001`$grdatum
[1] "UTM"

$return$rows$`221001`$township
[1] ""

$return$rows$`221001`$longitude
[1] "149.317296100"

$return$rows$`221001`$comment
[1] " \r\nTurn right from Monaro Highway onto Imlay road signposted 82 km to Eden.  Travel over low level bridge  to a sharp left bend in the road.  A pine plantation  will be directly on the right.  Turn down into plantation and travel approx. 100m2011/07/17 Virtual site entry generated by DSEVIRTUALSITE.HSC from details in 221001A\r\n"

$return$rows$`221001`$lldatum
[1] "WGS84"

$return$rows$`221001`$station
[1] "221001"

$return$rows$`221001`$datemod
[1] 20221117

$return$rows$`221001`$timecreate
[1] 0

$return$rows$`221001`$orgcode
[1] "DSE"

$return$rows$`221001`$barcode
[1] "Bombala"

$return$rows$`221001`$zone
[1] 55

$return$rows$`221001`$elev
[1] "429.000"

$return$rows$`221001`$cease
[1] 18991230

$return$rows$`221001`$local_map
[1] "CRAIGIE"

$return$rows$`221001`$latitude
[1] "-37.138654990"

$return$rows$`221001`$range
[1] ""

$return$rows$`221001`$qquarter
[1] "Y"

$return$rows$`221001`$easting
[1] "705825.000"

$return$rows$`221001`$stntype
[1] "VIR"</code></pre>
</div>
</div>
<p>If I hack it together to check, first note that the resp_body is raw, as we see in the <code>str</code> of <code>resp_raw</code> and in <code>resp_body_raw</code></p>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-28_16aa03ad7932bdab4e807cb1a431565c">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>resp <span class="sc">%&gt;%</span> <span class="fu">resp_raw</span>() <span class="sc">%&gt;%</span> <span class="fu">str</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>HTTP/1.1 200 OK
Date: Wed, 07 Dec 2022 02:36:05 GMT
Content-Type: text/html
Content-Length: 972
Connection: keep-alive
Content-Encoding: gzip
Vary: Accept-Encoding
Server: Microsoft-IIS/10.0
Content: 
Access-Control-Allow-Origin: *

{"error_num":0,"return":{"rows":{"221001":{"category20":"","category19":"","category18":"","category17":"","category16":"","category15":"","category14":"","category13":"","category12":"","category11":"","category10":"N\/A","active":false,"northing":"5887218.000","timezone":"10.0","shortname":"GENOA R @ ROCKTON","datecreate":18991230,"elevdatum":"","stname":"GENOA RIVER @ ROCKTON","category9":"N\/A","category8":"G(S)","category7":"G","category6":"2WD\/4WD","category5":"10","category4":"150","category3":"GRAVEL","category2":"V_70D3","category1":"23","elevacc":"1","dbver47":false,"quarter":"Y","section":0,"commence":19930526,"parent":"","mapname":"MAFFRA","meridian":"","spare5":"","spare4":"","spare3":"","spare2":"N\/A","spare1":"N\/A","posacc":"9","timemod":1642,"region":"221","grdatum":"UTM","township":"","longitude":"149.317296100","comment":" \r\nTurn right from Monaro Highway onto Imlay road signposted 82 km to Eden.  Travel over low level bridge  to a sharp left bend in the road.  A pine plantation  will be directly on the right.  Turn down into plantation and travel approx. 100m2011\/07\/17 Virtual site entry generated by DSEVIRTUALSITE.HSC from details in 221001A\r\n","lldatum":"WGS84","station":"221001","datemod":20221117,"timecreate":0,"orgcode":"DSE","barcode":"Bombala","zone":55,"elev":"429.000","cease":18991230,"local_map":"CRAIGIE","latitude":"-37.138654990","range":"","qquarter":"Y","easting":"705825.000","stntype":"VIR"}}}}
List of 5
 $ method     : chr "POST"
 $ url        : chr "https://data.water.vic.gov.au/cgi/webservice.exe?"
 $ status_code: int 200
 $ headers    :List of 9
  ..$ Date                       : chr "Wed, 07 Dec 2022 02:36:05 GMT"
  ..$ Content-Type               : chr "text/html"
  ..$ Content-Length             : chr "972"
  ..$ Connection                 : chr "keep-alive"
  ..$ Content-Encoding           : chr "gzip"
  ..$ Vary                       : chr "Accept-Encoding"
  ..$ Server                     : chr "Microsoft-IIS/10.0"
  ..$ Content                    : chr ""
  ..$ Access-Control-Allow-Origin: chr "*"
  ..- attr(*, "class")= chr "httr2_headers"
 $ body       : raw [1:1460] 7b 22 65 72 ...
 - attr(*, "class")= chr "httr2_response"</code></pre>
</div>
</div>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-29_5e00e5eea5018dd78afcd7386fb66d48">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>resp <span class="sc">%&gt;%</span> <span class="fu">resp_body_raw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   [1] 7b 22 65 72 72 6f 72 5f 6e 75 6d 22 3a 30 2c 22 72 65 74 75 72 6e 22 3a
  [25] 7b 22 72 6f 77 73 22 3a 7b 22 32 32 31 30 30 31 22 3a 7b 22 63 61 74 65
  [49] 67 6f 72 79 32 30 22 3a 22 22 2c 22 63 61 74 65 67 6f 72 79 31 39 22 3a
  [73] 22 22 2c 22 63 61 74 65 67 6f 72 79 31 38 22 3a 22 22 2c 22 63 61 74 65
  [97] 67 6f 72 79 31 37 22 3a 22 22 2c 22 63 61 74 65 67 6f 72 79 31 36 22 3a
 [121] 22 22 2c 22 63 61 74 65 67 6f 72 79 31 35 22 3a 22 22 2c 22 63 61 74 65
 [145] 67 6f 72 79 31 34 22 3a 22 22 2c 22 63 61 74 65 67 6f 72 79 31 33 22 3a
 [169] 22 22 2c 22 63 61 74 65 67 6f 72 79 31 32 22 3a 22 22 2c 22 63 61 74 65
 [193] 67 6f 72 79 31 31 22 3a 22 22 2c 22 63 61 74 65 67 6f 72 79 31 30 22 3a
 [217] 22 4e 5c 2f 41 22 2c 22 61 63 74 69 76 65 22 3a 66 61 6c 73 65 2c 22 6e
 [241] 6f 72 74 68 69 6e 67 22 3a 22 35 38 38 37 32 31 38 2e 30 30 30 22 2c 22
 [265] 74 69 6d 65 7a 6f 6e 65 22 3a 22 31 30 2e 30 22 2c 22 73 68 6f 72 74 6e
 [289] 61 6d 65 22 3a 22 47 45 4e 4f 41 20 52 20 40 20 52 4f 43 4b 54 4f 4e 22
 [313] 2c 22 64 61 74 65 63 72 65 61 74 65 22 3a 31 38 39 39 31 32 33 30 2c 22
 [337] 65 6c 65 76 64 61 74 75 6d 22 3a 22 22 2c 22 73 74 6e 61 6d 65 22 3a 22
 [361] 47 45 4e 4f 41 20 52 49 56 45 52 20 40 20 52 4f 43 4b 54 4f 4e 22 2c 22
 [385] 63 61 74 65 67 6f 72 79 39 22 3a 22 4e 5c 2f 41 22 2c 22 63 61 74 65 67
 [409] 6f 72 79 38 22 3a 22 47 28 53 29 22 2c 22 63 61 74 65 67 6f 72 79 37 22
 [433] 3a 22 47 22 2c 22 63 61 74 65 67 6f 72 79 36 22 3a 22 32 57 44 5c 2f 34
 [457] 57 44 22 2c 22 63 61 74 65 67 6f 72 79 35 22 3a 22 31 30 22 2c 22 63 61
 [481] 74 65 67 6f 72 79 34 22 3a 22 31 35 30 22 2c 22 63 61 74 65 67 6f 72 79
 [505] 33 22 3a 22 47 52 41 56 45 4c 22 2c 22 63 61 74 65 67 6f 72 79 32 22 3a
 [529] 22 56 5f 37 30 44 33 22 2c 22 63 61 74 65 67 6f 72 79 31 22 3a 22 32 33
 [553] 22 2c 22 65 6c 65 76 61 63 63 22 3a 22 31 22 2c 22 64 62 76 65 72 34 37
 [577] 22 3a 66 61 6c 73 65 2c 22 71 75 61 72 74 65 72 22 3a 22 59 22 2c 22 73
 [601] 65 63 74 69 6f 6e 22 3a 30 2c 22 63 6f 6d 6d 65 6e 63 65 22 3a 31 39 39
 [625] 33 30 35 32 36 2c 22 70 61 72 65 6e 74 22 3a 22 22 2c 22 6d 61 70 6e 61
 [649] 6d 65 22 3a 22 4d 41 46 46 52 41 22 2c 22 6d 65 72 69 64 69 61 6e 22 3a
 [673] 22 22 2c 22 73 70 61 72 65 35 22 3a 22 22 2c 22 73 70 61 72 65 34 22 3a
 [697] 22 22 2c 22 73 70 61 72 65 33 22 3a 22 22 2c 22 73 70 61 72 65 32 22 3a
 [721] 22 4e 5c 2f 41 22 2c 22 73 70 61 72 65 31 22 3a 22 4e 5c 2f 41 22 2c 22
 [745] 70 6f 73 61 63 63 22 3a 22 39 22 2c 22 74 69 6d 65 6d 6f 64 22 3a 31 36
 [769] 34 32 2c 22 72 65 67 69 6f 6e 22 3a 22 32 32 31 22 2c 22 67 72 64 61 74
 [793] 75 6d 22 3a 22 55 54 4d 22 2c 22 74 6f 77 6e 73 68 69 70 22 3a 22 22 2c
 [817] 22 6c 6f 6e 67 69 74 75 64 65 22 3a 22 31 34 39 2e 33 31 37 32 39 36 31
 [841] 30 30 22 2c 22 63 6f 6d 6d 65 6e 74 22 3a 22 20 5c 72 5c 6e 54 75 72 6e
 [865] 20 72 69 67 68 74 20 66 72 6f 6d 20 4d 6f 6e 61 72 6f 20 48 69 67 68 77
 [889] 61 79 20 6f 6e 74 6f 20 49 6d 6c 61 79 20 72 6f 61 64 20 73 69 67 6e 70
 [913] 6f 73 74 65 64 20 38 32 20 6b 6d 20 74 6f 20 45 64 65 6e 2e 20 20 54 72
 [937] 61 76 65 6c 20 6f 76 65 72 20 6c 6f 77 20 6c 65 76 65 6c 20 62 72 69 64
 [961] 67 65 20 20 74 6f 20 61 20 73 68 61 72 70 20 6c 65 66 74 20 62 65 6e 64
 [985] 20 69 6e 20 74 68 65 20 72 6f 61 64 2e 20 20 41 20 70 69 6e 65 20 70 6c
[1009] 61 6e 74 61 74 69 6f 6e 20 20 77 69 6c 6c 20 62 65 20 64 69 72 65 63 74
[1033] 6c 79 20 6f 6e 20 74 68 65 20 72 69 67 68 74 2e 20 20 54 75 72 6e 20 64
[1057] 6f 77 6e 20 69 6e 74 6f 20 70 6c 61 6e 74 61 74 69 6f 6e 20 61 6e 64 20
[1081] 74 72 61 76 65 6c 20 61 70 70 72 6f 78 2e 20 31 30 30 6d 32 30 31 31 5c
[1105] 2f 30 37 5c 2f 31 37 20 56 69 72 74 75 61 6c 20 73 69 74 65 20 65 6e 74
[1129] 72 79 20 67 65 6e 65 72 61 74 65 64 20 62 79 20 44 53 45 56 49 52 54 55
[1153] 41 4c 53 49 54 45 2e 48 53 43 20 66 72 6f 6d 20 64 65 74 61 69 6c 73 20
[1177] 69 6e 20 32 32 31 30 30 31 41 5c 72 5c 6e 22 2c 22 6c 6c 64 61 74 75 6d
[1201] 22 3a 22 57 47 53 38 34 22 2c 22 73 74 61 74 69 6f 6e 22 3a 22 32 32 31
[1225] 30 30 31 22 2c 22 64 61 74 65 6d 6f 64 22 3a 32 30 32 32 31 31 31 37 2c
[1249] 22 74 69 6d 65 63 72 65 61 74 65 22 3a 30 2c 22 6f 72 67 63 6f 64 65 22
[1273] 3a 22 44 53 45 22 2c 22 62 61 72 63 6f 64 65 22 3a 22 42 6f 6d 62 61 6c
[1297] 61 22 2c 22 7a 6f 6e 65 22 3a 35 35 2c 22 65 6c 65 76 22 3a 22 34 32 39
[1321] 2e 30 30 30 22 2c 22 63 65 61 73 65 22 3a 31 38 39 39 31 32 33 30 2c 22
[1345] 6c 6f 63 61 6c 5f 6d 61 70 22 3a 22 43 52 41 49 47 49 45 22 2c 22 6c 61
[1369] 74 69 74 75 64 65 22 3a 22 2d 33 37 2e 31 33 38 36 35 34 39 39 30 22 2c
[1393] 22 72 61 6e 67 65 22 3a 22 22 2c 22 71 71 75 61 72 74 65 72 22 3a 22 59
[1417] 22 2c 22 65 61 73 74 69 6e 67 22 3a 22 37 30 35 38 32 35 2e 30 30 30 22
[1441] 2c 22 73 74 6e 74 79 70 65 22 3a 22 56 49 52 22 7d 7d 7d 7d</code></pre>
</div>
</div>
<p>So, if we get the raw, convert to char, then pass to JSON, it looks the same as what I’m getting out of <code>resp_body_json</code>.</p>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-30_16aad140076ed9374d2bedae23b3c870">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>resp <span class="sc">%&gt;%</span> <span class="fu">resp_body_raw</span>() <span class="sc">%&gt;%</span> <span class="fu">rawToChar</span>() <span class="sc">%&gt;%</span> <span class="fu">fromJSON</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$error_num
[1] 0

$return
$return$rows
$return$rows$`221001`
$return$rows$`221001`$category20
[1] ""

$return$rows$`221001`$category19
[1] ""

$return$rows$`221001`$category18
[1] ""

$return$rows$`221001`$category17
[1] ""

$return$rows$`221001`$category16
[1] ""

$return$rows$`221001`$category15
[1] ""

$return$rows$`221001`$category14
[1] ""

$return$rows$`221001`$category13
[1] ""

$return$rows$`221001`$category12
[1] ""

$return$rows$`221001`$category11
[1] ""

$return$rows$`221001`$category10
[1] "N/A"

$return$rows$`221001`$active
[1] FALSE

$return$rows$`221001`$northing
[1] "5887218.000"

$return$rows$`221001`$timezone
[1] "10.0"

$return$rows$`221001`$shortname
[1] "GENOA R @ ROCKTON"

$return$rows$`221001`$datecreate
[1] 18991230

$return$rows$`221001`$elevdatum
[1] ""

$return$rows$`221001`$stname
[1] "GENOA RIVER @ ROCKTON"

$return$rows$`221001`$category9
[1] "N/A"

$return$rows$`221001`$category8
[1] "G(S)"

$return$rows$`221001`$category7
[1] "G"

$return$rows$`221001`$category6
[1] "2WD/4WD"

$return$rows$`221001`$category5
[1] "10"

$return$rows$`221001`$category4
[1] "150"

$return$rows$`221001`$category3
[1] "GRAVEL"

$return$rows$`221001`$category2
[1] "V_70D3"

$return$rows$`221001`$category1
[1] "23"

$return$rows$`221001`$elevacc
[1] "1"

$return$rows$`221001`$dbver47
[1] FALSE

$return$rows$`221001`$quarter
[1] "Y"

$return$rows$`221001`$section
[1] 0

$return$rows$`221001`$commence
[1] 19930526

$return$rows$`221001`$parent
[1] ""

$return$rows$`221001`$mapname
[1] "MAFFRA"

$return$rows$`221001`$meridian
[1] ""

$return$rows$`221001`$spare5
[1] ""

$return$rows$`221001`$spare4
[1] ""

$return$rows$`221001`$spare3
[1] ""

$return$rows$`221001`$spare2
[1] "N/A"

$return$rows$`221001`$spare1
[1] "N/A"

$return$rows$`221001`$posacc
[1] "9"

$return$rows$`221001`$timemod
[1] 1642

$return$rows$`221001`$region
[1] "221"

$return$rows$`221001`$grdatum
[1] "UTM"

$return$rows$`221001`$township
[1] ""

$return$rows$`221001`$longitude
[1] "149.317296100"

$return$rows$`221001`$comment
[1] " \r\nTurn right from Monaro Highway onto Imlay road signposted 82 km to Eden.  Travel over low level bridge  to a sharp left bend in the road.  A pine plantation  will be directly on the right.  Turn down into plantation and travel approx. 100m2011/07/17 Virtual site entry generated by DSEVIRTUALSITE.HSC from details in 221001A\r\n"

$return$rows$`221001`$lldatum
[1] "WGS84"

$return$rows$`221001`$station
[1] "221001"

$return$rows$`221001`$datemod
[1] 20221117

$return$rows$`221001`$timecreate
[1] 0

$return$rows$`221001`$orgcode
[1] "DSE"

$return$rows$`221001`$barcode
[1] "Bombala"

$return$rows$`221001`$zone
[1] 55

$return$rows$`221001`$elev
[1] "429.000"

$return$rows$`221001`$cease
[1] 18991230

$return$rows$`221001`$local_map
[1] "CRAIGIE"

$return$rows$`221001`$latitude
[1] "-37.138654990"

$return$rows$`221001`$range
[1] ""

$return$rows$`221001`$qquarter
[1] "Y"

$return$rows$`221001`$easting
[1] "705825.000"

$return$rows$`221001`$stntype
[1] "VIR"</code></pre>
</div>
</div>
<p>Now can I clean that up? THere’s a lot of nesting but some of it is pointless?</p>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-31_fcbed79d74981d3679035ae07e4c47ef">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(rj)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "error_num" "return"   </code></pre>
</div>
</div>
<p>and we know error_num is a single int from the str above. And <code>$return</code> is length 1 with only <code>rows</code> and rows only has the gauge number. After that there’s actually some data.</p>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-32_37917acad0c038ed4c17d34c77a35613">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(rj<span class="sc">$</span>return)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "rows"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(rj<span class="sc">$</span>return<span class="sc">$</span>rows)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "221001"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(rj<span class="sc">$</span>return<span class="sc">$</span>rows<span class="sc">$</span><span class="st">`</span><span class="at">221001</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "category20" "category19" "category18" "category17" "category16"
 [6] "category15" "category14" "category13" "category12" "category11"
[11] "category10" "active"     "northing"   "timezone"   "shortname" 
[16] "datecreate" "elevdatum"  "stname"     "category9"  "category8" 
[21] "category7"  "category6"  "category5"  "category4"  "category3" 
[26] "category2"  "category1"  "elevacc"    "dbver47"    "quarter"   
[31] "section"    "commence"   "parent"     "mapname"    "meridian"  
[36] "spare5"     "spare4"     "spare3"     "spare2"     "spare1"    
[41] "posacc"     "timemod"    "region"     "grdatum"    "township"  
[46] "longitude"  "comment"    "lldatum"    "station"    "datemod"   
[51] "timecreate" "orgcode"    "barcode"    "zone"       "elev"      
[56] "cease"      "local_map"  "latitude"   "range"      "qquarter"  
[61] "easting"    "stntype"   </code></pre>
</div>
</div>
<p>Now, can we put that in a dataframe? Is each one length 1?</p>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-33_ff22fca5372d59ef84c97bfdafa83fbf">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>actualdata <span class="ot">&lt;-</span> rj<span class="sc">$</span>return<span class="sc">$</span>rows<span class="sc">$</span><span class="st">`</span><span class="at">221001</span><span class="st">`</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="fu">all</span>(purrr<span class="sc">::</span><span class="fu">map_int</span>(actualdata, length) <span class="sc">==</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-34_2c492b8c0bea534776792b92a66407ff">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>tibout <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(actualdata)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>tibout</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 62
  category20 category19 catego…¹ categ…² categ…³ categ…⁴ categ…⁵ categ…⁶ categ…⁷
  &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  
1 ""         ""         ""       ""      ""      ""      ""      ""      ""     
# … with 53 more variables: category11 &lt;chr&gt;, category10 &lt;chr&gt;, active &lt;lgl&gt;,
#   northing &lt;chr&gt;, timezone &lt;chr&gt;, shortname &lt;chr&gt;, datecreate &lt;int&gt;,
#   elevdatum &lt;chr&gt;, stname &lt;chr&gt;, category9 &lt;chr&gt;, category8 &lt;chr&gt;,
#   category7 &lt;chr&gt;, category6 &lt;chr&gt;, category5 &lt;chr&gt;, category4 &lt;chr&gt;,
#   category3 &lt;chr&gt;, category2 &lt;chr&gt;, category1 &lt;chr&gt;, elevacc &lt;chr&gt;,
#   dbver47 &lt;lgl&gt;, quarter &lt;chr&gt;, section &lt;int&gt;, commence &lt;int&gt;, parent &lt;chr&gt;,
#   mapname &lt;chr&gt;, meridian &lt;chr&gt;, spare5 &lt;chr&gt;, spare4 &lt;chr&gt;, spare3 &lt;chr&gt;, …</code></pre>
</div>
</div>
<p>and toss cols with no data</p>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-35_0a90cd8d7e0d590c2932401973968478">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>tibout <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">where</span>(<span class="sc">~!</span><span class="fu">all</span>(. <span class="sc">==</span> <span class="st">''</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 44
  catego…¹ active north…² timez…³ short…⁴ datec…⁵ stname categ…⁶ categ…⁷ categ…⁸
  &lt;chr&gt;    &lt;lgl&gt;  &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  
1 N/A      FALSE  588721… 10.0    GENOA …  1.90e7 GENOA… N/A     G(S)    G      
# … with 34 more variables: category6 &lt;chr&gt;, category5 &lt;chr&gt;, category4 &lt;chr&gt;,
#   category3 &lt;chr&gt;, category2 &lt;chr&gt;, category1 &lt;chr&gt;, elevacc &lt;chr&gt;,
#   dbver47 &lt;lgl&gt;, quarter &lt;chr&gt;, section &lt;int&gt;, commence &lt;int&gt;, mapname &lt;chr&gt;,
#   spare2 &lt;chr&gt;, spare1 &lt;chr&gt;, posacc &lt;chr&gt;, timemod &lt;int&gt;, region &lt;chr&gt;,
#   grdatum &lt;chr&gt;, longitude &lt;chr&gt;, comment &lt;chr&gt;, lldatum &lt;chr&gt;,
#   station &lt;chr&gt;, datemod &lt;int&gt;, timecreate &lt;int&gt;, orgcode &lt;chr&gt;,
#   barcode &lt;chr&gt;, zone &lt;int&gt;, elev &lt;chr&gt;, cease &lt;int&gt;, local_map &lt;chr&gt;, …</code></pre>
</div>
</div>
<p>Cool, I have data and can do stuff with it. NOW, how do I get the data I actually want, vs the data that happens to be in the one demo on the website?</p>
</section>
</section>
<section id="testing-queries" class="level1">
<h1>Testing queries</h1>
<p>Sure would be nice if there were documentation….</p>
<p>First, let’s set up a clean call that gets us to a place we can see the output</p>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-36_cf0d806bc7c09405d700200a0ea258bb">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>vicurl <span class="ot">&lt;-</span> <span class="st">"https://data.water.vic.gov.au/cgi/webservice.exe?"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As above</p>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-37_aa46c60d27d67e9cca6b76863a7dffce">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>nestparams <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"function"</span> <span class="ot">=</span> <span class="st">'get_db_info'</span>,</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"version"</span> <span class="ot">=</span> <span class="st">"3"</span>,</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">"params"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"table_name"</span> <span class="ot">=</span> <span class="st">"site"</span>,</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"return_type"</span> <span class="ot">=</span> <span class="st">"hash"</span>,</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"filter_values"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"station"</span> <span class="ot">=</span> <span class="st">"221001"</span>)))</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>req <span class="ot">&lt;-</span> <span class="fu">request</span>(vicurl)</span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>req <span class="sc">%&gt;%</span> </span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(nestparams) <span class="sc">%&gt;%</span> </span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_dry_run</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>POST /cgi/webservice.exe? HTTP/1.1
Host: data.water.vic.gov.au
User-Agent: httr2/0.2.2 r-curl/4.3.3 libcurl/7.64.1
Accept: */*
Accept-Encoding: deflate, gzip
Content-Type: application/json
Content-Length: 129

{"function":"get_db_info","version":"3","params":{"table_name":"site","return_type":"hash","filter_values":{"station":"221001"}}}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>resp <span class="ot">&lt;-</span> req <span class="sc">%&gt;%</span> </span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(nestparams) <span class="sc">%&gt;%</span> </span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>rbody <span class="ot">&lt;-</span> resp <span class="sc">%&gt;%</span> <span class="fu">resp_body_json</span>(<span class="at">check_type =</span> <span class="cn">FALSE</span>)</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(rbody)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ error_num: int 0
 $ return   :List of 1
  ..$ rows:List of 1
  .. ..$ 221001:List of 62
  .. .. ..$ category20: chr ""
  .. .. ..$ category19: chr ""
  .. .. ..$ category18: chr ""
  .. .. ..$ category17: chr ""
  .. .. ..$ category16: chr ""
  .. .. ..$ category15: chr ""
  .. .. ..$ category14: chr ""
  .. .. ..$ category13: chr ""
  .. .. ..$ category12: chr ""
  .. .. ..$ category11: chr ""
  .. .. ..$ category10: chr "N/A"
  .. .. ..$ active    : logi FALSE
  .. .. ..$ northing  : chr "5887218.000"
  .. .. ..$ timezone  : chr "10.0"
  .. .. ..$ shortname : chr "GENOA R @ ROCKTON"
  .. .. ..$ datecreate: int 18991230
  .. .. ..$ elevdatum : chr ""
  .. .. ..$ stname    : chr "GENOA RIVER @ ROCKTON"
  .. .. ..$ category9 : chr "N/A"
  .. .. ..$ category8 : chr "G(S)"
  .. .. ..$ category7 : chr "G"
  .. .. ..$ category6 : chr "2WD/4WD"
  .. .. ..$ category5 : chr "10"
  .. .. ..$ category4 : chr "150"
  .. .. ..$ category3 : chr "GRAVEL"
  .. .. ..$ category2 : chr "V_70D3"
  .. .. ..$ category1 : chr "23"
  .. .. ..$ elevacc   : chr "1"
  .. .. ..$ dbver47   : logi FALSE
  .. .. ..$ quarter   : chr "Y"
  .. .. ..$ section   : int 0
  .. .. ..$ commence  : int 19930526
  .. .. ..$ parent    : chr ""
  .. .. ..$ mapname   : chr "MAFFRA"
  .. .. ..$ meridian  : chr ""
  .. .. ..$ spare5    : chr ""
  .. .. ..$ spare4    : chr ""
  .. .. ..$ spare3    : chr ""
  .. .. ..$ spare2    : chr "N/A"
  .. .. ..$ spare1    : chr "N/A"
  .. .. ..$ posacc    : chr "9"
  .. .. ..$ timemod   : int 1642
  .. .. ..$ region    : chr "221"
  .. .. ..$ grdatum   : chr "UTM"
  .. .. ..$ township  : chr ""
  .. .. ..$ longitude : chr "149.317296100"
  .. .. ..$ comment   : chr " \r\nTurn right from Monaro Highway onto Imlay road signposted 82 km to Eden.  Travel over low level bridge  to"| __truncated__
  .. .. ..$ lldatum   : chr "WGS84"
  .. .. ..$ station   : chr "221001"
  .. .. ..$ datemod   : int 20221117
  .. .. ..$ timecreate: int 0
  .. .. ..$ orgcode   : chr "DSE"
  .. .. ..$ barcode   : chr "Bombala"
  .. .. ..$ zone      : int 55
  .. .. ..$ elev      : chr "429.000"
  .. .. ..$ cease     : int 18991230
  .. .. ..$ local_map : chr "CRAIGIE"
  .. .. ..$ latitude  : chr "-37.138654990"
  .. .. ..$ range     : chr ""
  .. .. ..$ qquarter  : chr "Y"
  .. .. ..$ easting   : chr "705825.000"
  .. .. ..$ stntype   : chr "VIR"</code></pre>
</div>
</div>
<p>What happens if I don’t filter to site? Errors if no return_type. Runs for a long time then errors.</p>
<p>Try multiple stations. separate list items doesn’t work (<code>list("station" = "221001", "station" = "233217")</code> Also doesn’t seem to work to do <code>list("station" = c("221001","233217")</code>, though that does generate something that looks right. THe 233217 gauge does work on its own.</p>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-38_c28d18c52cffdc870323755a0f8d4c2a">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>nestparams <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"function"</span> <span class="ot">=</span> <span class="st">'get_db_info'</span>,</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"version"</span> <span class="ot">=</span> <span class="st">"3"</span>,</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">"params"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"table_name"</span> <span class="ot">=</span> <span class="st">"site"</span>,</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"return_type"</span> <span class="ot">=</span> <span class="st">"hash"</span>,</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"filter_values"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"station"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"221001"</span>,</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>                                                                    <span class="st">"233217"</span>))))</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>req <span class="ot">&lt;-</span> <span class="fu">request</span>(vicurl)</span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a>req <span class="sc">%&gt;%</span> </span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(nestparams) <span class="sc">%&gt;%</span> </span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_dry_run</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>POST /cgi/webservice.exe? HTTP/1.1
Host: data.water.vic.gov.au
User-Agent: httr2/0.2.2 r-curl/4.3.3 libcurl/7.64.1
Accept: */*
Accept-Encoding: deflate, gzip
Content-Type: application/json
Content-Length: 140

{"function":"get_db_info","version":"3","params":{"table_name":"site","return_type":"hash","filter_values":{"station":["221001","233217"]}}}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>resp <span class="ot">&lt;-</span> req <span class="sc">%&gt;%</span> </span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(nestparams) <span class="sc">%&gt;%</span> </span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>rbody <span class="ot">&lt;-</span> resp <span class="sc">%&gt;%</span> <span class="fu">resp_body_json</span>(<span class="at">check_type =</span> <span class="cn">FALSE</span>)</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(rbody)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 1
 $ error_num: int 0</code></pre>
</div>
</div>
<p>Try <code>get_ts_traces</code> . Use the barwon 233217. Trying to copy from mdba getter, but guessing. Version can’t be 3 for <code>get_ts_traces</code>. WHat do the datasources mean? And what are the varfrom and varto? THey aren’t what I expected</p>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-39_36356043231a6c37d38379cfe3f756a2">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>nestparams <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"function"</span> <span class="ot">=</span> <span class="st">'get_ts_traces'</span>,</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"version"</span> <span class="ot">=</span> <span class="st">"2"</span>,</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">"params"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"site_list"</span> <span class="ot">=</span> <span class="st">"233217"</span>,</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"start_time"</span> <span class="ot">=</span> <span class="st">"20200101000000"</span>,</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"varfrom"</span> <span class="ot">=</span> <span class="st">"100"</span>,</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"interval"</span> <span class="ot">=</span> <span class="st">"day"</span>,</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"varto"</span> <span class="ot">=</span> <span class="st">"141"</span>, <span class="co"># guessing</span></span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"datasource"</span> <span class="ot">=</span> <span class="st">"A"</span>, <span class="co"># no idea. getter has CP</span></span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"end_time"</span> <span class="ot">=</span> <span class="st">"20201231000000"</span>,</span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"data_type"</span> <span class="ot">=</span> <span class="st">"mean"</span>,</span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"multiplier"</span> <span class="ot">=</span> <span class="st">"1"</span>))</span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a>req <span class="ot">&lt;-</span> <span class="fu">request</span>(vicurl)</span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a>req <span class="sc">%&gt;%</span> </span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(nestparams) <span class="sc">%&gt;%</span> </span>
<span id="cb93-17"><a href="#cb93-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_dry_run</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>POST /cgi/webservice.exe? HTTP/1.1
Host: data.water.vic.gov.au
User-Agent: httr2/0.2.2 r-curl/4.3.3 libcurl/7.64.1
Accept: */*
Accept-Encoding: deflate, gzip
Content-Type: application/json
Content-Length: 232

{"function":"get_ts_traces","version":"2","params":{"site_list":"233217","start_time":"20200101000000","varfrom":"100","interval":"day","varto":"141","datasource":"A","end_time":"20201231000000","data_type":"mean","multiplier":"1"}}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>resp <span class="ot">&lt;-</span> req <span class="sc">%&gt;%</span> </span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(nestparams) <span class="sc">%&gt;%</span> </span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>rbody <span class="ot">&lt;-</span> resp <span class="sc">%&gt;%</span> <span class="fu">resp_body_json</span>(<span class="at">check_type =</span> <span class="cn">FALSE</span>)</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(rbody)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ error_num: int 0
 $ return   :List of 1
  ..$ traces:List of 1
  .. ..$ :List of 8
  .. .. ..$ error_num      : int 0
  .. .. ..$ compressed     : chr "0"
  .. .. ..$ site_details   :List of 6
  .. .. .. ..$ timezone  : chr "10.0"
  .. .. .. ..$ short_name: chr "BARWON @ GEELONG"
  .. .. .. ..$ longitude : chr "144.346892190"
  .. .. .. ..$ name      : chr "BARWON RIVER @ GEELONG"
  .. .. .. ..$ latitude  : chr "-38.163605590"
  .. .. .. ..$ org_name  : chr "Dept. Sustainability and Environment"
  .. .. ..$ quality_codes  :List of 3
  .. .. .. ..$ 150: chr "Rating extrapolated above 1.5x maximum flow gauged."
  .. .. .. ..$ 2  : chr "Good quality data - minimal editing required. +/- 0mm - 10mm Drift correction"
  .. .. .. ..$ 15 : chr "Minor editing. +/-11mm - 20mm drift correction"
  .. .. ..$ trace          :List of 366
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "15.93"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "14.11"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "11.23"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "8.81"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.52"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "6.75"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "6.09"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "4.13"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "2.48"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "6.88"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "12.64"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "9.87"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "8.42"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "6.45"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "9.74"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "11.98"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "6.24"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "5.13"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "5.65"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "5.89"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "4.80"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "5.40"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "140.73"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "64.54"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "30.23"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "22.19"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "37.79"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "87.84"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "75.92"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "56.23"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "39.45"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "115.16"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "113.39"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "52.73"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "33.34"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "27.99"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "68.83"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "89.55"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "75.06"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "62.44"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "48.77"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "36.28"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "36.74"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "51.80"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "93.38"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "116.70"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "112.29"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "137.43"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "258.34"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "261.02"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "130.53"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "108.27"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "88.65"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "72.27"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "79.87"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "96.81"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "73.02"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "55.39"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "44.17"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "39.50"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "41.59"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "60.38"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "55.40"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "50.09"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "189.87"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "119.15"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "73.80"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "67.45"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "79.09"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "117.81"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "100.90"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "80.16"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "67.04"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "52.16"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "45.44"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "39.66"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "35.61"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "34.74"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "37.66"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "33.15"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "30.12"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "29.67"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "28.57"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "26.04"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "26.59"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "26.93"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "25.80"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "24.26"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "44.20"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "56.38"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "39.08"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "32.12"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "140.49"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "115.66"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "333.21"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "191.13"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "404.26"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "622.35"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "458.40"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. .. [list output truncated]
  .. .. ..$ varfrom_details:List of 6
  .. .. .. ..$ short_name: chr "Water Level (m)"
  .. .. .. ..$ precision : chr "0.001000"
  .. .. .. ..$ subdesc   : chr "Available for release"
  .. .. .. ..$ variable  : chr "100.00"
  .. .. .. ..$ units     : chr "metres"
  .. .. .. ..$ name      : chr "Stream Water Level (m)"
  .. .. ..$ site           : chr "233217"
  .. .. ..$ varto_details  :List of 6
  .. .. .. ..$ short_name: chr "Discharge (Ml/d)"
  .. .. .. ..$ precision : chr "0.010000"
  .. .. .. ..$ subdesc   : chr "Available for release"
  .. .. .. ..$ variable  : chr "141.00"
  .. .. .. ..$ units     : chr "megalitres/day"
  .. .. .. ..$ name      : chr "Stream Discharge (Ml/d)"</code></pre>
</div>
</div>
<p>And the trace length is right</p>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-40_669af329b9ed91fe30e081746fc683a8">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(rbody<span class="sc">$</span>return<span class="sc">$</span>traces[[<span class="dv">1</span>]]<span class="sc">$</span>trace)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 366</code></pre>
</div>
</div>
<p>So, how do we actually get what we want?</p>
</section>
<section id="how-does-the-api-work" class="level1">
<h1>How does the API work?</h1>
<p>I finally found a couple sources of documentation that will hopefully be helpful: <a href="https://kisters.com.au/doco/hydllp.htm" class="uri">https://kisters.com.au/doco/hydllp.htm</a> and <a href="https://water-monitoring.information.qld.gov.au/wini/Documents/RDMW_API_doco.pdf" class="uri">https://water-monitoring.information.qld.gov.au/wini/Documents/RDMW_API_doco.pdf</a>. According to the QLD pdf, the datasource distinguishes things like Archive and Telemetry. Not sure what they are in Vic. And the different variables can be in a <code>var_list</code> or <code>varto</code> and <code>varfrom</code>. The numbers are for different variables, but again, no guarantee they’re the same in Vic.</p>
<p>The kisters site though looks like <code>get_datasources_by_site</code> and <code>get_variable_list</code> might tell me what the options are?</p>
<section id="querying-options" class="level2">
<h2 class="anchored" data-anchor-id="querying-options">Querying options</h2>
<p>Before we go get data, we need to figure out what we can ask for. First, sort out <em>those</em> functions.</p>
<section id="datasources" class="level3">
<h3 class="anchored" data-anchor-id="datasources">Datasources</h3>
<p>Let’s try <code>get_datasources_by_site</code>. Takes <code>site_list</code> params. Dunno what versions it works for? Tried 2, gave error says has to be 1. I assume the “A” datasource means archive here, since that’s what it means in QLD.</p>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-41_e3f09e98fdcb541d56e9b749e13f9621">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>ds_s_params <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"function"</span> <span class="ot">=</span> <span class="st">'get_datasources_by_site'</span>,</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"version"</span> <span class="ot">=</span> <span class="st">"1"</span>,</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">"params"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"site_list"</span> <span class="ot">=</span> <span class="st">"233217"</span>))</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a><span class="co"># req &lt;- request(vicurl)</span></span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>req <span class="sc">%&gt;%</span> </span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(ds_s_params) <span class="sc">%&gt;%</span> </span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_dry_run</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>POST /cgi/webservice.exe? HTTP/1.1
Host: data.water.vic.gov.au
User-Agent: httr2/0.2.2 r-curl/4.3.3 libcurl/7.64.1
Accept: */*
Accept-Encoding: deflate, gzip
Content-Type: application/json
Content-Length: 84

{"function":"get_datasources_by_site","version":"1","params":{"site_list":"233217"}}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>resp_ds_s <span class="ot">&lt;-</span> req <span class="sc">%&gt;%</span> </span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(ds_s_params) <span class="sc">%&gt;%</span> </span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>rbody_ds_s <span class="ot">&lt;-</span> resp_ds_s <span class="sc">%&gt;%</span> <span class="fu">resp_body_json</span>(<span class="at">check_type =</span> <span class="cn">FALSE</span>)</span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(rbody_ds_s)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ error_num: int 0
 $ return   :List of 1
  ..$ sites:List of 1
  .. ..$ :List of 2
  .. .. ..$ site       : chr "233217"
  .. .. ..$ datasources:List of 3
  .. .. .. ..$ : chr "A"
  .. .. .. ..$ : chr "TELEM"
  .. .. .. ..$ : chr "TELEMCOPY"</code></pre>
</div>
</div>
</section>
<section id="sitelist" class="level3">
<h3 class="anchored" data-anchor-id="sitelist">Sitelist</h3>
<p>Ok, I could make that into a tibble easily enough. It tells me what that site has for datasources, how about another? Can I figure out how to use a sitelist? That’d be really nice, and applies in a lot of places. Cool. I had tried to do <code>"sitelist" = c('site', 'site')</code> , and that failed. But it works to have <code>"site, site"</code></p>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-42_e6e558054214649852a4fbbbafcce672">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>ds_s_params <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"function"</span> <span class="ot">=</span> <span class="st">'get_datasources_by_site'</span>,</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"version"</span> <span class="ot">=</span> <span class="st">"1"</span>,</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">"params"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"site_list"</span> <span class="ot">=</span> <span class="st">"233217, 405328"</span>))</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a><span class="co"># req &lt;- request(vicurl)</span></span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>req <span class="sc">%&gt;%</span> </span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(ds_s_params) <span class="sc">%&gt;%</span> </span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_dry_run</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>POST /cgi/webservice.exe? HTTP/1.1
Host: data.water.vic.gov.au
User-Agent: httr2/0.2.2 r-curl/4.3.3 libcurl/7.64.1
Accept: */*
Accept-Encoding: deflate, gzip
Content-Type: application/json
Content-Length: 92

{"function":"get_datasources_by_site","version":"1","params":{"site_list":"233217, 405328"}}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>resp_ds_s <span class="ot">&lt;-</span> req <span class="sc">%&gt;%</span> </span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(ds_s_params) <span class="sc">%&gt;%</span> </span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>rbody_ds_s <span class="ot">&lt;-</span> resp_ds_s <span class="sc">%&gt;%</span> <span class="fu">resp_body_json</span>(<span class="at">check_type =</span> <span class="cn">FALSE</span>)</span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(rbody_ds_s)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ error_num: int 0
 $ return   :List of 1
  ..$ sites:List of 2
  .. ..$ :List of 2
  .. .. ..$ site       : chr "233217"
  .. .. ..$ datasources:List of 3
  .. .. .. ..$ : chr "A"
  .. .. .. ..$ : chr "TELEM"
  .. .. .. ..$ : chr "TELEMCOPY"
  .. ..$ :List of 2
  .. .. ..$ site       : chr "405328"
  .. .. ..$ datasources:List of 3
  .. .. .. ..$ : chr "A"
  .. .. .. ..$ : chr "TELEM"
  .. .. .. ..$ : chr "TELEMCOPY"</code></pre>
</div>
</div>
</section>
<section id="variables" class="level3">
<h3 class="anchored" data-anchor-id="variables">Variables</h3>
<p>Now, for a given site, we want to know what variables are available. (and I also eventually want to know what all possible variables are, and what happens if we ask for variables that aren’t there). Let’s start with the same two sites. I’m</p>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-43_f1be0fb0e147282ef921549988701b1a">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>v_s_params <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"function"</span> <span class="ot">=</span> <span class="st">'get_variable_list'</span>,</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"version"</span> <span class="ot">=</span> <span class="st">"1"</span>,</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">"params"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"site_list"</span> <span class="ot">=</span> <span class="st">"233217, 405328"</span>,</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"datasource"</span> <span class="ot">=</span> <span class="st">"A"</span>))</span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>req <span class="ot">&lt;-</span> <span class="fu">request</span>(vicurl)</span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>req <span class="sc">%&gt;%</span> </span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(v_s_params) <span class="sc">%&gt;%</span> </span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_dry_run</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>POST /cgi/webservice.exe? HTTP/1.1
Host: data.water.vic.gov.au
User-Agent: httr2/0.2.2 r-curl/4.3.3 libcurl/7.64.1
Accept: */*
Accept-Encoding: deflate, gzip
Content-Type: application/json
Content-Length: 103

{"function":"get_variable_list","version":"1","params":{"site_list":"233217, 405328","datasource":"A"}}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>resp_v_s <span class="ot">&lt;-</span> req <span class="sc">%&gt;%</span> </span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(v_s_params) <span class="sc">%&gt;%</span> </span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>rbody_v_s <span class="ot">&lt;-</span> resp_v_s <span class="sc">%&gt;%</span> <span class="fu">resp_body_json</span>(<span class="at">check_type =</span> <span class="cn">FALSE</span>)</span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(rbody_v_s)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ error_num: int 0
 $ return   :List of 1
  ..$ sites:List of 2
  .. ..$ :List of 3
  .. .. ..$ site_details:List of 3
  .. .. .. ..$ timezone  : chr "10.0"
  .. .. .. ..$ short_name: chr "BARWON @ GEELONG"
  .. .. .. ..$ name      : chr "BARWON RIVER @ GEELONG"
  .. .. ..$ variables   :List of 6
  .. .. .. ..$ :List of 6
  .. .. .. .. ..$ period_end  : chr "20221107070000"
  .. .. .. .. ..$ period_start: chr "19610306171500"
  .. .. .. .. ..$ subdesc     : chr "Available for release"
  .. .. .. .. ..$ variable    : chr "100.00"
  .. .. .. .. ..$ units       : chr "metres"
  .. .. .. .. ..$ name        : chr "Stream Water Level (m)"
  .. .. .. ..$ :List of 6
  .. .. .. .. ..$ period_end  : chr "20221107070000"
  .. .. .. .. ..$ period_start: chr "20100706123100"
  .. .. .. .. ..$ subdesc     : chr "Available for release"
  .. .. .. .. ..$ variable    : chr "210.00"
  .. .. .. .. ..$ units       : chr "pH"
  .. .. .. .. ..$ name        : chr "Acidity/Alkalinity (pH)"
  .. .. .. ..$ :List of 6
  .. .. .. .. ..$ period_end  : chr "20221107070000"
  .. .. .. .. ..$ period_start: chr "20100706123100"
  .. .. .. .. ..$ subdesc     : chr "Available for release"
  .. .. .. .. ..$ variable    : chr "215.00"
  .. .. .. .. ..$ units       : chr "ppm"
  .. .. .. .. ..$ name        : chr "Dissolved Oxygen (ppm)"
  .. .. .. ..$ :List of 6
  .. .. .. .. ..$ period_end  : chr "20221107070000"
  .. .. .. .. ..$ period_start: chr "20100706123100"
  .. .. .. .. ..$ subdesc     : chr "Available for release"
  .. .. .. .. ..$ variable    : chr "450.00"
  .. .. .. .. ..$ units       : chr "Degrees celsius"
  .. .. .. .. ..$ name        : chr "Water Temperature (°C)"
  .. .. .. ..$ :List of 6
  .. .. .. .. ..$ period_end  : chr "20221107070000"
  .. .. .. .. ..$ period_start: chr "20100706123100"
  .. .. .. .. ..$ subdesc     : chr "Available for release"
  .. .. .. .. ..$ variable    : chr "810.00"
  .. .. .. .. ..$ units       : chr "NTU"
  .. .. .. .. ..$ name        : chr "Turbidity (NTU)"
  .. .. .. ..$ :List of 6
  .. .. .. .. ..$ period_end  : chr "20221107070000"
  .. .. .. .. ..$ period_start: chr "20100706123100"
  .. .. .. .. ..$ subdesc     : chr "Available for release"
  .. .. .. .. ..$ variable    : chr "820.00"
  .. .. .. .. ..$ units       : chr "µS/cm@25°C"
  .. .. .. .. ..$ name        : chr "Conductivity (µS/cm)"
  .. .. ..$ site        : chr "233217"
  .. ..$ :List of 3
  .. .. ..$ site_details:List of 3
  .. .. .. ..$ timezone  : chr "10.0"
  .. .. .. ..$ short_name: chr "STEAVENSON R @ FALLS"
  .. .. .. ..$ name      : chr "STEAVENSON RIVER @ FALLS ROAD MARYSVILLE"
  .. .. ..$ variables   :List of 1
  .. .. .. ..$ :List of 6
  .. .. .. .. ..$ period_end  : chr "20221111094500"
  .. .. .. .. ..$ period_start: chr "20091119170800"
  .. .. .. .. ..$ subdesc     : chr "Available for release"
  .. .. .. .. ..$ variable    : chr "100.00"
  .. .. .. .. ..$ units       : chr "metres"
  .. .. .. .. ..$ name        : chr "Stream Water Level (m)"
  .. .. ..$ site        : chr "405328"</code></pre>
</div>
</div>
<p>So, that gives me the number <em>and name</em> of each variable at each site. But it does <em>not</em> give derived variables (discharge being the main one).</p>
</section>
</section>
<section id="location-etc" class="level2">
<h2 class="anchored" data-anchor-id="location-etc">Location etc</h2>
<p>So, <code>get_db_info</code> seems like it should be useful, but kind of isn’t (see above). Maybe I’ll come back to that. It does let us do geofilters, but they seem both crude and complex. I think I’d <em>probably</em> rather do geofiltering myself and then turn that into a <code>site_list</code>. But might come back to this. The <code>complex_filter</code> might be useful if we can use it to choose sites based on something. But again, I’d probably do that myself? Again, come back to this maybe?</p>
<section id="can-we-get-a-list-of-all-sites-and-all-variables" class="level3">
<h3 class="anchored" data-anchor-id="can-we-get-a-list-of-all-sites-and-all-variables">Can we get a list of all sites and all variables?</h3>
<p>Maybe? Do we want to?</p>
</section>
</section>
<section id="getting-timeseries" class="level2">
<h2 class="anchored" data-anchor-id="getting-timeseries">Getting timeseries</h2>
<p>Now, let’s go back to get timeseries, now we know what the variables are. Just for the Barwon at first, and way fewer days. There’s a <code>var_list</code> option, or <code>varfrom</code> and <code>varto</code>. It’s unclear whether the from and to version is numerivally inclusive- ie if we have 100 and 10000, does it get everything? I’ll try with <code>varto = 820</code>, since that’s the highest number avail at the barwon. Gives cryptic error. Try 210? Also, why isn’t 141 available in teh lsit above? Again, cryptic “Assumed fail to reload varcon for 233217: 100.00-&gt; 210.00, as we failed loading it last time”. does it work for 141? Yes.</p>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-44_ee456cd1e7ad236a0ffd95261e15ab9a">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>bparams <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"function"</span> <span class="ot">=</span> <span class="st">'get_ts_traces'</span>,</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"version"</span> <span class="ot">=</span> <span class="st">"2"</span>,</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">"params"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"site_list"</span> <span class="ot">=</span> <span class="st">"233217"</span>,</span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"start_time"</span> <span class="ot">=</span> <span class="st">"20200101000000"</span>,</span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"varfrom"</span> <span class="ot">=</span> <span class="st">"100"</span>,</span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"interval"</span> <span class="ot">=</span> <span class="st">"day"</span>,</span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"varto"</span> <span class="ot">=</span> <span class="st">"141"</span>,</span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"datasource"</span> <span class="ot">=</span> <span class="st">"A"</span>, </span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"end_time"</span> <span class="ot">=</span> <span class="st">"20200115000000"</span>,</span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"data_type"</span> <span class="ot">=</span> <span class="st">"mean"</span>,</span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"multiplier"</span> <span class="ot">=</span> <span class="st">"1"</span>))</span>
<span id="cb111-12"><a href="#cb111-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-13"><a href="#cb111-13" aria-hidden="true" tabindex="-1"></a>req <span class="ot">&lt;-</span> <span class="fu">request</span>(vicurl)</span>
<span id="cb111-14"><a href="#cb111-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-15"><a href="#cb111-15" aria-hidden="true" tabindex="-1"></a>req <span class="sc">%&gt;%</span> </span>
<span id="cb111-16"><a href="#cb111-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(bparams) <span class="sc">%&gt;%</span> </span>
<span id="cb111-17"><a href="#cb111-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_dry_run</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>POST /cgi/webservice.exe? HTTP/1.1
Host: data.water.vic.gov.au
User-Agent: httr2/0.2.2 r-curl/4.3.3 libcurl/7.64.1
Accept: */*
Accept-Encoding: deflate, gzip
Content-Type: application/json
Content-Length: 232

{"function":"get_ts_traces","version":"2","params":{"site_list":"233217","start_time":"20200101000000","varfrom":"100","interval":"day","varto":"141","datasource":"A","end_time":"20200115000000","data_type":"mean","multiplier":"1"}}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>respb <span class="ot">&lt;-</span> req <span class="sc">%&gt;%</span> </span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(bparams) <span class="sc">%&gt;%</span> </span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>rbodyb <span class="ot">&lt;-</span> respb <span class="sc">%&gt;%</span> <span class="fu">resp_body_json</span>(<span class="at">check_type =</span> <span class="cn">FALSE</span>)</span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(rbodyb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ error_num: int 0
 $ return   :List of 1
  ..$ traces:List of 1
  .. ..$ :List of 8
  .. .. ..$ error_num      : int 0
  .. .. ..$ compressed     : chr "0"
  .. .. ..$ site_details   :List of 6
  .. .. .. ..$ timezone  : chr "10.0"
  .. .. .. ..$ short_name: chr "BARWON @ GEELONG"
  .. .. .. ..$ longitude : chr "144.346892190"
  .. .. .. ..$ name      : chr "BARWON RIVER @ GEELONG"
  .. .. .. ..$ latitude  : chr "-38.163605590"
  .. .. .. ..$ org_name  : chr "Dept. Sustainability and Environment"
  .. .. ..$ quality_codes  :List of 1
  .. .. .. ..$ 150: chr "Rating extrapolated above 1.5x maximum flow gauged."
  .. .. ..$ trace          :List of 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "15.93"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "14.11"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "11.23"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "8.81"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.52"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "6.75"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "6.09"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "4.13"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "2.48"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "6.88"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "12.64"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "9.87"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "8.42"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "6.45"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "9.74"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. ..$ varfrom_details:List of 6
  .. .. .. ..$ short_name: chr "Water Level (m)"
  .. .. .. ..$ precision : chr "0.001000"
  .. .. .. ..$ subdesc   : chr "Available for release"
  .. .. .. ..$ variable  : chr "100.00"
  .. .. .. ..$ units     : chr "metres"
  .. .. .. ..$ name      : chr "Stream Water Level (m)"
  .. .. ..$ site           : chr "233217"
  .. .. ..$ varto_details  :List of 6
  .. .. .. ..$ short_name: chr "Discharge (Ml/d)"
  .. .. .. ..$ precision : chr "0.010000"
  .. .. .. ..$ subdesc   : chr "Available for release"
  .. .. .. ..$ variable  : chr "141.00"
  .. .. .. ..$ units     : chr "megalitres/day"
  .. .. .. ..$ name      : chr "Stream Discharge (Ml/d)"</code></pre>
</div>
</div>
<p>Do the other vars work if we ask for them separately? Try pH (which failed above)</p>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-45_c49a74d2a4832c0cf8b03876cf48fee7">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>bparams <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"function"</span> <span class="ot">=</span> <span class="st">'get_ts_traces'</span>,</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"version"</span> <span class="ot">=</span> <span class="st">"2"</span>,</span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">"params"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"site_list"</span> <span class="ot">=</span> <span class="st">"233217"</span>,</span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"start_time"</span> <span class="ot">=</span> <span class="st">"20200101000000"</span>,</span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"varfrom"</span> <span class="ot">=</span> <span class="st">"210"</span>,</span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"interval"</span> <span class="ot">=</span> <span class="st">"day"</span>,</span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"varto"</span> <span class="ot">=</span> <span class="st">"210"</span>,</span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"datasource"</span> <span class="ot">=</span> <span class="st">"A"</span>, </span>
<span id="cb115-9"><a href="#cb115-9" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"end_time"</span> <span class="ot">=</span> <span class="st">"20200115000000"</span>,</span>
<span id="cb115-10"><a href="#cb115-10" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"data_type"</span> <span class="ot">=</span> <span class="st">"mean"</span>,</span>
<span id="cb115-11"><a href="#cb115-11" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"multiplier"</span> <span class="ot">=</span> <span class="st">"1"</span>))</span>
<span id="cb115-12"><a href="#cb115-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-13"><a href="#cb115-13" aria-hidden="true" tabindex="-1"></a>req <span class="ot">&lt;-</span> <span class="fu">request</span>(vicurl)</span>
<span id="cb115-14"><a href="#cb115-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-15"><a href="#cb115-15" aria-hidden="true" tabindex="-1"></a>req <span class="sc">%&gt;%</span> </span>
<span id="cb115-16"><a href="#cb115-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(bparams) <span class="sc">%&gt;%</span> </span>
<span id="cb115-17"><a href="#cb115-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_dry_run</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>POST /cgi/webservice.exe? HTTP/1.1
Host: data.water.vic.gov.au
User-Agent: httr2/0.2.2 r-curl/4.3.3 libcurl/7.64.1
Accept: */*
Accept-Encoding: deflate, gzip
Content-Type: application/json
Content-Length: 232

{"function":"get_ts_traces","version":"2","params":{"site_list":"233217","start_time":"20200101000000","varfrom":"210","interval":"day","varto":"210","datasource":"A","end_time":"20200115000000","data_type":"mean","multiplier":"1"}}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>respb <span class="ot">&lt;-</span> req <span class="sc">%&gt;%</span> </span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(bparams) <span class="sc">%&gt;%</span> </span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>rbodyb <span class="ot">&lt;-</span> respb <span class="sc">%&gt;%</span> <span class="fu">resp_body_json</span>(<span class="at">check_type =</span> <span class="cn">FALSE</span>)</span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(rbodyb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ error_num: int 0
 $ return   :List of 1
  ..$ traces:List of 1
  .. ..$ :List of 8
  .. .. ..$ error_num      : int 0
  .. .. ..$ compressed     : chr "0"
  .. .. ..$ site_details   :List of 6
  .. .. .. ..$ timezone  : chr "10.0"
  .. .. .. ..$ short_name: chr "BARWON @ GEELONG"
  .. .. .. ..$ longitude : chr "144.346892190"
  .. .. .. ..$ name      : chr "BARWON RIVER @ GEELONG"
  .. .. .. ..$ latitude  : chr "-38.163605590"
  .. .. .. ..$ org_name  : chr "Dept. Sustainability and Environment"
  .. .. ..$ quality_codes  :List of 1
  .. .. .. ..$ 2: chr "Good quality data - minimal editing required. +/- 0mm - 10mm Drift correction"
  .. .. ..$ trace          :List of 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.80"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.82"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.94"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.90"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.71"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.59"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.52"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.64"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.95"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "8.11"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "8.01"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "8.14"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.85"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.92"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.79"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. ..$ varfrom_details:List of 6
  .. .. .. ..$ short_name: chr "Field pH"
  .. .. .. ..$ precision : chr "0.010000"
  .. .. .. ..$ subdesc   : chr "Available for release"
  .. .. .. ..$ variable  : chr "210.00"
  .. .. .. ..$ units     : chr "pH"
  .. .. .. ..$ name      : chr "Acidity/Alkalinity (pH)"
  .. .. ..$ site           : chr "233217"
  .. .. ..$ varto_details  :List of 6
  .. .. .. ..$ short_name: chr "Field pH"
  .. .. .. ..$ precision : chr "0.010000"
  .. .. .. ..$ subdesc   : chr "Available for release"
  .. .. .. ..$ variable  : chr "210.00"
  .. .. .. ..$ units     : chr "pH"
  .. .. .. ..$ name      : chr "Acidity/Alkalinity (pH)"</code></pre>
</div>
</div>
<p>Interesting. How about a <code>var_list</code>?</p>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-46_9b2910c6f0a77d5d4ebfe31f4ccfc00a">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>bparams <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"function"</span> <span class="ot">=</span> <span class="st">'get_ts_traces'</span>,</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"version"</span> <span class="ot">=</span> <span class="st">"2"</span>,</span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">"params"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"site_list"</span> <span class="ot">=</span> <span class="st">"233217"</span>,</span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"start_time"</span> <span class="ot">=</span> <span class="st">"20200101000000"</span>,</span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"var_list"</span> <span class="ot">=</span> <span class="st">"100,210"</span>,</span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"interval"</span> <span class="ot">=</span> <span class="st">"day"</span>,</span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"datasource"</span> <span class="ot">=</span> <span class="st">"A"</span>, </span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"end_time"</span> <span class="ot">=</span> <span class="st">"20200115000000"</span>,</span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"data_type"</span> <span class="ot">=</span> <span class="st">"mean"</span>,</span>
<span id="cb119-10"><a href="#cb119-10" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"multiplier"</span> <span class="ot">=</span> <span class="st">"1"</span>))</span>
<span id="cb119-11"><a href="#cb119-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-12"><a href="#cb119-12" aria-hidden="true" tabindex="-1"></a>req <span class="ot">&lt;-</span> <span class="fu">request</span>(vicurl)</span>
<span id="cb119-13"><a href="#cb119-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-14"><a href="#cb119-14" aria-hidden="true" tabindex="-1"></a>req <span class="sc">%&gt;%</span> </span>
<span id="cb119-15"><a href="#cb119-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(bparams) <span class="sc">%&gt;%</span> </span>
<span id="cb119-16"><a href="#cb119-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_dry_run</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>POST /cgi/webservice.exe? HTTP/1.1
Host: data.water.vic.gov.au
User-Agent: httr2/0.2.2 r-curl/4.3.3 libcurl/7.64.1
Accept: */*
Accept-Encoding: deflate, gzip
Content-Type: application/json
Content-Length: 223

{"function":"get_ts_traces","version":"2","params":{"site_list":"233217","start_time":"20200101000000","var_list":"100,210","interval":"day","datasource":"A","end_time":"20200115000000","data_type":"mean","multiplier":"1"}}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>respb <span class="ot">&lt;-</span> req <span class="sc">%&gt;%</span> </span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(bparams) <span class="sc">%&gt;%</span> </span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>rbodyb <span class="ot">&lt;-</span> respb <span class="sc">%&gt;%</span> <span class="fu">resp_body_json</span>(<span class="at">check_type =</span> <span class="cn">FALSE</span>)</span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(rbodyb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ error_num: int 0
 $ return   :List of 1
  ..$ traces:List of 2
  .. ..$ :List of 8
  .. .. ..$ error_num      : int 0
  .. .. ..$ compressed     : chr "0"
  .. .. ..$ site_details   :List of 6
  .. .. .. ..$ timezone  : chr "10.0"
  .. .. .. ..$ short_name: chr "BARWON @ GEELONG"
  .. .. .. ..$ longitude : chr "144.346892190"
  .. .. .. ..$ name      : chr "BARWON RIVER @ GEELONG"
  .. .. .. ..$ latitude  : chr "-38.163605590"
  .. .. .. ..$ org_name  : chr "Dept. Sustainability and Environment"
  .. .. ..$ quality_codes  :List of 2
  .. .. .. ..$ 2 : chr "Good quality data - minimal editing required. +/- 0mm - 10mm Drift correction"
  .. .. .. ..$ 15: chr "Minor editing. +/-11mm - 20mm drift correction"
  .. .. ..$ trace          :List of 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.838"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.834"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.827"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.821"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.816"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.814"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.811"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.802"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.791"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.805"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.831"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.824"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.820"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.812"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.817"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. ..$ varfrom_details:List of 6
  .. .. .. ..$ short_name: chr "Water Level (m)"
  .. .. .. ..$ precision : chr "0.001000"
  .. .. .. ..$ subdesc   : chr "Available for release"
  .. .. .. ..$ variable  : chr "100.00"
  .. .. .. ..$ units     : chr "metres"
  .. .. .. ..$ name      : chr "Stream Water Level (m)"
  .. .. ..$ site           : chr "233217"
  .. .. ..$ varto_details  :List of 6
  .. .. .. ..$ short_name: chr "Water Level (m)"
  .. .. .. ..$ precision : chr "0.001000"
  .. .. .. ..$ subdesc   : chr "Available for release"
  .. .. .. ..$ variable  : chr "100.00"
  .. .. .. ..$ units     : chr "metres"
  .. .. .. ..$ name      : chr "Stream Water Level (m)"
  .. ..$ :List of 8
  .. .. ..$ error_num      : int 0
  .. .. ..$ compressed     : chr "0"
  .. .. ..$ site_details   :List of 6
  .. .. .. ..$ timezone  : chr "10.0"
  .. .. .. ..$ short_name: chr "BARWON @ GEELONG"
  .. .. .. ..$ longitude : chr "144.346892190"
  .. .. .. ..$ name      : chr "BARWON RIVER @ GEELONG"
  .. .. .. ..$ latitude  : chr "-38.163605590"
  .. .. .. ..$ org_name  : chr "Dept. Sustainability and Environment"
  .. .. ..$ quality_codes  :List of 1
  .. .. .. ..$ 2: chr "Good quality data - minimal editing required. +/- 0mm - 10mm Drift correction"
  .. .. ..$ trace          :List of 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.80"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.82"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.94"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.90"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.71"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.59"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.52"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.64"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.95"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "8.11"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "8.01"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "8.14"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.85"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.92"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.79"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. ..$ varfrom_details:List of 6
  .. .. .. ..$ short_name: chr "Field pH"
  .. .. .. ..$ precision : chr "0.010000"
  .. .. .. ..$ subdesc   : chr "Available for release"
  .. .. .. ..$ variable  : chr "210.00"
  .. .. .. ..$ units     : chr "pH"
  .. .. .. ..$ name      : chr "Acidity/Alkalinity (pH)"
  .. .. ..$ site           : chr "233217"
  .. .. ..$ varto_details  :List of 6
  .. .. .. ..$ short_name: chr "Field pH"
  .. .. .. ..$ precision : chr "0.010000"
  .. .. .. ..$ subdesc   : chr "Available for release"
  .. .. .. ..$ variable  : chr "210.00"
  .. .. .. ..$ units     : chr "pH"
  .. .. .. ..$ name      : chr "Acidity/Alkalinity (pH)"</code></pre>
</div>
</div>
<p>That works, seems to set the varfrom and varto to each value in the list. I wonder if things like 141 are done in the from/to way because they are derived from 100. But how do we find them when they don’t appear in the <code>get_variable_list</code>? Can I include them in <code>var_list</code>? Hmm. No.&nbsp;what’s going on? <em>see table 3 in qld doc- they are derived, and it gives numbers</em>. Is there a <code>get_available_varcons</code> or similar?</p>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-47_2f2375ffa9353d651398aaa99395187f">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>bparams <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"function"</span> <span class="ot">=</span> <span class="st">'get_ts_traces'</span>,</span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"version"</span> <span class="ot">=</span> <span class="st">"2"</span>,</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">"params"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"site_list"</span> <span class="ot">=</span> <span class="st">"233217"</span>,</span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"start_time"</span> <span class="ot">=</span> <span class="st">"20200101000000"</span>,</span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"var_list"</span> <span class="ot">=</span> <span class="st">"100,141,210"</span>,</span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"interval"</span> <span class="ot">=</span> <span class="st">"day"</span>,</span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"datasource"</span> <span class="ot">=</span> <span class="st">"A"</span>,</span>
<span id="cb123-8"><a href="#cb123-8" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"end_time"</span> <span class="ot">=</span> <span class="st">"20200115000000"</span>,</span>
<span id="cb123-9"><a href="#cb123-9" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"data_type"</span> <span class="ot">=</span> <span class="st">"mean"</span>,</span>
<span id="cb123-10"><a href="#cb123-10" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"multiplier"</span> <span class="ot">=</span> <span class="st">"1"</span>))</span>
<span id="cb123-11"><a href="#cb123-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-12"><a href="#cb123-12" aria-hidden="true" tabindex="-1"></a>req <span class="ot">&lt;-</span> <span class="fu">request</span>(vicurl)</span>
<span id="cb123-13"><a href="#cb123-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-14"><a href="#cb123-14" aria-hidden="true" tabindex="-1"></a>req <span class="sc">%&gt;%</span> </span>
<span id="cb123-15"><a href="#cb123-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(bparams) <span class="sc">%&gt;%</span> </span>
<span id="cb123-16"><a href="#cb123-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_dry_run</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>POST /cgi/webservice.exe? HTTP/1.1
Host: data.water.vic.gov.au
User-Agent: httr2/0.2.2 r-curl/4.3.3 libcurl/7.64.1
Accept: */*
Accept-Encoding: deflate, gzip
Content-Type: application/json
Content-Length: 227

{"function":"get_ts_traces","version":"2","params":{"site_list":"233217","start_time":"20200101000000","var_list":"100,141,210","interval":"day","datasource":"A","end_time":"20200115000000","data_type":"mean","multiplier":"1"}}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>respb <span class="ot">&lt;-</span> req <span class="sc">%&gt;%</span> </span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(bparams) <span class="sc">%&gt;%</span> </span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>rbodyb <span class="ot">&lt;-</span> respb <span class="sc">%&gt;%</span> <span class="fu">resp_body_json</span>(<span class="at">check_type =</span> <span class="cn">FALSE</span>)</span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(rbodyb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ error_num: int 0
 $ return   :List of 1
  ..$ traces:List of 2
  .. ..$ :List of 8
  .. .. ..$ error_num      : int 0
  .. .. ..$ compressed     : chr "0"
  .. .. ..$ site_details   :List of 6
  .. .. .. ..$ timezone  : chr "10.0"
  .. .. .. ..$ short_name: chr "BARWON @ GEELONG"
  .. .. .. ..$ longitude : chr "144.346892190"
  .. .. .. ..$ name      : chr "BARWON RIVER @ GEELONG"
  .. .. .. ..$ latitude  : chr "-38.163605590"
  .. .. .. ..$ org_name  : chr "Dept. Sustainability and Environment"
  .. .. ..$ quality_codes  :List of 2
  .. .. .. ..$ 2 : chr "Good quality data - minimal editing required. +/- 0mm - 10mm Drift correction"
  .. .. .. ..$ 15: chr "Minor editing. +/-11mm - 20mm drift correction"
  .. .. ..$ trace          :List of 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.838"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.834"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.827"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.821"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.816"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.814"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.811"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.802"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.791"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.805"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.831"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.824"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.820"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.812"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.817"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. ..$ varfrom_details:List of 6
  .. .. .. ..$ short_name: chr "Water Level (m)"
  .. .. .. ..$ precision : chr "0.001000"
  .. .. .. ..$ subdesc   : chr "Available for release"
  .. .. .. ..$ variable  : chr "100.00"
  .. .. .. ..$ units     : chr "metres"
  .. .. .. ..$ name      : chr "Stream Water Level (m)"
  .. .. ..$ site           : chr "233217"
  .. .. ..$ varto_details  :List of 6
  .. .. .. ..$ short_name: chr "Water Level (m)"
  .. .. .. ..$ precision : chr "0.001000"
  .. .. .. ..$ subdesc   : chr "Available for release"
  .. .. .. ..$ variable  : chr "100.00"
  .. .. .. ..$ units     : chr "metres"
  .. .. .. ..$ name      : chr "Stream Water Level (m)"
  .. ..$ :List of 8
  .. .. ..$ error_num      : int 0
  .. .. ..$ compressed     : chr "0"
  .. .. ..$ site_details   :List of 6
  .. .. .. ..$ timezone  : chr "10.0"
  .. .. .. ..$ short_name: chr "BARWON @ GEELONG"
  .. .. .. ..$ longitude : chr "144.346892190"
  .. .. .. ..$ name      : chr "BARWON RIVER @ GEELONG"
  .. .. .. ..$ latitude  : chr "-38.163605590"
  .. .. .. ..$ org_name  : chr "Dept. Sustainability and Environment"
  .. .. ..$ quality_codes  :List of 1
  .. .. .. ..$ 2: chr "Good quality data - minimal editing required. +/- 0mm - 10mm Drift correction"
  .. .. ..$ trace          :List of 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.80"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.82"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.94"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.90"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.71"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.59"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.52"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.64"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.95"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "8.11"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "8.01"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "8.14"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.85"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.92"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.79"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. ..$ varfrom_details:List of 6
  .. .. .. ..$ short_name: chr "Field pH"
  .. .. .. ..$ precision : chr "0.010000"
  .. .. .. ..$ subdesc   : chr "Available for release"
  .. .. .. ..$ variable  : chr "210.00"
  .. .. .. ..$ units     : chr "pH"
  .. .. .. ..$ name      : chr "Acidity/Alkalinity (pH)"
  .. .. ..$ site           : chr "233217"
  .. .. ..$ varto_details  :List of 6
  .. .. .. ..$ short_name: chr "Field pH"
  .. .. .. ..$ precision : chr "0.010000"
  .. .. .. ..$ subdesc   : chr "Available for release"
  .. .. .. ..$ variable  : chr "210.00"
  .. .. .. ..$ units     : chr "pH"
  .. .. .. ..$ name      : chr "Acidity/Alkalinity (pH)"</code></pre>
</div>
</div>
<p>How about asking for variables that don’t exist- ie can we just ask for all of them, and it just gives us whatever’s available? The other site (Steavenson, 405328) only has variable 100, so ask for some others. Just gives 100.</p>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-48_a6391da647cf02a586c3c995da47e0eb">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>sparams <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"function"</span> <span class="ot">=</span> <span class="st">'get_ts_traces'</span>,</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"version"</span> <span class="ot">=</span> <span class="st">"2"</span>,</span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">"params"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"site_list"</span> <span class="ot">=</span> <span class="st">"405328"</span>,</span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"start_time"</span> <span class="ot">=</span> <span class="st">"20200101000000"</span>,</span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"var_list"</span> <span class="ot">=</span> <span class="st">"100,210"</span>,</span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"interval"</span> <span class="ot">=</span> <span class="st">"day"</span>,</span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"datasource"</span> <span class="ot">=</span> <span class="st">"A"</span>, </span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"end_time"</span> <span class="ot">=</span> <span class="st">"20200115000000"</span>,</span>
<span id="cb127-9"><a href="#cb127-9" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"data_type"</span> <span class="ot">=</span> <span class="st">"mean"</span>,</span>
<span id="cb127-10"><a href="#cb127-10" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"multiplier"</span> <span class="ot">=</span> <span class="st">"1"</span>))</span>
<span id="cb127-11"><a href="#cb127-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-12"><a href="#cb127-12" aria-hidden="true" tabindex="-1"></a>req <span class="ot">&lt;-</span> <span class="fu">request</span>(vicurl)</span>
<span id="cb127-13"><a href="#cb127-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-14"><a href="#cb127-14" aria-hidden="true" tabindex="-1"></a>req <span class="sc">%&gt;%</span> </span>
<span id="cb127-15"><a href="#cb127-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(sparams) <span class="sc">%&gt;%</span> </span>
<span id="cb127-16"><a href="#cb127-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_dry_run</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>POST /cgi/webservice.exe? HTTP/1.1
Host: data.water.vic.gov.au
User-Agent: httr2/0.2.2 r-curl/4.3.3 libcurl/7.64.1
Accept: */*
Accept-Encoding: deflate, gzip
Content-Type: application/json
Content-Length: 223

{"function":"get_ts_traces","version":"2","params":{"site_list":"405328","start_time":"20200101000000","var_list":"100,210","interval":"day","datasource":"A","end_time":"20200115000000","data_type":"mean","multiplier":"1"}}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>resps <span class="ot">&lt;-</span> req <span class="sc">%&gt;%</span> </span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(sparams) <span class="sc">%&gt;%</span> </span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>rbodys <span class="ot">&lt;-</span> resps <span class="sc">%&gt;%</span> <span class="fu">resp_body_json</span>(<span class="at">check_type =</span> <span class="cn">FALSE</span>)</span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(rbodys)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ error_num: int 0
 $ return   :List of 1
  ..$ traces:List of 1
  .. ..$ :List of 8
  .. .. ..$ error_num      : int 0
  .. .. ..$ compressed     : chr "0"
  .. .. ..$ site_details   :List of 6
  .. .. .. ..$ timezone  : chr "10.0"
  .. .. .. ..$ short_name: chr "STEAVENSON R @ FALLS"
  .. .. .. ..$ longitude : chr "145.773503100"
  .. .. .. ..$ name      : chr "STEAVENSON RIVER @ FALLS ROAD MARYSVILLE"
  .. .. .. ..$ latitude  : chr "-37.525797590"
  .. .. .. ..$ org_name  : chr "Victorian Rural Water Corporation"
  .. .. ..$ quality_codes  :List of 1
  .. .. .. ..$ 2: chr "Good quality data - minimal editing required. +/- 0mm - 10mm Drift correction"
  .. .. ..$ trace          :List of 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.741"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.738"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.736"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.734"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.741"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.755"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.745"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.739"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.735"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.745"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.759"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.745"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.742"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.740"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.757"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. ..$ varfrom_details:List of 6
  .. .. .. ..$ short_name: chr "Water Level (m)"
  .. .. .. ..$ precision : chr "0.001000"
  .. .. .. ..$ subdesc   : chr "Available for release"
  .. .. .. ..$ variable  : chr "100.00"
  .. .. .. ..$ units     : chr "metres"
  .. .. .. ..$ name      : chr "Stream Water Level (m)"
  .. .. ..$ site           : chr "405328"
  .. .. ..$ varto_details  :List of 6
  .. .. .. ..$ short_name: chr "Water Level (m)"
  .. .. .. ..$ precision : chr "0.001000"
  .. .. .. ..$ subdesc   : chr "Available for release"
  .. .. .. ..$ variable  : chr "100.00"
  .. .. .. ..$ units     : chr "metres"
  .. .. .. ..$ name      : chr "Stream Water Level (m)"</code></pre>
</div>
</div>
<section id="can-we-get-derived-141-etc-with-varlist" class="level3">
<h3 class="anchored" data-anchor-id="can-we-get-derived-141-etc-with-varlist">Can we get derived (141, etc) with varlist</h3>
<p>It looks like it’s really just 140 (cumecs) and 141 (ML/d) we’d want, if Vic matches QLD. There are a couple other varcons, but they’re about groundwater.</p>
<p>Let’s see what <code>get_varcon</code> gives us. I can’t get this not to error, and the examples online have square brackets mixed in the json. I think some combo of <code>c</code> and <code>list</code> might do it but not worth it.</p>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-49_41c6d4aad7e2f8aad4141948be5b5c23">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>vc_params <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"function"</span> <span class="ot">=</span> <span class="st">'get_varcon'</span>,</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"version"</span> <span class="ot">=</span> <span class="st">"2"</span>,</span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">"params"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"varcons"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"varfrom"</span> <span class="ot">=</span> <span class="st">"100"</span>,</span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"varto"</span> <span class="ot">=</span> <span class="st">"141"</span>,</span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"site_list"</span> <span class="ot">=</span> <span class="st">"233217, 405328"</span>,</span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"datasource"</span> <span class="ot">=</span> <span class="st">"A"</span>,</span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"requests"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"qf1"</span> <span class="ot">=</span> <span class="st">"1"</span>, </span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a>                                                 <span class="st">"t1"</span> <span class="ot">=</span> <span class="st">"20200101000000"</span>,</span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a>                                                 <span class="st">"t2"</span> <span class="ot">=</span> <span class="st">"20200131000000"</span>))))</span>
<span id="cb131-10"><a href="#cb131-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-11"><a href="#cb131-11" aria-hidden="true" tabindex="-1"></a>req <span class="ot">&lt;-</span> <span class="fu">request</span>(vicurl)</span>
<span id="cb131-12"><a href="#cb131-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-13"><a href="#cb131-13" aria-hidden="true" tabindex="-1"></a>req <span class="sc">%&gt;%</span> </span>
<span id="cb131-14"><a href="#cb131-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(vc_params) <span class="sc">%&gt;%</span> </span>
<span id="cb131-15"><a href="#cb131-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_dry_run</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>POST /cgi/webservice.exe? HTTP/1.1
Host: data.water.vic.gov.au
User-Agent: httr2/0.2.2 r-curl/4.3.3 libcurl/7.64.1
Accept: */*
Accept-Encoding: deflate, gzip
Content-Type: application/json
Content-Length: 205

{"function":"get_varcon","version":"2","params":{"varcons":{"varfrom":"100","varto":"141","site_list":"233217, 405328","datasource":"A","requests":{"qf1":"1","t1":"20200101000000","t2":"20200131000000"}}}}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>resp_vc <span class="ot">&lt;-</span> req <span class="sc">%&gt;%</span> </span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(vc_params) <span class="sc">%&gt;%</span> </span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a>rbody_vc <span class="ot">&lt;-</span> resp_vc <span class="sc">%&gt;%</span> <span class="fu">resp_body_json</span>(<span class="at">check_type =</span> <span class="cn">FALSE</span>)</span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(rbody_vc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 3
 $ error_num: int 124
 $ error_msg: chr "Access violation at address 005203ED in module 'webservice.exe'. Read of address 00000008"
 $ return   :List of 1
  ..$ varcons: list()</code></pre>
</div>
</div>
<p>This isn’t worth it. If we ask for 141 or 140, just do another round with varfrom and varto. Or always get 100, 140, 141, then only sometimes get the others if asked?</p>
</section>
</section>
<section id="geolocation" class="level2">
<h2 class="anchored" data-anchor-id="geolocation">Geolocation</h2>
<p>So, <code>get_db_info</code> seems to have a way to get sites by radius or bounding box.. And the flipside is we might want to get sites within a polygon, and so need their locations, which should be available as geoJSON. Try to figure both those out.</p>
<p>I think <code>get_site_geojson</code> is going to be simpler. start there. Not sure why the <code>site_list</code> <em>can’t</em> have a <code>c()</code>, but the <code>fields</code> <em>has to</em> use it. Works though, gives a feature list. I think those are readable by <code>sf</code>, so that’s good. Not sure what the fields even are though. The help says “Any field that is part of the site table”. So I guess we need to sort that out. On to <code>get_db_info</code>.</p>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-50_13c69adf9957c36811b57e2b4b9ae2a3">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>g_j_params <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"function"</span> <span class="ot">=</span> <span class="st">'get_site_geojson'</span>,</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"version"</span> <span class="ot">=</span> <span class="st">"2"</span>,</span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">"params"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"site_list"</span> <span class="ot">=</span> <span class="st">"233217, 405328"</span>,</span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"get_elev"</span> <span class="ot">=</span> <span class="st">"1"</span>,</span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"fields"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"zone"</span>,<span class="st">"region"</span>)))</span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a>req <span class="ot">&lt;-</span> <span class="fu">request</span>(vicurl)</span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-9"><a href="#cb135-9" aria-hidden="true" tabindex="-1"></a>req <span class="sc">%&gt;%</span> </span>
<span id="cb135-10"><a href="#cb135-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(g_j_params) <span class="sc">%&gt;%</span> </span>
<span id="cb135-11"><a href="#cb135-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_dry_run</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>POST /cgi/webservice.exe? HTTP/1.1
Host: data.water.vic.gov.au
User-Agent: httr2/0.2.2 r-curl/4.3.3 libcurl/7.64.1
Accept: */*
Accept-Encoding: deflate, gzip
Content-Type: application/json
Content-Length: 127

{"function":"get_site_geojson","version":"2","params":{"site_list":"233217, 405328","get_elev":"1","fields":["zone","region"]}}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>resp_g_j <span class="ot">&lt;-</span> req <span class="sc">%&gt;%</span> </span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(g_j_params) <span class="sc">%&gt;%</span> </span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a>rbody_g_j <span class="ot">&lt;-</span> resp_g_j <span class="sc">%&gt;%</span> <span class="fu">resp_body_json</span>(<span class="at">check_type =</span> <span class="cn">FALSE</span>)</span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-7"><a href="#cb137-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(rbody_g_j)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ error_num: int 0
 $ return   :List of 2
  ..$ features:List of 2
  .. ..$ :List of 4
  .. .. ..$ properties:List of 2
  .. .. .. ..$ region: chr "233"
  .. .. .. ..$ zone  : int 55
  .. .. ..$ geometry  :List of 2
  .. .. .. ..$ coordinates:List of 3
  .. .. .. .. ..$ : num 144
  .. .. .. .. ..$ : num -38.2
  .. .. .. .. ..$ : int 0
  .. .. .. ..$ type       : chr "Point"
  .. .. ..$ id        : chr "233217"
  .. .. ..$ type      : chr "Feature"
  .. ..$ :List of 4
  .. .. ..$ properties:List of 2
  .. .. .. ..$ region: chr "405"
  .. .. .. ..$ zone  : int 55
  .. .. ..$ geometry  :List of 2
  .. .. .. ..$ coordinates:List of 3
  .. .. .. .. ..$ : num 146
  .. .. .. .. ..$ : num -37.5
  .. .. .. .. ..$ : int 0
  .. .. .. ..$ type       : chr "Point"
  .. .. ..$ id        : chr "405328"
  .. .. ..$ type      : chr "Feature"
  ..$ type    : chr "FeatureCollection"</code></pre>
</div>
</div>
</section>
<section id="db-info" class="level2">
<h2 class="anchored" data-anchor-id="db-info">DB info</h2>
<p>I was using <code>get_db_info</code> to test above, so let’s just go back to that as a start and think a bit more about what we want. look at the barown. Cannot feed it a list of sites for <code>fitler_values</code>. It does give lat/long/northing, etc, so could use this instead of geoJSON, but geoJSON probably better if we want geo. Using <code>return_type = hash</code> is not noticably different than <code>return_type = array</code>. All examples use hash, so I guess keep using that moving forward. I think we can filter on lots of things in this list, both here and in the geojson.</p>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-51_964915e622e54981b5ce045f69684b62">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>dbparams <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"function"</span> <span class="ot">=</span> <span class="st">'get_db_info'</span>,</span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"version"</span> <span class="ot">=</span> <span class="st">"3"</span>,</span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">"params"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"table_name"</span> <span class="ot">=</span> <span class="st">"site"</span>,</span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"return_type"</span> <span class="ot">=</span> <span class="st">"array"</span>,</span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"filter_values"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"station"</span> <span class="ot">=</span> <span class="st">"233217"</span>)))</span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a>req <span class="ot">&lt;-</span> <span class="fu">request</span>(vicurl)</span>
<span id="cb139-8"><a href="#cb139-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-9"><a href="#cb139-9" aria-hidden="true" tabindex="-1"></a>req <span class="sc">%&gt;%</span> </span>
<span id="cb139-10"><a href="#cb139-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(dbparams) <span class="sc">%&gt;%</span> </span>
<span id="cb139-11"><a href="#cb139-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_dry_run</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>POST /cgi/webservice.exe? HTTP/1.1
Host: data.water.vic.gov.au
User-Agent: httr2/0.2.2 r-curl/4.3.3 libcurl/7.64.1
Accept: */*
Accept-Encoding: deflate, gzip
Content-Type: application/json
Content-Length: 130

{"function":"get_db_info","version":"3","params":{"table_name":"site","return_type":"array","filter_values":{"station":"233217"}}}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>respdb <span class="ot">&lt;-</span> req <span class="sc">%&gt;%</span> </span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(dbparams) <span class="sc">%&gt;%</span> </span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a>rbodydb <span class="ot">&lt;-</span> respdb <span class="sc">%&gt;%</span> <span class="fu">resp_body_json</span>(<span class="at">check_type =</span> <span class="cn">FALSE</span>)</span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(rbodydb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ error_num: int 0
 $ return   :List of 1
  ..$ rows:List of 1
  .. ..$ :List of 62
  .. .. ..$ category20: chr ""
  .. .. ..$ category19: chr ""
  .. .. ..$ category18: chr ""
  .. .. ..$ category17: chr ""
  .. .. ..$ category16: chr ""
  .. .. ..$ category15: chr ""
  .. .. ..$ category14: chr ""
  .. .. ..$ category13: chr ""
  .. .. ..$ category12: chr ""
  .. .. ..$ category11: chr ""
  .. .. ..$ category10: chr "THIESS"
  .. .. ..$ active    : logi TRUE
  .. .. ..$ northing  : chr "5772691.000"
  .. .. ..$ timezone  : chr "10.0"
  .. .. ..$ shortname : chr "BARWON @ GEELONG"
  .. .. ..$ datecreate: int 18991230
  .. .. ..$ elevdatum : chr ""
  .. .. ..$ stname    : chr "BARWON RIVER @ GEELONG"
  .. .. ..$ category9 : chr "N/A"
  .. .. ..$ category8 : chr "G"
  .. .. ..$ category7 : chr "G"
  .. .. ..$ category6 : chr "2WD"
  .. .. ..$ category5 : chr "0"
  .. .. ..$ category4 : chr "150"
  .. .. ..$ category3 : chr "SEALED"
  .. .. ..$ category2 : chr "V_93G4"
  .. .. ..$ category1 : chr "0"
  .. .. ..$ elevacc   : chr "1"
  .. .. ..$ dbver47   : logi FALSE
  .. .. ..$ quarter   : chr "Y"
  .. .. ..$ section   : int 0
  .. .. ..$ commence  : int 19601118
  .. .. ..$ parent    : chr ""
  .. .. ..$ mapname   : chr "GEE/SW"
  .. .. ..$ meridian  : chr ""
  .. .. ..$ spare5    : chr ""
  .. .. ..$ spare4    : chr ""
  .. .. ..$ spare3    : chr ""
  .. .. ..$ spare2    : chr ""
  .. .. ..$ spare1    : chr "BW"
  .. .. ..$ posacc    : chr "9"
  .. .. ..$ timemod   : int 1359
  .. .. ..$ region    : chr "233"
  .. .. ..$ grdatum   : chr "UTM"
  .. .. ..$ township  : chr ""
  .. .. ..$ longitude : chr "144.346892190"
  .. .. ..$ comment   : chr "\r\n\r\n\r\nBarwon Water flood monitoring stationFrom the intersection of the Fyans St and La Trobe Terrace, he"| __truncated__
  .. .. ..$ lldatum   : chr "WGS84"
  .. .. ..$ station   : chr "233217"
  .. .. ..$ datemod   : int 20220513
  .. .. ..$ timecreate: int 0
  .. .. ..$ orgcode   : chr "DSE"
  .. .. ..$ barcode   : chr "Geelong"
  .. .. ..$ zone      : int 55
  .. .. ..$ elev      : chr "0.000"
  .. .. ..$ cease     : int 18991230
  .. .. ..$ local_map : chr "GEELONG"
  .. .. ..$ latitude  : chr "-38.163605590"
  .. .. ..$ range     : chr ""
  .. .. ..$ qquarter  : chr "Y"
  .. .. ..$ easting   : chr "267562.000"
  .. .. ..$ stntype   : chr "VIR"</code></pre>
</div>
</div>
<section id="geofiltering-the-db-to-select-sites" class="level3">
<h3 class="anchored" data-anchor-id="geofiltering-the-db-to-select-sites">Geofiltering the db to select sites</h3>
<p>OK, so there are lots of ways to filter (sitename, date, name, etc). Some of those like Name or region or active might be useful, but for now let’s try the geo filters (boudning box and radius).</p>
<p>Try circle (lat, long, radius in degrees)- use the Barwon lat/long.</p>
<p>Keeps crashing with timeouts. is it just too much to ask for? Or is the json not right?</p>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-52_8b9f8a1942f6894782c0fa0651e92e1d">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dbparams &lt;- list("function" = 'get_db_info',</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a><span class="co">#                "version" = "3",</span></span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a><span class="co">#                "params" = list("table_name" = "site",</span></span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a><span class="co">#                                "return_type" = "hash",</span></span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a><span class="co">#                                "geo_filter" = list("circle" = c("-38.16", "144.35", "0.25"))))</span></span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb143-7"><a href="#cb143-7" aria-hidden="true" tabindex="-1"></a><span class="co"># req &lt;- request(vicurl)</span></span>
<span id="cb143-8"><a href="#cb143-8" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb143-9"><a href="#cb143-9" aria-hidden="true" tabindex="-1"></a><span class="co"># req %&gt;% </span></span>
<span id="cb143-10"><a href="#cb143-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   req_body_json(dbparams) %&gt;% </span></span>
<span id="cb143-11"><a href="#cb143-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   req_dry_run()</span></span>
<span id="cb143-12"><a href="#cb143-12" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb143-13"><a href="#cb143-13" aria-hidden="true" tabindex="-1"></a><span class="co"># respdb &lt;- req %&gt;% </span></span>
<span id="cb143-14"><a href="#cb143-14" aria-hidden="true" tabindex="-1"></a><span class="co">#   req_body_json(dbparams) %&gt;% </span></span>
<span id="cb143-15"><a href="#cb143-15" aria-hidden="true" tabindex="-1"></a><span class="co">#   req_perform()</span></span>
<span id="cb143-16"><a href="#cb143-16" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb143-17"><a href="#cb143-17" aria-hidden="true" tabindex="-1"></a><span class="co"># rbodydb &lt;- respdb %&gt;% resp_body_json(check_type = FALSE)</span></span>
<span id="cb143-18"><a href="#cb143-18" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb143-19"><a href="#cb143-19" aria-hidden="true" tabindex="-1"></a><span class="co"># str(rbodydb)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s try one of the other geofilters. Otherwise this will work better to write my own if I can et the geojson of all the sites.</p>
<p>Ugh. the rectangle (and region) need nested square brackets. I can make one with c(),</p>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-53_52971e25185cedec27ce1e27ad374211">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>dbparams <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"function"</span> <span class="ot">=</span> <span class="st">'get_db_info'</span>,</span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"version"</span> <span class="ot">=</span> <span class="st">"3"</span>,</span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">"params"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"table_name"</span> <span class="ot">=</span> <span class="st">"site"</span>,</span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"return_type"</span> <span class="ot">=</span> <span class="st">"hash"</span>,</span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"geo_filter"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"rectangle"</span> <span class="ot">=</span> </span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a>                                                     <span class="fu">c</span>(<span class="fu">c</span>(<span class="st">"-38.126"</span>, <span class="st">"144.282"</span>),</span>
<span id="cb144-7"><a href="#cb144-7" aria-hidden="true" tabindex="-1"></a>                                                       <span class="fu">c</span>(<span class="st">"-38.223"</span>, <span class="st">"144.406"</span>)))))</span>
<span id="cb144-8"><a href="#cb144-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-9"><a href="#cb144-9" aria-hidden="true" tabindex="-1"></a>req <span class="ot">&lt;-</span> <span class="fu">request</span>(vicurl)</span>
<span id="cb144-10"><a href="#cb144-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-11"><a href="#cb144-11" aria-hidden="true" tabindex="-1"></a>req <span class="sc">%&gt;%</span> </span>
<span id="cb144-12"><a href="#cb144-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(dbparams) <span class="sc">%&gt;%</span> </span>
<span id="cb144-13"><a href="#cb144-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_dry_run</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>POST /cgi/webservice.exe? HTTP/1.1
Host: data.water.vic.gov.au
User-Agent: httr2/0.2.2 r-curl/4.3.3 libcurl/7.64.1
Accept: */*
Accept-Encoding: deflate, gzip
Content-Type: application/json
Content-Length: 161

{"function":"get_db_info","version":"3","params":{"table_name":"site","return_type":"hash","geo_filter":{"rectangle":["-38.126","144.282","-38.223","144.406"]}}}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a><span class="co"># respdb &lt;- req %&gt;% </span></span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   req_body_json(dbparams) %&gt;% </span></span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   req_perform()</span></span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb146-6"><a href="#cb146-6" aria-hidden="true" tabindex="-1"></a><span class="co"># rbodydb &lt;- respdb %&gt;% resp_body_json(check_type = FALSE)</span></span>
<span id="cb146-7"><a href="#cb146-7" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb146-8"><a href="#cb146-8" aria-hidden="true" tabindex="-1"></a><span class="co"># str(rbodydb)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>the locations of all guages it’d be</p>
<p>OK, generating the json for these geo selections is horrible. If I can pull faster to do it myself.</p>
<p>Can I get a complete gaugelist, nad then pull geojson?</p>
</section>
</section>
<section id="get-all-gauges" class="level2">
<h2 class="anchored" data-anchor-id="get-all-gauges">Get all gauges</h2>
<p>What’s the best way? with get_db_info? With <code>get_sites_by_datasource</code>? The latter would assume we know all datasources. We probably <em>do</em> just want those in ‘A’ but not positive.</p>
<p>So, how about db_info, but maybe not <em>all</em> columns? Tempted to get lat/long or easting/northing.</p>
<p>Takes a while, but it does run. 189,464 sites??? Yikes. WHY? Clearly i need to filter on <em>something</em>.</p>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-54_021ac0a547611da0f2c0b49849cedbf1">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>dbparams <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"function"</span> <span class="ot">=</span> <span class="st">'get_db_info'</span>,</span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"version"</span> <span class="ot">=</span> <span class="st">"3"</span>,</span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">"params"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"table_name"</span> <span class="ot">=</span> <span class="st">"site"</span>,</span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"return_type"</span> <span class="ot">=</span> <span class="st">"array"</span>,</span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"field_list"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"station"</span>, <span class="st">"stname"</span>, <span class="st">"shortname"</span>)))</span>
<span id="cb147-6"><a href="#cb147-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-7"><a href="#cb147-7" aria-hidden="true" tabindex="-1"></a>req <span class="ot">&lt;-</span> <span class="fu">request</span>(vicurl)</span>
<span id="cb147-8"><a href="#cb147-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-9"><a href="#cb147-9" aria-hidden="true" tabindex="-1"></a>req <span class="sc">%&gt;%</span> </span>
<span id="cb147-10"><a href="#cb147-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(dbparams) <span class="sc">%&gt;%</span> </span>
<span id="cb147-11"><a href="#cb147-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_dry_run</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>POST /cgi/webservice.exe? HTTP/1.1
Host: data.water.vic.gov.au
User-Agent: httr2/0.2.2 r-curl/4.3.3 libcurl/7.64.1
Accept: */*
Accept-Encoding: deflate, gzip
Content-Type: application/json
Content-Length: 139

{"function":"get_db_info","version":"3","params":{"table_name":"site","return_type":"array","field_list":["station","stname","shortname"]}}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>respdb <span class="ot">&lt;-</span> req <span class="sc">%&gt;%</span> </span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(dbparams) <span class="sc">%&gt;%</span> </span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a>rbodydb <span class="ot">&lt;-</span> respdb <span class="sc">%&gt;%</span> <span class="fu">resp_body_json</span>(<span class="at">check_type =</span> <span class="cn">FALSE</span>)</span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(rbodydb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ error_num: int 0
 $ return   :List of 1
  ..$ rows:List of 189491
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "0"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "044079"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "044387"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "045407"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "045621"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "045652"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "045717"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "092825"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "097421"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "097962"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100000"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100001"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100002"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100003"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100004"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100005"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100006"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100007"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100008"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100009"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100010"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100011"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100012"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100013"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100014"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100015"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100016"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100017"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100018"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100019"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100020"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100021"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100022"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100023"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100024"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100025"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100026"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100028"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100029"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100030"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100031"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100032"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100033"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100034"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100035"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100036"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100037"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100038"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100039"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100040"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100041"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100042"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100043"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100044"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100045"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100046"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100047"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100048"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100049"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100050"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100051"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100054"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100055"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100056"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100057"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100058"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100059"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100060"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100061"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100062"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100063"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100064"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100065"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100066"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100067"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100068"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100069"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100070"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100071"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100072"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100073"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100074"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100075"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100076"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100077"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100078"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100079"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100080"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100081"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100082"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100083"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100084"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100085"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100086"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100087"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100088"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100089"
  .. ..$ :List of 3
  .. .. ..$ shortname: chr ""
  .. .. ..$ stname   : chr ""
  .. .. ..$ station  : chr "100090"
  .. .. [list output truncated]</code></pre>
</div>
</div>
<p>what are the variables at some of those sites? Can we figure out what’s up that way? I have a feeling some are groundewater, but there’s no obvious field for that.</p>
<div class="cell" data-hash="vicwater_api_howtocall_cache/html/unnamed-chunk-55_8cf859d71bbdf36e3179b328903334f8">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a>v_s_params <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"function"</span> <span class="ot">=</span> <span class="st">'get_variable_list'</span>,</span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"version"</span> <span class="ot">=</span> <span class="st">"1"</span>,</span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">"params"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"site_list"</span> <span class="ot">=</span> <span class="st">"100089, 100079"</span>,</span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"datasource"</span> <span class="ot">=</span> <span class="st">"A"</span>))</span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a>req <span class="ot">&lt;-</span> <span class="fu">request</span>(vicurl)</span>
<span id="cb151-7"><a href="#cb151-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-8"><a href="#cb151-8" aria-hidden="true" tabindex="-1"></a>req <span class="sc">%&gt;%</span> </span>
<span id="cb151-9"><a href="#cb151-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(v_s_params) <span class="sc">%&gt;%</span> </span>
<span id="cb151-10"><a href="#cb151-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_dry_run</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>POST /cgi/webservice.exe? HTTP/1.1
Host: data.water.vic.gov.au
User-Agent: httr2/0.2.2 r-curl/4.3.3 libcurl/7.64.1
Accept: */*
Accept-Encoding: deflate, gzip
Content-Type: application/json
Content-Length: 103

{"function":"get_variable_list","version":"1","params":{"site_list":"100089, 100079","datasource":"A"}}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a>resp_v_s <span class="ot">&lt;-</span> req <span class="sc">%&gt;%</span> </span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(v_s_params) <span class="sc">%&gt;%</span> </span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a>rbody_v_s <span class="ot">&lt;-</span> resp_v_s <span class="sc">%&gt;%</span> <span class="fu">resp_body_json</span>(<span class="at">check_type =</span> <span class="cn">FALSE</span>)</span>
<span id="cb153-6"><a href="#cb153-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-7"><a href="#cb153-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(rbody_v_s)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ error_num: int 0
 $ return   :List of 1
  ..$ sites:List of 2
  .. ..$ :List of 3
  .. .. ..$ site_details:List of 3
  .. .. .. ..$ timezone  : chr "10.0"
  .. .. .. ..$ short_name: chr ""
  .. .. .. ..$ name      : chr ""
  .. .. ..$ variables   : list()
  .. .. ..$ site        : chr "100089"
  .. ..$ :List of 3
  .. .. ..$ site_details:List of 3
  .. .. .. ..$ timezone  : chr "10.0"
  .. .. .. ..$ short_name: chr ""
  .. .. .. ..$ name      : chr ""
  .. .. ..$ variables   : list()
  .. .. ..$ site        : chr "100079"</code></pre>
</div>
</div>
<p>Uhhh, those have no variables? WHat’s going on here?</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>