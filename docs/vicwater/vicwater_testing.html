<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Galen Holt">

<title>Galen - Testing VicWater API</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Galen</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../research.html">
 <span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../code_demos.html" aria-current="page">
 <span class="menu-text">Code Demos</span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Testing VicWater API</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../code_demos.html" class="sidebar-item-text sidebar-link">Code Demos</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Small how-tos</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../small_helpers/smallpieces.html" class="sidebar-item-text sidebar-link">Bits and pieces</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../setup/rstudio_themes.html" class="sidebar-item-text sidebar-link">Editing Rstudio themes</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../small_helpers/zip_downloading.html" class="sidebar-item-text sidebar-link">Download and unpack zips</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Plotting</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../plotting/tweaks_tricks.html" class="sidebar-item-text sidebar-link">Saving and themeing plots</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../plotting/hcl_exploration.html" class="sidebar-item-text sidebar-link">Exploring HCL colorspace</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../plotting/fonts.html" class="sidebar-item-text sidebar-link">Fonts</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../plotting/faded_colors.html" class="sidebar-item-text sidebar-link">Faded 2d colour ramps</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../plotting/math_in_ggplot.html" class="sidebar-item-text sidebar-link">Latex in ggplot with latex2exp</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">Theory and simulation</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../simmodelling/twoDautocorr.html" class="sidebar-item-text sidebar-link">Generate 2d autocorrelation</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">R and python</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/python_setup.html" class="sidebar-item-text sidebar-link">Python environments with pyenv and poetry</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/python_updated_functions.html" class="sidebar-item-text sidebar-link">Small python bits</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/RandPython.html" class="sidebar-item-text sidebar-link">Using R and python together</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/R_py_shared_projects.html" class="sidebar-item-text sidebar-link">Shared R-py project structure</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/py_r_dates.html" class="sidebar-item-text sidebar-link">Passing complex objects py-R</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">Setting things up</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/rig.html" class="sidebar-item-text sidebar-link">Managing old R versions with rig</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/quarto_website_github.html" class="sidebar-item-text sidebar-link">Getting this website working</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RpyEnvs/managingprivate.html" class="sidebar-item-text sidebar-link">Private data for website repo</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">Building packages</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../package/package_creation.html" class="sidebar-item-text sidebar-link">First pass at building a package</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vicwater/vicwater_testing.html" class="sidebar-item-text sidebar-link active">Testing VicWater API</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">Data</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../data_acquisition/bom_gauges.html" class="sidebar-item-text sidebar-link">BOM gauge locations with httr2</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vicwater/vicwater_api_howtocall.html" class="sidebar-item-text sidebar-link">Experimenting with API calls for {vicwater}</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#section" id="toc-section" class="nav-link active" data-scroll-target="#section"></a></li>
  <li><a href="#access-victoria-water-data-through-api" id="toc-access-victoria-water-data-through-api" class="nav-link" data-scroll-target="#access-victoria-water-data-through-api">Access Victoria water data through API</a></li>
  <li><a href="#set-up-params" id="toc-set-up-params" class="nav-link" data-scroll-target="#set-up-params">Set up params</a>
  <ul class="collapse">
  <li><a href="#url" id="toc-url" class="nav-link" data-scroll-target="#url">URL</a></li>
  <li><a href="#site-lists" id="toc-site-lists" class="nav-link" data-scroll-target="#site-lists">Site lists</a></li>
  </ul></li>
  <li><a href="#api-functions" id="toc-api-functions" class="nav-link" data-scroll-target="#api-functions">API functions</a>
  <ul class="collapse">
  <li><a href="#datasources" id="toc-datasources" class="nav-link" data-scroll-target="#datasources">Datasources</a></li>
  <li><a href="#test-from-the-package" id="toc-test-from-the-package" class="nav-link" data-scroll-target="#test-from-the-package">Test from the package</a></li>
  <li><a href="#sites-by-datasource" id="toc-sites-by-datasource" class="nav-link" data-scroll-target="#sites-by-datasource">Sites by datasource</a></li>
  <li><a href="#test-package-version" id="toc-test-package-version" class="nav-link" data-scroll-target="#test-package-version">Test package version</a></li>
  </ul></li>
  <li><a href="#variables" id="toc-variables" class="nav-link" data-scroll-target="#variables">Variables</a>
  <ul class="collapse">
  <li><a href="#get_variable_list" id="toc-get_variable_list" class="nav-link" data-scroll-target="#get_variable_list">Get_variable_list</a></li>
  <li><a href="#test-package-version-1" id="toc-test-package-version-1" class="nav-link" data-scroll-target="#test-package-version-1">Test package version</a></li>
  </ul></li>
  <li><a href="#get-traces" id="toc-get-traces" class="nav-link" data-scroll-target="#get-traces">get traces</a>
  <ul class="collapse">
  <li><a href="#unpack-different-formats" id="toc-unpack-different-formats" class="nav-link" data-scroll-target="#unpack-different-formats">unpack different formats</a></li>
  <li><a href="#cleaning-that-up" id="toc-cleaning-that-up" class="nav-link" data-scroll-target="#cleaning-that-up">Cleaning that up</a></li>
  <li><a href="#test-package-version-2" id="toc-test-package-version-2" class="nav-link" data-scroll-target="#test-package-version-2">Test package version</a></li>
  </ul></li>
  <li><a href="#a-variable-and-time-aware-version" id="toc-a-variable-and-time-aware-version" class="nav-link" data-scroll-target="#a-variable-and-time-aware-version">A variable and time-aware version</a>
  <ul class="collapse">
  <li><a href="#test-package-version-3" id="toc-test-package-version-3" class="nav-link" data-scroll-target="#test-package-version-3">Test package version</a></li>
  </ul></li>
  <li><a href="#benchmark" id="toc-benchmark" class="nav-link" data-scroll-target="#benchmark">Benchmark</a></li>
  <li><a href="#todo" id="toc-todo" class="nav-link" data-scroll-target="#todo">TODO</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Testing VicWater API</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Galen Holt </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="section" class="level2">
<h2 class="anchored" data-anchor-id="section"></h2>
<div class="cell" data-hash="vicwater_testing_cache/html/setup_7af3bb94274f2042173969afa27334aa">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="access-victoria-water-data-through-api" class="level2">
<h2 class="anchored" data-anchor-id="access-victoria-water-data-through-api">Access Victoria water data through API</h2>
<p>This document is my testing and development of functions to include in the <a href="https://github.com/galenholt/vicwater">{vicwater} package</a>. Basically, it’s where I interactively sorted through how to hit the API functions, the formats of the lists, and how to unpack the returned lists. It is a work in progress, since that package is under development.</p>
<p>We want to access <a href="https://data.water.vic.gov.au/static.htm">victorian water data</a> for a set of sites. That requires using the api at <strong>https://data.water.vic.gov.au/cgi/webservice.exe?[JSON_request]</strong> , but it’s poorly documented. I think I got it mostly figured out in <a href="../vicwater/vicwater_api_howtocall.html">a testing document</a>, but there’s a lot of extra testing in there that needs to be skipped over and cleaned up. My plan is to make this a package, but it needs more development. I’m moving further testing here so I can get to the point a bit quicker.</p>
<p>Libraries. Do I still need jsonlite now that I’ve moved ot httr2?</p>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-1_53339c0dbff2b94e0596a0e87441d350">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'stringr' was built under R version 4.2.2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'httr2' was built under R version 4.2.2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'ggplot2' was built under R version 4.2.2</code></pre>
</div>
</div>
</section>
<section id="set-up-params" class="level2">
<h2 class="anchored" data-anchor-id="set-up-params">Set up params</h2>
<section id="url" class="level3">
<h3 class="anchored" data-anchor-id="url">URL</h3>
<p>The base url that everything gets attached to is: and we use <code>httr2::request</code> to start building the request.</p>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-2_c4f142457be6879637473ade5ab35e18">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>vicurl <span class="ot">&lt;-</span> <span class="st">"https://data.water.vic.gov.au/cgi/webservice.exe?"</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>reqvic <span class="ot">&lt;-</span> <span class="fu">request</span>(vicurl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="site-lists" class="level3">
<h3 class="anchored" data-anchor-id="site-lists">Site lists</h3>
<p>I want to test with one, two, and several sites in a site list. I had tried to do <code>"sitelist" = c('site', 'site')</code> , and that failed. But it works to have <code>"site, site"</code></p>
<p>The upper steavenson is 405328, Barwon is 233217 (and has Temp), Taggerty 405331 only ran 2010-2013, And the Marysville golf course 405837 (only rainfall). That hits some things we want to make sure we pick up- no longer running gauges, gauges with only rain, gauges with lots of variables, etc.</p>
<p>I only make one site_list here with multiple, but can do the <code>str_c</code> inside the calls usually.</p>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-3_04e39bc3ebe411e8b8528ac38712dfdf">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>barwon <span class="ot">&lt;-</span> <span class="st">'233217'</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>steavenson <span class="ot">&lt;-</span> <span class="st">'405328'</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>taggerty <span class="ot">&lt;-</span> <span class="st">'405331'</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>golf <span class="ot">&lt;-</span> <span class="st">'405837'</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>allsites <span class="ot">&lt;-</span> <span class="fu">str_c</span>(barwon, steavenson, taggerty, golf, <span class="at">sep =</span> <span class="st">", "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="api-functions" class="level2">
<h2 class="anchored" data-anchor-id="api-functions">API functions</h2>
<p>And how to call each- including multiple values.</p>
<p>I finally found a couple sources of documentation that will hopefully be helpful: <a href="https://kisters.com.au/doco/hydllp.htm" class="uri">https://kisters.com.au/doco/hydllp.htm</a> and <a href="https://water-monitoring.information.qld.gov.au/wini/Documents/RDMW_API_doco.pdf" class="uri">https://water-monitoring.information.qld.gov.au/wini/Documents/RDMW_API_doco.pdf</a>.</p>
<p>The first thing to do is to figure out what basic information is there, so we can ask for it. What we really want is <code>get_ts_traces</code>, but it has a lot of parameters (see <a href="https://kisters.com.au/doco/hydllp.htm#get_ts_traces">Kisters docs</a>). Some are relatively straightforward to meaning, though how to get them to be correct JSON can be tricky (e.g.&nbsp;<code>site_list</code>, while others are opaque, e.g.&nbsp;<code>varfrom</code>, <code>varto</code>, <code>datasource</code>, either to their meaning or what the options are we can ask for. We can try to figure that out with some querying of the other functions.</p>
<section id="datasources" class="level3">
<h3 class="anchored" data-anchor-id="datasources">Datasources</h3>
<p>Can we figure out what datasource means by asking for some by site?</p>
<p><code>version</code> has to be 1.</p>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-4_c8787c1b50d68ebb9f85d828c17236da">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>ds_s_params <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"function"</span> <span class="ot">=</span> <span class="st">'get_datasources_by_site'</span>,</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"version"</span> <span class="ot">=</span> <span class="st">"1"</span>,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">"params"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"site_list"</span> <span class="ot">=</span> allsites))</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>reqvic <span class="sc">%&gt;%</span> </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(ds_s_params) <span class="sc">%&gt;%</span> </span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_dry_run</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>POST /cgi/webservice.exe? HTTP/1.1
Host: data.water.vic.gov.au
User-Agent: httr2/0.2.2 r-curl/4.3.3 libcurl/7.64.1
Accept: */*
Accept-Encoding: deflate, gzip
Content-Type: application/json
Content-Length: 108

{"function":"get_datasources_by_site","version":"1","params":{"site_list":"233217, 405328, 405331, 405837"}}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>resp_ds_s <span class="ot">&lt;-</span> reqvic <span class="sc">%&gt;%</span> </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(ds_s_params) <span class="sc">%&gt;%</span> </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>rbody_ds_s <span class="ot">&lt;-</span> resp_ds_s <span class="sc">%&gt;%</span> <span class="fu">resp_body_json</span>(<span class="at">check_type =</span> <span class="cn">FALSE</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(rbody_ds_s)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ error_num: int 0
 $ return   :List of 1
  ..$ sites:List of 4
  .. ..$ :List of 2
  .. .. ..$ site       : chr "233217"
  .. .. ..$ datasources:List of 3
  .. .. .. ..$ : chr "A"
  .. .. .. ..$ : chr "TELEM"
  .. .. .. ..$ : chr "TELEMCOPY"
  .. ..$ :List of 2
  .. .. ..$ site       : chr "405328"
  .. .. ..$ datasources:List of 3
  .. .. .. ..$ : chr "A"
  .. .. .. ..$ : chr "TELEM"
  .. .. .. ..$ : chr "TELEMCOPY"
  .. ..$ :List of 2
  .. .. ..$ site       : chr "405331"
  .. .. ..$ datasources:List of 2
  .. .. .. ..$ : chr "A"
  .. .. .. ..$ : chr "TELEM"
  .. ..$ :List of 2
  .. .. ..$ site       : chr "405837"
  .. .. ..$ datasources:List of 3
  .. .. .. ..$ : chr "A"
  .. .. .. ..$ : chr "TELEM"
  .. .. .. ..$ : chr "TELEMCOPY"</code></pre>
</div>
</div>
<p>I’ll need to sort out how to unpack that list later, but for now, let’s just look at it and see that all of them have options <code>A</code> and <code>TELEM</code>, and a couple have <code>TELEMCOPY</code>.</p>
<p>According to the QLD pdf, the datasource distinguishes things like Archive and Telemetry. That’s similar in Vic, though QLD also had codes for back-filled holes, which don’t seem to be here (at least at these sites).</p>
<p>Seems like it will be safest to ask for ‘A’ or ‘TELEM’.</p>
<p>And the different variables can be in a <code>var_list</code> or <code>varto</code> and <code>varfrom</code> (though not always- see below). The numbers are for different variables, but again, no guarantee they’re the same in Vic.</p>
<section id="unpacking-the-list" class="level4">
<h4 class="anchored" data-anchor-id="unpacking-the-list">unpacking the list</h4>
<p>I might as well do this and build the function. Should be able to do it with <code>unnest</code>, and then maybe drop dumb columns? Nope, some of the lists unpack into lists of mixed type. But <code>unnest_wider</code> and <code>unnest_longer</code> might be the trick. Will need to test with single sites in case the structure changes.</p>
<p>For the function, we probably want to just print the error value or something, and not return it in the df. Or if it errors, return that, if it doesn’t, just give df. That’s probably best.</p>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-5_5b1455087a4d4f096b36ad1f09b780ce">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(rbody_ds_s[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> <span class="co"># the [2] drops the error column</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(<span class="at">col =</span> <span class="fu">where</span>(is.list)) <span class="sc">%&gt;%</span> <span class="co"># error and a `return` list</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> <span class="fu">where</span>(is.list)) <span class="sc">%&gt;%</span> <span class="co"># error, site, and a `datasources` list</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(<span class="at">col =</span> <span class="fu">where</span>(is.list)) <span class="co"># fully unpacked into a long df</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>a</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 2
   site   datasources
   &lt;chr&gt;  &lt;chr&gt;      
 1 233217 A          
 2 233217 TELEM      
 3 233217 TELEMCOPY  
 4 405328 A          
 5 405328 TELEM      
 6 405328 TELEMCOPY  
 7 405331 A          
 8 405331 TELEM      
 9 405837 A          
10 405837 TELEM      
11 405837 TELEMCOPY  </code></pre>
</div>
</div>
<p>Might actually be better as a table or <code>pivot_wider</code>? Depends what the point is? Pivot wider is kind of a pain, use table? But table actually unpacks longer when I as_tibble or as.data.frame it. Which is annoying.</p>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-6_dc9c609cbead1f0a5d23353f7f10f47e">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">table</span>(a<span class="sc">$</span>site, a<span class="sc">$</span>datasources)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>b</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        
         A TELEM TELEMCOPY
  233217 1     1         1
  405328 1     1         1
  405331 1     1         0
  405837 1     1         1</code></pre>
</div>
</div>
<p>I think just return the long tibble, and do the table as a plot or explicitly a table or something. Which orientation makes most sense? Not sure. Probably gauges on x? But plots of actual data will have gauges on y, time on x, so maybe stay consistent.</p>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-7_de10b5c4b4dc0008d8e0209c174a6789">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> b <span class="sc">%&gt;%</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">.name_repair =</span> <span class="st">'unique'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">gauge =</span> <span class="st">`</span><span class="at">...1</span><span class="st">`</span>, <span class="at">datasource =</span> <span class="st">`</span><span class="at">...2</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
• `` -&gt; `...1`
• `` -&gt; `...2`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>c <span class="sc">%&gt;%</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n =</span> <span class="fu">as.logical</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> datasource, <span class="at">y =</span> gauge, <span class="at">fill =</span> n)) <span class="sc">+</span> </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_tile</span>(<span class="at">colour=</span><span class="st">"white"</span>, <span class="at">size=</span><span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_discrete</span>(<span class="at">type =</span> <span class="fu">c</span>(<span class="st">'firebrick'</span>, <span class="st">'dodgerblue'</span>)) <span class="sc">+</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">fill =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">coord_equal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="vicwater_testing_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Can I just build that plot from a? Yes, but would be just as annoying. maybe.</p>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-8_d285301612596283091c7adca68fe2ac">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>allopts <span class="ot">&lt;-</span> a <span class="sc">%&gt;%</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand</span>(site, datasources)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>a2 <span class="ot">&lt;-</span> a <span class="sc">%&gt;%</span> </span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">indata =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">right_join</span>(allopts) <span class="sc">%&gt;%</span> </span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">indata =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(indata), <span class="cn">FALSE</span>, indata))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining, by = c("site", "datasources")</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(a2, <span class="fu">aes</span>(<span class="at">x =</span> datasources, <span class="at">y =</span> site, <span class="at">fill =</span> indata)) <span class="sc">+</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_tile</span>(<span class="at">colour=</span><span class="st">"white"</span>, <span class="at">linewidth=</span><span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_discrete</span>(<span class="at">type =</span> <span class="fu">c</span>(<span class="st">'firebrick'</span>, <span class="st">'dodgerblue'</span>)) <span class="sc">+</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">fill =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">coord_equal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="vicwater_testing_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>Good enough for this one</strong>- turn that into a function in a package.</p>
</section>
</section>
<section id="test-from-the-package" class="level3">
<h3 class="anchored" data-anchor-id="test-from-the-package">Test from the package</h3>
<p>I’m using <code>devtools::load_all()</code> to load the package repo in here for interactive testing and poking.</p>
<p>Obviously, hard paths are a bad idea, but I’m going to do it here since I typically do relative within repos, and these are across repos. Still, temporary and hacky.</p>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-9_b9fa782b01374240a3c784e475efff41">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">load_all</span>(<span class="st">'C:/Users/Galen/Documents/vicwater'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>ℹ Loading vicwater</code></pre>
</div>
</div>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-10_0635be48b33eb2eb1e10d270dde1b8d1">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>returntib <span class="ot">&lt;-</span> <span class="fu">get_datasources_by_site</span>(vicurl, allsites)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-11_9fa048940e343490051b0c338b345816">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>returntib</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 2
   site   datasource
   &lt;chr&gt;  &lt;chr&gt;     
 1 233217 A         
 2 233217 TELEM     
 3 233217 TELEMCOPY 
 4 405328 A         
 5 405328 TELEM     
 6 405328 TELEMCOPY 
 7 405331 A         
 8 405331 TELEM     
 9 405837 A         
10 405837 TELEM     
11 405837 TELEMCOPY </code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_datasources_by_site</span>(returntib)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining, by = c("site", "datasource")</code></pre>
</div>
<div class="cell-output-display">
<p><img src="vicwater_testing_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="sites-by-datasource" class="level3">
<h3 class="anchored" data-anchor-id="sites-by-datasource">Sites by datasource</h3>
<p>Haven’t written this one before, might blow things up. But if we want a list of sites, it might be better than the way I did this before of just asking for everything in the db, lots of which had no data.</p>
<p>And now we know the datasource options. I think? I suppose it’s possible there’s another type I’m not aware of.</p>
<p>For some weird reason, sitelists should be <code>"site, site, site"</code>, while the datasources should be <code>c('source', 'source')</code>. The latter yields JSON array <code>['source', 'source']</code>, while the former yields JSON <code>'site', 'site'</code></p>
<p>This works. The list truncates, but it did work.</p>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-12_e3a19657fa5774b401421f23f47d2962">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>ds_wanted <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'A'</span>, <span class="st">'TELEM'</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>s_ds_params <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"function"</span> <span class="ot">=</span> <span class="st">'get_sites_by_datasource'</span>,</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">"version"</span> <span class="ot">=</span> <span class="st">"1"</span>,</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>               <span class="st">"params"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"datasources"</span> <span class="ot">=</span> ds_wanted))</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>reqvic <span class="sc">%&gt;%</span> </span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(s_ds_params) <span class="sc">%&gt;%</span> </span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_dry_run</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>POST /cgi/webservice.exe? HTTP/1.1
Host: data.water.vic.gov.au
User-Agent: httr2/0.2.2 r-curl/4.3.3 libcurl/7.64.1
Accept: */*
Accept-Encoding: deflate, gzip
Content-Type: application/json
Content-Length: 91

{"function":"get_sites_by_datasource","version":"1","params":{"datasources":["A","TELEM"]}}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>resp_s_ds <span class="ot">&lt;-</span> reqvic <span class="sc">%&gt;%</span> </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(s_ds_params) <span class="sc">%&gt;%</span> </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>rbody_s_ds <span class="ot">&lt;-</span> resp_s_ds <span class="sc">%&gt;%</span> <span class="fu">resp_body_json</span>(<span class="at">check_type =</span> <span class="cn">FALSE</span>)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(rbody_s_ds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ error_num: int 0
 $ return   :List of 1
  ..$ datasources:List of 2
  .. ..$ :List of 2
  .. .. ..$ datasource: chr "A"
  .. .. ..$ sites     :List of 4044
  .. .. .. ..$ : chr "100023"
  .. .. .. ..$ : chr "100500"
  .. .. .. ..$ : chr "100503"
  .. .. .. ..$ : chr "100504"
  .. .. .. ..$ : chr "101708"
  .. .. .. ..$ : chr "102621"
  .. .. .. ..$ : chr "102827"
  .. .. .. ..$ : chr "102828"
  .. .. .. ..$ : chr "102829"
  .. .. .. ..$ : chr "102830"
  .. .. .. ..$ : chr "102831"
  .. .. .. ..$ : chr "103811"
  .. .. .. ..$ : chr "104929"
  .. .. .. ..$ : chr "104930"
  .. .. .. ..$ : chr "105134"
  .. .. .. ..$ : chr "105222"
  .. .. .. ..$ : chr "105287"
  .. .. .. ..$ : chr "105317"
  .. .. .. ..$ : chr "105480"
  .. .. .. ..$ : chr "105484"
  .. .. .. ..$ : chr "105936"
  .. .. .. ..$ : chr "107631"
  .. .. .. ..$ : chr "107970"
  .. .. .. ..$ : chr "107971"
  .. .. .. ..$ : chr "108201"
  .. .. .. ..$ : chr "108203"
  .. .. .. ..$ : chr "108319"
  .. .. .. ..$ : chr "108320"
  .. .. .. ..$ : chr "108321"
  .. .. .. ..$ : chr "108898"
  .. .. .. ..$ : chr "108899"
  .. .. .. ..$ : chr "108917"
  .. .. .. ..$ : chr "108944"
  .. .. .. ..$ : chr "109133"
  .. .. .. ..$ : chr "109461"
  .. .. .. ..$ : chr "109462"
  .. .. .. ..$ : chr "109644"
  .. .. .. ..$ : chr "109645"
  .. .. .. ..$ : chr "109769"
  .. .. .. ..$ : chr "109770"
  .. .. .. ..$ : chr "109778"
  .. .. .. ..$ : chr "109779"
  .. .. .. ..$ : chr "110151"
  .. .. .. ..$ : chr "110152"
  .. .. .. ..$ : chr "110153"
  .. .. .. ..$ : chr "110171"
  .. .. .. ..$ : chr "110186"
  .. .. .. ..$ : chr "110464"
  .. .. .. ..$ : chr "110721"
  .. .. .. ..$ : chr "110724"
  .. .. .. ..$ : chr "110731"
  .. .. .. ..$ : chr "110739"
  .. .. .. ..$ : chr "110745"
  .. .. .. ..$ : chr "110943"
  .. .. .. ..$ : chr "110978"
  .. .. .. ..$ : chr "111543"
  .. .. .. ..$ : chr "111549"
  .. .. .. ..$ : chr "111551"
  .. .. .. ..$ : chr "111691"
  .. .. .. ..$ : chr "111692"
  .. .. .. ..$ : chr "112182"
  .. .. .. ..$ : chr "112235"
  .. .. .. ..$ : chr "112236"
  .. .. .. ..$ : chr "112237"
  .. .. .. ..$ : chr "112459"
  .. .. .. ..$ : chr "112708"
  .. .. .. ..$ : chr "112803"
  .. .. .. ..$ : chr "112804"
  .. .. .. ..$ : chr "113004"
  .. .. .. ..$ : chr "113124"
  .. .. .. ..$ : chr "113125"
  .. .. .. ..$ : chr "113467"
  .. .. .. ..$ : chr "113694"
  .. .. .. ..$ : chr "113695"
  .. .. .. ..$ : chr "113705"
  .. .. .. ..$ : chr "113706"
  .. .. .. ..$ : chr "114158"
  .. .. .. ..$ : chr "114169"
  .. .. .. ..$ : chr "115732"
  .. .. .. ..$ : chr "115872"
  .. .. .. ..$ : chr "116382"
  .. .. .. ..$ : chr "116459"
  .. .. .. ..$ : chr "116460"
  .. .. .. ..$ : chr "116802"
  .. .. .. ..$ : chr "116803"
  .. .. .. ..$ : chr "119329"
  .. .. .. ..$ : chr "119330"
  .. .. .. ..$ : chr "119337"
  .. .. .. ..$ : chr "119338"
  .. .. .. ..$ : chr "119339"
  .. .. .. ..$ : chr "119340"
  .. .. .. ..$ : chr "119341"
  .. .. .. ..$ : chr "119342"
  .. .. .. ..$ : chr "119347"
  .. .. .. ..$ : chr "119348"
  .. .. .. ..$ : chr "119366"
  .. .. .. ..$ : chr "119367"
  .. .. .. ..$ : chr "119377"
  .. .. .. ..$ : chr "120248"
  .. .. .. .. [list output truncated]
  .. ..$ :List of 2
  .. .. ..$ datasource: chr "TELEM"
  .. .. ..$ sites     :List of 2093
  .. .. .. ..$ : chr "100023"
  .. .. .. ..$ : chr "100500"
  .. .. .. ..$ : chr "100503"
  .. .. .. ..$ : chr "100504"
  .. .. .. ..$ : chr "100731"
  .. .. .. ..$ : chr "101708"
  .. .. .. ..$ : chr "102621"
  .. .. .. ..$ : chr "102827"
  .. .. .. ..$ : chr "102828"
  .. .. .. ..$ : chr "102829"
  .. .. .. ..$ : chr "102830"
  .. .. .. ..$ : chr "102831"
  .. .. .. ..$ : chr "103811"
  .. .. .. ..$ : chr "104929"
  .. .. .. ..$ : chr "104930"
  .. .. .. ..$ : chr "105134"
  .. .. .. ..$ : chr "105222"
  .. .. .. ..$ : chr "105484"
  .. .. .. ..$ : chr "105936"
  .. .. .. ..$ : chr "107631"
  .. .. .. ..$ : chr "107970"
  .. .. .. ..$ : chr "108201"
  .. .. .. ..$ : chr "108203"
  .. .. .. ..$ : chr "108319"
  .. .. .. ..$ : chr "108320"
  .. .. .. ..$ : chr "108321"
  .. .. .. ..$ : chr "108944"
  .. .. .. ..$ : chr "109133"
  .. .. .. ..$ : chr "109462"
  .. .. .. ..$ : chr "109644"
  .. .. .. ..$ : chr "109645"
  .. .. .. ..$ : chr "109769"
  .. .. .. ..$ : chr "109770"
  .. .. .. ..$ : chr "110151"
  .. .. .. ..$ : chr "110152"
  .. .. .. ..$ : chr "110153"
  .. .. .. ..$ : chr "110171"
  .. .. .. ..$ : chr "110186"
  .. .. .. ..$ : chr "110464"
  .. .. .. ..$ : chr "110721"
  .. .. .. ..$ : chr "110724"
  .. .. .. ..$ : chr "110731"
  .. .. .. ..$ : chr "110739"
  .. .. .. ..$ : chr "110745"
  .. .. .. ..$ : chr "110943"
  .. .. .. ..$ : chr "110978"
  .. .. .. ..$ : chr "111543"
  .. .. .. ..$ : chr "111549"
  .. .. .. ..$ : chr "111551"
  .. .. .. ..$ : chr "111691"
  .. .. .. ..$ : chr "111692"
  .. .. .. ..$ : chr "112182"
  .. .. .. ..$ : chr "112185"
  .. .. .. ..$ : chr "112235"
  .. .. .. ..$ : chr "112236"
  .. .. .. ..$ : chr "112237"
  .. .. .. ..$ : chr "112459"
  .. .. .. ..$ : chr "112708"
  .. .. .. ..$ : chr "112803"
  .. .. .. ..$ : chr "112804"
  .. .. .. ..$ : chr "113004"
  .. .. .. ..$ : chr "113124"
  .. .. .. ..$ : chr "113125"
  .. .. .. ..$ : chr "113467"
  .. .. .. ..$ : chr "113694"
  .. .. .. ..$ : chr "113695"
  .. .. .. ..$ : chr "113705"
  .. .. .. ..$ : chr "113706"
  .. .. .. ..$ : chr "114158"
  .. .. .. ..$ : chr "114169"
  .. .. .. ..$ : chr "114975"
  .. .. .. ..$ : chr "115732"
  .. .. .. ..$ : chr "116382"
  .. .. .. ..$ : chr "116802"
  .. .. .. ..$ : chr "116803"
  .. .. .. ..$ : chr "119329"
  .. .. .. ..$ : chr "119337"
  .. .. .. ..$ : chr "119340"
  .. .. .. ..$ : chr "119341"
  .. .. .. ..$ : chr "119342"
  .. .. .. ..$ : chr "119347"
  .. .. .. ..$ : chr "119348"
  .. .. .. ..$ : chr "119366"
  .. .. .. ..$ : chr "119367"
  .. .. .. ..$ : chr "119377"
  .. .. .. ..$ : chr "120248"
  .. .. .. ..$ : chr "121019"
  .. .. .. ..$ : chr "122152"
  .. .. .. ..$ : chr "123140"
  .. .. .. ..$ : chr "126975"
  .. .. .. ..$ : chr "129744"
  .. .. .. ..$ : chr "129746"
  .. .. .. ..$ : chr "134949"
  .. .. .. ..$ : chr "137194"
  .. .. .. ..$ : chr "137195"
  .. .. .. ..$ : chr "137197"
  .. .. .. ..$ : chr "137198"
  .. .. .. ..$ : chr "137199"
  .. .. .. ..$ : chr "137200"
  .. .. .. .. [list output truncated]</code></pre>
</div>
</div>
<p>Can I tibble that up?</p>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-13_872d6fe00b68e64eecdaac20f0b3c6a0">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(rbody_s_ds[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> <span class="co"># the [2] drops the error column</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(<span class="at">col =</span> <span class="fu">where</span>(is.list)) <span class="sc">%&gt;%</span> <span class="co"># a `return` list</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> <span class="fu">where</span>(is.list)) <span class="sc">%&gt;%</span> <span class="co"># sites, and a `datasource` list</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(<span class="at">col =</span> <span class="fu">where</span>(is.list)) <span class="co"># fully unpacked into a long df</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>s</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6,137 × 2
   datasource sites 
   &lt;chr&gt;      &lt;chr&gt; 
 1 A          100023
 2 A          100500
 3 A          100503
 4 A          100504
 5 A          101708
 6 A          102621
 7 A          102827
 8 A          102828
 9 A          102829
10 A          102830
# … with 6,127 more rows</code></pre>
</div>
</div>
<p>What are the number of sites in each?</p>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-14_4681e309d61f211b352fbeb1e79407f4">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>s <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(datasource) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  datasource     n
  &lt;chr&gt;      &lt;int&gt;
1 A           4044
2 TELEM       2093</code></pre>
</div>
</div>
<p>Way more in Archive. Are there any in Telem that aren’t in A?</p>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-15_684c94d3c1fa954a900b6df30155865e">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>tsites <span class="ot">&lt;-</span> s <span class="sc">%&gt;%</span> </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(datasource <span class="sc">==</span> <span class="st">'TELEM'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sites) <span class="sc">%&gt;%</span> </span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>()</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>asites <span class="ot">&lt;-</span> s <span class="sc">%&gt;%</span> </span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(datasource <span class="sc">==</span> <span class="st">'A'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sites) <span class="sc">%&gt;%</span> </span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>()</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a><span class="fu">all</span>(tsites <span class="sc">%in%</span> asites)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="sc">!</span>(tsites <span class="sc">%in%</span> asites))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 96</code></pre>
</div>
</div>
<p>see if I can blow up ggplot. Oof the plurals</p>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-16_685304f602011c840ec6f8c6d7710d7f">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> s <span class="sc">%&gt;%</span> </span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">site =</span> sites, <span class="at">datasources =</span> datasource)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Unreadable. Not surprisingly.</p>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-17_4b09a48bbd4753ebb82c7ac73c6a2c9a">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_datasources_by_site</span>(s) <span class="sc">+</span> <span class="fu">coord_flip</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>yikes.</p>
</section>
<section id="test-package-version" class="level3">
<h3 class="anchored" data-anchor-id="test-package-version">Test package version</h3>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-18_73e2a80bb9bc34ef3063397be6bb48da">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">load_all</span>(<span class="st">'C:/Users/Galen/Documents/vicwater'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>ℹ Loading vicwater</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>sxd <span class="ot">&lt;-</span> <span class="fu">get_sites_by_datasource</span>(<span class="at">datasources =</span> <span class="fu">c</span>(<span class="st">'A'</span>, <span class="st">'TELEM'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-19_22ffcc318001cefddba7e44e14ec5ef6">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>sxd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6,172 × 2
   datasource site  
   &lt;chr&gt;      &lt;chr&gt; 
 1 A          100023
 2 A          100500
 3 A          100503
 4 A          100504
 5 A          101708
 6 A          102621
 7 A          102827
 8 A          102828
 9 A          102829
10 A          102830
# … with 6,162 more rows</code></pre>
</div>
</div>
<p>Plot still needs work.</p>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-20_da1fbb96a11a078c31c46a752f8ca9aa">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_datasources_by_site</span>(sxd) <span class="sc">+</span> <span class="fu">coord_flip</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining, by = c("datasource", "site")</code></pre>
</div>
<div class="cell-output-display">
<p><img src="vicwater_testing_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="variables" class="level2">
<h2 class="anchored" data-anchor-id="variables">Variables</h2>
<p>or do I go straight for get_ts_ and then back this back out? Or get_db_info?</p>
<p>I think I’m going to want to use get_variable_list both in get_ts_traces and to generate a set of possible variables.</p>
<p>I’d like to get all sites, then make a master list of datasources and variables. But I need to get this usable for get_ts_traces, I think.</p>
<section id="get_variable_list" class="level3">
<h3 class="anchored" data-anchor-id="get_variable_list">Get_variable_list</h3>
<p>Feeding this a c(datasource, datasource) makes it return only some of the results, but throws no errors. So do one at a time.</p>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-21_465bd4f3853bd163f0a693317e8a274d">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>v_s_params <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"function"</span> <span class="ot">=</span> <span class="st">'get_variable_list'</span>,</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"version"</span> <span class="ot">=</span> <span class="st">"1"</span>,</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">"params"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"site_list"</span> <span class="ot">=</span> allsites,</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"datasource"</span> <span class="ot">=</span> <span class="st">"A"</span>))</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>req <span class="ot">&lt;-</span> <span class="fu">request</span>(vicurl)</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>req <span class="sc">%&gt;%</span> </span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(v_s_params) <span class="sc">%&gt;%</span> </span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_dry_run</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>POST /cgi/webservice.exe? HTTP/1.1
Host: data.water.vic.gov.au
User-Agent: httr2/0.2.2 r-curl/4.3.3 libcurl/7.64.1
Accept: */*
Accept-Encoding: deflate, gzip
Content-Type: application/json
Content-Length: 119

{"function":"get_variable_list","version":"1","params":{"site_list":"233217, 405328, 405331, 405837","datasource":"A"}}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>resp_v_s <span class="ot">&lt;-</span> req <span class="sc">%&gt;%</span> </span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(v_s_params) <span class="sc">%&gt;%</span> </span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>rbody_v_s <span class="ot">&lt;-</span> resp_v_s <span class="sc">%&gt;%</span> <span class="fu">resp_body_json</span>(<span class="at">check_type =</span> <span class="cn">FALSE</span>)</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(rbody_v_s)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ error_num: int 0
 $ return   :List of 1
  ..$ sites:List of 4
  .. ..$ :List of 3
  .. .. ..$ site_details:List of 3
  .. .. .. ..$ timezone  : chr "10.0"
  .. .. .. ..$ short_name: chr "BARWON @ GEELONG"
  .. .. .. ..$ name      : chr "BARWON RIVER @ GEELONG"
  .. .. ..$ variables   :List of 6
  .. .. .. ..$ :List of 6
  .. .. .. .. ..$ period_end  : chr "20221107070000"
  .. .. .. .. ..$ period_start: chr "19610306171500"
  .. .. .. .. ..$ subdesc     : chr "Available for release"
  .. .. .. .. ..$ variable    : chr "100.00"
  .. .. .. .. ..$ units       : chr "metres"
  .. .. .. .. ..$ name        : chr "Stream Water Level (m)"
  .. .. .. ..$ :List of 6
  .. .. .. .. ..$ period_end  : chr "20221107070000"
  .. .. .. .. ..$ period_start: chr "20100706123100"
  .. .. .. .. ..$ subdesc     : chr "Available for release"
  .. .. .. .. ..$ variable    : chr "210.00"
  .. .. .. .. ..$ units       : chr "pH"
  .. .. .. .. ..$ name        : chr "Acidity/Alkalinity (pH)"
  .. .. .. ..$ :List of 6
  .. .. .. .. ..$ period_end  : chr "20221107070000"
  .. .. .. .. ..$ period_start: chr "20100706123100"
  .. .. .. .. ..$ subdesc     : chr "Available for release"
  .. .. .. .. ..$ variable    : chr "215.00"
  .. .. .. .. ..$ units       : chr "ppm"
  .. .. .. .. ..$ name        : chr "Dissolved Oxygen (ppm)"
  .. .. .. ..$ :List of 6
  .. .. .. .. ..$ period_end  : chr "20221107070000"
  .. .. .. .. ..$ period_start: chr "20100706123100"
  .. .. .. .. ..$ subdesc     : chr "Available for release"
  .. .. .. .. ..$ variable    : chr "450.00"
  .. .. .. .. ..$ units       : chr "Degrees celsius"
  .. .. .. .. ..$ name        : chr "Water Temperature (°C)"
  .. .. .. ..$ :List of 6
  .. .. .. .. ..$ period_end  : chr "20221107070000"
  .. .. .. .. ..$ period_start: chr "20100706123100"
  .. .. .. .. ..$ subdesc     : chr "Available for release"
  .. .. .. .. ..$ variable    : chr "810.00"
  .. .. .. .. ..$ units       : chr "NTU"
  .. .. .. .. ..$ name        : chr "Turbidity (NTU)"
  .. .. .. ..$ :List of 6
  .. .. .. .. ..$ period_end  : chr "20221107070000"
  .. .. .. .. ..$ period_start: chr "20100706123100"
  .. .. .. .. ..$ subdesc     : chr "Available for release"
  .. .. .. .. ..$ variable    : chr "820.00"
  .. .. .. .. ..$ units       : chr "µS/cm@25°C"
  .. .. .. .. ..$ name        : chr "Conductivity (µS/cm)"
  .. .. ..$ site        : chr "233217"
  .. ..$ :List of 3
  .. .. ..$ site_details:List of 3
  .. .. .. ..$ timezone  : chr "10.0"
  .. .. .. ..$ short_name: chr "STEAVENSON R @ FALLS"
  .. .. .. ..$ name      : chr "STEAVENSON RIVER @ FALLS ROAD MARYSVILLE"
  .. .. ..$ variables   :List of 1
  .. .. .. ..$ :List of 6
  .. .. .. .. ..$ period_end  : chr "20221202090000"
  .. .. .. .. ..$ period_start: chr "20091119170800"
  .. .. .. .. ..$ subdesc     : chr "Available for release"
  .. .. .. .. ..$ variable    : chr "100.00"
  .. .. .. .. ..$ units       : chr "metres"
  .. .. .. .. ..$ name        : chr "Stream Water Level (m)"
  .. .. ..$ site        : chr "405328"
  .. ..$ :List of 3
  .. .. ..$ site_details:List of 3
  .. .. .. ..$ timezone  : chr "10.0"
  .. .. .. ..$ short_name: chr "TAGGERTY R LADY TALT"
  .. .. .. ..$ name      : chr "TAGGERTY RV @ LADY TALBOT DRIVE NEAR MARYSVILLE"
  .. .. ..$ variables   :List of 4
  .. .. .. ..$ :List of 6
  .. .. .. .. ..$ period_end  : chr "20130211110700"
  .. .. .. .. ..$ period_start: chr "20100729122000"
  .. .. .. .. ..$ subdesc     : chr "Available for release"
  .. .. .. .. ..$ variable    : chr "100.00"
  .. .. .. .. ..$ units       : chr "metres"
  .. .. .. .. ..$ name        : chr "Stream Water Level (m)"
  .. .. .. ..$ :List of 6
  .. .. .. .. ..$ period_end  : chr "20130211110700"
  .. .. .. .. ..$ period_start: chr "20100729122000"
  .. .. .. .. ..$ subdesc     : chr "Available for release"
  .. .. .. .. ..$ variable    : chr "450.00"
  .. .. .. .. ..$ units       : chr "Degrees celsius"
  .. .. .. .. ..$ name        : chr "Water Temperature (°C)"
  .. .. .. ..$ :List of 6
  .. .. .. .. ..$ period_end  : chr "20130211110700"
  .. .. .. .. ..$ period_start: chr "20100729122000"
  .. .. .. .. ..$ subdesc     : chr "Available for release"
  .. .. .. .. ..$ variable    : chr "810.00"
  .. .. .. .. ..$ units       : chr "NTU"
  .. .. .. .. ..$ name        : chr "Turbidity (NTU)"
  .. .. .. ..$ :List of 6
  .. .. .. .. ..$ period_end  : chr "20130211110700"
  .. .. .. .. ..$ period_start: chr "20100729122000"
  .. .. .. .. ..$ subdesc     : chr "Available for release"
  .. .. .. .. ..$ variable    : chr "820.00"
  .. .. .. .. ..$ units       : chr "µS/cm@25°C"
  .. .. .. .. ..$ name        : chr "Conductivity (µS/cm)"
  .. .. ..$ site        : chr "405331"
  .. ..$ :List of 3
  .. .. ..$ site_details:List of 3
  .. .. .. ..$ timezone  : chr "10.0"
  .. .. .. ..$ short_name: chr "R.G. MARYSVILLE"
  .. .. .. ..$ name      : chr "RAINGAUGE @ MARYSVILLE GOLF CLUB"
  .. .. ..$ variables   :List of 1
  .. .. .. ..$ :List of 6
  .. .. .. .. ..$ period_end  : chr "20221202081730"
  .. .. .. .. ..$ period_start: chr "20010621142700"
  .. .. .. .. ..$ subdesc     : chr "Available for release"
  .. .. .. .. ..$ variable    : chr "10.00"
  .. .. .. .. ..$ units       : chr "mm"
  .. .. .. .. ..$ name        : chr "Rainfall (mm)"
  .. .. ..$ site        : chr "405837"</code></pre>
</div>
</div>
<p>Unpack that</p>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-22_eca6d46a4c0ecbc9419ef6d95e397730">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(rbody_v_s[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> <span class="co"># the [2] drops the error column</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(<span class="at">col =</span> <span class="fu">where</span>(is.list)) <span class="sc">%&gt;%</span> <span class="co"># a `return` list</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> <span class="fu">where</span>(is.list)) <span class="sc">%&gt;%</span> <span class="co"># sites, and a `datasource` list</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> site_details) <span class="sc">%&gt;%</span> <span class="co"># site details in new cols</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(<span class="at">col =</span> variables) <span class="sc">%&gt;%</span> <span class="co"># one line per variable, details of variables in a list</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">long_name =</span> name) <span class="sc">%&gt;%</span> <span class="co"># variables have names too, avoid conflicts</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> variables) <span class="sc">%&gt;%</span> <span class="co"># columns for each attribute of the variables</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">var_name =</span> name)</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>s</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 10
   timezone short_…¹ long_…² perio…³ perio…⁴ subdesc varia…⁵ units var_n…⁶ site 
   &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;
 1 10.0     BARWON … BARWON… 202211… 196103… Availa… 100.00  metr… Stream… 2332…
 2 10.0     BARWON … BARWON… 202211… 201007… Availa… 210.00  pH    Acidit… 2332…
 3 10.0     BARWON … BARWON… 202211… 201007… Availa… 215.00  ppm   Dissol… 2332…
 4 10.0     BARWON … BARWON… 202211… 201007… Availa… 450.00  Degr… Water … 2332…
 5 10.0     BARWON … BARWON… 202211… 201007… Availa… 810.00  NTU   Turbid… 2332…
 6 10.0     BARWON … BARWON… 202211… 201007… Availa… 820.00  µS/c… Conduc… 2332…
 7 10.0     STEAVEN… STEAVE… 202212… 200911… Availa… 100.00  metr… Stream… 4053…
 8 10.0     TAGGERT… TAGGER… 201302… 201007… Availa… 100.00  metr… Stream… 4053…
 9 10.0     TAGGERT… TAGGER… 201302… 201007… Availa… 450.00  Degr… Water … 4053…
10 10.0     TAGGERT… TAGGER… 201302… 201007… Availa… 810.00  NTU   Turbid… 4053…
11 10.0     TAGGERT… TAGGER… 201302… 201007… Availa… 820.00  µS/c… Conduc… 4053…
12 10.0     R.G. MA… RAINGA… 202212… 200106… Availa… 10.00   mm    Rainfa… 4058…
# … with abbreviated variable names ¹​short_name, ²​long_name, ³​period_end,
#   ⁴​period_start, ⁵​variable, ⁶​var_name</code></pre>
</div>
</div>
</section>
<section id="test-package-version-1" class="level3">
<h3 class="anchored" data-anchor-id="test-package-version-1">Test package version</h3>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-23_3e2e2dfc3d11c92d80239780c87f332b">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">load_all</span>(<span class="st">'C:/Users/Galen/Documents/vicwater'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>ℹ Loading vicwater</code></pre>
</div>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>vl <span class="ot">&lt;-</span> <span class="fu">get_variable_list</span>(<span class="at">site_list =</span> allsites, <span class="at">datasource =</span> <span class="st">'A'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-24_9122f5f88f141d287039949287170f3e">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>vl</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 11
   site   short_…¹ long_…² varia…³ units var_n…⁴ perio…⁵ perio…⁶ subdesc datas…⁷
   &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  
 1 233217 BARWON … BARWON… 100.00  metr… Stream… 196103… 202211… Availa… A      
 2 233217 BARWON … BARWON… 210.00  pH    Acidit… 201007… 202211… Availa… A      
 3 233217 BARWON … BARWON… 215.00  ppm   Dissol… 201007… 202211… Availa… A      
 4 233217 BARWON … BARWON… 450.00  Degr… Water … 201007… 202211… Availa… A      
 5 233217 BARWON … BARWON… 810.00  NTU   Turbid… 201007… 202211… Availa… A      
 6 233217 BARWON … BARWON… 820.00  µS/c… Conduc… 201007… 202211… Availa… A      
 7 405328 STEAVEN… STEAVE… 100.00  metr… Stream… 200911… 202212… Availa… A      
 8 405331 TAGGERT… TAGGER… 100.00  metr… Stream… 201007… 201302… Availa… A      
 9 405331 TAGGERT… TAGGER… 450.00  Degr… Water … 201007… 201302… Availa… A      
10 405331 TAGGERT… TAGGER… 810.00  NTU   Turbid… 201007… 201302… Availa… A      
11 405331 TAGGERT… TAGGER… 820.00  µS/c… Conduc… 201007… 201302… Availa… A      
12 405837 R.G. MA… RAINGA… 10.00   mm    Rainfa… 200106… 202212… Availa… A      
# … with 1 more variable: timezone &lt;chr&gt;, and abbreviated variable names
#   ¹​short_name, ²​long_name, ³​variable, ⁴​var_name, ⁵​period_start, ⁶​period_end,
#   ⁷​datasource</code></pre>
</div>
</div>
<p>Try with two datasources</p>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-25_e6c7250994444a3a64ceceebbe11caf8">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>v2 <span class="ot">&lt;-</span> <span class="fu">get_variable_list</span>(<span class="at">site_list =</span> allsites, <span class="at">datasource =</span> <span class="fu">c</span>(<span class="st">'A'</span>, <span class="st">'TELEM'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-26_8c5f8822b7029eee8c506fc7a0fb29db">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>v2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 27 × 11
   site   short_…¹ long_…² varia…³ units var_n…⁴ perio…⁵ perio…⁶ subdesc datas…⁷
   &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  
 1 233217 BARWON … BARWON… 100.00  metr… Stream… 196103… 202211… Availa… A      
 2 233217 BARWON … BARWON… 210.00  pH    Acidit… 201007… 202211… Availa… A      
 3 233217 BARWON … BARWON… 215.00  ppm   Dissol… 201007… 202211… Availa… A      
 4 233217 BARWON … BARWON… 450.00  Degr… Water … 201007… 202211… Availa… A      
 5 233217 BARWON … BARWON… 810.00  NTU   Turbid… 201007… 202211… Availa… A      
 6 233217 BARWON … BARWON… 820.00  µS/c… Conduc… 201007… 202211… Availa… A      
 7 405328 STEAVEN… STEAVE… 100.00  metr… Stream… 200911… 202212… Availa… A      
 8 405331 TAGGERT… TAGGER… 100.00  metr… Stream… 201007… 201302… Availa… A      
 9 405331 TAGGERT… TAGGER… 450.00  Degr… Water … 201007… 201302… Availa… A      
10 405331 TAGGERT… TAGGER… 810.00  NTU   Turbid… 201007… 201302… Availa… A      
# … with 17 more rows, 1 more variable: timezone &lt;chr&gt;, and abbreviated
#   variable names ¹​short_name, ²​long_name, ³​variable, ⁴​var_name,
#   ⁵​period_start, ⁶​period_end, ⁷​datasource</code></pre>
</div>
</div>
<p>I think now go to get_ts_traces, and then go back and write some helpers that can call get_datasources and get_variable and geo-locate, and use them to allow passing things like variables = ‘all’</p>
</section>
</section>
<section id="get-traces" class="level2">
<h2 class="anchored" data-anchor-id="get-traces">get traces</h2>
<p>The basic format is this, will need to do some testing.</p>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-27_cc42566b3a79541b951b8823ecb8b28b">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>b1params <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"function"</span> <span class="ot">=</span> <span class="st">'get_ts_traces'</span>,</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"version"</span> <span class="ot">=</span> <span class="st">"2"</span>,</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">"params"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"site_list"</span> <span class="ot">=</span> barwon,</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"start_time"</span> <span class="ot">=</span> <span class="st">"20200101000000"</span>,</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"var_list"</span> <span class="ot">=</span> <span class="st">"100"</span>,</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"interval"</span> <span class="ot">=</span> <span class="st">"day"</span>,</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"datasource"</span> <span class="ot">=</span> <span class="st">"A"</span>, </span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"end_time"</span> <span class="ot">=</span> <span class="st">"20200115000000"</span>,</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"data_type"</span> <span class="ot">=</span> <span class="st">"mean"</span>,</span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"multiplier"</span> <span class="ot">=</span> <span class="st">"1"</span>))</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>req <span class="ot">&lt;-</span> <span class="fu">request</span>(vicurl)</span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>req <span class="sc">%&gt;%</span> </span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(b1params) <span class="sc">%&gt;%</span> </span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_dry_run</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>POST /cgi/webservice.exe? HTTP/1.1
Host: data.water.vic.gov.au
User-Agent: httr2/0.2.2 r-curl/4.3.3 libcurl/7.64.1
Accept: */*
Accept-Encoding: deflate, gzip
Content-Type: application/json
Content-Length: 219

{"function":"get_ts_traces","version":"2","params":{"site_list":"233217","start_time":"20200101000000","var_list":"100","interval":"day","datasource":"A","end_time":"20200115000000","data_type":"mean","multiplier":"1"}}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>respb1 <span class="ot">&lt;-</span> req <span class="sc">%&gt;%</span> </span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(b1params) <span class="sc">%&gt;%</span> </span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>rbodyb1 <span class="ot">&lt;-</span> respb1 <span class="sc">%&gt;%</span> <span class="fu">resp_body_json</span>(<span class="at">check_type =</span> <span class="cn">FALSE</span>)</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(rbodyb1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ error_num: int 0
 $ return   :List of 1
  ..$ traces:List of 1
  .. ..$ :List of 8
  .. .. ..$ error_num      : int 0
  .. .. ..$ compressed     : chr "0"
  .. .. ..$ site_details   :List of 6
  .. .. .. ..$ timezone  : chr "10.0"
  .. .. .. ..$ short_name: chr "BARWON @ GEELONG"
  .. .. .. ..$ longitude : chr "144.346892190"
  .. .. .. ..$ name      : chr "BARWON RIVER @ GEELONG"
  .. .. .. ..$ latitude  : chr "-38.163605590"
  .. .. .. ..$ org_name  : chr "Dept. Sustainability and Environment"
  .. .. ..$ quality_codes  :List of 2
  .. .. .. ..$ 2 : chr "Good quality data - minimal editing required. +/- 0mm - 10mm Drift correction"
  .. .. .. ..$ 15: chr "Minor editing. +/-11mm - 20mm drift correction"
  .. .. ..$ trace          :List of 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.838"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.834"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.827"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.821"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.816"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.814"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.811"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.802"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.791"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.805"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.831"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.824"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.820"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.812"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.817"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. ..$ varfrom_details:List of 6
  .. .. .. ..$ short_name: chr "Water Level (m)"
  .. .. .. ..$ precision : chr "0.001000"
  .. .. .. ..$ subdesc   : chr "Available for release"
  .. .. .. ..$ variable  : chr "100.00"
  .. .. .. ..$ units     : chr "metres"
  .. .. .. ..$ name      : chr "Stream Water Level (m)"
  .. .. ..$ site           : chr "233217"
  .. .. ..$ varto_details  :List of 6
  .. .. .. ..$ short_name: chr "Water Level (m)"
  .. .. .. ..$ precision : chr "0.001000"
  .. .. .. ..$ subdesc   : chr "Available for release"
  .. .. .. ..$ variable  : chr "100.00"
  .. .. .. ..$ units     : chr "metres"
  .. .. .. ..$ name      : chr "Stream Water Level (m)"</code></pre>
</div>
</div>
<p>and with two params</p>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-28_df6ff31a58e7badeca6f5ebd05372fe1">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>b2params <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"function"</span> <span class="ot">=</span> <span class="st">'get_ts_traces'</span>,</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"version"</span> <span class="ot">=</span> <span class="st">"2"</span>,</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">"params"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"site_list"</span> <span class="ot">=</span> barwon,</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"start_time"</span> <span class="ot">=</span> <span class="st">"20200101000000"</span>,</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"var_list"</span> <span class="ot">=</span> <span class="st">"100,210"</span>,</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"interval"</span> <span class="ot">=</span> <span class="st">"day"</span>,</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"datasource"</span> <span class="ot">=</span> <span class="st">"A"</span>, </span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"end_time"</span> <span class="ot">=</span> <span class="st">"20200115000000"</span>,</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"data_type"</span> <span class="ot">=</span> <span class="st">"mean"</span>,</span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"multiplier"</span> <span class="ot">=</span> <span class="st">"1"</span>))</span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>req <span class="ot">&lt;-</span> <span class="fu">request</span>(vicurl)</span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>req <span class="sc">%&gt;%</span> </span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(b2params) <span class="sc">%&gt;%</span> </span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_dry_run</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>POST /cgi/webservice.exe? HTTP/1.1
Host: data.water.vic.gov.au
User-Agent: httr2/0.2.2 r-curl/4.3.3 libcurl/7.64.1
Accept: */*
Accept-Encoding: deflate, gzip
Content-Type: application/json
Content-Length: 223

{"function":"get_ts_traces","version":"2","params":{"site_list":"233217","start_time":"20200101000000","var_list":"100,210","interval":"day","datasource":"A","end_time":"20200115000000","data_type":"mean","multiplier":"1"}}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>respb2 <span class="ot">&lt;-</span> req <span class="sc">%&gt;%</span> </span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(b2params) <span class="sc">%&gt;%</span> </span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>rbodyb2 <span class="ot">&lt;-</span> respb2 <span class="sc">%&gt;%</span> <span class="fu">resp_body_json</span>(<span class="at">check_type =</span> <span class="cn">FALSE</span>)</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(rbodyb2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ error_num: int 0
 $ return   :List of 1
  ..$ traces:List of 2
  .. ..$ :List of 8
  .. .. ..$ error_num      : int 0
  .. .. ..$ compressed     : chr "0"
  .. .. ..$ site_details   :List of 6
  .. .. .. ..$ timezone  : chr "10.0"
  .. .. .. ..$ short_name: chr "BARWON @ GEELONG"
  .. .. .. ..$ longitude : chr "144.346892190"
  .. .. .. ..$ name      : chr "BARWON RIVER @ GEELONG"
  .. .. .. ..$ latitude  : chr "-38.163605590"
  .. .. .. ..$ org_name  : chr "Dept. Sustainability and Environment"
  .. .. ..$ quality_codes  :List of 2
  .. .. .. ..$ 2 : chr "Good quality data - minimal editing required. +/- 0mm - 10mm Drift correction"
  .. .. .. ..$ 15: chr "Minor editing. +/-11mm - 20mm drift correction"
  .. .. ..$ trace          :List of 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.838"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.834"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.827"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.821"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.816"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.814"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.811"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.802"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.791"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.805"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.831"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.824"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.820"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.812"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.817"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. ..$ varfrom_details:List of 6
  .. .. .. ..$ short_name: chr "Water Level (m)"
  .. .. .. ..$ precision : chr "0.001000"
  .. .. .. ..$ subdesc   : chr "Available for release"
  .. .. .. ..$ variable  : chr "100.00"
  .. .. .. ..$ units     : chr "metres"
  .. .. .. ..$ name      : chr "Stream Water Level (m)"
  .. .. ..$ site           : chr "233217"
  .. .. ..$ varto_details  :List of 6
  .. .. .. ..$ short_name: chr "Water Level (m)"
  .. .. .. ..$ precision : chr "0.001000"
  .. .. .. ..$ subdesc   : chr "Available for release"
  .. .. .. ..$ variable  : chr "100.00"
  .. .. .. ..$ units     : chr "metres"
  .. .. .. ..$ name      : chr "Stream Water Level (m)"
  .. ..$ :List of 8
  .. .. ..$ error_num      : int 0
  .. .. ..$ compressed     : chr "0"
  .. .. ..$ site_details   :List of 6
  .. .. .. ..$ timezone  : chr "10.0"
  .. .. .. ..$ short_name: chr "BARWON @ GEELONG"
  .. .. .. ..$ longitude : chr "144.346892190"
  .. .. .. ..$ name      : chr "BARWON RIVER @ GEELONG"
  .. .. .. ..$ latitude  : chr "-38.163605590"
  .. .. .. ..$ org_name  : chr "Dept. Sustainability and Environment"
  .. .. ..$ quality_codes  :List of 1
  .. .. .. ..$ 2: chr "Good quality data - minimal editing required. +/- 0mm - 10mm Drift correction"
  .. .. ..$ trace          :List of 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.80"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.82"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.94"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.90"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.71"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.59"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.52"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.64"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.95"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "8.11"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "8.01"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "8.14"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.85"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.92"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.79"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. ..$ varfrom_details:List of 6
  .. .. .. ..$ short_name: chr "Field pH"
  .. .. .. ..$ precision : chr "0.010000"
  .. .. .. ..$ subdesc   : chr "Available for release"
  .. .. .. ..$ variable  : chr "210.00"
  .. .. .. ..$ units     : chr "pH"
  .. .. .. ..$ name      : chr "Acidity/Alkalinity (pH)"
  .. .. ..$ site           : chr "233217"
  .. .. ..$ varto_details  :List of 6
  .. .. .. ..$ short_name: chr "Field pH"
  .. .. .. ..$ precision : chr "0.010000"
  .. .. .. ..$ subdesc   : chr "Available for release"
  .. .. .. ..$ variable  : chr "210.00"
  .. .. .. ..$ units     : chr "pH"
  .. .. .. ..$ name      : chr "Acidity/Alkalinity (pH)"</code></pre>
</div>
</div>
<p>Two params, two sites (one site only has one var, but not an error, I hope)</p>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-29_c1d3f062245e053d9a8019a2d7bc63bf">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>b22params <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"function"</span> <span class="ot">=</span> <span class="st">'get_ts_traces'</span>,</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"version"</span> <span class="ot">=</span> <span class="st">"2"</span>,</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">"params"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"site_list"</span> <span class="ot">=</span> <span class="fu">str_c</span>(barwon, steavenson, <span class="at">sep =</span> <span class="st">", "</span>),</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"start_time"</span> <span class="ot">=</span> <span class="st">"20200101000000"</span>,</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"var_list"</span> <span class="ot">=</span> <span class="st">"100,210"</span>,</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"interval"</span> <span class="ot">=</span> <span class="st">"day"</span>,</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"datasource"</span> <span class="ot">=</span> <span class="st">"A"</span>, </span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"end_time"</span> <span class="ot">=</span> <span class="st">"20200115000000"</span>,</span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"data_type"</span> <span class="ot">=</span> <span class="st">"mean"</span>,</span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"multiplier"</span> <span class="ot">=</span> <span class="st">"1"</span>))</span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a>req <span class="ot">&lt;-</span> <span class="fu">request</span>(vicurl)</span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a>req <span class="sc">%&gt;%</span> </span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(b22params) <span class="sc">%&gt;%</span> </span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_dry_run</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>POST /cgi/webservice.exe? HTTP/1.1
Host: data.water.vic.gov.au
User-Agent: httr2/0.2.2 r-curl/4.3.3 libcurl/7.64.1
Accept: */*
Accept-Encoding: deflate, gzip
Content-Type: application/json
Content-Length: 231

{"function":"get_ts_traces","version":"2","params":{"site_list":"233217, 405328","start_time":"20200101000000","var_list":"100,210","interval":"day","datasource":"A","end_time":"20200115000000","data_type":"mean","multiplier":"1"}}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>respb22 <span class="ot">&lt;-</span> req <span class="sc">%&gt;%</span> </span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(b22params) <span class="sc">%&gt;%</span> </span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>rbodyb22 <span class="ot">&lt;-</span> respb22 <span class="sc">%&gt;%</span> <span class="fu">resp_body_json</span>(<span class="at">check_type =</span> <span class="cn">FALSE</span>)</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(rbodyb22)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ error_num: int 0
 $ return   :List of 1
  ..$ traces:List of 3
  .. ..$ :List of 8
  .. .. ..$ error_num      : int 0
  .. .. ..$ compressed     : chr "0"
  .. .. ..$ site_details   :List of 6
  .. .. .. ..$ timezone  : chr "10.0"
  .. .. .. ..$ short_name: chr "BARWON @ GEELONG"
  .. .. .. ..$ longitude : chr "144.346892190"
  .. .. .. ..$ name      : chr "BARWON RIVER @ GEELONG"
  .. .. .. ..$ latitude  : chr "-38.163605590"
  .. .. .. ..$ org_name  : chr "Dept. Sustainability and Environment"
  .. .. ..$ quality_codes  :List of 2
  .. .. .. ..$ 2 : chr "Good quality data - minimal editing required. +/- 0mm - 10mm Drift correction"
  .. .. .. ..$ 15: chr "Minor editing. +/-11mm - 20mm drift correction"
  .. .. ..$ trace          :List of 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.838"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.834"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.827"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.821"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.816"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.814"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.811"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.802"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.791"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.805"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.831"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.824"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.820"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.812"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.817"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. ..$ varfrom_details:List of 6
  .. .. .. ..$ short_name: chr "Water Level (m)"
  .. .. .. ..$ precision : chr "0.001000"
  .. .. .. ..$ subdesc   : chr "Available for release"
  .. .. .. ..$ variable  : chr "100.00"
  .. .. .. ..$ units     : chr "metres"
  .. .. .. ..$ name      : chr "Stream Water Level (m)"
  .. .. ..$ site           : chr "233217"
  .. .. ..$ varto_details  :List of 6
  .. .. .. ..$ short_name: chr "Water Level (m)"
  .. .. .. ..$ precision : chr "0.001000"
  .. .. .. ..$ subdesc   : chr "Available for release"
  .. .. .. ..$ variable  : chr "100.00"
  .. .. .. ..$ units     : chr "metres"
  .. .. .. ..$ name      : chr "Stream Water Level (m)"
  .. ..$ :List of 8
  .. .. ..$ error_num      : int 0
  .. .. ..$ compressed     : chr "0"
  .. .. ..$ site_details   :List of 6
  .. .. .. ..$ timezone  : chr "10.0"
  .. .. .. ..$ short_name: chr "BARWON @ GEELONG"
  .. .. .. ..$ longitude : chr "144.346892190"
  .. .. .. ..$ name      : chr "BARWON RIVER @ GEELONG"
  .. .. .. ..$ latitude  : chr "-38.163605590"
  .. .. .. ..$ org_name  : chr "Dept. Sustainability and Environment"
  .. .. ..$ quality_codes  :List of 1
  .. .. .. ..$ 2: chr "Good quality data - minimal editing required. +/- 0mm - 10mm Drift correction"
  .. .. ..$ trace          :List of 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.80"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.82"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.94"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.90"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.71"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.59"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.52"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.64"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.95"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "8.11"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "8.01"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "8.14"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.85"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.92"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "7.79"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. ..$ varfrom_details:List of 6
  .. .. .. ..$ short_name: chr "Field pH"
  .. .. .. ..$ precision : chr "0.010000"
  .. .. .. ..$ subdesc   : chr "Available for release"
  .. .. .. ..$ variable  : chr "210.00"
  .. .. .. ..$ units     : chr "pH"
  .. .. .. ..$ name      : chr "Acidity/Alkalinity (pH)"
  .. .. ..$ site           : chr "233217"
  .. .. ..$ varto_details  :List of 6
  .. .. .. ..$ short_name: chr "Field pH"
  .. .. .. ..$ precision : chr "0.010000"
  .. .. .. ..$ subdesc   : chr "Available for release"
  .. .. .. ..$ variable  : chr "210.00"
  .. .. .. ..$ units     : chr "pH"
  .. .. .. ..$ name      : chr "Acidity/Alkalinity (pH)"
  .. ..$ :List of 8
  .. .. ..$ error_num      : int 0
  .. .. ..$ compressed     : chr "0"
  .. .. ..$ site_details   :List of 6
  .. .. .. ..$ timezone  : chr "10.0"
  .. .. .. ..$ short_name: chr "STEAVENSON R @ FALLS"
  .. .. .. ..$ longitude : chr "145.773503100"
  .. .. .. ..$ name      : chr "STEAVENSON RIVER @ FALLS ROAD MARYSVILLE"
  .. .. .. ..$ latitude  : chr "-37.525797590"
  .. .. .. ..$ org_name  : chr "Victorian Rural Water Corporation"
  .. .. ..$ quality_codes  :List of 1
  .. .. .. ..$ 2: chr "Good quality data - minimal editing required. +/- 0mm - 10mm Drift correction"
  .. .. ..$ trace          :List of 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.741"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.738"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.736"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.734"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.741"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.755"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.745"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.739"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.735"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.745"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.759"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.745"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.742"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.740"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.757"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. ..$ varfrom_details:List of 6
  .. .. .. ..$ short_name: chr "Water Level (m)"
  .. .. .. ..$ precision : chr "0.001000"
  .. .. .. ..$ subdesc   : chr "Available for release"
  .. .. .. ..$ variable  : chr "100.00"
  .. .. .. ..$ units     : chr "metres"
  .. .. .. ..$ name      : chr "Stream Water Level (m)"
  .. .. ..$ site           : chr "405328"
  .. .. ..$ varto_details  :List of 6
  .. .. .. ..$ short_name: chr "Water Level (m)"
  .. .. .. ..$ precision : chr "0.001000"
  .. .. .. ..$ subdesc   : chr "Available for release"
  .. .. .. ..$ variable  : chr "100.00"
  .. .. .. ..$ units     : chr "metres"
  .. .. .. ..$ name      : chr "Stream Water Level (m)"</code></pre>
</div>
</div>
<p>I wasn’t able to get discharge (140, 141) from a varlist. Double check</p>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-30_1ea49f9f0e4e018dc9c3599ea34caa4b">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>bparamsd <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"function"</span> <span class="ot">=</span> <span class="st">'get_ts_traces'</span>,</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"version"</span> <span class="ot">=</span> <span class="st">"2"</span>,</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">"params"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"site_list"</span> <span class="ot">=</span> barwon,</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"start_time"</span> <span class="ot">=</span> <span class="st">"20200101000000"</span>,</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"var_list"</span> <span class="ot">=</span> <span class="st">"100,140"</span>,</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"interval"</span> <span class="ot">=</span> <span class="st">"day"</span>,</span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"datasource"</span> <span class="ot">=</span> <span class="st">"A"</span>, </span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"end_time"</span> <span class="ot">=</span> <span class="st">"20200115000000"</span>,</span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"data_type"</span> <span class="ot">=</span> <span class="st">"mean"</span>,</span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"multiplier"</span> <span class="ot">=</span> <span class="st">"1"</span>))</span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>req <span class="ot">&lt;-</span> <span class="fu">request</span>(vicurl)</span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a>req <span class="sc">%&gt;%</span> </span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(bparamsd) <span class="sc">%&gt;%</span> </span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_dry_run</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>POST /cgi/webservice.exe? HTTP/1.1
Host: data.water.vic.gov.au
User-Agent: httr2/0.2.2 r-curl/4.3.3 libcurl/7.64.1
Accept: */*
Accept-Encoding: deflate, gzip
Content-Type: application/json
Content-Length: 223

{"function":"get_ts_traces","version":"2","params":{"site_list":"233217","start_time":"20200101000000","var_list":"100,140","interval":"day","datasource":"A","end_time":"20200115000000","data_type":"mean","multiplier":"1"}}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>respbd <span class="ot">&lt;-</span> req <span class="sc">%&gt;%</span> </span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(bparamsd) <span class="sc">%&gt;%</span> </span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>rbodybd <span class="ot">&lt;-</span> respbd <span class="sc">%&gt;%</span> <span class="fu">resp_body_json</span>(<span class="at">check_type =</span> <span class="cn">FALSE</span>)</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(rbodybd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ error_num: int 0
 $ return   :List of 1
  ..$ traces:List of 1
  .. ..$ :List of 8
  .. .. ..$ error_num      : int 0
  .. .. ..$ compressed     : chr "0"
  .. .. ..$ site_details   :List of 6
  .. .. .. ..$ timezone  : chr "10.0"
  .. .. .. ..$ short_name: chr "BARWON @ GEELONG"
  .. .. .. ..$ longitude : chr "144.346892190"
  .. .. .. ..$ name      : chr "BARWON RIVER @ GEELONG"
  .. .. .. ..$ latitude  : chr "-38.163605590"
  .. .. .. ..$ org_name  : chr "Dept. Sustainability and Environment"
  .. .. ..$ quality_codes  :List of 2
  .. .. .. ..$ 2 : chr "Good quality data - minimal editing required. +/- 0mm - 10mm Drift correction"
  .. .. .. ..$ 15: chr "Minor editing. +/-11mm - 20mm drift correction"
  .. .. ..$ trace          :List of 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.838"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.834"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.827"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.821"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.816"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.814"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.811"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.802"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.791"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.805"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.831"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.824"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.820"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.812"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.817"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. ..$ varfrom_details:List of 6
  .. .. .. ..$ short_name: chr "Water Level (m)"
  .. .. .. ..$ precision : chr "0.001000"
  .. .. .. ..$ subdesc   : chr "Available for release"
  .. .. .. ..$ variable  : chr "100.00"
  .. .. .. ..$ units     : chr "metres"
  .. .. .. ..$ name      : chr "Stream Water Level (m)"
  .. .. ..$ site           : chr "233217"
  .. .. ..$ varto_details  :List of 6
  .. .. .. ..$ short_name: chr "Water Level (m)"
  .. .. .. ..$ precision : chr "0.001000"
  .. .. .. ..$ subdesc   : chr "Available for release"
  .. .. .. ..$ variable  : chr "100.00"
  .. .. .. ..$ units     : chr "metres"
  .. .. .. ..$ name      : chr "Stream Water Level (m)"</code></pre>
</div>
</div>
<p>Kisters has an example of asking for 140.01? Try that? No, just do the varfrom/varto method for discharge and stage.</p>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-31_f3b44f7664d24c9fe99d9eea344f5f8b">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>bparams <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"function"</span> <span class="ot">=</span> <span class="st">'get_ts_traces'</span>,</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"version"</span> <span class="ot">=</span> <span class="st">"2"</span>,</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">"params"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"site_list"</span> <span class="ot">=</span> barwon,</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"start_time"</span> <span class="ot">=</span> <span class="st">"20200101000000"</span>,</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"var_list"</span> <span class="ot">=</span> <span class="st">"100,140.01"</span>,</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"interval"</span> <span class="ot">=</span> <span class="st">"day"</span>,</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"datasource"</span> <span class="ot">=</span> <span class="st">"A"</span>, </span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"end_time"</span> <span class="ot">=</span> <span class="st">"20200115000000"</span>,</span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"data_type"</span> <span class="ot">=</span> <span class="st">"mean"</span>,</span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"multiplier"</span> <span class="ot">=</span> <span class="st">"1"</span>))</span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>req <span class="ot">&lt;-</span> <span class="fu">request</span>(vicurl)</span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a>req <span class="sc">%&gt;%</span> </span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(bparams) <span class="sc">%&gt;%</span> </span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_dry_run</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>POST /cgi/webservice.exe? HTTP/1.1
Host: data.water.vic.gov.au
User-Agent: httr2/0.2.2 r-curl/4.3.3 libcurl/7.64.1
Accept: */*
Accept-Encoding: deflate, gzip
Content-Type: application/json
Content-Length: 226

{"function":"get_ts_traces","version":"2","params":{"site_list":"233217","start_time":"20200101000000","var_list":"100,140.01","interval":"day","datasource":"A","end_time":"20200115000000","data_type":"mean","multiplier":"1"}}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>respb <span class="ot">&lt;-</span> req <span class="sc">%&gt;%</span> </span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(bparams) <span class="sc">%&gt;%</span> </span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>rbodyb <span class="ot">&lt;-</span> respb <span class="sc">%&gt;%</span> <span class="fu">resp_body_json</span>(<span class="at">check_type =</span> <span class="cn">FALSE</span>)</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(rbodyb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ error_num: int 0
 $ return   :List of 1
  ..$ traces:List of 1
  .. ..$ :List of 8
  .. .. ..$ error_num      : int 0
  .. .. ..$ compressed     : chr "0"
  .. .. ..$ site_details   :List of 6
  .. .. .. ..$ timezone  : chr "10.0"
  .. .. .. ..$ short_name: chr "BARWON @ GEELONG"
  .. .. .. ..$ longitude : chr "144.346892190"
  .. .. .. ..$ name      : chr "BARWON RIVER @ GEELONG"
  .. .. .. ..$ latitude  : chr "-38.163605590"
  .. .. .. ..$ org_name  : chr "Dept. Sustainability and Environment"
  .. .. ..$ quality_codes  :List of 2
  .. .. .. ..$ 2 : chr "Good quality data - minimal editing required. +/- 0mm - 10mm Drift correction"
  .. .. .. ..$ 15: chr "Minor editing. +/-11mm - 20mm drift correction"
  .. .. ..$ trace          :List of 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.838"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.834"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.827"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.821"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.816"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.814"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.811"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.802"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.791"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.805"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.831"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.824"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.820"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.812"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.817"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 2
  .. .. ..$ varfrom_details:List of 6
  .. .. .. ..$ short_name: chr "Water Level (m)"
  .. .. .. ..$ precision : chr "0.001000"
  .. .. .. ..$ subdesc   : chr "Available for release"
  .. .. .. ..$ variable  : chr "100.00"
  .. .. .. ..$ units     : chr "metres"
  .. .. .. ..$ name      : chr "Stream Water Level (m)"
  .. .. ..$ site           : chr "233217"
  .. .. ..$ varto_details  :List of 6
  .. .. .. ..$ short_name: chr "Water Level (m)"
  .. .. .. ..$ precision : chr "0.001000"
  .. .. .. ..$ subdesc   : chr "Available for release"
  .. .. .. ..$ variable  : chr "100.00"
  .. .. .. ..$ units     : chr "metres"
  .. .. .. ..$ name      : chr "Stream Water Level (m)"</code></pre>
</div>
</div>
<p>varfrom-varto check. Does it give us both, or do we have to ask for the from separately`?</p>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-32_a294617ec99f43826b9f6d2678e82696">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>bparamsft <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"function"</span> <span class="ot">=</span> <span class="st">'get_ts_traces'</span>,</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"version"</span> <span class="ot">=</span> <span class="st">"2"</span>,</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">"params"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"site_list"</span> <span class="ot">=</span> barwon,</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"start_time"</span> <span class="ot">=</span> <span class="st">"20200101000000"</span>,</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"varfrom"</span> <span class="ot">=</span> <span class="st">"100"</span>,</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"varto"</span> <span class="ot">=</span> <span class="st">"140"</span>, </span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"interval"</span> <span class="ot">=</span> <span class="st">"day"</span>,</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"datasource"</span> <span class="ot">=</span> <span class="st">"A"</span>, </span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"end_time"</span> <span class="ot">=</span> <span class="st">"20200115000000"</span>,</span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"data_type"</span> <span class="ot">=</span> <span class="st">"mean"</span>,</span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"multiplier"</span> <span class="ot">=</span> <span class="st">"1"</span>))</span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a>req <span class="ot">&lt;-</span> <span class="fu">request</span>(vicurl)</span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a>req <span class="sc">%&gt;%</span> </span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(bparamsft) <span class="sc">%&gt;%</span> </span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_dry_run</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>POST /cgi/webservice.exe? HTTP/1.1
Host: data.water.vic.gov.au
User-Agent: httr2/0.2.2 r-curl/4.3.3 libcurl/7.64.1
Accept: */*
Accept-Encoding: deflate, gzip
Content-Type: application/json
Content-Length: 232

{"function":"get_ts_traces","version":"2","params":{"site_list":"233217","start_time":"20200101000000","varfrom":"100","varto":"140","interval":"day","datasource":"A","end_time":"20200115000000","data_type":"mean","multiplier":"1"}}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>respbft <span class="ot">&lt;-</span> req <span class="sc">%&gt;%</span> </span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(bparamsft) <span class="sc">%&gt;%</span> </span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>rbodybft <span class="ot">&lt;-</span> respbft <span class="sc">%&gt;%</span> <span class="fu">resp_body_json</span>(<span class="at">check_type =</span> <span class="cn">FALSE</span>)</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(rbodybft)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ error_num: int 0
 $ return   :List of 1
  ..$ traces:List of 1
  .. ..$ :List of 8
  .. .. ..$ error_num      : int 0
  .. .. ..$ compressed     : chr "0"
  .. .. ..$ site_details   :List of 6
  .. .. .. ..$ timezone  : chr "10.0"
  .. .. .. ..$ short_name: chr "BARWON @ GEELONG"
  .. .. .. ..$ longitude : chr "144.346892190"
  .. .. .. ..$ name      : chr "BARWON RIVER @ GEELONG"
  .. .. .. ..$ latitude  : chr "-38.163605590"
  .. .. .. ..$ org_name  : chr "Dept. Sustainability and Environment"
  .. .. ..$ quality_codes  :List of 1
  .. .. .. ..$ 150: chr "Rating extrapolated above 1.5x maximum flow gauged."
  .. .. ..$ trace          :List of 15
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.18443"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.16332"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.12997"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.10202"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.08706"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.07811"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.07044"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.04782"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.02872"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.07961"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.14628"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.11425"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.09740"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.07464"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. .. ..$ :List of 3
  .. .. .. .. ..$ v: chr "0.11269"
  .. .. .. .. ..$ t: num 2.02e+13
  .. .. .. .. ..$ q: int 150
  .. .. ..$ varfrom_details:List of 6
  .. .. .. ..$ short_name: chr "Water Level (m)"
  .. .. .. ..$ precision : chr "0.001000"
  .. .. .. ..$ subdesc   : chr "Available for release"
  .. .. .. ..$ variable  : chr "100.00"
  .. .. .. ..$ units     : chr "metres"
  .. .. .. ..$ name      : chr "Stream Water Level (m)"
  .. .. ..$ site           : chr "233217"
  .. .. ..$ varto_details  :List of 6
  .. .. .. ..$ short_name: chr "Discharge (m3/sec)"
  .. .. .. ..$ precision : chr "0.000010"
  .. .. .. ..$ subdesc   : chr "Available for release"
  .. .. .. ..$ variable  : chr "140.00"
  .. .. .. ..$ units     : chr "cubic metres/second"
  .. .. .. ..$ name      : chr "Stream Discharge (m3/s)"</code></pre>
</div>
</div>
<p>That looks like it might have only given us varto.</p>
<p>What happens if we ask for a varto/from for a site that doesn’t have it? Earlier we saw that the varlist just skips, but does this?</p>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-33_d3a24e697aa6923ac70bd3773189ffc9">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>bparamse <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"function"</span> <span class="ot">=</span> <span class="st">'get_ts_traces'</span>,</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"version"</span> <span class="ot">=</span> <span class="st">"2"</span>,</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">"params"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"site_list"</span> <span class="ot">=</span> golf,</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"start_time"</span> <span class="ot">=</span> <span class="st">"20200101000000"</span>,</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"var_list"</span> <span class="ot">=</span> <span class="st">"100,210"</span>,</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"interval"</span> <span class="ot">=</span> <span class="st">"day"</span>,</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"datasource"</span> <span class="ot">=</span> <span class="st">"A"</span>, </span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"end_time"</span> <span class="ot">=</span> <span class="st">"20200115000000"</span>,</span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"data_type"</span> <span class="ot">=</span> <span class="st">"mean"</span>,</span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"multiplier"</span> <span class="ot">=</span> <span class="st">"1"</span>))</span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>req <span class="ot">&lt;-</span> <span class="fu">request</span>(vicurl)</span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a>req <span class="sc">%&gt;%</span> </span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(bparamse) <span class="sc">%&gt;%</span> </span>
<span id="cb95-16"><a href="#cb95-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_dry_run</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>POST /cgi/webservice.exe? HTTP/1.1
Host: data.water.vic.gov.au
User-Agent: httr2/0.2.2 r-curl/4.3.3 libcurl/7.64.1
Accept: */*
Accept-Encoding: deflate, gzip
Content-Type: application/json
Content-Length: 223

{"function":"get_ts_traces","version":"2","params":{"site_list":"405837","start_time":"20200101000000","var_list":"100,210","interval":"day","datasource":"A","end_time":"20200115000000","data_type":"mean","multiplier":"1"}}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>respbe <span class="ot">&lt;-</span> req <span class="sc">%&gt;%</span> </span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_body_json</span>(bparamse) <span class="sc">%&gt;%</span> </span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>rbodybe <span class="ot">&lt;-</span> respbe <span class="sc">%&gt;%</span> <span class="fu">resp_body_json</span>(<span class="at">check_type =</span> <span class="cn">FALSE</span>)</span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(rbodybe)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ error_num: int 125
 $ error_msg: chr "No data for specified variable in file"</code></pre>
</div>
</div>
<p>Ok, that errors. So I’ll need to capture and skip errors.</p>
<section id="unpack-different-formats" class="level3">
<h3 class="anchored" data-anchor-id="unpack-different-formats">unpack different formats</h3>
<p>(varlist with multiple, varfrom/to, etc). b1params (one param, one site), b2params (two params, varlist), b22params (two params, two sites- only one param at one site) bparamsft (varfrom/varto), bparamse (error),</p>
<p>start simple- grab errors. Should have been doing this all along.</p>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-34_357020aad1b0ff104c4becb0dba55deb">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>er1 <span class="ot">&lt;-</span> rbodyb1[<span class="dv">1</span>]</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>ere <span class="ot">&lt;-</span> rbodybe[<span class="dv">1</span>]</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>er1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$error_num
[1] 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>ere</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$error_num
[1] 125</code></pre>
</div>
</div>
<p>Unpack the single. Yeesh</p>
<p>I’m ignoring quality codes for the moment. They’re a definition list, and so maybe should be unpacked separately, matched to varto (I think not varfrom), and then joined? But I want to see how they work with more complex structures first.</p>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-35_8488483bcc83c73c26f50bbad3022f44">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(rbodyb1[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> <span class="co"># the [2] drops the error column</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(<span class="at">col =</span> <span class="fu">where</span>(is.list)) <span class="sc">%&gt;%</span> <span class="co"># a `return` list</span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> <span class="fu">where</span>(is.list)) <span class="sc">%&gt;%</span> <span class="co"># complex set of lists</span></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> site_details) <span class="sc">%&gt;%</span> <span class="co"># columns of info about the site</span></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">site_name =</span> name, <span class="at">site_short_name =</span> short_name) <span class="sc">%&gt;%</span> </span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># there are name conflicts between site and varfrom and varto. Not sure we need both varfrom and varto?</span></span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> varfrom_details) <span class="sc">%&gt;%</span> </span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span>(<span class="fu">paste0</span>(<span class="st">'varfrom_'</span>, .)), </span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a>              <span class="fu">c</span>(short_name, precision, subdesc, variable, units, name)) <span class="sc">%&gt;%</span> </span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> varto_details) <span class="sc">%&gt;%</span> </span>
<span id="cb103-11"><a href="#cb103-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span>(<span class="fu">paste0</span>(<span class="st">'varto_'</span>, .)), </span>
<span id="cb103-12"><a href="#cb103-12" aria-hidden="true" tabindex="-1"></a>              <span class="fu">c</span>(short_name, precision, subdesc, variable, units, name)) <span class="sc">%&gt;%</span> </span>
<span id="cb103-13"><a href="#cb103-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(<span class="at">col =</span> trace) <span class="sc">%&gt;%</span> </span>
<span id="cb103-14"><a href="#cb103-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> trace)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Try two variables. still works. still not sure why I need both varfrom and varto when they match.</p>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-36_6449ecea9bbba9c2492d9b7cb7b62473">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(rbodyb2[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> <span class="co"># the [2] drops the error column</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(<span class="at">col =</span> <span class="fu">where</span>(is.list)) <span class="sc">%&gt;%</span> <span class="co"># a `return` list</span></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> <span class="fu">where</span>(is.list)) <span class="sc">%&gt;%</span> <span class="co"># complex set of lists</span></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> site_details) <span class="sc">%&gt;%</span> <span class="co"># columns of info about the site</span></span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">site_name =</span> name, <span class="at">site_short_name =</span> short_name) <span class="sc">%&gt;%</span> </span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># there are name conflicts between site and varfrom and varto. Not sure we need both varfrom and varto?</span></span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> varfrom_details) <span class="sc">%&gt;%</span> </span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span>(<span class="fu">paste0</span>(<span class="st">'varfrom_'</span>, .)), </span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a>              <span class="fu">c</span>(short_name, precision, subdesc, variable, units, name)) <span class="sc">%&gt;%</span> </span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> varto_details) <span class="sc">%&gt;%</span> </span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span>(<span class="fu">paste0</span>(<span class="st">'varto_'</span>, .)), </span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a>              <span class="fu">c</span>(short_name, precision, subdesc, variable, units, name)) <span class="sc">%&gt;%</span> </span>
<span id="cb104-13"><a href="#cb104-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(<span class="at">col =</span> trace) <span class="sc">%&gt;%</span> </span>
<span id="cb104-14"><a href="#cb104-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> trace)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Two variables, two sites</p>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-37_1edefdec01b9af483ffa147c31177f14">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(rbodyb22[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> <span class="co"># the [2] drops the error column</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(<span class="at">col =</span> <span class="fu">where</span>(is.list)) <span class="sc">%&gt;%</span> <span class="co"># a `return` list</span></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> <span class="fu">where</span>(is.list)) <span class="sc">%&gt;%</span> <span class="co"># complex set of lists</span></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> site_details) <span class="sc">%&gt;%</span> <span class="co"># columns of info about the site</span></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">site_name =</span> name, <span class="at">site_short_name =</span> short_name) <span class="sc">%&gt;%</span> </span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># there are name conflicts between site and varfrom and varto. Not sure we need both varfrom and varto?</span></span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> varfrom_details) <span class="sc">%&gt;%</span> </span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span>(<span class="fu">paste0</span>(<span class="st">'varfrom_'</span>, .)), </span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a>              <span class="fu">c</span>(short_name, precision, subdesc, variable, units, name)) <span class="sc">%&gt;%</span> </span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> varto_details) <span class="sc">%&gt;%</span> </span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span>(<span class="fu">paste0</span>(<span class="st">'varto_'</span>, .)), </span>
<span id="cb105-12"><a href="#cb105-12" aria-hidden="true" tabindex="-1"></a>              <span class="fu">c</span>(short_name, precision, subdesc, variable, units, name)) <span class="sc">%&gt;%</span> </span>
<span id="cb105-13"><a href="#cb105-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(<span class="at">col =</span> trace) <span class="sc">%&gt;%</span> </span>
<span id="cb105-14"><a href="#cb105-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> trace)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And finally, the one where we do have a varto</p>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-38_d061b14d68d1d0aba718721a82ff81e7">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(rbodybft[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> <span class="co"># the [2] drops the error column</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(<span class="at">col =</span> <span class="fu">where</span>(is.list)) <span class="sc">%&gt;%</span> <span class="co"># a `return` list</span></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> <span class="fu">where</span>(is.list)) <span class="sc">%&gt;%</span> <span class="co"># complex set of lists</span></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> site_details) <span class="sc">%&gt;%</span> <span class="co"># columns of info about the site</span></span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">site_name =</span> name, <span class="at">site_short_name =</span> short_name) <span class="sc">%&gt;%</span> </span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># there are name conflicts between site and varfrom and varto. Not sure we need both varfrom and varto?</span></span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> varfrom_details) <span class="sc">%&gt;%</span> </span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span>(<span class="fu">paste0</span>(<span class="st">'varfrom_'</span>, .)), </span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a>              <span class="fu">c</span>(short_name, precision, subdesc, variable, units, name)) <span class="sc">%&gt;%</span> </span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> varto_details) <span class="sc">%&gt;%</span> </span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span>(<span class="fu">paste0</span>(<span class="st">'varto_'</span>, .)), </span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a>              <span class="fu">c</span>(short_name, precision, subdesc, variable, units, name)) <span class="sc">%&gt;%</span> </span>
<span id="cb106-13"><a href="#cb106-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(<span class="at">col =</span> trace) <span class="sc">%&gt;%</span> </span>
<span id="cb106-14"><a href="#cb106-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> trace)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, some new q values. and pretty clear we don’t need the varfroms.</p>
<p>Need to change the time column to dates</p>
<p>Do we want to split up or return stacked or return wide? Make an option.</p>
<p>Do we want to return NA days as NA or skip them?</p>
</section>
<section id="cleaning-that-up" class="level3">
<h3 class="anchored" data-anchor-id="cleaning-that-up">Cleaning that up</h3>
<p>safest is code x site x varto. though I think don’t need site, we’ll have expanded there by the time we get varto.</p>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-39_246d2c2e2d178d2c432f504a2eca6480">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(rbodyb22[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> <span class="co"># the [2] drops the error column</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(<span class="at">col =</span> <span class="fu">where</span>(is.list)) <span class="sc">%&gt;%</span> <span class="co"># a `return` list</span></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> <span class="fu">where</span>(is.list)) <span class="sc">%&gt;%</span> <span class="co"># complex set of lists</span></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> site_details) <span class="sc">%&gt;%</span> <span class="co"># columns of info about the site</span></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">site_name =</span> name, <span class="at">site_short_name =</span> short_name) <span class="sc">%&gt;%</span> </span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># there are name conflicts between site and varfrom and varto. </span></span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># and we can drop varfrom</span></span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>varfrom_details) <span class="sc">%&gt;%</span> </span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> varto_details) <span class="sc">%&gt;%</span> </span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span>(<span class="fu">paste0</span>(<span class="st">'variable_'</span>, .)), </span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a>              <span class="fu">c</span>(short_name, name)) </span>
<span id="cb107-12"><a href="#cb107-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-13"><a href="#cb107-13" aria-hidden="true" tabindex="-1"></a><span class="co"># break in here to get the quality codes to match</span></span>
<span id="cb107-14"><a href="#cb107-14" aria-hidden="true" tabindex="-1"></a>qc <span class="ot">&lt;-</span> s <span class="sc">%&gt;%</span> </span>
<span id="cb107-15"><a href="#cb107-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(quality_codes, site, variable) <span class="sc">%&gt;%</span> </span>
<span id="cb107-16"><a href="#cb107-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(<span class="at">col =</span> quality_codes) <span class="sc">%&gt;%</span> </span>
<span id="cb107-17"><a href="#cb107-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">quality_codes_id =</span> <span class="fu">as.integer</span>(quality_codes_id))</span>
<span id="cb107-18"><a href="#cb107-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-19"><a href="#cb107-19" aria-hidden="true" tabindex="-1"></a><span class="co"># finish unpacking</span></span>
<span id="cb107-20"><a href="#cb107-20" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> s <span class="sc">%&gt;%</span></span>
<span id="cb107-21"><a href="#cb107-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>quality_codes) <span class="sc">%&gt;%</span> </span>
<span id="cb107-22"><a href="#cb107-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(<span class="at">col =</span> trace) <span class="sc">%&gt;%</span> </span>
<span id="cb107-23"><a href="#cb107-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> trace)</span>
<span id="cb107-24"><a href="#cb107-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-25"><a href="#cb107-25" aria-hidden="true" tabindex="-1"></a><span class="co"># clean up</span></span>
<span id="cb107-26"><a href="#cb107-26" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> s <span class="sc">%&gt;%</span> </span>
<span id="cb107-27"><a href="#cb107-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">value =</span> v, <span class="at">time =</span> t, <span class="at">quality_codes_id =</span> q) <span class="sc">%&gt;%</span> </span>
<span id="cb107-28"><a href="#cb107-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">time =</span> lubridate<span class="sc">::</span><span class="fu">ymd_hms</span>(time)) <span class="sc">%&gt;%</span> </span>
<span id="cb107-29"><a href="#cb107-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(qc, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'quality_codes_id'</span>, <span class="st">'site'</span>, <span class="st">'variable'</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb107-30"><a href="#cb107-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(longitude, latitude, value), as.numeric)) <span class="co"># leaving some others because they either are names (gauges, variable) or display better (precision)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Can I make that wide? Works without using <code>id_cols</code> but messy because too many info cols. Would end up being better to cut and join the info back on. But then I lose the quality codes, because they apply to each variable differently. Just return like this for now with a warning.</p>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-40_a96fa5e29574157c7c424d02d43c6808">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>sw <span class="ot">&lt;-</span> s <span class="sc">%&gt;%</span> <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> variable, <span class="at">values_from =</span> value, <span class="at">id_cols =</span> <span class="fu">c</span>(time, site))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>What I could do though is break it up into a list, potentially by sites and/or variables.</p>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-41_7653e1d7ec72185f33478fbdb9aca016">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>slist <span class="ot">&lt;-</span> <span class="fu">split</span>(s, s<span class="sc">$</span>site)</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>vlist <span class="ot">&lt;-</span> <span class="fu">split</span>(s, s<span class="sc">$</span>variable)</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>svlist <span class="ot">&lt;-</span> <span class="fu">split</span>(s, <span class="fu">interaction</span>(s<span class="sc">$</span>site, s<span class="sc">$</span>variable))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="test-package-version-2" class="level3">
<h3 class="anchored" data-anchor-id="test-package-version-2">Test package version</h3>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-42_b2fbbfb517c05ce72381724be3aeb3d0">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">load_all</span>(<span class="st">'C:/Users/Galen/Documents/vicwater'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>ℹ Loading vicwater</code></pre>
</div>
</div>
<p>One site, one variable</p>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-43_356a7144fc411ccf715105b6de8028cd">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>bs <span class="ot">&lt;-</span> <span class="fu">get_ts_traces</span>(<span class="at">site_list =</span> barwon, <span class="at">datasource =</span> <span class="st">'A'</span>, <span class="at">var_list =</span> <span class="st">'100'</span>, <span class="at">start_time =</span> <span class="st">'20200101'</span>, <span class="at">end_time =</span> <span class="st">'20200105'</span>, <span class="at">interval =</span> <span class="st">'day'</span>, <span class="at">data_type =</span> <span class="st">'mean'</span>, <span class="at">multiplier =</span> <span class="dv">1</span>, <span class="at">returnformat =</span> <span class="st">'df'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: executing %dopar% sequentially: no parallel backend registered</code></pre>
</div>
</div>
<p>Can I pass decimals? it’s how they come out of get_variable_list</p>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-44_a8a880da9d9c1fc2b61d57b0117b7a11">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>bsdec <span class="ot">&lt;-</span> <span class="fu">get_ts_traces</span>(<span class="at">site_list =</span> barwon, <span class="at">datasource =</span> <span class="st">'A'</span>, <span class="at">var_list =</span> <span class="st">'100.00'</span>, <span class="at">start_time =</span> <span class="st">'20200101'</span>, <span class="at">end_time =</span> <span class="st">'20200105'</span>, <span class="at">interval =</span> <span class="st">'day'</span>, <span class="at">data_type =</span> <span class="st">'mean'</span>, <span class="at">multiplier =</span> <span class="dv">1</span>, <span class="at">returnformat =</span> <span class="st">'df'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>One site, derived variables</p>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-45_0330e96948a3380efe8bb04b19e06886">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>bsd <span class="ot">&lt;-</span> <span class="fu">get_ts_traces</span>(<span class="at">site_list =</span> barwon, <span class="at">datasource =</span> <span class="st">'A'</span>, <span class="at">var_list =</span> <span class="fu">c</span>(<span class="st">'100'</span>, <span class="st">'140'</span>), <span class="at">start_time =</span> <span class="st">'20200101'</span>, <span class="at">end_time =</span> <span class="st">'20200105'</span>, <span class="at">interval =</span> <span class="st">'day'</span>, <span class="at">data_type =</span> <span class="st">'mean'</span>, <span class="at">multiplier =</span> <span class="dv">1</span>, <span class="at">returnformat =</span> <span class="st">'df'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Only derived</p>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-46_3891aa19db8fa5e09a755720cd18fd6c">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>bsod <span class="ot">&lt;-</span> <span class="fu">get_ts_traces</span>(<span class="at">site_list =</span> barwon, <span class="at">datasource =</span> <span class="st">'A'</span>, <span class="at">var_list =</span> <span class="st">'140'</span>, <span class="at">start_time =</span> <span class="st">'20200101'</span>, <span class="at">end_time =</span> <span class="st">'20200105'</span>, <span class="at">interval =</span> <span class="st">'day'</span>, <span class="at">data_type =</span> <span class="st">'mean'</span>, <span class="at">multiplier =</span> <span class="dv">1</span>, <span class="at">returnformat =</span> <span class="st">'df'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Some more variables, derived and not</p>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-47_97ff97a784cf88c8dad45e93c3daf0f2">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>bsdv <span class="ot">&lt;-</span> <span class="fu">get_ts_traces</span>(<span class="at">site_list =</span> barwon, <span class="at">datasource =</span> <span class="st">'A'</span>, <span class="at">var_list =</span> <span class="fu">c</span>(<span class="st">'100'</span>, <span class="st">'140'</span>, <span class="st">'210'</span>, <span class="st">'450'</span>), <span class="at">start_time =</span> <span class="st">'20200101'</span>, <span class="at">end_time =</span> <span class="st">'20200105'</span>, <span class="at">interval =</span> <span class="st">'day'</span>, <span class="at">data_type =</span> <span class="st">'mean'</span>, <span class="at">multiplier =</span> <span class="dv">1</span>, <span class="at">returnformat =</span> <span class="st">'df'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And multi-sites too- does it correctly collapse the vector?</p>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-48_05080070cc59ad3870ad3c7fb9fc2fa9">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>bsdvs <span class="ot">&lt;-</span> <span class="fu">get_ts_traces</span>(<span class="at">site_list =</span> <span class="fu">c</span>(barwon, steavenson), </span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">datasource =</span> <span class="st">'A'</span>, </span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">var_list =</span> <span class="fu">c</span>(<span class="st">'100'</span>, <span class="st">'140'</span>, <span class="st">'210'</span>, <span class="st">'450'</span>), </span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">start_time =</span> <span class="st">'20200101'</span>, <span class="at">end_time =</span> <span class="st">'20200105'</span>, </span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">interval =</span> <span class="st">'day'</span>, <span class="at">data_type =</span> <span class="st">'mean'</span>, </span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">multiplier =</span> <span class="dv">1</span>, <span class="at">returnformat =</span> <span class="st">'df'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And finally everything including rain at golf. Careful though- does mean make sense for that? Probably better as a sum? Tried that and threw an error but told me the options:</p>
<p>Mean/Max/Min/Start/End/First/Last/Tot/MaxMin/Point/Cum</p>
<p><strong>Definitely need two calls if need two different values</strong> at least for now- total temp is nonsense.</p>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-49_29059b9deaab1ec2f4b6e0fc2113a79a">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>bsdvs <span class="ot">&lt;-</span> <span class="fu">get_ts_traces</span>(<span class="at">site_list =</span> allsites, </span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">datasource =</span> <span class="st">'A'</span>, </span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">var_list =</span> <span class="fu">c</span>(<span class="st">'10'</span>, <span class="st">'100'</span>, <span class="st">'140'</span>, <span class="st">'210'</span>, <span class="st">'450'</span>), </span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">start_time =</span> <span class="st">'20200101'</span>, <span class="at">end_time =</span> <span class="st">'20200105'</span>, </span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">interval =</span> <span class="st">'day'</span>, <span class="at">data_type =</span> <span class="st">'mean'</span>, </span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">multiplier =</span> <span class="dv">1</span>, <span class="at">returnformat =</span> <span class="st">'df'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and return a list</p>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-50_fdd9e60f0e6909d19f695bd592931b90">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>bsdvsl <span class="ot">&lt;-</span> <span class="fu">get_ts_traces</span>(<span class="at">site_list =</span> allsites, </span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">datasource =</span> <span class="st">'A'</span>, </span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">var_list =</span> <span class="fu">c</span>(<span class="st">'10'</span>, <span class="st">'100'</span>, <span class="st">'140'</span>, <span class="st">'210'</span>, <span class="st">'450'</span>), </span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">start_time =</span> <span class="st">'20200101'</span>, <span class="at">end_time =</span> <span class="st">'20200105'</span>, </span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">interval =</span> <span class="st">'day'</span>, <span class="at">data_type =</span> <span class="st">'mean'</span>, </span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">multiplier =</span> <span class="dv">1</span>, <span class="at">returnformat =</span> <span class="st">'sxvlist'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="a-variable-and-time-aware-version" class="level2">
<h2 class="anchored" data-anchor-id="a-variable-and-time-aware-version">A variable and time-aware version</h2>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-51_077894b283b5785f00e5cff7eac63245">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>possibles <span class="ot">&lt;-</span> <span class="fu">get_variable_list</span>(<span class="at">site_list =</span> allsites, <span class="at">datasource =</span> <span class="st">'A'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(site, datasource, variable, period_start, period_end)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-52_897c9202c320d82989f6a0507ae59dca">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>poss140 <span class="ot">&lt;-</span> possibles[possibles<span class="sc">$</span>variable <span class="sc">==</span> <span class="st">'100.00'</span>, ] </span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>poss141 <span class="ot">&lt;-</span> poss140</span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>poss140<span class="sc">$</span>variable <span class="ot">&lt;-</span> <span class="st">'140.00'</span></span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a>poss141<span class="sc">$</span>variable <span class="ot">&lt;-</span> <span class="st">'141.00'</span></span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a>possibles <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(possibles, poss140, poss141)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>all the tests above should run</strong></p>
<section id="test-package-version-3" class="level3">
<h3 class="anchored" data-anchor-id="test-package-version-3">Test package version</h3>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-53_3536356b4bd347b711cd1fd4b221b531">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">load_all</span>(<span class="st">'C:/Users/Galen/Documents/vicwater'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>ℹ Loading vicwater</code></pre>
</div>
</div>
<p>One site, one variable</p>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-54_daa0ea79dc717cba367af97a8760be3d">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>bs <span class="ot">&lt;-</span> <span class="fu">get_ts_traces2</span>(<span class="at">site_list =</span> barwon, <span class="at">datasource =</span> <span class="st">'A'</span>, <span class="at">var_list =</span> <span class="st">'100'</span>, <span class="at">start_time =</span> <span class="st">'20200101'</span>, <span class="at">end_time =</span> <span class="st">'20200105'</span>, <span class="at">interval =</span> <span class="st">'day'</span>, <span class="at">data_type =</span> <span class="st">'mean'</span>, <span class="at">multiplier =</span> <span class="dv">1</span>, <span class="at">returnformat =</span> <span class="st">'df'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Can I pass decimals? it’s how they come out of get_variable_list</p>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-55_7b2ce14e1b5b3e43a42f68b40989ae3e">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>bsdec <span class="ot">&lt;-</span> <span class="fu">get_ts_traces2</span>(<span class="at">site_list =</span> barwon, <span class="at">datasource =</span> <span class="st">'A'</span>, <span class="at">var_list =</span> <span class="st">'100.00'</span>, <span class="at">start_time =</span> <span class="st">'20200101'</span>, <span class="at">end_time =</span> <span class="st">'20200105'</span>, <span class="at">interval =</span> <span class="st">'day'</span>, <span class="at">data_type =</span> <span class="st">'mean'</span>, <span class="at">multiplier =</span> <span class="dv">1</span>, <span class="at">returnformat =</span> <span class="st">'df'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>One site, derived variables</p>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-56_41c822cc0b8ab3fe7fe1be89c59a1040">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>bsd <span class="ot">&lt;-</span> <span class="fu">get_ts_traces2</span>(<span class="at">site_list =</span> barwon, <span class="at">datasource =</span> <span class="st">'A'</span>, <span class="at">var_list =</span> <span class="fu">c</span>(<span class="st">'100'</span>, <span class="st">'140'</span>, <span class="st">'141'</span>), <span class="at">start_time =</span> <span class="st">'20200101'</span>, <span class="at">end_time =</span> <span class="st">'20200105'</span>, <span class="at">interval =</span> <span class="st">'day'</span>, <span class="at">data_type =</span> <span class="st">'mean'</span>, <span class="at">multiplier =</span> <span class="dv">1</span>, <span class="at">returnformat =</span> <span class="st">'df'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Only derived</p>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-57_588db067665e3027e2aea5cad374ab3a">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>bsod <span class="ot">&lt;-</span> <span class="fu">get_ts_traces2</span>(<span class="at">site_list =</span> barwon, <span class="at">datasource =</span> <span class="st">'A'</span>, <span class="at">var_list =</span> <span class="st">'140'</span>, <span class="at">start_time =</span> <span class="st">'20200101'</span>, <span class="at">end_time =</span> <span class="st">'20200105'</span>, <span class="at">interval =</span> <span class="st">'day'</span>, <span class="at">data_type =</span> <span class="st">'mean'</span>, <span class="at">multiplier =</span> <span class="dv">1</span>, <span class="at">returnformat =</span> <span class="st">'df'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Some more variables, derived and not</p>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-58_715652a70b1682e5ef77f80e988b7fea">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>bsdv <span class="ot">&lt;-</span> <span class="fu">get_ts_traces2</span>(<span class="at">site_list =</span> barwon, <span class="at">datasource =</span> <span class="st">'A'</span>, <span class="at">var_list =</span> <span class="fu">c</span>(<span class="st">'100'</span>, <span class="st">'140'</span>, <span class="st">'210'</span>, <span class="st">'450'</span>), <span class="at">start_time =</span> <span class="st">'20200101'</span>, <span class="at">end_time =</span> <span class="st">'20200105'</span>, <span class="at">interval =</span> <span class="st">'day'</span>, <span class="at">data_type =</span> <span class="st">'mean'</span>, <span class="at">multiplier =</span> <span class="dv">1</span>, <span class="at">returnformat =</span> <span class="st">'df'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And multi-sites too- does it correctly collapse the vector?</p>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-59_a11b02c1180dee133dcf6aa55e6e9822">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>bsdvs <span class="ot">&lt;-</span> <span class="fu">get_ts_traces2</span>(<span class="at">site_list =</span> <span class="fu">c</span>(barwon, steavenson), </span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">datasource =</span> <span class="st">'A'</span>, </span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">var_list =</span> <span class="fu">c</span>(<span class="st">'100'</span>, <span class="st">'140'</span>, <span class="st">'210'</span>, <span class="st">'450'</span>), </span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">start_time =</span> <span class="st">'20200101'</span>, <span class="at">end_time =</span> <span class="st">'20200105'</span>, </span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">interval =</span> <span class="st">'day'</span>, <span class="at">data_type =</span> <span class="st">'mean'</span>, </span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">multiplier =</span> <span class="dv">1</span>, <span class="at">returnformat =</span> <span class="st">'df'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Do the ‘all’ settings work? Let’s bump to year so I don’t have so much data</p>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-60_a9650bf160ec6e2379b46f4a3679e60d">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>bsdvs <span class="ot">&lt;-</span> <span class="fu">get_ts_traces2</span>(<span class="at">site_list =</span> <span class="fu">c</span>(barwon, steavenson), </span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">datasource =</span> <span class="st">'A'</span>, </span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">var_list =</span> <span class="st">"all"</span>, </span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">start_time =</span> <span class="st">"all"</span>, </span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">end_time =</span> <span class="st">"all"</span>, </span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">interval =</span> <span class="st">'year'</span>, <span class="at">data_type =</span> <span class="st">'mean'</span>, </span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">multiplier =</span> <span class="dv">1</span>, <span class="at">returnformat =</span> <span class="st">'df'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `var_list = 'all'` is *very* dangerous, since it applies the same
`data_type` to all variables, which is rarely appropriate. Check the variables
available for your sites and make sure you want to do this.</code></pre>
</div>
</div>
<p>Can I throw something wrong to interval to see if it tells me what it can do? Kisters says</p>
<p>year, month, day, hour, minute, second,<br>
period,<br>
default</p>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-61_cbf9e53d13609d0f4ad481b56773978e">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>biw <span class="ot">&lt;-</span> <span class="fu">get_ts_traces2</span>(<span class="at">site_list =</span> barwon, </span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">datasource =</span> <span class="st">'A'</span>, </span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">var_list =</span> <span class="st">"100"</span>, </span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">start_time =</span> <span class="st">"20200101"</span>, </span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">end_time =</span> <span class="st">"20211231"</span>, </span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">interval =</span> <span class="st">'eon'</span>, <span class="at">data_type =</span> <span class="st">'mean'</span>, </span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">multiplier =</span> <span class="dv">1</span>, <span class="at">returnformat =</span> <span class="st">'df'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>error is Invalid interval, must be YEAR, MONTH, DAY, HOUR, MINUTE or SECOND</p>
</section>
</section>
<section id="benchmark" class="level2">
<h2 class="anchored" data-anchor-id="benchmark">Benchmark</h2>
<p>This likely varies a lot depending on what I’m asking for. Should be done more systematically, and use microbenchmark.</p>
<p>They should be roughly the same for a single?</p>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-62_f75a07f0ffa05c37342fdd561f4a2241">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(b1 <span class="ot">&lt;-</span> <span class="fu">get_ts_traces</span>(<span class="at">site_list =</span> barwon, </span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">datasource =</span> <span class="st">'A'</span>, </span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">var_list =</span> <span class="st">'100'</span>, </span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">start_time =</span> <span class="st">'20200101'</span>, <span class="at">end_time =</span> <span class="st">'20200105'</span>, </span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">interval =</span> <span class="st">'day'</span>, <span class="at">data_type =</span> <span class="st">'mean'</span>, </span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">multiplier =</span> <span class="dv">1</span>, <span class="at">returnformat =</span> <span class="st">'df'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   user  system elapsed 
   0.10    0.00    0.86 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(b2 <span class="ot">&lt;-</span> <span class="fu">get_ts_traces2</span>(<span class="at">site_list =</span> barwon, </span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">datasource =</span> <span class="st">'A'</span>, </span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">var_list =</span> <span class="st">'100'</span>, </span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">start_time =</span> <span class="st">'20200101'</span>, <span class="at">end_time =</span> <span class="st">'20200105'</span>, </span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">interval =</span> <span class="st">'day'</span>, <span class="at">data_type =</span> <span class="st">'mean'</span>, </span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">multiplier =</span> <span class="dv">1</span>, <span class="at">returnformat =</span> <span class="st">'df'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   user  system elapsed 
   0.17    0.01    1.50 </code></pre>
</div>
</div>
<p>interesting. so the second is faster locally, but higher network, I think.</p>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-63_776c95beb062d530dbe0b783fdd6b5c3">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(bsdvs1 <span class="ot">&lt;-</span> <span class="fu">get_ts_traces</span>(<span class="at">site_list =</span> <span class="fu">c</span>(barwon, steavenson), </span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">datasource =</span> <span class="st">'A'</span>, </span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">var_list =</span> <span class="fu">c</span>(<span class="st">'100'</span>, <span class="st">'140'</span>, <span class="st">'210'</span>, <span class="st">'450'</span>), </span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">start_time =</span> <span class="st">'20200101'</span>, <span class="at">end_time =</span> <span class="st">'20200105'</span>, </span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">interval =</span> <span class="st">'day'</span>, <span class="at">data_type =</span> <span class="st">'mean'</span>, </span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">multiplier =</span> <span class="dv">1</span>, <span class="at">returnformat =</span> <span class="st">'df'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   user  system elapsed 
   0.16    0.02    1.71 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(bsdvs2 <span class="ot">&lt;-</span> <span class="fu">get_ts_traces2</span>(<span class="at">site_list =</span> <span class="fu">c</span>(barwon, steavenson), </span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">datasource =</span> <span class="st">'A'</span>, </span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">var_list =</span> <span class="fu">c</span>(<span class="st">'100'</span>, <span class="st">'140'</span>, <span class="st">'210'</span>, <span class="st">'450'</span>), </span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">start_time =</span> <span class="st">'20200101'</span>, <span class="at">end_time =</span> <span class="st">'20200105'</span>, </span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">interval =</span> <span class="st">'day'</span>, <span class="at">data_type =</span> <span class="st">'mean'</span>, </span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">multiplier =</span> <span class="dv">1</span>, <span class="at">returnformat =</span> <span class="st">'df'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   user  system elapsed 
   0.25    0.01    5.69 </code></pre>
</div>
</div>
<p>Oof. That’s pretty bad. Can I speed it up? probably.</p>
<p>How about parallel?</p>
<div class="cell" data-hash="vicwater_testing_cache/html/unnamed-chunk-64_ef032b60194dcfc62ceafdfb76f76e74">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(doFuture)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: foreach</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'foreach' was built under R version 4.2.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: future</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'future' was built under R version 4.2.2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="fu">registerDoFuture</span>()</span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plan</span>(multisession)</span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(bsdvs1p <span class="ot">&lt;-</span> <span class="fu">get_ts_traces</span>(<span class="at">site_list =</span> <span class="fu">c</span>(barwon, steavenson), </span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">datasource =</span> <span class="st">'A'</span>, </span>
<span id="cb147-6"><a href="#cb147-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">var_list =</span> <span class="fu">c</span>(<span class="st">'100'</span>, <span class="st">'140'</span>, <span class="st">'210'</span>, <span class="st">'450'</span>), </span>
<span id="cb147-7"><a href="#cb147-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">start_time =</span> <span class="st">'20200101'</span>, <span class="at">end_time =</span> <span class="st">'20200105'</span>, </span>
<span id="cb147-8"><a href="#cb147-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">interval =</span> <span class="st">'day'</span>, <span class="at">data_type =</span> <span class="st">'mean'</span>, </span>
<span id="cb147-9"><a href="#cb147-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">multiplier =</span> <span class="dv">1</span>, <span class="at">returnformat =</span> <span class="st">'df'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   user  system elapsed 
   0.04    0.00    2.81 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(bsdvs2p <span class="ot">&lt;-</span> <span class="fu">get_ts_traces2</span>(<span class="at">site_list =</span> <span class="fu">c</span>(barwon, steavenson), </span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">datasource =</span> <span class="st">'A'</span>, </span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">var_list =</span> <span class="fu">c</span>(<span class="st">'100'</span>, <span class="st">'140'</span>, <span class="st">'210'</span>, <span class="st">'450'</span>), </span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">start_time =</span> <span class="st">'20200101'</span>, <span class="at">end_time =</span> <span class="st">'20200105'</span>, </span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">interval =</span> <span class="st">'day'</span>, <span class="at">data_type =</span> <span class="st">'mean'</span>, </span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">multiplier =</span> <span class="dv">1</span>, <span class="at">returnformat =</span> <span class="st">'df'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   user  system elapsed 
   0.06    0.00    3.67 </code></pre>
</div>
</div>
</section>
<section id="todo" class="level1">
<h1>TODO</h1>
<p>List of all datasources and variables and sites in the db - cross-reffed? Not sure</p>
<p>List of variable numbers and their names in a readable table (vignette?)</p>
<p>List of possible data_type functions</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>